var ae=Object.defineProperty;var le=(M,e,t)=>e in M?ae(M,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):M[e]=t;var v=(M,e,t)=>le(M,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const ce="modulepreload",de=function(M){return"/Armchair-General/"+M},Z={},U=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){let s=function(d){return Promise.all(d.map(a=>Promise.resolve(a).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));n=s(t.map(d=>{if(d=de(d),d in Z)return;Z[d]=!0;const a=d.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${c}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":ce,a||(h.as="script"),h.crossOrigin="",h.href=d,l&&h.setAttribute("nonce",l),document.head.appendChild(h),a)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return n.then(s=>{for(const i of s||[])i.status==="rejected"&&r(i.reason);return e().catch(r)})};class he{constructor(e=[]){v(this,"countries");this.countries=e}}const oe=Math.sqrt(3),ue=.5*(oe-1),H=(3-oe)/6,ee=M=>Math.floor(M)|0,te=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function K(M=Math.random){const e=fe(M),t=new Float64Array(e).map(n=>te[n%12*2]),o=new Float64Array(e).map(n=>te[n%12*2+1]);return function(r,s){let i=0,l=0,d=0;const a=(r+s)*ue,c=ee(r+a),h=ee(s+a),f=(c+h)*H,g=c-f,u=h-f,y=r-g,m=s-u;let w,p;y>m?(w=1,p=0):(w=0,p=1);const C=y-w+H,b=m-p+H,x=y-1+2*H,k=m-1+2*H,E=c&255,S=h&255;let T=.5-y*y-m*m;if(T>=0){const A=E+e[S],$=t[A],F=o[A];T*=T,i=T*T*($*y+F*m)}let I=.5-C*C-b*b;if(I>=0){const A=E+w+e[S+p],$=t[A],F=o[A];I*=I,l=I*I*($*C+F*b)}let N=.5-x*x-k*k;if(N>=0){const A=E+1+e[S+1],$=t[A],F=o[A];N*=N,d=N*N*($*x+F*k)}return 70*(i+l+d)}}function fe(M){const t=new Uint8Array(512);for(let o=0;o<512/2;o++)t[o]=o;for(let o=0;o<512/2-1;o++){const n=o+~~(M()*(256-o)),r=t[o];t[o]=t[n],t[n]=r}for(let o=256;o<512;o++)t[o]=t[o-256];return t}function me(M,e,t,o=1e3){var d;const n=M.length,r=((d=M[0])==null?void 0:d.length)||0,s=Array.from({length:n},()=>Array(r).fill(!1)),i=[[1,0],[-1,0],[0,1],[0,-1]],l=M.map(a=>a.slice());for(let a=0;a<n;a++)for(let c=0;c<r;c++)if(!s[a][c]&&M[a][c]===t){const h=[[a,c]],f=[[a,c]];for(s[a][c]=!0;h.length;){const[g,u]=h.shift();for(const[y,m]of i){const w=g+y,p=u+m;w>=0&&w<n&&p>=0&&p<r&&!s[w][p]&&M[w][p]===t&&(s[w][p]=!0,h.push([w,p]),f.push([w,p]))}}if(f.length<o)for(const[g,u]of f)l[g][u]=e}return l}function ye(M,e,t){var d;const o=M.length,n=((d=M[0])==null?void 0:d.length)||0,r=Array.from({length:o},()=>Array(n).fill(!1)),s=[];for(let a=0;a<n;a++)M[0][a]===e&&(s.push([0,a]),r[0][a]=!0),M[o-1][a]===e&&(s.push([o-1,a]),r[o-1][a]=!0);for(let a=1;a<o-1;a++)M[a][0]===e&&(s.push([a,0]),r[a][0]=!0),M[a][n-1]===e&&(s.push([a,n-1]),r[a][n-1]=!0);const i=[[1,0],[-1,0],[0,1],[0,-1]];for(;s.length;){const[a,c]=s.shift();for(const[h,f]of i){const g=a+h,u=c+f;g>=0&&g<o&&u>=0&&u<n&&!r[g][u]&&M[g][u]===e&&(r[g][u]=!0,s.push([g,u]))}}return M.map((a,c)=>a.map((h,f)=>h===e&&!r[c][f]?t:h))}function pe(M,e){return re(M,e,{scale:.0018,threshold:-.05,borderStrength:.5,borderWidth:.15,octaves:6,persistence:.5,seed:Math.floor(Math.random()*1e9)})}function re(M,e,t){const o=(t==null?void 0:t.scale)??.015,n=(t==null?void 0:t.threshold)??0,r=(t==null?void 0:t.seed)!==void 0?ge(t.seed):Math.random,s=K(r),i=(t==null?void 0:t.borderStrength)??.5,l=(t==null?void 0:t.borderWidth)??.2,d=(t==null?void 0:t.octaves)??4,a=(t==null?void 0:t.persistence)??.5,c=[];for(let f=0;f<e;f++){const g=[];for(let u=0;u<M;u++){const y=u-M/2,m=f-e/2;let w=0,p=0,C=1,b=1;for(let T=0;T<d;T++)w+=s(y*o*C,m*o*C)*b,p+=b,b*=a,C*=2;w/=p;const x=Math.min(u,M-1-u)/(M/2),k=Math.min(f,e-1-f)/(e/2),E=Math.min(x,k);let S=w;if(E<l){const T=i*(1-E/l);S=w*(1-T)+D*T}g.push(S>n?z:D)}c.push(g)}let h=ye(c,D,z);return h=me(h,D,z,1e3),h}function ge(M){return function(){let e=M+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}class we{constructor(e,t=null,o=0,n=0){v(this,"name");v(this,"owner");v(this,"armies");v(this,"income");v(this,"coordinates");v(this,"border");v(this,"oceanBorder");v(this,"neighbors");v(this,"color");v(this,"fortified",!1);v(this,"_center",null);this.name=e,this.owner=t,this.armies=o,this.income=n,this.coordinates=[],this.border=[],this.oceanBorder=[],this.neighbors=[],this.color=[Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150)]}setOwner(e){this.owner=e}setArmies(e){this.armies=e}center(){if(this._center)return this._center;if(!this.coordinates.length)return this._center=[0,0],this._center;let e=0,t=0;for(const[o,n]of this.coordinates)e+=o,t+=n;return this._center=[e/this.coordinates.length,t/this.coordinates.length],this._center}canBeFortified(){if(this.fortified)return!1;if(this.owner){for(const[e,t]of this.owner.plannedFortifications)if(e===this)return!1}return!0}}class be{static generateCountriesMap(e,t={}){if(!e||e.length===0||!e[0])throw new Error("continentMap must be a non-empty 2D array");const o=e.length,n=e[0].length,r=t.countryCount??12,s=t.scale??.09,i=t.minResistance??10,l=t.maxResistance??50,d=t.skipProbability??.9,a=t.seed!==void 0?Ce(t.seed):Math.random,c=K(a),h=[];for(let p=0;p<o;p++){const C=[];for(let b=0;b<n;b++)C.push(e[p][b]===z?i+(l-i)*Math.abs(c(b*s,p*s)):1/0);h.push(C)}const f=[],g=[];for(let p=0;p<o;p++)for(let C=0;C<n;C++)e[p][C]===z&&g.push([C,p]);for(let p=0;p<r&&g.length>0;p++){const C=Math.floor(a()*g.length),[b,x]=g.splice(C,1)[0];f.push({x:b,y:x,idx:p})}for(let p=0;p<o;p++)for(let C=0;C<n;C++)e[p][C]!==D&&(e[p][C]=z);for(const{x:p,y:C,idx:b}of f)e[C][p]=b;const u=f.map(({x:p,y:C,idx:b})=>[p,C,b]),y=(i+l)/2;for(;u.length>0;){const p=Math.floor(a()*u.length),[C,b,x]=u.splice(p,1)[0],k=[];for(const[E,S]of[[1,0],[0,1],[-1,0],[0,-1]]){const T=C+E,I=b+S;T>=0&&T<n&&I>=0&&I<o&&e[I][T]===z&&k.push([T,I])}if(k.length!==0)for(const[E,S]of k)h[S][E]>y&&a()<d||(e[S][E]=x,u.push([E,S,x]))}const m=Array.from({length:o},()=>Array(n).fill(!1));let w=0;for(let p=0;p<o;p++)for(let C=0;C<n;C++)e[p][C]>=0&&e[p][C]+1>w&&(w=e[p][C]+1);for(let p=0;p<o;p++)for(let C=0;C<n;C++)if(e[p][C]===z&&!m[p][C]){const b=[[C,p]];for(m[p][C]=!0;b.length>0;){const[x,k]=b.pop();e[k][x]=w;for(const[E,S]of[[1,0],[0,1],[-1,0],[0,-1]]){const T=x+E,I=k+S;T>=0&&T<n&&I>=0&&I<o&&e[I][T]===z&&!m[I][T]&&(b.push([T,I]),m[I][T]=!0)}}w++}return e}static generateCountriesInternal(e,t){const o=this.generateCountriesMap(e,t);if(!o||o.length===0||!o[0])throw new Error("map must be a non-empty 2D array");const n=o.length,r=o[0].length,s={};for(let d=0;d<n;d++)for(let a=0;a<r;a++){const c=o[d][a];if(c>=0){if(!s[c]){const h=new we(`Country ${c}`);h.id=c,s[c]=h}s[c].coordinates.push([a,d])}}const i=Math.max(...Object.keys(s).map(Number)),l=Array.from({length:i+1},(d,a)=>s[a]);return this.findCountryBorders(o,l,r,n),{map:o,countries:l}}static findCountryBorders(e,t,o,n){const r=[[1,0],[0,1],[-1,0],[0,-1]];for(const s of t){const i=s.id;s.border=[],s.oceanBorder=[];for(const[l,d]of s.coordinates){let a=!1,c=!1;for(const[h,f]of r){const g=l+h,u=d+f;(g<0||g>=o||u<0||u>=n||e[u][g]!==i)&&(a=!0,(g<0||g>=o||u<0||u>=n||e[u][g]===D)&&(c=!0))}a&&s.border.push([l,d]),c&&s.oceanBorder.push([l,d])}}}static findNeighbors(e){const t=new Map;for(const o of e)for(const[n,r]of o.border)t.set(`${n},${r}`,o);for(const o of e){const n=new Set;for(const[r,s]of o.border)for(const[i,l]of[[1,0],[0,1],[-1,0],[0,-1]]){const d=r+i,a=s+l,c=t.get(`${d},${a}`);c&&c!==o&&n.add(c)}o.neighbors=Array.from(n)}}static mergeSmallCountries(e,t=1e3){let o=!0;for(;o;){o=!1;for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.coordinates.length<t&&r.neighbors.length>0){let s=r.neighbors[0];for(const i of r.neighbors)i.coordinates.length<s.coordinates.length&&(s=i);s.coordinates.push(...r.coordinates),e.splice(n,1),o=!0}}o&&this.findNeighbors(e)}}static generateCountries(e,t={}){const{map:o,countries:n}=this.generateCountriesInternal(e,t);this.findNeighbors(n);const r=(t==null?void 0:t.minCountrySize)??1e3;if(this.mergeSmallCountries(n,r),!o||o.length===0||!o[0])throw new Error("map must be a non-empty 2D array");const s=o[0].length,i=o.length;return this.findCountryBorders(o,n,s,i),this.findNeighbors(n),{map:o,countries:n}}}function Ce(M){return function(){let e=M+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function xe(M,e){return be.generateCountries(M,{countryCount:e,minResistance:0,maxResistance:130,skipProbability:0})}const D=-1,z=-2,q=class q{constructor(e,t,o=[]){v(this,"countries");v(this,"map");v(this,"continents",[]);this.countries=o,this.map=q.createOceanMap(e,t)}static logCountryNamesInOrder(e,t=""){const o=e.map((n,r)=>`${r}: ${n.name}`);console.log(`[WorldMap] Country order${t?" - "+t:""}:
`+o.join(", "))}static checkMapCountryConsistency(e,t){if(!Array.isArray(e)||!Array.isArray(t))return console.error("[WorldMap] Consistency check failed: map or countries not arrays"),!1;let o=!0;for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r){const s=e[n][r];s>=0&&(t[s]?typeof t[s].name!="string"&&(console.error(`[WorldMap] Inconsistent: countries[${s}] has no valid name at map[${n}][${r}]`),o=!1):(console.error(`[WorldMap] Inconsistent: map[${n}][${r}] = ${s}, but countries[${s}] is undefined`),o=!1))}return o}assignRandomCountryNames(){let e=!1;for(;!e;){const t=new Set;for(const o of this.countries){let n,r=0;do if(n=q.generateRandomName(),r++,r>1e3)throw new Error("Failed to generate unique random country names");while(t.has(n));o.name=n,t.add(n)}e=t.size===this.countries.length}}assignRealCountryNames(){let e=!1;for(;!e;){const t=[...q.REAL_COUNTRY_NAMES],o=new Set;for(const n of this.countries){let r;if(t.length>0){const s=Math.floor(Math.random()*t.length);r=t.splice(s,1)[0]}else{let s=0;do if(r=q.generateRandomName(),s++,s>1e3)throw new Error("Failed to generate unique fallback country names");while(o.has(r))}n.name=r,o.add(r)}e=o.size===this.countries.length}}static generateRandomName(){const e=["zan","mor","vek","tal","rin","dor","lek","sha","val","nor","ka","bel","dra","sil","tur","gar","fen","mir","sol","vor","lin","sar","qu","zel","ron","bar","zen","tir","lom","kal","vin","lor","mel","dar","gol","han","jor","ken","lun","mar"],t=2+Math.floor(Math.random()*2);let o="";for(let n=0;n<t;n++)o+=e[Math.floor(Math.random()*e.length)];return o.charAt(0).toUpperCase()+o.slice(1)}static createOceanMap(e,t){return Array.from({length:t},()=>Array(e).fill(D))}static generateContinentsMap(e,t,o){return re(e,t,o)}static createMap(e,t,o=40,n=!0){const r=pe(e,t),{map:s,countries:i}=xe(r,o),l=new q(e,t,i);return l.map=s,n?l.assignRealCountryNames():l.assignRandomCountryNames(),l.regenerateMapFromCountries(l.countries),l.createContinents(),l}addCountry(e){this.countries.push(e)}createContinents(){const e=new Set,t=[];for(const o of this.countries)if(!e.has(o)){const n=[o],r=[];for(e.add(o);n.length>0;){const s=n.shift();r.push(s);for(const i of s.neighbors)e.has(i)||(e.add(i),n.push(i))}t.push(new he(r))}this.continents=t}getCountries(){return this.countries}distance(e,t){const[o,n]=e.center(),[r,s]=t.center(),i=Math.sqrt((o-r)**2+(n-s)**2);if(e.neighbors.includes(t)||t.neighbors.includes(e))return i;const l=e.oceanBorder&&e.oceanBorder.length>0,d=t.oceanBorder&&t.oceanBorder.length>0;return l&&d?i*3:null}getMap(){return this.map}regenerateMapFromCountries(e){if(!this.map||!Array.isArray(this.map)||this.map.length===0||this.map[0].length===0)throw new Error("WorldMap.map is not initialized or has invalid dimensions");const t=this.map.length,o=this.map[0].length,n=q.createOceanMap(o,t);for(let r=0;r<e.length;++r){const s=e[r];if(!s.coordinates||!Array.isArray(s.coordinates))throw new Error(`Country at index ${r} has no valid coordinates array`);for(const[i,l]of s.coordinates){if(typeof i!="number"||typeof l!="number"||i<0||i>=o||l<0||l>=t)throw new Error(`Country index ${r} has out-of-bounds coordinate (${i}, ${l})`);n[l][i]=r}}this.map=n}};v(q,"REAL_COUNTRY_NAMES",["Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia"]);let ne=q;const B=class B{static render(e,t=[],o=[],n=!1,r=null){var g;const s=e.getMap(),i=((g=e.getCountries)==null?void 0:g.call(e))||[],l=s.length,d=s[0].length,a=document.createElement("canvas");a.width=d,a.height=l;const c=a.getContext("2d");if(!c)throw new Error("Could not get canvas context");const h=c.createImageData(d,l),f=h.data;for(let u=0;u<l;u++)for(let y=0;y<d;y++){const m=s[u][y],[w,p,C]=B.getRGBForValue(m,i,y,u,s),b=(u*d+y)*4;f[b]=w,f[b+1]=p,f[b+2]=C,f[b+3]=255}if(t&&t.length>0){for(const u of t)if(!(!u||!u.coordinates)){for(const[y,m]of u.coordinates)if(y>=0&&y<d&&m>=0&&m<l){const w=(m*d+y)*4;f[w]=Math.min(255,Math.round(.6*255+.4*f[w])),f[w+1]=Math.min(255,Math.round(.6*255+.4*f[w+1])),f[w+2]=Math.round(.4*f[w+2]),f[w+3]=255}}}for(const u of i){const y=u.owner&&u.owner.homeCountry===u,m=y?[255,140,0]:[0,0,0];for(const[w,p]of u.border||[])if(y)for(let C=-1;C<=1;C++)for(let b=-1;b<=1;b++){const x=w+b,k=p+C;if(x>=0&&x<d&&k>=0&&k<l){const E=(k*d+x)*4;f[E]=m[0],f[E+1]=m[1],f[E+2]=m[2],f[E+3]=255}}else if(w>=0&&w<d&&p>=0&&p<l){const C=(p*d+w)*4;f[C]=m[0],f[C+1]=m[1],f[C+2]=m[2],f[C+3]=255}}c.putImageData(h,0,0),c.save(),c.font="bold 10px Verdana, Geneva, sans-serif",c.textAlign="center",c.textBaseline="middle";for(const u of i){if(!u.name)continue;const[y,m]=u.center?u.center():[0,0],w=u.fortified?"🛡️ "+u.name:u.name;c.lineWidth=3,c.strokeStyle="black",c.strokeText(w,y,m);const p=o.some(b=>b===u);c.fillStyle=p?"#90EE90":"white",c.fillText(w,y,m);let C=!1;if((n||r&&u.owner===r&&!r.isAI||r&&typeof r.armyKnown=="function"&&r.armyKnown(u)&&!r.isAI)&&(C=!0),C){const b=u.armies||0,x=`${Math.round(b/1e3)}k`;c.font="bold 9px Verdana, Geneva, sans-serif",c.lineWidth=2,c.strokeStyle="black",c.strokeText(x,y,m+13),c.fillStyle="#FFD700",c.fillText(x,y,m+13),c.font="bold 10px Verdana, Geneva, sans-serif"}}return c.restore(),a}static displayWithPanZoom(e,t,o=512,n=512,r=[]){let s=null,i=B.render(e,[],r);const l=i.width,d=i.height,a=document.createElement("canvas");a.width=o,a.height=n,a.style.border="1px solid #888",t.appendChild(a);const c=a.getContext("2d");if(!c)throw new Error("Could not get canvas context");let h=Math.min(a.width/l,a.height/d),f=(a.width-l*h)/2,g=(a.height-d*h)/2,u=!1,y=0,m=0;function w(){i=B.render(e,s?[s]:[],r),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,a.width,a.height),c.setTransform(h,0,0,h,f,g),c.drawImage(i,0,0)}return a.addEventListener("mousedown",p=>{const C=a.getBoundingClientRect(),b=(p.clientX-C.left-f)/h,x=(p.clientY-C.top-g)/h,k=e.getMap(),E=e.getCountries(),S=Math.floor(b),T=Math.floor(x);let I=null;if(S>=0&&T>=0&&T<k.length&&S<k[0].length){const N=k[T][S];N>=0&&E[N]&&(I=E[N])}if(I){s=I,w();return}u=!0,y=p.clientX,m=p.clientY}),window.addEventListener("mousemove",p=>{if(!u)return;const C=p.clientX-y,b=p.clientY-m;f+=C,g+=b,y=p.clientX,m=p.clientY,w()}),window.addEventListener("mouseup",()=>{u=!1}),a.addEventListener("wheel",p=>{p.preventDefault();const C=p.offsetX,b=p.offsetY,x=Math.exp(-p.deltaY*.001);f=C-(C-f)*x,g=b-(b-g)*x,h*=x,w()}),w(),a}static getRGBForValue(e,t,o,n,r){var s,i,l;if(e===D){o=o??0,n=n??0,r=r??[];const d=((s=r[0])==null?void 0:s.length)||1024,a=r.length||768,c=n/a;let h=Math.round(30*(1-c)+10*c),f=Math.round(144*(1-c)+80*c),g=Math.round(255*(1-c)+180*c);const u=B._oceanNoise2D(o*.03,n*.03),y=Math.floor(18*u);h+=y,f+=y,g+=y;let m=!1;if(r&&o>0&&n>0&&o<d-1&&n<a-1)for(const[w,p]of[[1,0],[-1,0],[0,1],[0,-1]]){const C=o+w,b=n+p;if(r[b][C]!==D){m=!0;break}}return m&&(h=Math.min(255,h+40),f=Math.min(255,f+40),g=Math.min(255,g+40)),[h,f,g]}if(e===z){o=o??0,n=n??0,r=r??[];const d=((i=r[0])==null?void 0:i.length)||1024,a=r.length||768,c=B._landNoise2D(o*.04,n*.04),h=[34,139,34],f=[80,180,80],g=.5+.5*c;let u=Math.round(h[0]*(1-g)+f[0]*g),y=Math.round(h[1]*(1-g)+f[1]*g),m=Math.round(h[2]*(1-g)+f[2]*g),w=!1;if(r&&o>0&&n>0&&o<d-1&&n<a-1)for(const[p,C]of[[1,0],[-1,0],[0,1],[0,-1]]){const b=o+p,x=n+C;if(r[x][b]===D){w=!0;break}}return w&&(u=Math.min(255,u+30),y=Math.min(255,y+30),m=Math.min(255,m+30)),[u,y,m]}if(e>=0){const d=t[e];let a=[200,200,200];if(d)if(d.owner&&typeof d.owner.RGBColor=="string"){const E=d.owner.RGBColor.split(",").map(Number);E.length===3&&E.every(S=>!isNaN(S))&&(a=[E[0],E[1],E[2]])}else d.color&&(a=d.color);o=o??0,n=n??0,r=r??[];const c=((l=r[0])==null?void 0:l.length)||1024,h=r.length||768,f=B._landNoise2D(o*.02,n*.02),g=Math.round(18*f),u=a,y=[Math.max(0,a[0]-32),Math.max(0,a[1]-48),Math.max(0,a[2]-32)],m=.5+.5*f;let w=Math.round(u[0]*(1-m)+y[0]*m)+g,p=Math.round(u[1]*(1-m)+y[1]*m)+g,C=Math.round(u[2]*(1-m)+y[2]*m)+g;const b=B._landNoise2D(o*.006+100,n*.006+100),x=Math.round(18*b);w=Math.min(255,Math.max(0,w+x)),p=Math.min(255,Math.max(0,p+x)),C=Math.min(255,Math.max(0,C+x));let k=!1;if(r&&o>0&&n>0&&o<c-1&&n<h-1)for(const[E,S]of[[1,0],[-1,0],[0,1],[0,-1]]){const T=o+E,I=n+S;if(r[I][T]===D){k=!0;break}}return k&&(w=Math.min(255,w+12),p=Math.min(255,p+12),C=Math.min(255,C+12)),[w,p,C]}return[255,255,255]}static drawCountryGlow(e,t,o,n){function r(i,l,d){return[Math.round(i[0]+(l[0]-i[0])*d),Math.round(i[1]+(l[1]-i[1])*d),Math.round(i[2]+(l[2]-i[2])*d)]}let s=new Set(t.coordinates.map(([i,l])=>`${i},${l}`));for(let i=0;i<10;++i){const l=[];for(const c of s){const[h,f]=c.split(",").map(Number),g=[[h-1,f],[h+1,f],[h,f-1],[h,f+1]];for(const[u,y]of g)if(!s.has(`${u},${y}`)){l.push([h,f]);break}}const d=i/9,a=r(o,n,d);e.save(),e.fillStyle=`rgb(${a[0]},${a[1]},${a[2]})`;for(const[c,h]of l)e.fillRect(c,h,1,1);e.restore();for(const[c,h]of l)s.delete(`${c},${h}`);if(s.size===0)break}e.save();for(const i of s){const[l,d]=i.split(",").map(Number);let a=[200,200,200];if(t)if(t.owner&&typeof t.owner.RGBColor=="string"){const b=t.owner.RGBColor.split(",").map(Number);b.length===3&&b.every(x=>!isNaN(x))&&(a=[b[0],b[1],b[2]])}else t.color&&(a=t.color);const c=B._landNoise2D(l*.02,d*.02),h=Math.round(18*c),f=a,g=[Math.max(0,a[0]-32),Math.max(0,a[1]-48),Math.max(0,a[2]-32)],u=.5+.5*c;let y=Math.round(f[0]*(1-u)+g[0]*u)+h,m=Math.round(f[1]*(1-u)+g[1]*u)+h,w=Math.round(f[2]*(1-u)+g[2]*u)+h;const p=B._landNoise2D(l*.006+100,d*.006+100),C=Math.round(18*p);y=Math.min(255,Math.max(0,y+C)),m=Math.min(255,Math.max(0,m+C)),w=Math.min(255,Math.max(0,w+C)),e.fillStyle=`rgb(${y},${m},${w})`,e.fillRect(l,d,1,1)}e.restore()}};v(B,"drawBorders",!0),v(B,"_oceanNoise2D",K()),v(B,"_landNoise2D",K());let _=B;class W{RequiresAmount(e,t,o){return null}}class R{constructor(e,t,o,n,r=null){v(this,"countries");v(this,"amount");v(this,"action");v(this,"score");v(this,"followUp");this.countries=e,this.amount=t,this.action=o,this.score=n,this.followUp=r}}class ve{constructor(e,t,o){v(this,"canvas");v(this,"ctx");v(this,"start");v(this,"end");this.canvas=e;const n=e.getContext("2d");if(!n)throw new Error("Could not get canvas context");this.ctx=n,this.start=t,this.end=o}draw(){const e=this.ctx,{start:t,end:o}=this,n=(t.x+o.x)/2,r=(t.y+o.y)/2,s=o.x-t.x,i=o.y-t.y,l=Math.sqrt(s*s+i*i),d=.25*l,a=-i/l*d,c=s/l*d,h=n+a,f=r+c,g=e.createLinearGradient(t.x,t.y,o.x,o.y);g.addColorStop(0,"#fff"),g.addColorStop(.5,"#0ff"),g.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=12,e.strokeStyle=g,e.beginPath(),e.moveTo(t.x,t.y),e.quadraticCurveTo(h,f,o.x,o.y),e.stroke();const u=.95,y=this.getQuadraticPoint(t,{x:h,y:f},o,u),m=this.getQuadraticTangent(t,{x:h,y:f},o,u);this.drawArrowhead(y,m),e.restore()}getQuadraticPoint(e,t,o,n){const r=(1-n)*(1-n)*e.x+2*(1-n)*n*t.x+n*n*o.x,s=(1-n)*(1-n)*e.y+2*(1-n)*n*t.y+n*n*o.y;return{x:r,y:s}}getQuadraticTangent(e,t,o,n){const r=2*(1-n)*(t.x-e.x)+2*n*(o.x-t.x),s=2*(1-n)*(t.y-e.y)+2*n*(o.y-t.y),i=Math.sqrt(r*r+s*s);return{x:r/i,y:s/i}}drawArrowhead(e,t){const o=this.ctx;o.save(),o.translate(e.x,e.y);const n=Math.atan2(t.y,t.x);o.rotate(n),o.beginPath(),o.moveTo(0,0),o.lineTo(-18,7),o.lineTo(-12,0),o.lineTo(-18,-7),o.closePath(),o.fillStyle="rgba(0,255,255,0.95)",o.shadowColor="#fff",o.shadowBlur=8,o.fill(),o.restore()}}class Me{constructor(e,t,o){v(this,"canvas");v(this,"attacker");v(this,"defender");this.canvas=e,this.attacker=t,this.defender=o}async start(){const e=this.canvas.getContext("2d");if(!e)return;const[t,o]=this.attacker.center(),[n,r]=this.defender.center(),s={x:t,y:o},i={x:n,y:r};new ve(this.canvas,s,i);const l=500,d=this.attacker,a=this.defender;return new Promise(c=>{const h=f=>{const u=performance.now()-f,y=Math.min(u/l,1);e.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCountry(e,d,"attacker"),this.drawCountry(e,a,"defender"),this.drawAnimatedArrow(e,s,i,y),y<1?requestAnimationFrame(()=>h(f)):c()};requestAnimationFrame(f=>h(f))})}drawAnimatedArrow(e,t,o,n){const r=(t.x+o.x)/2,s=(t.y+o.y)/2,i=o.x-t.x,l=o.y-t.y,d=Math.sqrt(i*i+l*l),a=.25*d,c=-l/d*a,h=i/d*a,f=r+c,g=s+h,u=e.createLinearGradient(t.x,t.y,o.x,o.y);u.addColorStop(0,"#fff"),u.addColorStop(.5,"#0ff"),u.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=16,e.strokeStyle=u,e.beginPath(),e.moveTo(t.x,t.y);const y=60;for(let m=1;m<=Math.floor(y*n);++m){const w=m/y,p=this.getQuadraticPoint(t,{x:f,y:g},o,w);e.lineTo(p.x,p.y)}if(e.stroke(),n>.05){const m=n,w=this.getQuadraticPoint(t,{x:f,y:g},o,m),p=this.getQuadraticTangent(t,{x:f,y:g},o,m);this.drawArrowhead(e,w,p)}e.restore()}drawCountry(e,t,o){let n;o==="attacker"?n=[180,0,0]:o==="defender"?n=[0,0,180]:n=t.color||[200,200,200],_.drawCountryGlow(e,t,n,t.color);const[r,s]=t.center?t.center():[0,0],i=t.fortified?"🛡️ "+t.name:t.name;if(e.save(),e.font="bold 10px Verdana, Geneva, sans-serif",e.textAlign="center",e.textBaseline="middle",e.lineWidth=3,e.strokeStyle="black",e.strokeText(i,r,s),e.fillStyle="white",e.fillText(i,r,s),typeof t.armies=="number"&&P.showArmies){const l=`${Math.round(t.armies/1e3)}k`;e.font="bold 9px Verdana, Geneva, sans-serif",e.lineWidth=2,e.strokeStyle="black",e.strokeText(l,r,s+13),e.fillStyle="#FFD700",e.fillText(l,r,s+13)}e.restore()}getQuadraticPoint(e,t,o,n){const r=(1-n)*(1-n)*e.x+2*(1-n)*n*t.x+n*n*o.x,s=(1-n)*(1-n)*e.y+2*(1-n)*n*t.y+n*n*o.y;return{x:r,y:s}}getQuadraticTangent(e,t,o,n){const r=2*(1-n)*(t.x-e.x)+2*n*(o.x-t.x),s=2*(1-n)*(t.y-e.y)+2*n*(o.y-t.y),i=Math.sqrt(r*r+s*s);return{x:r/i,y:s/i}}drawArrowhead(e,t,o){e.save(),e.translate(t.x,t.y);const n=Math.atan2(o.y,o.x);e.rotate(n),e.beginPath(),e.moveTo(0,0),e.lineTo(-18,7),e.lineTo(-12,0),e.lineTo(-18,-7),e.closePath(),e.fillStyle="rgba(0,255,255,0.95)",e.shadowColor="#fff",e.shadowBlur=8,e.fill(),e.restore()}}class O extends W{GetButtonText(e,t){if(e.length<2)return null;const o=e[e.length-2],n=e[e.length-1];if(o.owner!==t||o===n)return null;const r=o.neighbors.includes(n),s=o.oceanBorder.length>0&&n.oceanBorder.length>0;return!r&&!s||n.owner===t?null:`Attack ${n.name} from ${o.name}`}async Act(e,t,o,n=0){var p,C;if(!o)throw new Error("Internal error: currentGame is required.");if(e.length<2)throw new Error("Select source and target countries to attack.");const r=e[e.length-2],s=e[e.length-1];if(r.owner!==t)throw new Error("You must own the attacking country.");const i=r.neighbors.includes(s),l=r.oceanBorder.length>0&&s.oceanBorder.length>0;if(!i&&!l)throw new Error("Target country must be a neighbor or reachable by naval attack.");if(s.owner===t)throw new Error("Cannot attack your own country.");if(n<=0||n>=r.armies)throw new Error("Invalid number of armies committed.");if(!t.game)throw new Error("ActionAttack: activePlayer.game is missing");if(!t.game.gui)throw new Error("ActionAttack: activePlayer.game.gui is missing");const a=t.game.gui.getWorldMapCanvas(),c=a.parentElement;if(!c)throw new Error("ActionAttack: mapCanvas.parentElement is null");c.style.position="relative";let h=document.getElementById("attack-animation-overlay");h&&((p=h.parentElement)==null||p.removeChild(h));let f=document.createElement("canvas");f.id="attack-animation-overlay",f.width=a.width,f.height=a.height,f.style.position="absolute",f.style.left="0",f.style.top="0",f.style.pointerEvents="none",f.style.zIndex="9999",f.style.width="100%",f.style.height="100%",f.style.background="rgba(255,255,255,0.01)",c.appendChild(f),new Me(f,r,s).start(),await new Promise(b=>setTimeout(b,0)),await new Promise(b=>setTimeout(b,1e3)),(C=f==null?void 0:f.parentElement)==null||C.removeChild(f);const u=O.AttackChance(r.armies,s.armies,o.worldMap.distance(r,s)||0,s.fortified,o),y=Math.random(),m=Math.sqrt(Math.abs(y-u));let w="";if(r.armies-=n,y<u){const b=s.owner;b&&(b.ownedCountries=b.ownedCountries.filter(k=>k!==s),b.plannedFortifications=b.plannedFortifications.filter(([k,E])=>k!==s)),s.owner=t,t.ownedCountries.push(s);let x=Math.max(1,Math.round(n*Math.sqrt(m)));x>0&&(x=Math.max(1e3,Math.round(x/1e3)*1e3)),s.armies=x,s.fortified=!1,b&&b.ownedCountries.length===0&&o.players.includes(b)&&(o.players=o.players.filter(k=>k!==b),o.activePlayerIndex>=o.players.length&&(o.activePlayerIndex=0)),t.ownedCountries.length===0&&o.players.includes(t)&&(o.players=o.players.filter(k=>k!==t),o.activePlayerIndex>=o.players.length&&(o.activePlayerIndex=0));for(const k of o.players)k.knowledge=k.knowledge.filter(E=>E.country!==s);w=`Attack successful! ${x} of your ${n} armies occupy ${s.name}.`}else{let b=Math.round(s.armies*Math.sqrt(m));b>0&&(b=Math.max(1e3,Math.round(b/1e3)*1e3)),s.armies=Math.max(1,s.armies-b),s.armies>0&&(s.armies=Math.max(1e3,Math.round(s.armies/1e3)*1e3)),w=`Attack failed! All ${n} attacking armies lost. Defenders lost ${b} troops.`}return w}static AttackChance(e,t,o,n,r){return o===null?0:(t*=o/100,n&&(t*=2),e>=3*t?1:e<=t/3?0:e<t?.5*(e-t/3)/(t-t/3):.5+.5*(e-t)/(2*t))}RequiresAmount(e,t,o){if(e.length<2)return null;const n=e[e.length-2];return!n||typeof n.armies!="number"||n.armies<=1?null:[1e3,n.armies-1e3]}}class j extends W{GetButtonText(e,t){if(e.length<2)return null;const o=e[e.length-2],n=e[e.length-1];return!o||!n||o.owner!==t||n.owner!==t||o===n?null:`Move armies from ${o.name} to ${n.name}`}async Act(e,t,o,n=0){if(!o)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to move armies.";const r=e[e.length-2],s=e[e.length-1];return r.owner!==t||s.owner!==t?"Both countries must be owned by you.":r===s?"Source and target countries must be different.":n<=0||n>=r.armies?"Invalid number of armies to move.":(r.armies-=n,s.armies+=n,`Moved ${n} armies from ${r.name} to ${s.name}.`)}RequiresAmount(e,t,o){if(e.length<2)return null;const n=e[e.length-2];return!n||typeof n.armies!="number"||n.armies<=1?null:[1e3,n.armies-1e3]}}class se extends W{GetButtonText(e,t){if(e.length===0)return null;const o=e[e.length-1];return o.owner!==t||o.fortified?null:`Fortify ${o.name}`}async Act(e,t,o,n=0){if(!o)return"Internal error: currentGame is required.";if(e.length===0)return"Please select a country to fortify.";const r=e[e.length-1];return r.canBeFortified()?t.money<P.fortifyCost?`Not enough money to fortify. You need $${P.fortifyCost}.`:(t.money-=P.fortifyCost,t.plannedFortifications.push([r,o.gameTurn+2]),`Fortification planned for ${r.name} on turn ${o.gameTurn+2}.`):`${r.name} cannot be fortified.`}RequiresAmount(e,t,o){return null}}class X extends W{GetButtonText(e,t){if(e.length<1)return null;const o=e[e.length-1];return!o||o.owner!==t?null:`Buy armies for ${o.name}`}async Act(e,t,o,n=0){if(!o)return"Internal error: currentGame is required.";if(e.length<1)return"Select a friendly country to buy armies for.";const r=e[e.length-1];if(r.owner!==t)return"You must own the target country.";if(n<=0)return"Invalid number of armies to buy.";const s=n*P.armyCost;return t.money<s?`Not enough money. Need ${s.toLocaleString()}, have ${t.money.toLocaleString()}.`:(t.money-=s,r.armies+=n,`Bought ${n} armies for ${r.name} at a cost of ${s.toLocaleString()}.`)}RequiresAmount(e,t,o){const n=Math.floor(t.money/P.armyCost/1e3)*1e3;return n<1e3?null:[1e3,n]}}const L=class L{constructor(e,t){v(this,"player");v(this,"game");v(this,"actionPlan",[]);this.player=e,this.game=t}GetBestArmies(e){return!this.player.ownedCountries||this.player.ownedCountries.length===0?[]:this.player.ownedCountries.slice().sort((t,o)=>(o.armies||0)-(t.armies||0)).slice(0,e)}FindSpyOpportunities(){const e=new ie,t=[],o=this.getNonOwnedCountriesSortedByDistance();for(const{country:n,distance:r}of o){const s=this.player.knowledge.find(l=>l.country===n);if(n.owner){if(s&&this.game.gameTurn-s.gameTurn<=3)continue}else if(s)continue;const i=3e3-Math.sqrt(r);if(i>0){const l=n.fortified?P.spyFortifiedCost:P.spyCost;if(this.player.money>=l){const d=i*(this.player.totalIncome()/5e6);t.push(new R([n],0,e,d))}}}return t}FindAttackOpportunities(){const e=new O,o=this.game.worldMap.getCountries(),n=[];for(const r of o){if(r.owner===this.player)continue;const[s,i]=this.countryBestAttackerScore(r);if(!s)continue;const l=Math.floor(s.armies*L.ATTACK_COMMIT/1e3)*1e3;l<1e3||n.push(new R([s,r],l,e,i*this.player.aggressivity))}return n}async takeAction(){if(this.player.actionsLeft<=0)return!1;if(this.player.actionsLeft>=4&&Math.random()<.2&&this.actionPlan.length===0)return this.PlanSurpriseAttack(),!0;let e=null,t=!1;if(this.actionPlan.length>0){e=this.actionPlan.shift(),t=!0;const n=e.action,r=e.countries,s=e.amount;if(n instanceof j){const i=r[0];if(!i||i.armies<s+1e3)return console.warn("Skipping invalid move from actionPlan:",e),this.actionPlan=[],!1}else if(n instanceof O){const i=r[0],l=r[1];if(!i||!l||l.owner===this.player||i.armies<s)return console.warn("Skipping invalid attack from actionPlan:",e),this.actionPlan=[],!1}else if(n instanceof X&&this.player.money<s*P.armyCost)return console.warn("Skipping invalid buy from actionPlan:",e),this.actionPlan=[],!1}else e=this.findBestOpportunity();if(!e)return!1;const o=await e.action.Act(e.countries,this.player,this.game,e.amount);return t&&o&&console.log("Action result (from actionPlan):",o),e.followUp&&this.actionPlan.length===0&&this.actionPlan.push(e.followUp),this.player.useAction(),!0}countryDefenseEstimate(e){let t;const o=this.player.knowledge.find(r=>r.country===e),n=e.owner&&e.owner!==this.player;return n&&(!o||this.game.gameTurn-o.gameTurn>3)?t=1e5:!n&&!o?t=7e4:o?t=o.army:t=7e4,e.fortified&&(t*=2),t}countryScore(e){let t;const o=this.player.knowledge.find(r=>r.country===e);o&&typeof o.income=="number"?t=o.income:t=1e6;const n=this.countryDefenseEstimate(e);return t/n}countryBestAttackerScore(e){const t=this.countryDefenseEstimate(e);let o=0,n=null;for(const r of this.player.ownedCountries){const s=this.game.worldMap.distance(r,e);if(s===null)continue;const i=Math.round((r.armies||0)*L.ATTACK_COMMIT/1e3)*1e3;if(i<1e3)continue;const l=O.AttackChance(i,t,s,!1,this.game);let d=0;l>=.7&&(d=l*l*l*this.countryScore(e)*100),d>o&&(o=d,n=r)}return[n,o]}FindMoveOpportunities(e){const t=[];if(this.player.ownedCountries.length===0)return t;const o=this.player.ownedCountries.reduce((d,a)=>a.armies>d.armies?a:d,this.player.ownedCountries[0]);let n=null,r=-1/0,s=null;for(const d of this.player.ownedCountries){const a=this.getReachableNonOwnedCountries(d);for(const{country:c,distance:h}of a){let f=1;h>100&&(f=Math.max(0,1-(h-100)/900));const g=this.countryScore(c)*f;g>r&&(r=g,n=d,s=c)}}if(n&&n!==o){const d=Math.floor(o.armies*.5/1e3)*1e3;if(d>0&&o!==n){let a=null;if(this.actionPlan.length===0&&s){const c=n.armies+d,h=Object.create(n);if(h.armies=c,this.isAttackFeasible(h,s,L.ATTACK_COMMIT)){const f=new O,g=Math.floor(c*L.ATTACK_COMMIT/1e3)*1e3;a=new R([n,s],g,f,100)}}t.push(new R([o,n],d,e,r,a))}}const i=this.player.totalArmies()/this.player.ownedCountries.length,l=this.player.ownedCountries.reduce((d,a)=>a.armies<d.armies?a:d,this.player.ownedCountries[0]);if(l.armies<i/2&&l!==o){const d=i/2,a=Math.floor((d-l.armies)/1e3)*1e3,c=Math.max(0,Math.min(a,o.armies-1e3));c>0&&o!==l&&t.push(new R([o,l],c,e,i-l.armies))}return t}FindFortifyOpportunities(e){const t=[],o=this.player.ownedCountries.filter(n=>!n.fortified).length;for(const n of this.player.ownedCountries)if(n.canBeFortified()&&this.player.money>=P.fortifyCost){let r=n.income/100;r*=o,t.push(new R([n],0,e,r))}return t}FindBuyOpportunities(){if(this.player.money<=2e6)return[];const t=[],o=new X,n=this.player.money,r=P.armyCost,i=Math.max(0,n-2e6);if(this.player.ownedCountries.length===0||i<r)return t;const l=Math.floor(this.player.totalArmies()/this.player.ownedCountries.length),d=this.player.ownedCountries.reduce((f,g)=>g.armies<f.armies?g:f,this.player.ownedCountries[0]);if(d.armies<l){const f=l-d.armies,g=Math.floor(i/r),u=Math.min(f,g,1e5),y=Math.floor(u/1e3)*1e3;if(y>0){const m=(l-d.armies)/1e3;t.push(new R([d],y,o,m))}}let a=null,c=-1/0,h=null;for(const f of this.player.ownedCountries){const g=this.getReachableNonOwnedCountries(f);for(const{country:u,distance:y}of g){let m=1;y>100&&(m=Math.max(0,1-(y-100)/900));const w=this.countryScore(u)*m;w>c&&(c=w,a=f,h=u)}}if(a||(a=this.player.homeCountry),a){const f=Math.floor((i-2e6)/r),g=Math.floor(f/1e3)*1e3;if(g>0){let u=null;if(this.actionPlan.length===0&&h){const y=a.armies+g,m=Object.create(a);if(m.armies=y,this.isAttackFeasible(m,h,L.ATTACK_COMMIT)){const w=new O,p=Math.floor(y*L.ATTACK_COMMIT/1e3)*1e3;u=new R([a,h],p,w,100)}}t.push(new R([a],g,o,c*1e3,u))}}return t}findBestOpportunity(){const e=new j,t=new se,o=[];return o.push(...this.FindSpyOpportunities()),o.push(...this.FindAttackOpportunities()),o.push(...this.FindMoveOpportunities(e)),o.push(...this.FindFortifyOpportunities(t)),o.push(...this.FindBuyOpportunities()),o.length===0?null:o.reduce((n,r)=>r.score>n.score?r:n,o[0])}getNonOwnedCountriesSortedByDistance(){const e=this.game.worldMap,t=e.getCountries(),o=[];for(const n of t){if(n.owner===this.player)continue;let r=1e4;for(const s of this.player.ownedCountries){const i=e.distance(s,n);i!==null&&(r=Math.min(r,i))}o.push({country:n,distance:r})}return o.sort((n,r)=>n.distance-r.distance),o}getReachableNonOwnedCountries(e){const t=this.game.worldMap,o=t.getCountries(),n=[];for(const r of o){if(r.owner===this.player)continue;const s=t.distance(e,r);s!==null&&n.push({country:r,distance:s})}return n.sort((r,s)=>r.distance-s.distance),n}MakeAttackPlan(e){if(this.actionPlan.length>0)return;const t=O,o=j,n=X,r=this.player.ownedCountries;if(r.length===0||e.owner===this.player)return;let s=1/0,i=null;for(const x of r){const k=this.game.worldMap.distance(x,e);k!==null&&k<s&&(s=k,i=x)}if(!i)return;const l=new Map;for(const x of r)l.set(x,x.armies);let d=this.player.money;const a=[],c=new n,h=P.armyCost,f=Math.floor(d/h);if(f>0){const x=Math.floor(f/1e3)*1e3;x>0&&(a.push(new R([i],x,c,1)),l.set(i,l.get(i)+x),d-=x*h)}const g=new o;let u=0,y=l.get(i);const m=r.filter(x=>x!==i).sort((x,k)=>k.armies-x.armies);for(const x of m){if(u>=2)break;const k=this.game.worldMap.distance(x,i),E=l.get(x);if(k!==null&&E>1e3){const S=Math.floor((E-1e3)/1e3)*1e3;S>0&&(a.push(new R([x,i],S,g,1)),l.set(x,E-S),y+=S,l.set(i,y),u++)}}const w=this.countryDefenseEstimate(e),p=this.game.worldMap.distance(i,e)||1,C=Math.floor(y*L.ATTACK_COMMIT/1e3)*1e3,b=t.AttackChance(C,w,p,e.fortified,this.game);if(b>.7&&C>=1e3){const x=new t;a.push(new R([i,e],C,x,b*100)),l.set(i,1e3),this.actionPlan.push(...a)}}PlanSurpriseAttack(){if(this.actionPlan.length>0)return;const e=this.game.worldMap.getCountries();let t=1/0,o=null;for(const s of e)if(!s.owner){const i=this.countryDefenseEstimate(s);i<t&&(t=i,o=s)}if(o){this.MakeAttackPlan(o);return}let n=1/0,r=null;for(const s of e)if(s.owner&&s.owner!==this.player){const i=this.countryDefenseEstimate(s);i<n&&(n=i,r=s)}r&&this.MakeAttackPlan(r)}isAttackFeasible(e,t,o=.8){if(!e||!t||e.owner!==this.player||t.owner===this.player||e===t)return!1;const n=e.neighbors.includes(t),r=e.oceanBorder.length>0&&t.oceanBorder.length>0;if(!n&&!r||typeof e.armies!="number"||e.armies<=1e3)return!1;const s=this.countryDefenseEstimate(t),i=this.game.worldMap.distance(e,t);if(i===null)return!1;const l=Math.floor(e.armies*o);return!(O.AttackChance(l,s,i,t.fortified,this.game)<.7)}};v(L,"ATTACK_COMMIT",.8);let Q=L;const G=class G{constructor(e,t=[]){v(this,"worldMap");v(this,"players");v(this,"gameTurn");v(this,"activePlayerIndex");v(this,"gui");this.worldMap=e,this.players=t,this.gameTurn=1,this.activePlayerIndex=0,this.players.length>0&&this.activePlayer.startTurn()}get activePlayer(){return this.players[this.activePlayerIndex]}nextTurn(){this.activePlayer.money+=this.activePlayer.totalIncome(),this.activePlayerIndex=(this.activePlayerIndex+1)%this.players.length,this.activePlayerIndex===0&&this.gameTurn++;const e=this.activePlayer;e.plannedFortifications=e.plannedFortifications.filter(([t,o])=>o===this.gameTurn?(t.fortified=!0,!1):!0),this.activePlayer.startTurn()}static initNewGame(e,t,o){for(const c of t)c.money=G.initialPlayerMoney,c.homeCountry=null,c.ownedCountries=[],c.isAI&&(c.AI=new Q(c,null));const n=e.getCountries();for(const c of n)c.income=Math.floor((5e5+Math.random()*2e6)/1e3)*1e3,c.owner=null;let r=-1,s=[];const i=t.length,l=10;function d(c,h){if(!c.center||!h.center)return 0;const[f,g]=c.center(),[u,y]=h.center();return Math.sqrt((f-u)**2+(g-y)**2)}for(let c=0;c<l;++c){const h=[...n];for(let u=h.length-1;u>0;u--){const y=Math.floor(Math.random()*(u+1));[h[u],h[y]]=[h[y],h[u]]}const f=h.slice(0,i);let g=1/0;for(let u=0;u<f.length;++u)for(let y=u+1;y<f.length;++y)g=Math.min(g,d(f[u],f[y]));g>r&&(r=g,s=f)}for(let c=0;c<t.length;++c){const h=s[c];t[c].homeCountry=h,h.owner=t[c],t[c].ownedCountries.push(h),h.income=G.homeCountryIncome,h.fortified=!0}for(const c of e.getCountries())if(c.owner)c.armies=1e5;else{const h=Math.round((Math.random()*Math.random()*99e3+1e3)/1e3)*1e3;c.armies=h}const a=new G(e,t);o&&(a.gui=o);for(const c of t)c.game=a,c.isAI&&c.AI&&(c.AI.game=a,c.AI.player=c);return a}};v(G,"armyCost",100),v(G,"spyCost",2e5),v(G,"spyFortifiedCost",1e6),v(G,"initialPlayerMoney",1e7),v(G,"homeCountryIncome",4e6),v(G,"fortifyCost",1e5),v(G,"showArmies",!1),v(G,"INCOME_SHARE_WIN",.8);let P=G;const ke=Object.freeze(Object.defineProperty({__proto__:null,Game:P},Symbol.toStringTag,{value:"Module"}));class ie extends W{GetButtonText(e,t){if(e.length===0)return null;const o=e[e.length-1];return o.owner==t?null:`Spy on ${o.name}`}async Act(e,t,o,n=0){if(e.length===0)return"Please select a country to spy on.";const r=e[e.length-1],s=r.fortified?P.spyFortifiedCost:P.spyCost;if(t.money<s)return`Not enough money to spy. You need $${s}.`;const i=t.knowledge.find(a=>a.country===r);if(!o)return"Internal error: currentGame is required.";const l=o.gameTurn;if(i&&i.gameTurn===l)return"You already have recent information about this country.";t.money-=s;const d={country:r,gameTurn:l,army:r.armies,income:r.income};return i?(i.gameTurn=d.gameTurn,i.army=d.army,i.income=d.income):t.knowledge.push(d),null}RequiresAmount(e,t,o){return null}}function Ae(M,e,t=M){return new Promise(o=>{const n=document.createElement("div");n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.width="100vw",n.style.height="100vh",n.style.background="rgba(0,0,0,0.5)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="10000";const r=document.createElement("div");r.style.background="#fff",r.style.padding="32px 40px",r.style.borderRadius="12px",r.style.boxShadow="0 2px 16px rgba(0,0,0,0.2)",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.gap="18px";const s=document.createElement("div");s.textContent="Select amount to commit:",s.style.fontSize="1.2rem",s.style.marginBottom="8px",r.appendChild(s);const i=document.createElement("div");i.textContent=`Maximum: ${e.toLocaleString()}`,i.style.fontSize="1rem",i.style.color="#555",i.style.marginBottom="4px",r.appendChild(i);let l=Math.max(M,Math.min(e,t));const d=document.createElement("div");d.textContent=l.toLocaleString(),d.style.fontSize="2rem",d.style.fontWeight="bold",d.style.margin="8px 0",r.appendChild(d);const a=document.createElement("div");a.style.display="flex",a.style.gap="6px";function c(y){l=Math.max(M,Math.min(e,y)),d.textContent=l.toLocaleString()}function h(y,m){const w=document.createElement("button");return w.textContent=y,w.style.padding="6px 14px",w.style.fontSize="1.1rem",w.style.border="none",w.style.borderRadius="6px",w.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",w.style.color="#fff",w.style.cursor="pointer",w.onclick=m,w}a.appendChild(h("-100k",()=>c(l-1e5))),a.appendChild(h("-10k",()=>c(l-1e4))),a.appendChild(h("-1k",()=>c(l-1e3))),a.appendChild(h("Min",()=>c(M))),a.appendChild(h("Max",()=>c(e))),a.appendChild(h("+1k",()=>c(l+1e3))),a.appendChild(h("+10k",()=>c(l+1e4))),a.appendChild(h("+100k",()=>c(l+1e5))),r.appendChild(a);const f=document.createElement("div");f.style.display="flex",f.style.gap="12px",f.style.marginTop="18px";const g=h("OK",()=>{document.body.removeChild(n),o(l)});g.style.background="linear-gradient(90deg,#43cea2 0%,#43e97b 100%)",g.style.fontWeight="bold";const u=h("Cancel",()=>{document.body.removeChild(n),o(null)});u.style.background="linear-gradient(90deg,#e57373 0%,#ffb74d 100%)",f.appendChild(g),f.appendChild(u),r.appendChild(f),n.appendChild(r),document.body.appendChild(n),g.focus()})}class Se extends W{GetButtonText(e,t){if(e.length<2)return null;const o=e[e.length-2],n=e[e.length-1];if(o.owner!==t||o===n||!(t.knowledge&&t.knowledge.some(l=>l.country===n)))return null;const s=o.neighbors.includes(n),i=o.oceanBorder.length>0&&n.oceanBorder.length>0;return!s&&!i||n.owner===t?null:`Calculate attack chance for ${n.name} from ${o.name}`}async Act(e,t,o,n=0){if(!o)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to calculate attack.";const r=e[e.length-2],s=e[e.length-1];if(r.owner!==t)return"You must own the attacking country.";const i=r.neighbors.includes(s),l=r.oceanBorder.length>0&&s.oceanBorder.length>0;if(!i&&!l)return"Target country must be a neighbor or reachable by naval attack.";if(s.owner===t)return"Cannot attack your own country.";if(n<=0||n>=r.armies)return"Invalid number of armies committed.";const d=t.getCountryInfo(s,o.gameTurn),a=o.worldMap.distance(r,s);let h=`Attack chance: ${(O.AttackChance(r.armies,d.army||0,a||0,s.fortified,o)*100).toFixed(2)}%`;return d.recency&&d.recency>0&&(h+=`
Warning: Information about ${s.name} may be outdated (last spied ${d.recency} turn(s) ago).`),h}RequiresAmount(e,t,o){if(e.length<2)return null;const n=e[e.length-2];return!n||typeof n.armies!="number"||n.armies<=1?null:[1e3,n.armies-1e3]}}function Ee(M,e,t){let o=document.getElementById("gamegui-win-modal");if(o)return;o=document.createElement("div"),o.id="gamegui-win-modal",o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.background="rgba(0,0,0,0.85)",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.zIndex="99999";const n=document.createElement("canvas");n.width=window.innerWidth,n.height=window.innerHeight,n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",o.appendChild(n);const r=document.createElement("div");r.style.background="linear-gradient(120deg,#ffd700 0%,#43cea2 100%)",r.style.padding="48px 64px",r.style.borderRadius="24px",r.style.boxShadow="0 4px 32px rgba(0,0,0,0.25)",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.gap="32px",r.style.position="relative";const s=document.createElement("div");s.innerHTML=`<div style="font-size:2.5rem;font-weight:bold;color:#222;text-shadow:0 2px 8px #fff">🎉 ${M} WINS! 🎉</div><div style="font-size:1.3rem;color:#333;margin-top:18px">has reached ${e.toFixed(0)}% of world income!</div>`,r.appendChild(s);const i=document.createElement("button");i.textContent="OK",i.style.marginTop="24px",i.style.padding="12px 36px",i.style.fontSize="1.3rem",i.style.border="none",i.style.borderRadius="8px",i.style.background="linear-gradient(90deg,#43cea2 0%,#ffd700 100%)",i.style.color="#222",i.style.fontWeight="bold",i.style.cursor="pointer",i.onclick=()=>{a=!1,o&&o.parentNode&&o.parentNode.removeChild(o),t&&t()},r.appendChild(i),o.appendChild(r),document.body.appendChild(o);const l=n.getContext("2d"),d=Array.from({length:180},()=>({x:Math.random()*n.width,y:Math.random()*-n.height,r:6+Math.random()*10,d:2+Math.random()*4,color:`hsl(${Math.random()*360},90%,60%)`,tilt:Math.random()*10,tiltAngle:0,tiltAngleInc:.05+Math.random()*.07}));let a=!0;function c(){if(!(!a||!l)){l.clearRect(0,0,n.width,n.height);for(const h of d)l.beginPath(),l.ellipse(h.x,h.y,h.r,h.r/2,h.tilt,0,2*Math.PI),l.fillStyle=h.color,l.globalAlpha=.85,l.fill(),l.globalAlpha=1;for(const h of d)h.y+=h.d,h.tilt+=h.tiltAngleInc,h.y>n.height+20&&(h.x=Math.random()*n.width,h.y=-20,h.tilt=Math.random()*10);requestAnimationFrame(c)}}c()}class Te{constructor(e,t,o,n){v(this,"overlay");v(this,"ctx");v(this,"width");v(this,"height");v(this,"fish",[]);v(this,"running",!1);v(this,"lastSpawn",0);v(this,"nextSpawn",0);v(this,"getOceanPredicate");v(this,"loop",e=>{this.ctx.clearRect(0,0,this.width,this.height),this.fish=this.fish.filter(t=>!t.done);for(const t of this.fish)t.update(e),t.draw(this.ctx);e>this.nextSpawn&&(this.spawnFish(),this.scheduleNextSpawn()),this.fish.length>0||this.nextSpawn-e<2e3?requestAnimationFrame(this.loop):(this.running=!1,setTimeout(()=>this.start(),this.nextSpawn-e))});this.width=t,this.height=o,this.getOceanPredicate=n,this.overlay=document.createElement("canvas"),this.overlay.width=t,this.overlay.height=o,this.overlay.style.position="absolute",this.overlay.style.left="0",this.overlay.style.top="0",this.overlay.style.pointerEvents="none",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.zIndex="20",e.appendChild(this.overlay);const r=this.overlay.getContext("2d");if(!r)throw new Error("Could not get canvas context for FishOverlay");this.ctx=r,this.scheduleNextSpawn(),this.start()}scheduleNextSpawn(){this.nextSpawn=performance.now()+5e3+Math.random()*1e4}spawnFish(){for(let e=0;e<10;e++){const t=Math.floor(Math.random()*this.width),o=Math.floor(this.height*(.4+.5*Math.random())),n=Math.random()<.5?1:-1,r=32+Math.random()*24,s=t+n*r;if(this.getOceanPredicate(t,o)&&this.getOceanPredicate(Math.round(s),o)){const i="#444";this.fish.push(new Ie(t,o,n,i));break}}}start(){this.running||(this.running=!0,requestAnimationFrame(this.loop))}}class Ie{constructor(e,t,o,n){v(this,"x0");v(this,"y0");v(this,"x1");v(this,"y1");v(this,"dir");v(this,"color","#444");v(this,"t0");v(this,"duration");v(this,"done",!1);v(this,"splash",!1);v(this,"splashStart",0);v(this,"splashDuration",1200);this.x0=e,this.y0=t;const r=32+Math.random()*24;this.x1=e+o*r,this.y1=t,this.dir=o,this.t0=performance.now(),this.duration=(1200+Math.random()*400)/2}update(e){const t=(e-this.t0)/this.duration;if(!this.splash&&t>.95&&(this.splash=!0,this.splashStart=e),t>1&&this.splash){e-this.splashStart>this.splashDuration&&(this.done=!0);return}if(t>1){this.done=!0;return}}draw(e){const t=performance.now(),o=Math.min(1,(t-this.t0)/this.duration),n=18,r=this.x0+(this.x1-this.x0)*o,s=this.y0-(1-4*Math.pow(o-.5,2))*n,i=1+.18*Math.sin(Math.PI*o),l=.5*Math.sin(Math.PI*o);if(o<=.95){e.save(),e.translate(r,s);const d=1/3,a=e.createRadialGradient(0,0,.3,0,0,7*i*d);a.addColorStop(0,"#222"),a.addColorStop(.7,"#666"),a.addColorStop(1,"#bbb"),e.fillStyle=a,e.beginPath(),e.ellipse(0,0,7*i*d,3*d,0,0,2*Math.PI),e.fill(),e.save(),e.beginPath(),e.moveTo(-7*i*d,0),e.lineTo(-11*i*d,-4*d),e.lineTo(-11*i*d,4*d),e.closePath(),e.fillStyle="#222",e.globalAlpha=.8,e.fill(),e.restore(),e.save(),e.beginPath(),e.ellipse(-2*i*d,2.2*d,2*d,.7*d,Math.PI/4+l,0,2*Math.PI),e.ellipse(-2*i*d,-2.2*d,2*d,.7*d,-Math.PI/4-l,0,2*Math.PI),e.fillStyle="#888",e.globalAlpha=.7,e.fill(),e.restore(),e.restore()}if(this.splash){const d=Math.min(1,(t-this.splashStart)/this.splashDuration);for(let a=0;a<3;a++){const c=10+12*d+a*6;e.save(),e.beginPath(),e.arc(this.x1,this.y1,c,0,2*Math.PI),e.strokeStyle=`rgba(10,10,10,${.7*(1-d)})`,e.lineWidth=2.5-a*.5,e.globalAlpha=1*(1-d),e.stroke(),e.restore()}}}}class Pe{constructor(){v(this,"state");v(this,"currentGame",null);v(this,"rootContainer",null);v(this,"canceled",!1);v(this,"clickedCountryNames",[]);v(this,"worldMapCanvas",null);v(this,"mapDirty",!0);v(this,"actions");v(this,"_onResize",()=>{this.markMapDirty(),this.rootContainer&&this.renderMainGui(this.rootContainer,this.currentGame)});this.state="initialized",this.actions=[new ie,new se,new O,new Se,new j,new X]}afterAction(){if(this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],o=this.currentGame.worldMap.getCountries().find(n=>n.name===e);if(o&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const n=this.currentGame.activePlayer.getCountryInfo(o,this.currentGame.gameTurn),r=document.getElementById("country-info-panel");r&&(r.innerHTML=`
            <b>Country Info</b><br>
            <div><b>Name:</b> ${n.name}</div>
            <div><b>Owner:</b> ${n.owner?n.owner.name:"None"}</div>
            <div><b>Income:</b> ${n.income!==void 0?n.income:"?"}</div>
            <div><b>Army:</b> ${n.army!==void 0?n.army:"?"}</div>
            <div><b>Recency:</b> ${n.recency!==void 0?n.recency:"?"}</div>
          `)}}if(this.markMapDirty(),this.rootContainer&&(this.renderMainGui(this.rootContainer,this.currentGame),this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap)){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],o=this.currentGame.worldMap.getCountries().find(n=>n.name===e);if(o&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const n=this.currentGame.activePlayer.getCountryInfo(o,this.currentGame.gameTurn),r=document.getElementById("country-info-panel");r&&(r.innerHTML=`
              <b>Country Info</b><br>
              <div><b>Name:</b> ${n.name}</div>
              <div><b>Owner:</b> ${n.owner?n.owner.name:"None"}</div>
              <div><b>Income:</b> ${n.income!==void 0?n.income:"?"}</div>
              <div><b>Army:</b> ${n.army!==void 0?n.army:"?"}</div>
              <div><b>Recency:</b> ${n.recency!==void 0?n.recency:"?"}</div>
            `)}}this.updateActionButtons()}updateActionButtons(){const e=document.getElementById("action-buttons-area");if(!e)return;const t=[];if(Array.from(e.children).forEach(s=>{s instanceof HTMLElement&&(s.classList.contains("persistent-action-btn")?(t.push(s),s.textContent&&s.textContent.trim()==="New Game"&&(s.disabled=!1)):e.removeChild(s))}),!this.currentGame||!this.currentGame.players||!this.currentGame.activePlayer)return;const o=this.currentGame.worldMap?this.currentGame.worldMap.getCountries():[],n=this.clickedCountryNames.map(s=>o.find(i=>i.name===s)).filter(Boolean);if(this.currentGame.activePlayer.actionsLeft<=0){const s=document.createElement("div");s.textContent="You are out of actions for this turn!",s.style.background="linear-gradient(90deg,#ff5e62 0%,#ff9966 100%)",s.style.color="#fff",s.style.fontSize="1.5rem",s.style.fontWeight="bold",s.style.padding="32px 0",s.style.borderRadius="12px",s.style.textAlign="center",s.style.margin="24px 0",e.appendChild(s);return}const r=[];for(const s of this.actions){const i=s.GetButtonText(n,this.currentGame.activePlayer);if(i){const l=document.createElement("button");l.textContent=i,l.style.padding="12px 0",l.style.fontSize="1.1rem",l.style.background="linear-gradient(90deg,#00c3ff 0%,#ffff1c 100%)",l.style.color="#222",l.style.border="none",l.style.borderRadius="8px",l.style.cursor="pointer",l.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",l.style.marginBottom="8px",l.onclick=async()=>{const d=s.RequiresAmount(n,this.currentGame.activePlayer,this.currentGame);let a=null;if(d){const[c,h]=d,f=await Ae(c,h,c);if(f===null)return;a=await s.Act(n,this.currentGame.activePlayer,this.currentGame,f)}else a=await s.Act(n,this.currentGame.activePlayer,this.currentGame);this.currentGame.activePlayer.useAction(),typeof a=="string"&&a!==null?(this.showModalMessage(a),this.afterAction()):this.afterAction()},r.push(l)}}if(r.length&&t.length){const s=document.createElement("div");s.style.height="16px",s.style.width="100%",e.insertBefore(s,t[0]),r.forEach(i=>e.insertBefore(i,s))}else r.length&&r.forEach(s=>e.appendChild(s))}showModalMessage(e){let t=document.getElementById("gamegui-modal-messagebox");if(!t){t=document.createElement("div"),t.id="gamegui-modal-messagebox",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.5)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="9999";const n=document.createElement("div");n.style.background="#fff",n.style.padding="32px 40px",n.style.borderRadius="12px",n.style.boxShadow="0 2px 16px rgba(0,0,0,0.2)",n.style.maxWidth="90vw",n.style.maxHeight="80vh",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.gap="24px";const r=document.createElement("div");r.id="gamegui-modal-messagebox-text",r.style.fontSize="1.2rem",r.style.color="#222",n.appendChild(r);const s=document.createElement("button");s.textContent="OK",s.style.marginTop="12px",s.style.padding="8px 24px",s.style.fontSize="1.1rem",s.style.border="none",s.style.borderRadius="6px",s.style.background="linear-gradient(90deg,#ff9966 0%,#ff5e62 100%)",s.style.color="#fff",s.style.cursor="pointer",s.onclick=()=>{t&&t.parentNode&&t.parentNode.removeChild(t)},n.appendChild(s),t.appendChild(n),document.body.appendChild(t)}const o=document.getElementById("gamegui-modal-messagebox-text");o&&(o.textContent=e),t.style.display="flex"}markMapDirty(){this.mapDirty=!0}getWorldMapCanvas(){if(!this.currentGame||!this.currentGame.worldMap)throw new Error("GameGui.getWorldMapCanvas: currentGame or worldMap is missing");if(this.mapDirty||!this.worldMapCanvas){let e=[];if(this.currentGame.activePlayer){const t=this.currentGame.activePlayer.getKnownCountries();e=t.owned.concat(t.known)}this.worldMapCanvas=_.render(this.currentGame.worldMap,[],e,P.showArmies,this.currentGame.activePlayer),this.mapDirty=!1}return this.worldMapCanvas}async mount(e){this.rootContainer=e,window.addEventListener("resize",this._onResize),this.renderMainGui(e,this.currentGame)}unmount(){window.removeEventListener("resize",this._onResize)}async turnStarted(){var o,n;if(this.currentGame&&this.currentGame.activePlayer&&this.currentGame.activePlayer.IncomeShare>=P.INCOME_SHARE_WIN){Ee(this.currentGame.activePlayer.name,P.INCOME_SHARE_WIN*100,()=>{this.canceled=!0}),this.canceled=!0;return}if(this.renderMainGui(this.rootContainer,this.currentGame),this.canceled||!((n=(o=this.currentGame)==null?void 0:o.activePlayer)!=null&&n.isAI))return;const e=this.currentGame.activePlayer.AI;if(!e)return;const t=async()=>{if(this.canceled)return;const r=await e.takeAction();this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),r?setTimeout(()=>t(),100):(this.currentGame.nextTurn(),this.markMapDirty(),this.currentGame.activePlayer.isAI?setTimeout(()=>this.turnStarted(),100):this.turnStarted())};t()}async startNewGame(){this.canceled=!0;const e=this.rootContainer,{showNewGameDialog:t}=await U(async()=>{const{showNewGameDialog:o}=await import("./NewGameDialog-D0kpPWAx.js");return{showNewGameDialog:o}},[]);try{const o=await t(e),n=await U(()=>import("./Player-DRYjS8f-.js"),[]),r=await U(()=>Promise.resolve().then(()=>ke),void 0);r.Game.showArmies=o.showArmies;const s=["#4fc3f7","#81c784","#ffb74d","#e57373","#ba68c8","#ffd54f","#64b5f6","#a1887f"],i=n.Player.COLORS??s,l=o.players.map((d,a)=>new n.Player(d.name,i[a%i.length],[],null,[],0,d.isAI));this.currentGame=r.Game.initNewGame(o.map,l,this),this.markMapDirty(),this.getWorldMapCanvas(),this.renderMainGui(e,this.currentGame),this.currentGame&&this.currentGame.players.length>0&&(this.canceled=!1,this.currentGame.activePlayer.startTurn(),this.turnStarted())}catch(o){console.error("NewGameDialog error or cancellation:",o)}}renderMainGui(e,t){const o=this.rootContainer;if(!o)throw new Error("rootContainer is not set (null) in renderMainGui");o.innerHTML="";const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="row",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.background="linear-gradient(120deg, #232526 0%, #414345 100%)",n.style.borderRadius="0",n.style.boxShadow="none",n.style.overflow="hidden",n.style.margin="0",n.style.maxWidth="100vw";const r=document.createElement("div");r.style.flex="3",r.style.background="#222",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.position="relative",r.style.borderRight="2px solid #333";let s=null;t&&t.worldMap&&(s=this.getWorldMapCanvas()),this.clickedCountryNames||(this.clickedCountryNames=[]);const i=document.createElement("div");if(i.id="country-info-panel",i.style.background="#22232a",i.style.border="1px solid #555",i.style.borderRadius="8px",i.style.padding="10px 12px",i.style.marginBottom="18px",i.style.color="#b3e5fc",i.style.fontSize="1.05rem",i.style.minHeight="100px",i.innerHTML='<b>Country Info</b><br><span style="color:#888">Click a country to view details.</span>',s){let g=function(){y||(y=document.createElement("canvas"),y.width=s.width,y.height=s.height,y.style.position="absolute",y.style.left="0",y.style.top="0",y.style.pointerEvents="none",y.style.width="100%",y.style.height="100%",r.appendChild(y))},u=function(){if(y){const w=y.getContext("2d");w&&w.clearRect(0,0,y.width,y.height)}};s.style.width="100%",s.style.height="100%",s.style.display="block",r.appendChild(s);let y=null;if(!r._fishOverlay){const w=t.worldMap.getMap(),p=s.width,C=s.height,b=(x,k)=>x<0||k<0||k>=w.length||x>=w[0].length?!1:w[k][x]===D;r._fishOverlay=new Te(r,p,C,b)}s._countryClickHandler&&s.removeEventListener("mousedown",s._countryClickHandler);const m=w=>{const p=s.width,C=s.height,b=Math.floor(w.offsetX*(p/s.clientWidth)),x=Math.floor(w.offsetY*(C/s.clientHeight)),k=t.worldMap.getMap(),E=t.worldMap.getCountries();let S=null;if(b>=0&&x>=0&&x<k.length&&b<k[0].length){const T=k[x][b];if(T>=0&&E[T]){if(S=E[T],S.coordinates.some(([A,$])=>A===b&&$===x)||console.warn(`[GameGui] Click at (${b},${x}) is not in coordinates of country: ${S.name}`),this.clickedCountryNames.push(S.name),g(),u(),y&&S){const A=y.getContext("2d");if(A){_.drawCountryGlow(A,S,[0,0,0],S.color);const[$,F]=S.center?S.center():[0,0],V=S.fortified?"🛡️ "+S.name:S.name;if(A.save(),A.font="bold 10px Verdana, Geneva, sans-serif",A.textAlign="center",A.textBaseline="middle",A.lineWidth=3,A.strokeStyle="black",A.strokeText(V,$,F),A.fillStyle="white",A.fillText(V,$,F),P.showArmies&&typeof S.armies=="number"){const J=`${Math.round(S.armies/1e3)}k`;A.font="bold 9px Verdana, Geneva, sans-serif",A.lineWidth=2,A.strokeStyle="black",A.strokeText(J,$,F+13),A.fillStyle="#FFD700",A.fillText(J,$,F+13)}A.restore()}}this.updateActionButtons();const I=document.getElementById("country-info-panel");if(I&&t&&t.activePlayer&&typeof t.gameTurn=="number"){const A=t.activePlayer.getCountryInfo(S,t.gameTurn);I.innerHTML=`
                <b>Country Info</b><br>
                <div><b>Name:</b> ${A.name}</div>
                <div><b>Owner:</b> ${A.owner?A.owner.name:"None"}</div>
                <div><b>Income:</b> ${A.income!==void 0?A.income:"?"}</div>
                <div><b>Army:</b> ${A.army!==void 0?A.army:"?"}</div>
                <div><b>Recency:</b> ${A.recency!==void 0?A.recency:"?"}</div>
              `}const N=document.getElementById("last-clicked-country-info-panel");if(N&&t&&t.activePlayer&&typeof t.gameTurn=="number"){const A=t.activePlayer.getCountryInfo(S,t.gameTurn);N.innerHTML=`
                <b>Last Clicked Country Info</b><br>
                <div><b>Name:</b> ${A.name}</div>
                <div><b>Owner:</b> ${A.owner?A.owner.name:"None"}</div>
                <div><b>Income:</b> ${A.income!==void 0?A.income:"?"}</div>
                <div><b>Army:</b> ${A.army!==void 0?A.army:"?"}</div>
                <div><b>Recency:</b> ${A.recency!==void 0?A.recency:"?"}</div>
              `}}}};s.addEventListener("mousedown",m),s._countryClickHandler=m}else{const g=document.createElement("div");g.style.width="100%",g.style.height="100%",g.style.background="repeating-linear-gradient(135deg,#444 0 10px,#333 10px 20px)",g.style.border="4px solid #666",g.style.borderRadius="12px",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center";const u=document.createElement("img");u.src="riskStartup.png",u.alt="Risk Startup",u.style.width="100%",u.style.height="100%",u.style.objectFit="cover",u.style.borderRadius="8px",g.appendChild(u),r.appendChild(g)}const l=document.createElement("div");l.appendChild(i),l.style.flex="1",l.style.background="rgba(30,32,34,0.98)",l.style.display="flex",l.style.flexDirection="column",l.style.padding="32px 24px",l.style.color="#fff",l.style.minWidth="320px";const d=document.createElement("div");d.style.marginBottom="32px";const a=document.createElement("div");if(a.style.fontSize="1.2rem",a.style.fontWeight="bold",t&&t.players&&t.players.length>0){const g=t.activePlayer;a.textContent=`Turn: ${t.gameTurn} | Player: ${g.name}`;const u=document.createElement("div"),y=g.constructor.ACTIONS_PER_TURN||5,m=g.actionsLeft;u.style.margin="8px 0 0 0",u.style.fontSize="2rem",u.style.letterSpacing="0.2rem";for(let w=0;w<y;w++){const p=document.createElement("span");p.textContent=w<m?"★":"☆",p.style.color=w<m?"#ffd700":"#888",u.appendChild(p)}u.title=`${m} of ${y} actions remaining`,d.appendChild(u)}else a.textContent="No game loaded. Start a new game to play!";if(d.appendChild(a),l.appendChild(d),t&&t.players&&t.players.length>0){const g=document.createElement("div");g.textContent="Players",g.style.fontWeight="bold",g.style.marginBottom="8px",l.appendChild(g);const u=document.createElement("ul");u.style.listStyle="none",u.style.padding="0",u.style.margin="0 0 24px 0";for(const y of t.players){const m=document.createElement("li");m.style.display="flex",m.style.alignItems="center",m.style.marginBottom="8px",y===t.activePlayer&&(m.style.boxShadow="0 0 16px 4px #ffd700, 0 0 4px 2px #fff",m.style.border="2px solid #ffd700",m.style.borderRadius="12px",m.style.background="rgba(255, 215, 0, 0.10)");const w=document.createElement("span");w.style.display="inline-block",w.style.width="16px",w.style.height="16px",w.style.borderRadius="50%",w.style.background=y.color,w.style.marginRight="8px",m.appendChild(w);const p=document.createElement("span");if(p.textContent=y.name+(y.isAI?" (AI)":""),p.style.flex="1",m.appendChild(p),typeof y.money=="number"){const C=document.createElement("span");C.textContent=`💰 ${y.money}`,C.style.marginLeft="8px",m.appendChild(C);const b=document.createElement("span");b.style.display="inline-block",b.style.width="54px",b.style.height="12px",b.style.marginLeft="8px",b.style.verticalAlign="middle",b.style.background="#222",b.style.border="1px solid #444",b.style.borderRadius="6px",b.style.overflow="hidden";const x=document.createElement("span"),k=Math.min(y.IncomeShare/P.INCOME_SHARE_WIN,1);x.style.display="inline-block",x.style.height="100%",x.style.width=`${Math.round(k*100)}%`,x.style.background=k>=1?"linear-gradient(90deg,#43cea2,#ffd700)":"linear-gradient(90deg,#43cea2,#185a9d)",x.style.transition="width 0.3s",b.title=`Income share: ${(y.IncomeShare*100).toFixed(1)}% (win at ${(P.INCOME_SHARE_WIN*100).toFixed(0)}%)`,b.appendChild(x),m.appendChild(b)}u.appendChild(m)}l.appendChild(u)}const c=document.createElement("div");c.id="action-buttons-area",c.style.display="flex",c.style.flexDirection="column",c.style.gap="12px",c.style.marginTop="auto";const h=document.createElement("button");h.textContent="New Game",h.classList.add("persistent-action-btn"),h.style.padding="12px 0",h.style.fontSize="1.1rem",h.style.background="linear-gradient(90deg,#00c3ff 0%,#ffff1c 100%)",h.style.color="#222",h.style.border="none",h.style.borderRadius="8px",h.style.cursor="pointer",h.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",h.style.marginBottom="8px",h.onclick=()=>{this.startNewGame()},c.appendChild(h);const f=document.createElement("button");f.textContent="End Turn",f.classList.add("persistent-action-btn"),f.style.padding="12px 0",f.style.fontSize="1.1rem",f.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",f.style.color="#fff",f.style.border="none",f.style.borderRadius="8px",f.style.cursor="pointer",f.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",f.onclick=()=>{this.currentGame&&(this.currentGame.nextTurn(),this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),this.turnStarted())},c.appendChild(f),l.appendChild(c),n.appendChild(r),n.appendChild(l),o.appendChild(n)}}function Be(M,e){const t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.zIndex="10000",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.pointerEvents="none",t.style.overflow="hidden";const o=document.createElement("div");o.innerText="Armchair",o.style.position="relative",o.style.color="#fffbe6",o.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',o.style.fontSize="6vw",o.style.fontWeight="bold",o.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",o.style.letterSpacing="0.18em",o.style.opacity="0",o.style.transform="translateX(-120%) skew(-12deg)",o.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",o.style.filter="drop-shadow(0 0 12px #fffbe6)",o.style.background="",o.style.webkitBackgroundClip="",o.style.backgroundClip="",o.style.webkitTextFillColor="";const n=document.createElement("div");n.innerText="General",n.style.position="relative",n.style.color="#fffbe6",n.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',n.style.fontSize="6vw",n.style.fontWeight="bold",n.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",n.style.letterSpacing="0.18em",n.style.opacity="0",n.style.transform="translateX(120%) skew(12deg)",n.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",n.style.filter="drop-shadow(0 0 12px #fffbe6)",n.style.background="",n.style.webkitBackgroundClip="",n.style.backgroundClip="",n.style.webkitTextFillColor="";const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.justifyContent="center",r.style.gap="1vw",r.style.pointerEvents="none",r.appendChild(o),r.appendChild(n),t.appendChild(r),M.appendChild(t);const s=document.createElement("canvas");s.width=M.offsetWidth||800,s.height=M.offsetHeight||600,s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none",t.appendChild(s);const i=s.getContext("2d"),l=10,d=[];s.width/2;const a=s.height*.8;for(let u=0;u<l;u++){const m=u%2===0?s.width*.05:s.width*.95,w=s.width*(.15+.7*Math.random()),p=a-s.height*.25+Math.random()*s.height*.1,C=a-s.height*.05+Math.random()*s.height*.18,b=1200+Math.random()*400,x=s.height*(.32+Math.random()*.12);d.push({startX:m,startY:p,endX:w,endY:C,duration:b,startTime:null,exploded:!1,explosionTime:null,arcHeight:x})}function c(u,y,m){i&&(i.save(),i.beginPath(),i.arc(u,y,18*m,0,2*Math.PI),i.fillStyle="rgba(40,40,40,0.95)",i.shadowColor="#222",i.shadowBlur=12*m,i.fill(),i.restore(),i.save(),i.beginPath(),i.arc(u-6*m,y-6*m,5*m,0,2*Math.PI),i.fillStyle="rgba(200,200,200,0.18)",i.fill(),i.restore())}function h(u,y,m){if(i){if(m<.15){const w=38+60*m;i.save(),i.beginPath(),i.arc(u,y,w,0,2*Math.PI),i.fillStyle=`rgba(255,255,220,${.7*(1-m/.15)})`,i.shadowColor="#fffbe6",i.shadowBlur=48,i.fill(),i.restore()}if(m<.6){const w=32+80*m;i.save(),i.beginPath(),i.arc(u,y,w,0,2*Math.PI),i.fillStyle=`rgba(255,120,40,${.5*(1-m/.6)})`,i.shadowColor="#ffae42",i.shadowBlur=32,i.fill(),i.restore(),i.save(),i.beginPath(),i.arc(u,y,w*.5,0,2*Math.PI),i.fillStyle=`rgba(255,220,120,${.7*(1-m/.6)})`,i.shadowColor="#fffbe6",i.shadowBlur=16,i.fill(),i.restore()}if(m>.2){const w=(m-.2)/.8;for(let p=0;p<4;p++){const C=Math.PI*2*(p/4)+Math.random()*.2,b=38+60*m+Math.random()*10,x=u+Math.cos(C)*b*.7*w,k=y+Math.sin(C)*b*.5*w+10*w;i.save(),i.beginPath(),i.arc(x,k,18+18*w,0,2*Math.PI),i.fillStyle=`rgba(80,60,40,${.18*(1-w)})`,i.shadowColor="#222",i.shadowBlur=8,i.fill(),i.restore()}}}}function f(u){i.clearRect(0,0,s.width,s.height);let y=!0;for(const m of d){m.startTime||(m.startTime=u);const w=u-m.startTime;if(m.exploded){if(m.explosionTime&&u-m.explosionTime<700){const p=(u-m.explosionTime)/700;h(m.endX,m.endY,p),y=!1}}else{y=!1;const p=Math.min(w/m.duration,1),C=m.startX+(m.endX-m.startX)*p,b=(1-p)*m.startY+p*m.endY-m.arcHeight*4*p*(1-p),x=.9+.3*(1-Math.abs(2*p-1));c(C,b,x),p>=1&&(m.exploded=!0,m.explosionTime=u)}}y||requestAnimationFrame(f)}requestAnimationFrame(f),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateX(0) skew(0)",n.style.opacity="1",n.style.transform="translateX(0) skew(0)"},400),setTimeout(()=>{},3200);const g=document.createElement("link");g.rel="stylesheet",g.href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=UnifrakturCook:wght@700&display=swap",document.head.appendChild(g)}const Y=document.getElementById("app");if(Y)Y.innerHTML="",new Pe().mount(Y),setTimeout(()=>{const e=Y.querySelector('div[style*="flex: 3"]');e&&Be(e)},0);else throw new Error("No app element found in index.html");export{we as C,_ as R,ne as W};
