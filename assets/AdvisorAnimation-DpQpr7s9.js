async function R(e,C,c,y){return new Promise(t=>{const d=new window.Image;d.src="Hand.png",d.onload=()=>{const f=d.width*.5,P=d.height*.5,r=500,p=200,h=1e3,s=700,v=performance.now(),a=C+100,i=c-100,n=C,m=c;function H(g){const l=g-v;e.clearRect(0,0,y.width,y.height);let b=a,A=i,u=1;if(l<r){const o=l/r;b=a+(n-a)*o,A=i+(m-i)*o,u=o}else if(l<r+p)b=n,A=m,u=1;else{const o=Math.min(1,(l-r-p)/s);b=n+(a-n)*o,A=m+(i-m)*o,u=1-o}u=Math.max(.01,Math.min(1,u));const w=Math.min(1,(l-r)/h);if(w<1&&l>=r)for(let o=0;o<5;o++){const M=18+28*w+o*12;e.save(),e.beginPath(),e.arc(C,c,M,0,2*Math.PI);const I=(360*(o/5)+360*w)%360;e.strokeStyle=`hsla(${I}, 95%, 55%, ${.85*(1-w)})`,e.lineWidth=5-o*1.2,e.globalAlpha=1*(1-w),e.shadowColor=`hsla(${I}, 95%, 65%, 0.8)`,e.shadowBlur=18,e.stroke(),e.restore()}e.save(),e.globalAlpha=u,e.drawImage(d,b,A-P,f,P),e.restore(),l<r+Math.max(h,p+s)?requestAnimationFrame(H):(e.clearRect(0,0,y.width,y.height),t())}requestAnimationFrame(H)}})}async function S(e,C){var P,r,p;e.isProcessingAdvisorSynthetic=!0;const c=document.querySelector('div[style*="flex: 3"]');if(!c)return;const y=c.getBoundingClientRect();let t=document.getElementById("advisor-animation-overlay");t?(t.width=window.innerWidth,t.height=window.innerHeight):(t=document.createElement("canvas"),t.id="advisor-animation-overlay",t.width=window.innerWidth,t.height=window.innerHeight,t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.pointerEvents="none",t.style.width="100vw",t.style.height="100vh",t.style.zIndex="9999",document.body.appendChild(t));const d=t.getContext("2d");if(!d)return;let f=[];for(const h of C.countries){f.push(h.name);const s=document.getElementById("country-info-panel");if(s&&e.currentGame&&typeof e.currentGame.gameTurn=="number"){const n=e.currentGame.activePlayer.getCountryInfo(h,e.currentGame.gameTurn);s.innerHTML=`
        <div><b>Name:</b> ${n.name}</div>
        <div><b>Owner:</b> ${n.owner?n.owner.name:"None"}</div>
        <div><b>Income:</b> ${n.income!==void 0?n.income:"?"}</div>
        <div><b>Army:</b> ${n.army!==void 0?n.army:"?"}</div>
        <div><b>Recency:</b> ${n.recency!==void 0?n.recency:"?"}</div>
      `}let[v,a]=h.center();const i=c.querySelector("canvas");if(i){const n=i.clientWidth/i.width,m=i.clientHeight/i.height;v*=n,a*=m}v+=y.left,a+=y.top,await R(d,v,a,t),d.clearRect(0,0,t.width,t.height)}if(e.setClickedCountryNames([...f]),f.length>0&&c){const h=((r=(P=e.currentGame)==null?void 0:P.worldMap)==null?void 0:r.getCountries())||[],s=c.querySelector("canvas");if(s)for(const v of[...f]){const a=h.find(i=>i.name===v);if(a){const[i,n]=a.center?a.center():[0,0],m=s.width,H=s.height,g=s.getBoundingClientRect(),l=g.width/m,b=g.height/H,A=i*l,u=n*b,w=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:g.left+A,clientY:g.top+u});Object.defineProperty(w,"isAdvisorSynthetic",{value:!0}),s.dispatchEvent(w),await new Promise(o=>setTimeout(o,50))}}}(p=t.parentElement)==null||p.removeChild(t),e.isProcessingAdvisorSynthetic=!1}export{S as runAdvisorAnimation};
