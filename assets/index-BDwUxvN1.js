var ue=Object.defineProperty;var fe=(M,e,n)=>e in M?ue(M,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):M[e]=n;var b=(M,e,n)=>fe(M,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ye="modulepreload",me=function(M){return"/Armchair-General/"+M},oe={},K=function(e,n,t){let o=Promise.resolve();if(n&&n.length>0){let r=function(l){return Promise.all(l.map(a=>Promise.resolve(a).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=r(n.map(l=>{if(l=me(l),l in oe)return;oe[l]=!0;const a=l.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":ye,a||(u.as="script"),u.crossOrigin="",u.href=l,c&&u.setAttribute("nonce",c),document.head.appendChild(u),a)return new Promise((h,w)=>{u.addEventListener("load",h),u.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return o.then(r=>{for(const i of r||[])i.status==="rejected"&&s(i.reason);return e().catch(s)})};class pe{constructor(e=[]){b(this,"countries");this.countries=e}}const ae=Math.sqrt(3),ge=.5*(ae-1),Y=(3-ae)/6,re=M=>Math.floor(M)|0,se=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Z(M=Math.random){const e=we(M),n=new Float64Array(e).map(o=>se[o%12*2]),t=new Float64Array(e).map(o=>se[o%12*2+1]);return function(s,r){let i=0,c=0,l=0;const a=(s+r)*ge,d=re(s+a),u=re(r+a),h=(d+u)*Y,w=d-h,y=u-h,f=s-w,m=r-y;let g,p;f>m?(g=1,p=0):(g=0,p=1);const C=f-g+Y,x=m-p+Y,v=f-1+2*Y,k=m-1+2*Y,A=d&255,T=u&255;let I=.5-f*f-m*m;if(I>=0){const $=A+e[T],q=n[$],S=t[$];I*=I,i=I*I*(q*f+S*m)}let E=.5-C*C-x*x;if(E>=0){const $=A+g+e[T+p],q=n[$],S=t[$];E*=E,c=E*E*(q*C+S*x)}let B=.5-v*v-k*k;if(B>=0){const $=A+1+e[T+1],q=n[$],S=t[$];B*=B,l=B*B*(q*v+S*k)}return 70*(i+c+l)}}function we(M){const n=new Uint8Array(512);for(let t=0;t<512/2;t++)n[t]=t;for(let t=0;t<512/2-1;t++){const o=t+~~(M()*(256-t)),s=n[t];n[t]=n[o],n[o]=s}for(let t=256;t<512;t++)n[t]=n[t-256];return n}function Ce(M,e,n,t=1e3){var l;const o=M.length,s=((l=M[0])==null?void 0:l.length)||0,r=Array.from({length:o},()=>Array(s).fill(!1)),i=[[1,0],[-1,0],[0,1],[0,-1]],c=M.map(a=>a.slice());for(let a=0;a<o;a++)for(let d=0;d<s;d++)if(!r[a][d]&&M[a][d]===n){const u=[[a,d]],h=[[a,d]];for(r[a][d]=!0;u.length;){const[w,y]=u.shift();for(const[f,m]of i){const g=w+f,p=y+m;g>=0&&g<o&&p>=0&&p<s&&!r[g][p]&&M[g][p]===n&&(r[g][p]=!0,u.push([g,p]),h.push([g,p]))}}if(h.length<t)for(const[w,y]of h)c[w][y]=e}return c}function xe(M,e,n){var l;const t=M.length,o=((l=M[0])==null?void 0:l.length)||0,s=Array.from({length:t},()=>Array(o).fill(!1)),r=[];for(let a=0;a<o;a++)M[0][a]===e&&(r.push([0,a]),s[0][a]=!0),M[t-1][a]===e&&(r.push([t-1,a]),s[t-1][a]=!0);for(let a=1;a<t-1;a++)M[a][0]===e&&(r.push([a,0]),s[a][0]=!0),M[a][o-1]===e&&(r.push([a,o-1]),s[a][o-1]=!0);const i=[[1,0],[-1,0],[0,1],[0,-1]];for(;r.length;){const[a,d]=r.shift();for(const[u,h]of i){const w=a+u,y=d+h;w>=0&&w<t&&y>=0&&y<o&&!s[w][y]&&M[w][y]===e&&(s[w][y]=!0,r.push([w,y]))}}return M.map((a,d)=>a.map((u,h)=>u===e&&!s[d][h]?n:u))}function be(M,e){return le(M,e,{scale:.0018,threshold:-.05,borderStrength:.5,borderWidth:.15,octaves:6,persistence:.5,seed:Math.floor(Math.random()*1e9)})}function le(M,e,n){const t=(n==null?void 0:n.scale)??.015,o=(n==null?void 0:n.threshold)??0,s=(n==null?void 0:n.seed)!==void 0?ve(n.seed):Math.random,r=Z(s),i=(n==null?void 0:n.borderStrength)??.5,c=(n==null?void 0:n.borderWidth)??.2,l=(n==null?void 0:n.octaves)??4,a=(n==null?void 0:n.persistence)??.5,d=[];for(let h=0;h<e;h++){const w=[];for(let y=0;y<M;y++){const f=y-M/2,m=h-e/2;let g=0,p=0,C=1,x=1;for(let I=0;I<l;I++)g+=r(f*t*C,m*t*C)*x,p+=x,x*=a,C*=2;g/=p;const v=Math.min(y,M-1-y)/(M/2),k=Math.min(h,e-1-h)/(e/2),A=Math.min(v,k);let T=g;if(A<c){const I=i*(1-A/c);T=g*(1-I)+R*I}w.push(T>o?L:R)}d.push(w)}let u=xe(d,R,L);return u=Ce(u,R,L,1e3),u}function ve(M){return function(){let e=M+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}class Me{constructor(e,n=null,t=0,o=0){b(this,"name");b(this,"owner");b(this,"armies");b(this,"income");b(this,"coordinates");b(this,"border");b(this,"oceanBorder");b(this,"neighbors");b(this,"color");b(this,"fortified",!1);b(this,"_center",null);this.name=e,this.owner=n,this.armies=t,this.income=o,this.coordinates=[],this.border=[],this.oceanBorder=[],this.neighbors=[],this.color=[Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150)]}setOwner(e){this.owner=e}setArmies(e){this.armies=e}center(){if(this._center)return this._center;if(!this.coordinates.length)return this._center=[0,0],this._center;let e=0,n=0;for(const[t,o]of this.coordinates)e+=t,n+=o;return this._center=[e/this.coordinates.length,n/this.coordinates.length],this._center}canBeFortified(){if(this.fortified)return!1;if(this.owner){for(const[e,n]of this.owner.plannedFortifications)if(e===this)return!1}return!0}}class ke{static generateCountriesMap(e,n={}){if(!e||e.length===0||!e[0])throw new Error("continentMap must be a non-empty 2D array");const t=e.length,o=e[0].length,s=n.countryCount??12,r=n.scale??.09,i=n.minResistance??10,c=n.maxResistance??50,l=n.skipProbability??.9,a=n.seed!==void 0?Ae(n.seed):Math.random,d=Z(a),u=[];for(let p=0;p<t;p++){const C=[];for(let x=0;x<o;x++)C.push(e[p][x]===L?i+(c-i)*Math.abs(d(x*r,p*r)):1/0);u.push(C)}const h=[],w=[];for(let p=0;p<t;p++)for(let C=0;C<o;C++)e[p][C]===L&&w.push([C,p]);for(let p=0;p<s&&w.length>0;p++){const C=Math.floor(a()*w.length),[x,v]=w.splice(C,1)[0];h.push({x,y:v,idx:p})}for(let p=0;p<t;p++)for(let C=0;C<o;C++)e[p][C]!==R&&(e[p][C]=L);for(const{x:p,y:C,idx:x}of h)e[C][p]=x;const y=h.map(({x:p,y:C,idx:x})=>[p,C,x]),f=(i+c)/2;for(;y.length>0;){const p=Math.floor(a()*y.length),[C,x,v]=y.splice(p,1)[0],k=[];for(const[A,T]of[[1,0],[0,1],[-1,0],[0,-1]]){const I=C+A,E=x+T;I>=0&&I<o&&E>=0&&E<t&&e[E][I]===L&&k.push([I,E])}if(k.length!==0)for(const[A,T]of k)u[T][A]>f&&a()<l||(e[T][A]=v,y.push([A,T,v]))}const m=Array.from({length:t},()=>Array(o).fill(!1));let g=0;for(let p=0;p<t;p++)for(let C=0;C<o;C++)e[p][C]>=0&&e[p][C]+1>g&&(g=e[p][C]+1);for(let p=0;p<t;p++)for(let C=0;C<o;C++)if(e[p][C]===L&&!m[p][C]){const x=[[C,p]];for(m[p][C]=!0;x.length>0;){const[v,k]=x.pop();e[k][v]=g;for(const[A,T]of[[1,0],[0,1],[-1,0],[0,-1]]){const I=v+A,E=k+T;I>=0&&I<o&&E>=0&&E<t&&e[E][I]===L&&!m[E][I]&&(x.push([I,E]),m[E][I]=!0)}}g++}return e}static generateCountriesInternal(e,n){const t=this.generateCountriesMap(e,n);if(!t||t.length===0||!t[0])throw new Error("map must be a non-empty 2D array");const o=t.length,s=t[0].length,r={};for(let l=0;l<o;l++)for(let a=0;a<s;a++){const d=t[l][a];if(d>=0){if(!r[d]){const u=new Me(`Country ${d}`);u.id=d,r[d]=u}r[d].coordinates.push([a,l])}}const i=Math.max(...Object.keys(r).map(Number)),c=Array.from({length:i+1},(l,a)=>r[a]);return this.findCountryBorders(t,c,s,o),{map:t,countries:c}}static findCountryBorders(e,n,t,o){const s=[[1,0],[0,1],[-1,0],[0,-1]];for(const r of n){const i=r.id;r.border=[],r.oceanBorder=[];for(const[c,l]of r.coordinates){let a=!1,d=!1;for(const[u,h]of s){const w=c+u,y=l+h;(w<0||w>=t||y<0||y>=o||e[y][w]!==i)&&(a=!0,(w<0||w>=t||y<0||y>=o||e[y][w]===R)&&(d=!0))}a&&r.border.push([c,l]),d&&r.oceanBorder.push([c,l])}}}static findNeighbors(e){const n=new Map;for(const t of e)for(const[o,s]of t.border)n.set(`${o},${s}`,t);for(const t of e){const o=new Set;for(const[s,r]of t.border)for(const[i,c]of[[1,0],[0,1],[-1,0],[0,-1]]){const l=s+i,a=r+c,d=n.get(`${l},${a}`);d&&d!==t&&o.add(d)}t.neighbors=Array.from(o)}}static mergeSmallCountries(e,n=1e3){let t=!0;for(;t;){t=!1;for(let o=e.length-1;o>=0;o--){const s=e[o];if(s.coordinates.length<n&&s.neighbors.length>0){let r=s.neighbors[0];for(const i of s.neighbors)i.coordinates.length<r.coordinates.length&&(r=i);r.coordinates.push(...s.coordinates),e.splice(o,1),t=!0}}t&&this.findNeighbors(e)}}static generateCountries(e,n={}){const{map:t,countries:o}=this.generateCountriesInternal(e,n);this.findNeighbors(o);const s=(n==null?void 0:n.minCountrySize)??1e3;if(this.mergeSmallCountries(o,s),!t||t.length===0||!t[0])throw new Error("map must be a non-empty 2D array");const r=t[0].length,i=t.length;return this.findCountryBorders(t,o,r,i),this.findNeighbors(o),{map:t,countries:o}}}function Ae(M){return function(){let e=M+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function Se(M,e){return ke.generateCountries(M,{countryCount:e,minResistance:0,maxResistance:130,skipProbability:0})}const R=-1,L=-2,z=class z{constructor(e,n,t=[]){b(this,"countries");b(this,"map");b(this,"continents",[]);this.countries=t,this.map=z.createOceanMap(e,n)}static logCountryNamesInOrder(e,n=""){const t=e.map((o,s)=>`${s}: ${o.name}`);console.log(`[WorldMap] Country order${n?" - "+n:""}:
`+t.join(", "))}static checkMapCountryConsistency(e,n){if(!Array.isArray(e)||!Array.isArray(n))return console.error("[WorldMap] Consistency check failed: map or countries not arrays"),!1;let t=!0;for(let o=0;o<e.length;++o)for(let s=0;s<e[o].length;++s){const r=e[o][s];r>=0&&(n[r]?typeof n[r].name!="string"&&(console.error(`[WorldMap] Inconsistent: countries[${r}] has no valid name at map[${o}][${s}]`),t=!1):(console.error(`[WorldMap] Inconsistent: map[${o}][${s}] = ${r}, but countries[${r}] is undefined`),t=!1))}return t}assignRandomCountryNames(){let e=!1;for(;!e;){const n=new Set;for(const t of this.countries){let o,s=0;do if(o=z.generateRandomName(),s++,s>1e3)throw new Error("Failed to generate unique random country names");while(n.has(o));t.name=o,n.add(o)}e=n.size===this.countries.length}}assignRealCountryNames(){let e=!1;for(;!e;){const n=[...z.REAL_COUNTRY_NAMES],t=new Set;for(const o of this.countries){let s;if(n.length>0){const r=Math.floor(Math.random()*n.length);s=n.splice(r,1)[0]}else{let r=0;do if(s=z.generateRandomName(),r++,r>1e3)throw new Error("Failed to generate unique fallback country names");while(t.has(s))}o.name=s,t.add(s)}e=t.size===this.countries.length}}static generateRandomName(){const e=["zan","mor","vek","tal","rin","dor","lek","sha","val","nor","ka","bel","dra","sil","tur","gar","fen","mir","sol","vor","lin","sar","qu","zel","ron","bar","zen","tir","lom","kal","vin","lor","mel","dar","gol","han","jor","ken","lun","mar"],n=2+Math.floor(Math.random()*2);let t="";for(let o=0;o<n;o++)t+=e[Math.floor(Math.random()*e.length)];return t.charAt(0).toUpperCase()+t.slice(1)}static createOceanMap(e,n){return Array.from({length:n},()=>Array(e).fill(R))}static generateContinentsMap(e,n,t){return le(e,n,t)}static createMap(e,n,t=40,o=!0){const s=be(e,n),{map:r,countries:i}=Se(s,t),c=new z(e,n,i);return c.map=r,o?c.assignRealCountryNames():c.assignRandomCountryNames(),c.regenerateMapFromCountries(c.countries),c.createContinents(),c}addCountry(e){this.countries.push(e)}createContinents(){const e=new Set,n=[];for(const t of this.countries)if(!e.has(t)){const o=[t],s=[];for(e.add(t);o.length>0;){const r=o.shift();s.push(r);for(const i of r.neighbors)e.has(i)||(e.add(i),o.push(i))}n.push(new pe(s))}this.continents=n}getCountries(){return this.countries}distance(e,n){const[t,o]=e.center(),[s,r]=n.center(),i=Math.sqrt((t-s)**2+(o-r)**2);if(e.neighbors.includes(n)||n.neighbors.includes(e))return i;const c=e.oceanBorder&&e.oceanBorder.length>0,l=n.oceanBorder&&n.oceanBorder.length>0;return c&&l?i*3:null}getMap(){return this.map}regenerateMapFromCountries(e){if(!this.map||!Array.isArray(this.map)||this.map.length===0||this.map[0].length===0)throw new Error("WorldMap.map is not initialized or has invalid dimensions");const n=this.map.length,t=this.map[0].length,o=z.createOceanMap(t,n);for(let s=0;s<e.length;++s){const r=e[s];if(!r.coordinates||!Array.isArray(r.coordinates))throw new Error(`Country at index ${s} has no valid coordinates array`);for(const[i,c]of r.coordinates){if(typeof i!="number"||typeof c!="number"||i<0||i>=t||c<0||c>=n)throw new Error(`Country index ${s} has out-of-bounds coordinate (${i}, ${c})`);o[c][i]=s}}this.map=o}};b(z,"REAL_COUNTRY_NAMES",["Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia"]);let ie=z;const N=class N{static render(e,n=[],t=[],o=!1,s=null){var w;const r=e.getMap(),i=((w=e.getCountries)==null?void 0:w.call(e))||[],c=r.length,l=r[0].length,a=document.createElement("canvas");a.width=l,a.height=c;const d=a.getContext("2d");if(!d)throw new Error("Could not get canvas context");const u=d.createImageData(l,c),h=u.data;for(let y=0;y<c;y++)for(let f=0;f<l;f++){const m=r[y][f],[g,p,C]=N.getRGBForValue(m,i,f,y,r),x=(y*l+f)*4;h[x]=g,h[x+1]=p,h[x+2]=C,h[x+3]=255}if(n&&n.length>0){for(const y of n)if(!(!y||!y.coordinates)){for(const[f,m]of y.coordinates)if(f>=0&&f<l&&m>=0&&m<c){const g=(m*l+f)*4;h[g]=Math.min(255,Math.round(.6*255+.4*h[g])),h[g+1]=Math.min(255,Math.round(.6*255+.4*h[g+1])),h[g+2]=Math.round(.4*h[g+2]),h[g+3]=255}}}for(const y of i){const f=y.owner&&y.owner.homeCountry===y,m=f?[255,140,0]:[0,0,0];for(const[g,p]of y.border||[])if(f)for(let C=-1;C<=1;C++)for(let x=-1;x<=1;x++){const v=g+x,k=p+C;if(v>=0&&v<l&&k>=0&&k<c){const A=(k*l+v)*4;h[A]=m[0],h[A+1]=m[1],h[A+2]=m[2],h[A+3]=255}}else if(g>=0&&g<l&&p>=0&&p<c){const C=(p*l+g)*4;h[C]=m[0],h[C+1]=m[1],h[C+2]=m[2],h[C+3]=255}}d.putImageData(u,0,0),d.save(),d.font="bold 10px MedievalSharp, Verdana, serif",d.textAlign="center",d.textBaseline="middle";for(const y of i){if(!y.name)continue;const[f,m]=y.center?y.center():[0,0],g=y.fortified?"🛡️ "+y.name:y.name;d.lineWidth=3,d.strokeStyle="black",d.strokeText(g,f,m);const p=t.some(x=>x===y);d.fillStyle=p?"#90EE90":"white",d.fillText(g,f,m);let C=!1;if((o||s&&y.owner===s&&!s.isAI||s&&typeof s.armyKnown=="function"&&s.armyKnown(y)&&!s.isAI)&&(C=!0),C){const x=y.armies||0,v=`${Math.round(x/1e3)}k`;d.font="bold 9px MedievalSharp, Verdana, serif",d.lineWidth=2,d.strokeStyle="black",d.strokeText(v,f,m+13),d.fillStyle="#FFD700",d.fillText(v,f,m+13),d.font="bold 10px MedievalSharp, Verdana, serif"}}return d.restore(),a}static displayWithPanZoom(e,n,t=512,o=512,s=[]){let r=null,i=N.render(e,[],s);const c=i.width,l=i.height,a=document.createElement("canvas");a.width=t,a.height=o,a.style.border="1px solid #888",n.appendChild(a);const d=a.getContext("2d");if(!d)throw new Error("Could not get canvas context");let u=Math.min(a.width/c,a.height/l),h=(a.width-c*u)/2,w=(a.height-l*u)/2,y=!1,f=0,m=0;function g(){i=N.render(e,r?[r]:[],s),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,a.width,a.height),d.setTransform(u,0,0,u,h,w),d.drawImage(i,0,0)}return a.addEventListener("mousedown",p=>{const C=a.getBoundingClientRect(),x=(p.clientX-C.left-h)/u,v=(p.clientY-C.top-w)/u,k=e.getMap(),A=e.getCountries(),T=Math.floor(x),I=Math.floor(v);let E=null;if(T>=0&&I>=0&&I<k.length&&T<k[0].length){const B=k[I][T];B>=0&&A[B]&&(E=A[B])}if(E){r=E,g();return}y=!0,f=p.clientX,m=p.clientY}),window.addEventListener("mousemove",p=>{if(!y)return;const C=p.clientX-f,x=p.clientY-m;h+=C,w+=x,f=p.clientX,m=p.clientY,g()}),window.addEventListener("mouseup",()=>{y=!1}),a.addEventListener("wheel",p=>{p.preventDefault();const C=p.offsetX,x=p.offsetY,v=Math.exp(-p.deltaY*.001);h=C-(C-h)*v,w=x-(x-w)*v,u*=v,g()}),g(),a}static getRGBForValue(e,n,t,o,s){var r,i,c;if(e===R){t=t??0,o=o??0,s=s??[];const l=((r=s[0])==null?void 0:r.length)||1024,a=s.length||768,d=o/a;let u=Math.round(30*(1-d)+10*d),h=Math.round(144*(1-d)+80*d),w=Math.round(255*(1-d)+180*d);const y=N._oceanNoise2D(t*.03,o*.03),f=Math.floor(18*y);u+=f,h+=f,w+=f;let m=!1;if(s&&t>0&&o>0&&t<l-1&&o<a-1)for(const[g,p]of[[1,0],[-1,0],[0,1],[0,-1]]){const C=t+g,x=o+p;if(s[x][C]!==R){m=!0;break}}return m&&(u=Math.min(255,u+40),h=Math.min(255,h+40),w=Math.min(255,w+40)),[u,h,w]}if(e===L){t=t??0,o=o??0,s=s??[];const l=((i=s[0])==null?void 0:i.length)||1024,a=s.length||768,d=N._landNoise2D(t*.04,o*.04),u=[34,139,34],h=[80,180,80],w=.5+.5*d;let y=Math.round(u[0]*(1-w)+h[0]*w),f=Math.round(u[1]*(1-w)+h[1]*w),m=Math.round(u[2]*(1-w)+h[2]*w),g=!1;if(s&&t>0&&o>0&&t<l-1&&o<a-1)for(const[p,C]of[[1,0],[-1,0],[0,1],[0,-1]]){const x=t+p,v=o+C;if(s[v][x]===R){g=!0;break}}return g&&(y=Math.min(255,y+30),f=Math.min(255,f+30),m=Math.min(255,m+30)),[y,f,m]}if(e>=0){const l=n[e];let a=[200,200,200];if(l)if(l.owner&&typeof l.owner.RGBColor=="string"){const A=l.owner.RGBColor.split(",").map(Number);A.length===3&&A.every(T=>!isNaN(T))&&(a=[A[0],A[1],A[2]])}else l.color&&(a=l.color);t=t??0,o=o??0,s=s??[];const d=((c=s[0])==null?void 0:c.length)||1024,u=s.length||768,h=N._landNoise2D(t*.02,o*.02),w=Math.round(18*h),y=a,f=[Math.max(0,a[0]-32),Math.max(0,a[1]-48),Math.max(0,a[2]-32)],m=.5+.5*h;let g=Math.round(y[0]*(1-m)+f[0]*m)+w,p=Math.round(y[1]*(1-m)+f[1]*m)+w,C=Math.round(y[2]*(1-m)+f[2]*m)+w;const x=N._landNoise2D(t*.006+100,o*.006+100),v=Math.round(18*x);g=Math.min(255,Math.max(0,g+v)),p=Math.min(255,Math.max(0,p+v)),C=Math.min(255,Math.max(0,C+v));let k=!1;if(s&&t>0&&o>0&&t<d-1&&o<u-1)for(const[A,T]of[[1,0],[-1,0],[0,1],[0,-1]]){const I=t+A,E=o+T;if(s[E][I]===R){k=!0;break}}return k&&(g=Math.min(255,g+12),p=Math.min(255,p+12),C=Math.min(255,C+12)),[g,p,C]}return[255,255,255]}static drawCountryGlow(e,n,t,o){function s(i,c,l){return[Math.round(i[0]+(c[0]-i[0])*l),Math.round(i[1]+(c[1]-i[1])*l),Math.round(i[2]+(c[2]-i[2])*l)]}let r=new Set(n.coordinates.map(([i,c])=>`${i},${c}`));for(let i=0;i<10;++i){const c=[];for(const d of r){const[u,h]=d.split(",").map(Number),w=[[u-1,h],[u+1,h],[u,h-1],[u,h+1]];for(const[y,f]of w)if(!r.has(`${y},${f}`)){c.push([u,h]);break}}const l=i/9,a=s(t,o,l);e.save(),e.fillStyle=`rgb(${a[0]},${a[1]},${a[2]})`;for(const[d,u]of c)e.fillRect(d,u,1,1);e.restore();for(const[d,u]of c)r.delete(`${d},${u}`);if(r.size===0)break}e.save();for(const i of r){const[c,l]=i.split(",").map(Number);let a=[200,200,200];if(n)if(n.owner&&typeof n.owner.RGBColor=="string"){const x=n.owner.RGBColor.split(",").map(Number);x.length===3&&x.every(v=>!isNaN(v))&&(a=[x[0],x[1],x[2]])}else n.color&&(a=n.color);const d=N._landNoise2D(c*.02,l*.02),u=Math.round(18*d),h=a,w=[Math.max(0,a[0]-32),Math.max(0,a[1]-48),Math.max(0,a[2]-32)],y=.5+.5*d;let f=Math.round(h[0]*(1-y)+w[0]*y)+u,m=Math.round(h[1]*(1-y)+w[1]*y)+u,g=Math.round(h[2]*(1-y)+w[2]*y)+u;const p=N._landNoise2D(c*.006+100,l*.006+100),C=Math.round(18*p);f=Math.min(255,Math.max(0,f+C)),m=Math.min(255,Math.max(0,m+C)),g=Math.min(255,Math.max(0,g+C)),e.fillStyle=`rgb(${f},${m},${g})`,e.fillRect(c,l,1,1)}e.restore()}};b(N,"drawBorders",!0),b(N,"_oceanNoise2D",Z()),b(N,"_landNoise2D",Z());let X=N;class H{RequiresAmount(e,n,t){return null}}class O{constructor(e,n,t,o,s=null){b(this,"countries");b(this,"amount");b(this,"action");b(this,"score");b(this,"followUp");this.countries=e,this.amount=n,this.action=t,this.score=o,this.followUp=s}}class Te{constructor(e,n,t){b(this,"canvas");b(this,"ctx");b(this,"start");b(this,"end");this.canvas=e;const o=e.getContext("2d");if(!o)throw new Error("Could not get canvas context");this.ctx=o,this.start=n,this.end=t}draw(){const e=this.ctx,{start:n,end:t}=this,o=(n.x+t.x)/2,s=(n.y+t.y)/2,r=t.x-n.x,i=t.y-n.y,c=Math.sqrt(r*r+i*i),l=.25*c,a=-i/c*l,d=r/c*l,u=o+a,h=s+d,w=e.createLinearGradient(n.x,n.y,t.x,t.y);w.addColorStop(0,"#fff"),w.addColorStop(.5,"#0ff"),w.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=12,e.strokeStyle=w,e.beginPath(),e.moveTo(n.x,n.y),e.quadraticCurveTo(u,h,t.x,t.y),e.stroke();const y=.95,f=this.getQuadraticPoint(n,{x:u,y:h},t,y),m=this.getQuadraticTangent(n,{x:u,y:h},t,y);this.drawArrowhead(f,m),e.restore()}getQuadraticPoint(e,n,t,o){const s=(1-o)*(1-o)*e.x+2*(1-o)*o*n.x+o*o*t.x,r=(1-o)*(1-o)*e.y+2*(1-o)*o*n.y+o*o*t.y;return{x:s,y:r}}getQuadraticTangent(e,n,t,o){const s=2*(1-o)*(n.x-e.x)+2*o*(t.x-n.x),r=2*(1-o)*(n.y-e.y)+2*o*(t.y-n.y),i=Math.sqrt(s*s+r*r);return{x:s/i,y:r/i}}drawArrowhead(e,n){const t=this.ctx;t.save(),t.translate(e.x,e.y);const o=Math.atan2(n.y,n.x);t.rotate(o),t.beginPath(),t.moveTo(0,0),t.lineTo(-18,7),t.lineTo(-12,0),t.lineTo(-18,-7),t.closePath(),t.fillStyle="rgba(0,255,255,0.95)",t.shadowColor="#fff",t.shadowBlur=8,t.fill(),t.restore()}}class Ee{constructor(e,n,t){b(this,"canvas");b(this,"attacker");b(this,"defender");this.canvas=e,this.attacker=n,this.defender=t}async start(){const e=this.canvas.getContext("2d");if(!e)return;const[n,t]=this.attacker.center(),[o,s]=this.defender.center(),r={x:n,y:t},i={x:o,y:s};new Te(this.canvas,r,i);const c=500,l=this.attacker,a=this.defender;return new Promise(d=>{const u=h=>{const y=performance.now()-h,f=Math.min(y/c,1);e.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCountry(e,l,"attacker"),this.drawCountry(e,a,"defender"),this.drawAnimatedArrow(e,r,i,f),f<1?requestAnimationFrame(()=>u(h)):d()};requestAnimationFrame(h=>u(h))})}drawAnimatedArrow(e,n,t,o){const s=(n.x+t.x)/2,r=(n.y+t.y)/2,i=t.x-n.x,c=t.y-n.y,l=Math.sqrt(i*i+c*c),a=.25*l,d=-c/l*a,u=i/l*a,h=s+d,w=r+u,y=e.createLinearGradient(n.x,n.y,t.x,t.y);y.addColorStop(0,"#fff"),y.addColorStop(.5,"#0ff"),y.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=16,e.strokeStyle=y,e.beginPath(),e.moveTo(n.x,n.y);const f=60;for(let m=1;m<=Math.floor(f*o);++m){const g=m/f,p=this.getQuadraticPoint(n,{x:h,y:w},t,g);e.lineTo(p.x,p.y)}if(e.stroke(),o>.05){const m=o,g=this.getQuadraticPoint(n,{x:h,y:w},t,m),p=this.getQuadraticTangent(n,{x:h,y:w},t,m);this.drawArrowhead(e,g,p)}e.restore()}drawCountry(e,n,t){let o;t==="attacker"?o=[180,0,0]:t==="defender"?o=[0,0,180]:o=n.color||[200,200,200],X.drawCountryGlow(e,n,o,n.color);const[s,r]=n.center?n.center():[0,0],i=n.fortified?"🛡️ "+n.name:n.name;if(e.save(),e.font="bold 10px Verdana, Geneva, sans-serif",e.textAlign="center",e.textBaseline="middle",e.lineWidth=3,e.strokeStyle="black",e.strokeText(i,s,r),e.fillStyle="white",e.fillText(i,s,r),typeof n.armies=="number"&&P.showArmies){const c=`${Math.round(n.armies/1e3)}k`;e.font="bold 9px Verdana, Geneva, sans-serif",e.lineWidth=2,e.strokeStyle="black",e.strokeText(c,s,r+13),e.fillStyle="#FFD700",e.fillText(c,s,r+13)}e.restore()}getQuadraticPoint(e,n,t,o){const s=(1-o)*(1-o)*e.x+2*(1-o)*o*n.x+o*o*t.x,r=(1-o)*(1-o)*e.y+2*(1-o)*o*n.y+o*o*t.y;return{x:s,y:r}}getQuadraticTangent(e,n,t,o){const s=2*(1-o)*(n.x-e.x)+2*o*(t.x-n.x),r=2*(1-o)*(n.y-e.y)+2*o*(t.y-n.y),i=Math.sqrt(s*s+r*r);return{x:s/i,y:r/i}}drawArrowhead(e,n,t){e.save(),e.translate(n.x,n.y);const o=Math.atan2(t.y,t.x);e.rotate(o),e.beginPath(),e.moveTo(0,0),e.lineTo(-18,7),e.lineTo(-12,0),e.lineTo(-18,-7),e.closePath(),e.fillStyle="rgba(0,255,255,0.95)",e.shadowColor="#fff",e.shadowBlur=8,e.fill(),e.restore()}}class D extends H{GetButtonText(e,n){if(e.length<2)return null;const t=e[e.length-2],o=e[e.length-1];if(t.owner!==n||t===o)return null;const s=t.neighbors.includes(o),r=t.oceanBorder.length>0&&o.oceanBorder.length>0;return!s&&!r||o.owner===n?null:`Attack ${o.name} from ${t.name}`}async Act(e,n,t,o=0){var p,C;if(!t)throw new Error("Internal error: currentGame is required.");if(e.length<2)throw new Error("Select source and target countries to attack.");const s=e[e.length-2],r=e[e.length-1];if(s.owner!==n)throw new Error("You must own the attacking country.");const i=s.neighbors.includes(r),c=s.oceanBorder.length>0&&r.oceanBorder.length>0;if(!i&&!c)throw new Error("Target country must be a neighbor or reachable by naval attack.");if(r.owner===n)throw new Error("Cannot attack your own country.");if(o<=0||o>=s.armies)throw new Error("Invalid number of armies committed.");if(!n.game)throw new Error("ActionAttack: activePlayer.game is missing");if(!n.game.gui)throw new Error("ActionAttack: activePlayer.game.gui is missing");const a=n.game.gui.getWorldMapCanvas(),d=a.parentElement;if(!d)throw new Error("ActionAttack: mapCanvas.parentElement is null");d.style.position="relative";let u=document.getElementById("attack-animation-overlay");u&&((p=u.parentElement)==null||p.removeChild(u));let h=document.createElement("canvas");h.id="attack-animation-overlay",h.width=a.width,h.height=a.height,h.style.position="absolute",h.style.left="0",h.style.top="0",h.style.pointerEvents="none",h.style.zIndex="9999",h.style.width="100%",h.style.height="100%",h.style.background="rgba(255,255,255,0.01)",d.appendChild(h),new Ee(h,s,r).start(),await new Promise(x=>setTimeout(x,0)),await new Promise(x=>setTimeout(x,1e3)),(C=h==null?void 0:h.parentElement)==null||C.removeChild(h);const y=D.AttackChance(s.armies,r.armies,t.worldMap.distance(s,r)||0,r.fortified,t),f=Math.random(),m=Math.sqrt(Math.abs(f-y));let g="";if(s.armies-=o,f<y){const x=r.owner;x&&(x.ownedCountries=x.ownedCountries.filter(k=>k!==r),x.plannedFortifications=x.plannedFortifications.filter(([k,A])=>k!==r)),r.owner=n,n.ownedCountries.push(r);let v=Math.max(1,Math.round(o*Math.sqrt(m)));v>0&&(v=Math.max(1e3,Math.round(v/1e3)*1e3)),r.armies=v,r.fortified=!1,x&&x.ownedCountries.length===0&&t.players.includes(x)&&(t.players=t.players.filter(k=>k!==x),t.activePlayerIndex>=t.players.length&&(t.activePlayerIndex=0)),n.ownedCountries.length===0&&t.players.includes(n)&&(t.players=t.players.filter(k=>k!==n),t.activePlayerIndex>=t.players.length&&(t.activePlayerIndex=0));for(const k of t.players)k.knowledge=k.knowledge.filter(A=>A.country!==r);g=`Attack successful! ${v} of your ${o} armies occupy ${r.name}.`}else{let x=Math.round(r.armies*Math.sqrt(m));x>0&&(x=Math.max(1e3,Math.round(x/1e3)*1e3)),r.armies=Math.max(1,r.armies-x),r.armies>0&&(r.armies=Math.max(1e3,Math.round(r.armies/1e3)*1e3)),g=`Attack failed! All ${o} attacking armies lost. Defenders lost ${x} troops.`}return g}static AttackChance(e,n,t,o,s){return t===null?0:(n*=t/100,o&&(n*=2),e>=3*n?1:e<=n/3?0:e<n?.5*(e-n/3)/(n-n/3):.5+.5*(e-n)/(2*n))}RequiresAmount(e,n,t){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}get countryCountNeeded(){return 2}Type(){return"Attack"}}class V extends H{GetButtonText(e,n){if(e.length<2)return null;const t=e[e.length-2],o=e[e.length-1];return!t||!o||t.owner!==n||o.owner!==n||t===o?null:`Move armies from ${t.name} to ${o.name}`}async Act(e,n,t,o=0){if(!t)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to move armies.";const s=e[e.length-2],r=e[e.length-1];return s.owner!==n||r.owner!==n?"Both countries must be owned by you.":s===r?"Source and target countries must be different.":o<=0||o>=s.armies?"Invalid number of armies to move.":(s.armies-=o,r.armies+=o,`Moved ${o} armies from ${s.name} to ${r.name}.`)}RequiresAmount(e,n,t){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}get countryCountNeeded(){return 2}Type(){return"Move"}}class ce extends H{GetButtonText(e,n){if(e.length===0)return null;const t=e[e.length-1];return t.owner!==n||t.fortified?null:`Fortify ${t.name}`}async Act(e,n,t,o=0){if(!t)return"Internal error: currentGame is required.";if(e.length===0)return"Please select a country to fortify.";const s=e[e.length-1];return s.canBeFortified()?n.money<P.fortifyCost?`Not enough money to fortify. You need $${P.fortifyCost}.`:(n.money-=P.fortifyCost,n.plannedFortifications.push([s,t.gameTurn+2]),`Fortification planned for ${s.name} on turn ${t.gameTurn+2}.`):`${s.name} cannot be fortified.`}RequiresAmount(e,n,t){return null}get countryCountNeeded(){return 1}Type(){return"Fortify"}}class J extends H{GetButtonText(e,n){if(e.length<1)return null;const t=e[e.length-1];return!t||t.owner!==n?null:`Buy armies for ${t.name}`}async Act(e,n,t,o=0){if(!t)return"Internal error: currentGame is required.";if(e.length<1)return"Select a friendly country to buy armies for.";const s=e[e.length-1];if(s.owner!==n)return"You must own the target country.";if(o<=0)return"Invalid number of armies to buy.";const r=o*P.armyCost;return n.money<r?`Not enough money. Need ${r.toLocaleString()}, have ${n.money.toLocaleString()}.`:(n.money-=r,s.armies+=o,`Bought ${o} armies for ${s.name} at a cost of ${r.toLocaleString()}.`)}RequiresAmount(e,n,t){const o=Math.floor(n.money/P.armyCost/1e3)*1e3;return o<1e3?null:[1e3,o]}get countryCountNeeded(){return 1}Type(){return"BuyArmies"}}const F=class F{constructor(e,n){b(this,"player");b(this,"game");b(this,"actionPlan",[]);this.player=e,this.game=n}GetBestArmies(e){return!this.player.ownedCountries||this.player.ownedCountries.length===0?[]:this.player.ownedCountries.slice().sort((n,t)=>(t.armies||0)-(n.armies||0)).slice(0,e)}FindSpyOpportunities(){const e=new de,n=[],t=this.getNonOwnedCountriesSortedByDistance(),r=this.game.worldMap.getCountries().filter(a=>a.owner&&a.owner!==this.player),i=Math.min(5,this.player.ownedCountries.length);let c=0;for(const a of r){const d=this.player.knowledge.find(u=>u.country===a);a.owner&&a.owner!==this.player?d&&this.game.gameTurn-d.gameTurn<=3&&c++:a.owner||d&&c++}let l=1;c<i&&(l=10);for(const{country:a,distance:d}of t){const u=this.player.knowledge.find(w=>w.country===a);if(!a.owner&&u||a.owner&&a.owner!==this.player&&u&&this.game.gameTurn-u.gameTurn<=3)continue;let h=3e3-Math.sqrt(d);if(h*=l,h>0){const w=a.fortified?P.spyFortifiedCost:P.spyCost;if(this.player.money>=w){const y=h*(this.player.totalIncome()/5e6);n.push(new O([a],0,e,y))}}}return n}FindAttackOpportunities(){const e=new D,t=this.game.worldMap.getCountries(),o=[];for(const s of t){if(s.owner===this.player)continue;const[r,i]=this.countryBestAttackerScore(s);if(!r)continue;const c=Math.floor(r.armies*F.ATTACK_COMMIT/1e3)*1e3;c<1e3||o.push(new O([r,s],c,e,i*this.player.aggressivity))}return o}async takeAction(){if(this.player.actionsLeft<=0)return!1;if(this.player.actionsLeft>=4&&Math.random()<.2&&this.actionPlan.length===0)return this.PlanSurpriseAttack(),!0;let e=null;if(this.actionPlan.length>0){e=this.actionPlan.shift();const o=e.action,s=e.countries,r=e.amount;if(o instanceof V){const i=s[0];if(!i||i.armies<r+1e3)return console.warn("Skipping invalid move from actionPlan:",e),this.actionPlan=[],!1}else if(o instanceof D){const i=s[0],c=s[1];if(!i||!c||c.owner===this.player||i.armies<r)return console.warn("Skipping invalid attack from actionPlan:",e),this.actionPlan=[],!1}else if(o instanceof J&&this.player.money<r*P.armyCost)return console.warn("Skipping invalid buy from actionPlan:",e),this.actionPlan=[],!1}else e=this.findBestOpportunity();if(!e)return!1;const n=await e.action.Act(e.countries,this.player,this.game,e.amount),t=e.countries.slice(-e.action.countryCountNeeded);return this.player.actionLog.push({actionType:e.action.Type(),countries:t,amount:e.amount,result:n??null}),e.followUp&&this.actionPlan.length===0&&this.actionPlan.push(e.followUp),this.player.useAction(),!0}countryDefenseEstimate(e){let n;const t=this.player.knowledge.find(s=>s.country===e),o=e.owner&&e.owner!==this.player;return o&&(!t||this.game.gameTurn-t.gameTurn>3)?n=1e5:!o&&!t?n=7e4:t?n=t.army:n=7e4,e.fortified&&(n*=2),n}countryScore(e){let n;const t=this.player.knowledge.find(s=>s.country===e);t&&typeof t.income=="number"?n=t.income:n=1e6;const o=this.countryDefenseEstimate(e);return n/o}countryBestAttackerScore(e){const n=this.countryDefenseEstimate(e);let t=0,o=null;for(const s of this.player.ownedCountries){const r=this.game.worldMap.distance(s,e);if(r===null)continue;const i=Math.round((s.armies||0)*F.ATTACK_COMMIT/1e3)*1e3;if(i<1e3)continue;const c=D.AttackChance(i,n,r,!1,this.game);let l=0;c>=.7&&(l=c*c*this.countryScore(e)*1e3),l>t&&(t=l,o=s)}return[o,t]}FindMoveOpportunities(e){const n=[];if(this.player.ownedCountries.length===0)return n;const t=this.player.ownedCountries.reduce((l,a)=>a.armies>l.armies?a:l,this.player.ownedCountries[0]);let o=null,s=-1/0,r=null;for(const l of this.player.ownedCountries){const a=this.getReachableNonOwnedCountries(l);for(const{country:d,distance:u}of a){let h=1;u>100&&(h=Math.max(0,1-(u-100)/900));const w=this.countryScore(d)*h;w>s&&(s=w,o=l,r=d)}}if(o&&o!==t){const l=Math.floor(t.armies*.5/1e3)*1e3;if(l>0&&t!==o){let a=null;if(this.actionPlan.length===0&&r){const d=o.armies+l,u=Object.create(o);if(u.armies=d,this.isAttackFeasible(u,r,F.ATTACK_COMMIT)){const h=new D,w=Math.floor(d*F.ATTACK_COMMIT/1e3)*1e3;a=new O([o,r],w,h,100)}}n.push(new O([t,o],l,e,s,a))}}const i=this.player.totalArmies()/this.player.ownedCountries.length,c=this.player.ownedCountries.reduce((l,a)=>a.armies<l.armies?a:l,this.player.ownedCountries[0]);if(c.armies<i/2&&c!==t){const l=i/2,a=Math.floor((l-c.armies)/1e3)*1e3,d=Math.max(0,Math.min(a,t.armies-1e3));d>0&&t!==c&&n.push(new O([t,c],d,e,i-c.armies))}return n}FindFortifyOpportunities(e){const n=[],t=this.player.ownedCountries.filter(o=>!o.fortified).length;for(const o of this.player.ownedCountries)if(o.canBeFortified()&&this.player.money>=P.fortifyCost){let s=o.income/100;s*=t,n.push(new O([o],0,e,s))}return n}FindBuyOpportunities(){if(this.player.money<=2e6)return[];const n=[],t=new J,o=this.player.money,s=P.armyCost,r=Math.max(0,o-2e6);if(this.player.ownedCountries.length===0||r<s)return n;const i=Math.floor(this.player.totalArmies()/this.player.ownedCountries.length),c=this.player.ownedCountries.reduce((u,h)=>h.armies<u.armies?h:u,this.player.ownedCountries[0]);if(c.armies<i){const u=i-c.armies,h=Math.floor(r/s),w=Math.min(u,h,1e5),y=Math.floor(w/1e3)*1e3;if(y>0){const f=(i-c.armies)/1e3;n.push(new O([c],y,t,f))}}let l=null,a=-1/0,d=null;for(const u of this.player.ownedCountries){const h=this.getReachableNonOwnedCountries(u);for(const{country:w,distance:y}of h){let f=1;y>100&&(f=Math.max(0,1-(y-100)/900));const m=this.countryScore(w)*f;m>a&&(a=m,l=u,d=w)}}if(l||(l=this.player.homeCountry),l){const u=Math.floor((r-2e6)/s),h=Math.floor(u/1e3)*1e3;if(h>0){let w=null;if(this.actionPlan.length===0&&d){const y=l.armies+h,f=Object.create(l);if(f.armies=y,this.isAttackFeasible(f,d,F.ATTACK_COMMIT)){const m=new D,g=Math.floor(y*F.ATTACK_COMMIT/1e3)*1e3;w=new O([l,d],g,m,100)}}n.push(new O([l],h,t,a*1e3,w))}}if(r>0&&this.player.ownedCountries.length>0){const u=this.findMostThreatenedOwnedCountry();if(!u)throw new Error("findMostThreatenedOwnedCountry() returned null, which should not happen if there are owned countries.");const h=Math.floor(r/s),w=Math.floor(h/1e3)*1e3;if(w>0){const y=r/1e3;n.push(new O([u],w,t,y))}}return n}findBestOpportunity(){const e=new V,n=new ce,t=[];if(t.push(...this.FindSpyOpportunities()),t.push(...this.FindAttackOpportunities()),t.push(...this.FindMoveOpportunities(e)),t.push(...this.FindFortifyOpportunities(n)),t.push(...this.FindBuyOpportunities()),t.length===0)return null;const o=.5,s=Math.max(...t.map(d=>d.score)),r=t.map(d=>Math.exp((d.score-s)/o)),i=r.reduce((d,u)=>d+u,0),c=r.map(d=>d/i),l=Math.random();let a=0;for(let d=0;d<t.length;++d)if(a+=c[d],l<a)return t[d];throw new Error("Softmax selection failed to pick an opportunity.")}getNonOwnedCountriesSortedByDistance(){const e=this.game.worldMap,n=e.getCountries(),t=[];for(const o of n){if(o.owner===this.player)continue;let s=1e4;for(const r of this.player.ownedCountries){const i=e.distance(r,o);i!==null&&(s=Math.min(s,i))}t.push({country:o,distance:s})}return t.sort((o,s)=>o.distance-s.distance),t}getReachableNonOwnedCountries(e){const n=this.game.worldMap,t=n.getCountries(),o=[];for(const s of t){if(s.owner===this.player)continue;const r=n.distance(e,s);r!==null&&o.push({country:s,distance:r})}return o.sort((s,r)=>s.distance-r.distance),o}MakeAttackPlan(e){if(this.actionPlan.length>0)return;const n=D,t=V,o=J,s=this.player.ownedCountries;if(s.length===0||e.owner===this.player)return;let r=1/0,i=null;for(const v of s){const k=this.game.worldMap.distance(v,e);k!==null&&k<r&&(r=k,i=v)}if(!i)return;const c=new Map;for(const v of s)c.set(v,v.armies);let l=this.player.money;const a=[],d=new o,u=P.armyCost,h=Math.floor(l/u);if(h>0){const v=Math.floor(h/1e3)*1e3;v>0&&(a.push(new O([i],v,d,1)),c.set(i,c.get(i)+v),l-=v*u)}const w=new t;let y=0,f=c.get(i);const m=s.filter(v=>v!==i).sort((v,k)=>k.armies-v.armies);for(const v of m){if(y>=2)break;const k=this.game.worldMap.distance(v,i),A=c.get(v);if(k!==null&&A>1e3){const T=Math.floor((A-1e3)/1e3)*1e3;T>0&&(a.push(new O([v,i],T,w,1)),c.set(v,A-T),f+=T,c.set(i,f),y++)}}const g=this.countryDefenseEstimate(e),p=this.game.worldMap.distance(i,e)||1,C=Math.floor(f*F.ATTACK_COMMIT/1e3)*1e3,x=n.AttackChance(C,g,p,e.fortified,this.game);if(x>.7&&C>=1e3){const v=new n;a.push(new O([i,e],C,v,x*100)),c.set(i,1e3),this.actionPlan.push(...a)}}PlanSurpriseAttack(){if(this.actionPlan.length>0)return;const e=this.game.worldMap.getCountries();let n=1/0,t=null;for(const r of e)if(!r.owner){const i=this.countryDefenseEstimate(r);i<n&&(n=i,t=r)}if(t){this.MakeAttackPlan(t);return}let o=1/0,s=null;for(const r of e)if(r.owner&&r.owner!==this.player){const i=this.countryDefenseEstimate(r);i<o&&(o=i,s=r)}s&&this.MakeAttackPlan(s)}isAttackFeasible(e,n,t=.8){if(!e||!n||e.owner!==this.player||n.owner===this.player||e===n)return!1;const o=e.neighbors.includes(n),s=e.oceanBorder.length>0&&n.oceanBorder.length>0;if(!o&&!s||typeof e.armies!="number"||e.armies<=1e3)return!1;const r=this.countryDefenseEstimate(n),i=this.game.worldMap.distance(e,n);if(i===null)return!1;const c=Math.floor(e.armies*t);return!(D.AttackChance(c,r,i,n.fortified,this.game)<.7)}findMostThreatenedOwnedCountry(){if(!this.player.ownedCountries||this.player.ownedCountries.length===0)throw new Error("AI has no owned countries to evaluate for threat.");const e=this.game.worldMap,n=e.getCountries();let t=null,o=-1/0;for(const s of this.player.ownedCountries){let r=0;for(const i of n){if(!i.owner||i.owner===this.player)continue;const c=e.distance(s,i);c===null||c===0||(r+=1/c)}r>o&&(o=r,t=s)}if(!t)throw new Error("No threatened country found. This should not happen if there are enemy countries.");return t}};b(F,"ATTACK_COMMIT",.8);let ee=F;const G=class G{constructor(e,n=[]){b(this,"worldMap");b(this,"players");b(this,"gameTurn");b(this,"activePlayerIndex");b(this,"gui");this.worldMap=e,this.players=n,this.gameTurn=1,this.activePlayerIndex=0,this.players.length>0&&this.activePlayer.startTurn()}get activePlayer(){return this.players[this.activePlayerIndex]}nextTurn(){this.activePlayer.money+=this.activePlayer.totalIncome(),this.activePlayerIndex=(this.activePlayerIndex+1)%this.players.length,this.activePlayerIndex===0&&this.gameTurn++;const e=this.activePlayer;e.plannedFortifications=e.plannedFortifications.filter(([n,t])=>t===this.gameTurn?(n.fortified=!0,!1):!0),this.activePlayer.startTurn()}static initNewGame(e,n,t){for(const d of n)d.money=G.initialPlayerMoney,d.homeCountry=null,d.ownedCountries=[],d.isAI&&(d.AI=new ee(d,null));const o=e.getCountries();for(const d of o)d.income=Math.floor((5e5+Math.random()*2e6)/1e3)*1e3,d.owner=null;let s=-1,r=[];const i=n.length,c=10;function l(d,u){if(!d.center||!u.center)return 0;const[h,w]=d.center(),[y,f]=u.center();return Math.sqrt((h-y)**2+(w-f)**2)}for(let d=0;d<c;++d){const u=[...o];for(let y=u.length-1;y>0;y--){const f=Math.floor(Math.random()*(y+1));[u[y],u[f]]=[u[f],u[y]]}const h=u.slice(0,i);let w=1/0;for(let y=0;y<h.length;++y)for(let f=y+1;f<h.length;++f)w=Math.min(w,l(h[y],h[f]));w>s&&(s=w,r=h)}for(let d=0;d<n.length;++d){const u=r[d];n[d].homeCountry=u,u.owner=n[d],n[d].ownedCountries.push(u),u.income=G.homeCountryIncome,u.fortified=!0}for(const d of e.getCountries())if(d.owner)d.armies=1e5;else{const u=Math.round((Math.random()*Math.random()*99e3+1e3)/1e3)*1e3;d.armies=u}const a=new G(e,n);t&&(a.gui=t);for(const d of n)d.game=a,d.isAI&&d.AI&&(d.AI.game=a,d.AI.player=d);return a}};b(G,"armyCost",100),b(G,"spyCost",2e5),b(G,"spyFortifiedCost",1e6),b(G,"initialPlayerMoney",1e7),b(G,"homeCountryIncome",4e6),b(G,"fortifyCost",1e5),b(G,"showArmies",!1),b(G,"INCOME_SHARE_WIN",.8);let P=G;const Ie=Object.freeze(Object.defineProperty({__proto__:null,Game:P},Symbol.toStringTag,{value:"Module"}));class de extends H{GetButtonText(e,n){if(e.length===0)return null;const t=e[e.length-1];return t.owner==n?null:`Spy on ${t.name}`}async Act(e,n,t,o=0){if(e.length===0)return"Please select a country to spy on.";const s=e[e.length-1],r=s.fortified?P.spyFortifiedCost:P.spyCost;if(n.money<r)return`Not enough money to spy. You need $${r}.`;const i=n.knowledge.find(a=>a.country===s);if(!t)return"Internal error: currentGame is required.";const c=t.gameTurn;if(i&&i.gameTurn===c)return"You already have recent information about this country.";n.money-=r;const l={country:s,gameTurn:c,army:s.armies,income:s.income};return i?(i.gameTurn=l.gameTurn,i.army=l.army,i.income=l.income):n.knowledge.push(l),null}RequiresAmount(e,n,t){return null}get countryCountNeeded(){return 1}Type(){return"Spy"}}function Pe(M,e,n=M){return new Promise(t=>{const o=document.createElement("div");o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.background="rgba(0,0,0,0.5)",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.zIndex="10000";const s=document.createElement("div");s.style.background="#fff",s.style.padding="32px 40px",s.style.borderRadius="12px",s.style.boxShadow="0 2px 16px rgba(0,0,0,0.2)",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.gap="18px";const r=document.createElement("div");r.textContent="Select amount to commit:",r.style.fontSize="1.2rem",r.style.marginBottom="8px",s.appendChild(r);const i=document.createElement("div");i.textContent=`Maximum: ${e.toLocaleString()}`,i.style.fontSize="1rem",i.style.color="#555",i.style.marginBottom="4px",s.appendChild(i);let c=Math.max(M,Math.min(e,e));const l=document.createElement("div");l.textContent=c.toLocaleString(),l.style.fontSize="2rem",l.style.fontWeight="bold",l.style.margin="8px 0",s.appendChild(l);const a=document.createElement("div");a.style.display="flex",a.style.gap="6px";function d(f){c=Math.max(M,Math.min(e,f)),l.textContent=c.toLocaleString()}function u(f,m){const g=document.createElement("button");return g.textContent=f,g.style.padding="6px 14px",g.style.fontSize="1.1rem",g.style.border="none",g.style.borderRadius="6px",g.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",g.style.color="#fff",g.style.cursor="pointer",g.onclick=m,g}a.appendChild(u("-100k",()=>d(c-1e5))),a.appendChild(u("-10k",()=>d(c-1e4))),a.appendChild(u("-1k",()=>d(c-1e3))),a.appendChild(u("Min",()=>d(M))),a.appendChild(u("Half",()=>d(Math.floor(e/2/1e3)*1e3))),a.appendChild(u("Max",()=>d(e))),a.appendChild(u("+1k",()=>d(c+1e3))),a.appendChild(u("+10k",()=>d(c+1e4))),a.appendChild(u("+100k",()=>d(c+1e5))),s.appendChild(a);const h=document.createElement("div");h.style.display="flex",h.style.gap="12px",h.style.marginTop="18px";const w=u("OK",()=>{document.body.removeChild(o),t(c)});w.style.background="linear-gradient(90deg,#43cea2 0%,#43e97b 100%)",w.style.fontWeight="bold";const y=u("Cancel",()=>{document.body.removeChild(o),t(null)});y.style.background="linear-gradient(90deg,#e57373 0%,#ffb74d 100%)",h.appendChild(w),h.appendChild(y),s.appendChild(h),o.appendChild(s),document.body.appendChild(o),w.focus()})}class Ne extends H{GetButtonText(e,n){if(e.length<2)return null;const t=e[e.length-2],o=e[e.length-1];if(t.owner!==n||t===o||!(n.knowledge&&n.knowledge.some(c=>c.country===o)))return null;const r=t.neighbors.includes(o),i=t.oceanBorder.length>0&&o.oceanBorder.length>0;return!r&&!i||o.owner===n?null:`Calculate attack chance for ${o.name} from ${t.name}`}async Act(e,n,t,o=0){if(!t)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to calculate attack.";const s=e[e.length-2],r=e[e.length-1];if(s.owner!==n)return"You must own the attacking country.";const i=s.neighbors.includes(r),c=s.oceanBorder.length>0&&r.oceanBorder.length>0;if(!i&&!c)return"Target country must be a neighbor or reachable by naval attack.";if(r.owner===n)return"Cannot attack your own country.";if(o<=0||o>=s.armies)return"Invalid number of armies committed.";const l=n.getCountryInfo(r,t.gameTurn),a=t.worldMap.distance(s,r);let u=`Attack chance: ${(D.AttackChance(s.armies,l.army||0,a||0,r.fortified,t)*100).toFixed(2)}%`;return l.recency&&l.recency>0&&(u+=`
Warning: Information about ${r.name} may be outdated (last spied ${l.recency} turn(s) ago).`),u}RequiresAmount(e,n,t){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}Type(){return"CalculateAttack"}get countryCountNeeded(){return 2}}function he(M,e,n){let t=document.getElementById("gamegui-win-modal");if(t)return;t=document.createElement("div"),t.id="gamegui-win-modal",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.85)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="99999";const o=document.createElement("canvas");o.width=window.innerWidth,o.height=window.innerHeight,o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.zIndex="0",o.style.pointerEvents="none",t.appendChild(o);function s(){o.width=window.innerWidth,o.height=window.innerHeight}window.addEventListener("resize",s);const r=document.createElement("div");r.style.width="50vw",r.style.height="50vh",r.style.background='url("Won.png") center/cover no-repeat',r.style.padding="48px 64px",r.style.borderRadius="24px",r.style.boxShadow="0 4px 32px rgba(0,0,0,0.25)",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.gap="32px",r.style.position="relative",r.style.zIndex="1";const i=document.createElement("div");i.innerHTML=`<div style="font-size:2.5rem;font-weight:bold;color:#222;text-shadow:0 2px 8px #fff,0 0 8px #000">🎉 ${M} WINS! 🎉</div><div style="font-size:1.3rem;color:#333;margin-top:18px;text-shadow:0 2px 8px #fff,0 0 8px #000">has reached ${e.toFixed(0)}% of world income!</div>`,r.appendChild(i);const c=document.createElement("button");c.textContent="OK",c.style.marginTop="24px",c.style.padding="12px 36px",c.style.fontSize="1.3rem",c.style.border="none",c.style.borderRadius="8px",c.style.background="linear-gradient(90deg,#43cea2 0%,#ffd700 100%)",c.style.color="#222",c.style.fontWeight="bold",c.style.cursor="pointer",c.style.textShadow="0 2px 8px #fff,0 0 8px #000",c.onclick=()=>{w=!1,window.removeEventListener("resize",s),t&&t.parentNode&&t.parentNode.removeChild(t),n&&n()},r.appendChild(c),t.appendChild(r),document.body.appendChild(t);const l=o.getContext("2d"),a=[];let d=o.height;function u(){const f=Math.random()*o.width*.8+o.width*.1,m=o.height*.02+Math.random()*o.height*.04,g=(Math.random()-.5)*2,p=(-8-Math.random()*4)*2,C=`hsl(${Math.random()*360},90%,60%)`;a.push({x:f,y:o.height,vx:g,vy:p,color:C,exploded:!1,particles:[],age:0,targetY:m})}function h(f){for(let m=0;m<48;m++){const g=m/48*2*Math.PI,p=2+Math.random()*2.5;f.particles.push({x:f.x,y:f.y,vx:Math.cos(g)*p,vy:Math.sin(g)*p,color:f.color,alpha:1,age:0})}}let w=!0;function y(){if(!(!w||!l)){l.clearRect(0,0,o.width,o.height),Math.random()<.06&&a.length<7&&u();for(const f of a)if(!f.exploded)f.x+=f.vx,f.y+=f.vy,f.vy+=.13,f.age++,f.y<d&&(d=f.y),l.save(),l.beginPath(),l.arc(f.x,f.y,4,0,2*Math.PI),l.fillStyle=f.color,l.globalAlpha=.9,l.shadowColor=f.color,l.shadowBlur=16,l.fill(),l.restore(),f.y<=f.targetY&&(f.exploded=!0,h(f));else{for(const m of f.particles)m.x+=m.vx,m.y+=m.vy,m.vy+=.04,m.alpha-=.012+Math.random()*.01,m.age++,l.save(),l.beginPath(),l.arc(m.x,m.y,2.2,0,2*Math.PI),l.fillStyle=m.color,l.globalAlpha=Math.max(0,m.alpha),l.shadowColor=m.color,l.shadowBlur=8,l.fill(),l.restore();f.particles=f.particles.filter(m=>m.alpha>.05&&m.age<90)}for(let f=a.length-1;f>=0;f--)a[f].exploded&&a[f].particles.length===0&&a.splice(f,1);requestAnimationFrame(y)}}y()}const Be=Object.freeze(Object.defineProperty({__proto__:null,showWinDialog:he},Symbol.toStringTag,{value:"Module"}));class Oe{constructor(e,n,t,o){b(this,"overlay");b(this,"ctx");b(this,"width");b(this,"height");b(this,"fish",[]);b(this,"running",!1);b(this,"lastSpawn",0);b(this,"nextSpawn",0);b(this,"getOceanPredicate");b(this,"animationFrameId",null);b(this,"timeoutId",null);b(this,"loop",e=>{this.ctx.clearRect(0,0,this.width,this.height),this.fish=this.fish.filter(n=>!n.done);for(const n of this.fish)n.update(e),n.draw(this.ctx);e>this.nextSpawn&&(this.spawnFish(),this.scheduleNextSpawn()),this.fish.length>0||this.nextSpawn-e<2e3?this.animationFrameId=requestAnimationFrame(this.loop):(this.running=!1,this.timeoutId=setTimeout(()=>this.start(),this.nextSpawn-e))});this.width=n,this.height=t,this.getOceanPredicate=o,this.overlay=document.createElement("canvas"),this.overlay.width=n,this.overlay.height=t,this.overlay.style.position="absolute",this.overlay.style.left="0",this.overlay.style.top="0",this.overlay.style.pointerEvents="none",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.zIndex="20",e.appendChild(this.overlay);const s=this.overlay.getContext("2d");if(!s)throw new Error("Could not get canvas context for FishOverlay");this.ctx=s,this.scheduleNextSpawn(),this.start()}scheduleNextSpawn(){this.nextSpawn=performance.now()+5e3+Math.random()*1e4}spawnFish(){for(let e=0;e<10;e++){const n=Math.floor(Math.random()*this.width),t=Math.floor(this.height*(.4+.5*Math.random())),o=Math.random()<.5?1:-1,s=32+Math.random()*24,r=n+o*s;if(this.getOceanPredicate(n,t)&&this.getOceanPredicate(Math.round(r),t)){const i="#444";this.fish.push(new Ge(n,t,o,i));break}}}start(){this.running||(this.running=!0,this.animationFrameId=requestAnimationFrame(this.loop))}stop(){this.running=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}resume(){this.running||this.start()}}class Ge{constructor(e,n,t,o){b(this,"x0");b(this,"y0");b(this,"x1");b(this,"y1");b(this,"dir");b(this,"color","#444");b(this,"t0");b(this,"duration");b(this,"done",!1);b(this,"splash",!1);b(this,"splashStart",0);b(this,"splashDuration",1200);this.x0=e,this.y0=n;const s=32+Math.random()*24;this.x1=e+t*s,this.y1=n,this.dir=t,this.t0=performance.now(),this.duration=(1200+Math.random()*400)/2}update(e){const n=(e-this.t0)/this.duration;if(!this.splash&&n>.95&&(this.splash=!0,this.splashStart=e),n>1&&this.splash){e-this.splashStart>this.splashDuration&&(this.done=!0);return}if(n>1){this.done=!0;return}}draw(e){const n=performance.now(),t=Math.min(1,(n-this.t0)/this.duration),o=18,s=this.x0+(this.x1-this.x0)*t,r=this.y0-(1-4*Math.pow(t-.5,2))*o,i=1+.18*Math.sin(Math.PI*t),c=.5*Math.sin(Math.PI*t);if(t<=.95){e.save(),e.translate(s,r);const l=1/3,a=e.createRadialGradient(0,0,.3,0,0,7*i*l);a.addColorStop(0,"#222"),a.addColorStop(.7,"#666"),a.addColorStop(1,"#bbb"),e.fillStyle=a,e.beginPath(),e.ellipse(0,0,7*i*l,3*l,0,0,2*Math.PI),e.fill(),e.save(),e.beginPath(),e.moveTo(-7*i*l,0),e.lineTo(-11*i*l,-4*l),e.lineTo(-11*i*l,4*l),e.closePath(),e.fillStyle="#222",e.globalAlpha=.8,e.fill(),e.restore(),e.save(),e.beginPath(),e.ellipse(-2*i*l,2.2*l,2*l,.7*l,Math.PI/4+c,0,2*Math.PI),e.ellipse(-2*i*l,-2.2*l,2*l,.7*l,-Math.PI/4-c,0,2*Math.PI),e.fillStyle="#888",e.globalAlpha=.7,e.fill(),e.restore(),e.restore()}if(this.splash){const l=Math.min(1,(n-this.splashStart)/this.splashDuration);for(let a=0;a<3;a++){const d=10+12*l+a*6;e.save(),e.beginPath(),e.arc(this.x1,this.y1,d,0,2*Math.PI),e.strokeStyle=`rgba(10,10,10,${.7*(1-l)})`,e.lineWidth=2.5-a*.5,e.globalAlpha=1*(1-l),e.stroke(),e.restore()}}}}function Re(M){var d;let e=document.getElementById("action-log-dialog");e&&e.remove();const n=document.createElement("div");n.id="action-log-dialog",n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.width="100vw",n.style.height="100vh",n.style.background="rgba(0,0,0,0.6)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="99999",(d=_.getInstance())==null||d.pauseGame();const t=document.createElement("div");t.style.background="#fff",t.style.width="100vw",t.style.height="100vh",t.style.padding="0",t.style.borderRadius="0",t.style.boxShadow="none",t.style.maxWidth="100vw",t.style.maxHeight="100vh",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="stretch",t.style.gap="0",t.style.overflow="hidden";const o=document.createElement("button");o.textContent="Close",o.style.alignSelf="flex-end",o.style.margin="16px 24px 0 0",o.style.padding="10px 32px",o.style.fontSize="1.2rem",o.style.border="none",o.style.borderRadius="8px",o.style.background="linear-gradient(90deg,#ff9966 0%,#ff5e62 100%)",o.style.color="#fff",o.style.cursor="pointer",o.onclick=()=>{var h,w;(h=_.getInstance())==null||h.resumeGame(),n.remove();const u=_.getInstance();u&&u.currentGame&&!u.canceled&&((w=u.currentGame.activePlayer)!=null&&w.isAI)&&setTimeout(()=>u.turnStarted(),0)},t.appendChild(o);const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="row",s.style.alignItems="center",s.style.gap="16px",s.style.padding="24px 32px 8px 32px",s.style.background="#f5f5f5";const r=document.createElement("select");r.style.fontSize="1.1rem",r.style.padding="6px 12px";for(const u of M.players){const h=document.createElement("option");h.value=u.name,h.textContent=u.name+(u.isAI?" (AI)":""),r.appendChild(h)}s.appendChild(r);const i=document.createElement("input");i.type="text",i.placeholder="Filter (wildcard, all fields)",i.style.fontSize="1.1rem",i.style.padding="6px 12px",i.style.borderRadius="6px",i.style.border="1px solid #aaa",s.appendChild(i),t.appendChild(s);const c=document.createElement("div");c.style.overflow="auto",c.style.flex="1",c.style.padding="0 32px 32px 32px",c.style.background="#fff",t.appendChild(c);function l(u,h){c.innerHTML="";const w=document.createElement("table");w.style.width="100%",w.style.borderCollapse="collapse",w.style.fontSize="1.05rem";const y=document.createElement("thead"),f=document.createElement("tr");for(const p of["#","Action","Countries","Amount","Result"]){const C=document.createElement("th");C.textContent=p,C.style.borderBottom="2px solid #888",C.style.padding="8px 12px",C.style.background="#eee",f.appendChild(C)}y.appendChild(f),w.appendChild(y);const m=document.createElement("tbody");let g=u.actionLog;if(h.trim()){const p=h.trim().toLowerCase();g=g.filter(C=>C.actionType.toLowerCase().includes(p)||C.countries.map(x=>x.name).join(",").toLowerCase().includes(p)||(""+C.amount).includes(p)||(C.result?C.result.toLowerCase():"").includes(p))}g.forEach((p,C)=>{const x=document.createElement("tr");x.style.borderBottom="1px solid #ddd";const v=document.createElement("td");v.textContent=(C+1).toString(),v.style.padding="6px 12px",x.appendChild(v);const k=document.createElement("td");k.textContent=p.actionType,k.style.padding="6px 12px",x.appendChild(k);const A=document.createElement("td");A.textContent=p.countries.map(E=>E.name).join(", "),A.style.padding="6px 12px",x.appendChild(A);const T=document.createElement("td");T.textContent=p.amount.toString(),T.style.padding="6px 12px",x.appendChild(T);const I=document.createElement("td");I.textContent=p.result??"",I.style.padding="6px 12px",x.appendChild(I),m.appendChild(x)}),w.appendChild(m),c.appendChild(w)}let a=M.players[0];l(a,""),r.onchange=()=>{a=M.players.find(u=>u.name===r.value)||M.players[0],l(a,i.value)},i.oninput=()=>{l(a,i.value)},n.appendChild(t),document.body.appendChild(n)}const j=class j{constructor(){b(this,"state");b(this,"currentGame",null);b(this,"rootContainer",null);b(this,"canceled",!1);b(this,"paused",!1);b(this,"clickedCountryNames",[]);b(this,"worldMapCanvas",null);b(this,"mapDirty",!0);b(this,"actions");b(this,"fishOverlay",null);b(this,"_onResize",()=>{this.markMapDirty(),this.rootContainer&&this.renderMainGui(this.rootContainer,this.currentGame)});this.state="initialized",this.actions=[new de,new ce,new D,new Ne,new V,new J],j._instance=this,window.addEventListener("keydown",e=>{e.key==="F9"&&this.currentGame&&Re(this.currentGame),e.key==="F8"&&K(()=>Promise.resolve().then(()=>Be),void 0).then(n=>{var o,s;const t=((s=(o=this.currentGame)==null?void 0:o.activePlayer)==null?void 0:s.name)||"Player";n.showWinDialog(t,100)})})}pauseGame(){if(this.paused=!0,!this.fishOverlay){const e=document.querySelector('div[style*="flex: 3"]');e&&e._fishOverlay&&(this.fishOverlay=e._fishOverlay)}this.fishOverlay&&typeof this.fishOverlay.stop=="function"?(console.log("Pausing FishOverlay",this.fishOverlay),this.fishOverlay.stop()):console.log("No FishOverlay to pause")}resumeGame(){if(this.paused=!1,!this.fishOverlay){const e=document.querySelector('div[style*="flex: 3"]');e&&e._fishOverlay&&(this.fishOverlay=e._fishOverlay)}this.fishOverlay&&typeof this.fishOverlay.resume=="function"?(console.log("Resuming FishOverlay",this.fishOverlay),this.fishOverlay.resume()):console.log("No FishOverlay to resume")}isPaused(){return this.paused}static getInstance(){return j._instance}afterAction(){if(this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],t=this.currentGame.worldMap.getCountries().find(o=>o.name===e);if(t&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const o=this.currentGame.activePlayer.getCountryInfo(t,this.currentGame.gameTurn),s=document.getElementById("country-info-panel");s&&(s.innerHTML=`
            <div><b>Name:</b> ${o.name}</div>
            <div><b>Owner:</b> ${o.owner?o.owner.name:"None"}</div>
            <div><b>Income:</b> ${o.income!==void 0?o.income:"?"}</div>
            <div><b>Army:</b> ${o.army!==void 0?o.army:"?"}</div>
            <div><b>Recency:</b> ${o.recency!==void 0?o.recency:"?"}</div>
          `)}}if(this.markMapDirty(),this.rootContainer&&(this.renderMainGui(this.rootContainer,this.currentGame),this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap)){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],t=this.currentGame.worldMap.getCountries().find(o=>o.name===e);if(t&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const o=this.currentGame.activePlayer.getCountryInfo(t,this.currentGame.gameTurn),s=document.getElementById("country-info-panel");s&&(s.innerHTML=`
              <div><b>Name:</b> ${o.name}</div>
              <div><b>Owner:</b> ${o.owner?o.owner.name:"None"}</div>
              <div><b>Income:</b> ${o.income!==void 0?o.income:"?"}</div>
              <div><b>Army:</b> ${o.army!==void 0?o.army:"?"}</div>
              <div><b>Recency:</b> ${o.recency!==void 0?o.recency:"?"}</div>
            `)}}this.updateActionButtons()}updateActionButtons(){if(this.paused)return;const e=document.getElementById("action-buttons-area");if(!e)return;const n=[];if(Array.from(e.children).forEach(r=>{r instanceof HTMLElement&&(r.classList.contains("persistent-action-btn")?(n.push(r),r.textContent&&r.textContent.trim()==="New Game"&&(r.disabled=!1)):e.removeChild(r))}),!this.currentGame||!this.currentGame.players||!this.currentGame.activePlayer)return;const t=this.currentGame.worldMap?this.currentGame.worldMap.getCountries():[],o=this.clickedCountryNames.map(r=>t.find(i=>i.name===r)).filter(Boolean);if(this.currentGame.activePlayer.actionsLeft<=0){const r=document.createElement("div");r.textContent="You are out of actions for this turn!",r.style.background="linear-gradient(90deg,#ff5e62 0%,#ff9966 100%)",r.style.color="#fff",r.style.fontSize="1.5rem",r.style.fontWeight="bold",r.style.padding="32px 0",r.style.borderRadius="12px",r.style.textAlign="center",r.style.margin="24px 0",e.appendChild(r);return}const s=[];for(const r of this.actions){const i=r.GetButtonText(o,this.currentGame.activePlayer);if(i){const c=document.createElement("button");c.textContent=i,c.style.padding="12px 0",c.style.fontSize="1.1rem",c.style.background="linear-gradient(90deg,#00c3ff 0%,#ffff1c 100%)",c.style.color="#222",c.style.border="none",c.style.borderRadius="8px",c.style.cursor="pointer",c.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",c.style.marginBottom="8px",c.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",c.onclick=async()=>{const l=r.RequiresAmount(o,this.currentGame.activePlayer,this.currentGame);let a=null,d=0;if(l){const[h,w]=l,y=await Pe(h,w,h);if(y===null)return;d=y,a=await r.Act(o,this.currentGame.activePlayer,this.currentGame,y)}else a=await r.Act(o,this.currentGame.activePlayer,this.currentGame);const u=o.slice(-r.countryCountNeeded);this.currentGame.activePlayer.actionLog.push({actionType:r.Type(),countries:u,amount:d,result:a??null}),this.currentGame.activePlayer.useAction(),typeof a=="string"&&a!==null?(this.afterAction(),this.showActionResult(a)):this.afterAction()},s.push(c)}}if(s.length&&n.length){const r=document.createElement("div");r.style.height="16px",r.style.width="100%",e.insertBefore(r,n[0]),s.forEach(i=>e.insertBefore(i,r))}else s.length&&s.forEach(r=>e.appendChild(r))}showActionResult(e){const n=document.getElementById("action-result-panel");n&&(n.innerHTML=`<span style="color:#fff">${e}</span>`)}clearActionResult(){const e=document.getElementById("action-result-panel");e&&(e.innerHTML='<span style="color:#888">No recent action.</span>')}markMapDirty(){this.mapDirty=!0}getWorldMapCanvas(){if(this.paused)throw new Error("Game is paused");if(!this.currentGame||!this.currentGame.worldMap)throw new Error("GameGui.getWorldMapCanvas: currentGame or worldMap is missing");if(this.mapDirty||!this.worldMapCanvas){let e=[];if(this.currentGame.activePlayer){const n=this.currentGame.activePlayer.getKnownCountries();e=n.owned.concat(n.known)}this.worldMapCanvas=X.render(this.currentGame.worldMap,[],e,P.showArmies,this.currentGame.activePlayer),this.mapDirty=!1}return this.worldMapCanvas}async mount(e){this.rootContainer=e,window.addEventListener("resize",this._onResize),this.renderMainGui(e,this.currentGame)}unmount(){window.removeEventListener("resize",this._onResize)}async turnStarted(){var t,o;if(this.paused)return;if(this.clearActionResult(),this.currentGame&&this.currentGame.activePlayer&&this.currentGame.activePlayer.IncomeShare>=P.INCOME_SHARE_WIN){he(this.currentGame.activePlayer.name,P.INCOME_SHARE_WIN*100,()=>{this.canceled=!0}),this.canceled=!0;return}if(this.renderMainGui(this.rootContainer,this.currentGame),this.canceled||!((o=(t=this.currentGame)==null?void 0:t.activePlayer)!=null&&o.isAI))return;const e=this.currentGame.activePlayer.AI;if(!e)return;const n=async()=>{if(this.paused||this.canceled)return;const s=await e.takeAction();this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),s?setTimeout(()=>n(),100):(this.currentGame.nextTurn(),this.markMapDirty(),this.currentGame.activePlayer.isAI?setTimeout(()=>this.turnStarted(),100):this.turnStarted())};n()}async startNewGame(){this.canceled=!0;const e=this.rootContainer,{showNewGameDialog:n}=await K(async()=>{const{showNewGameDialog:t}=await import("./NewGameDialog-DoDwRvQV.js");return{showNewGameDialog:t}},[]);try{const t=await n(e),o=await K(()=>import("./Player-BLwqAABQ.js"),[]),s=await K(()=>Promise.resolve().then(()=>Ie),void 0);s.Game.showArmies=t.showArmies;const r=["#4fc3f7","#81c784","#ffb74d","#e57373","#ba68c8","#ffd54f","#64b5f6","#a1887f"],i=o.Player.COLORS??r,c=t.players.map((l,a)=>new o.Player(l.name,i[a%i.length],[],null,[],0,l.isAI));this.currentGame=s.Game.initNewGame(t.map,c,this),this.markMapDirty(),this.getWorldMapCanvas(),this.renderMainGui(e,this.currentGame),this.currentGame&&this.currentGame.players.length>0&&(this.canceled=!1,this.currentGame.activePlayer.startTurn(),this.turnStarted())}catch(t){console.error("NewGameDialog error or cancellation:",t)}}renderMainGui(e,n){if(this.paused)return;const t=this.rootContainer;if(!t)throw new Error("rootContainer is not set (null) in renderMainGui");const o=t.querySelector('div[style*="flex: 3"]');if(o&&o._fishOverlay){const f=o._fishOverlay;typeof f.stop=="function"&&f.stop(),f.overlay&&f.overlay.parentNode&&f.overlay.parentNode.removeChild(f.overlay),o._fishOverlay=null}t.innerHTML="";const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="row",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100vw",s.style.height="100vh",s.style.background="linear-gradient(120deg, #232526 0%, #414345 100%)",s.style.borderRadius="0",s.style.boxShadow="none",s.style.overflow="hidden",s.style.margin="0",s.style.maxWidth="100vw";const r=document.createElement("div");r.style.flex="3",r.style.background="#222",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.position="relative",r.style.borderRight="2px solid #333";let i=null;n&&n.worldMap&&(i=this.getWorldMapCanvas()),this.clickedCountryNames||(this.clickedCountryNames=[]);const c=document.createElement("div");if(c.id="country-info-panel",c.style.background="#a67c52",c.style.border="1px solid #555",c.style.borderRadius="8px",c.style.padding="10px 12px",c.style.marginBottom="18px",c.style.color="#b3e5fc",c.style.fontSize="1.05rem",c.style.minHeight="100px",c.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",c.innerHTML='<span style="color:#888">Click a country to view details.</span>',i){let f=function(){g||(g=document.createElement("canvas"),g.width=i.width,g.height=i.height,g.style.position="absolute",g.style.left="0",g.style.top="0",g.style.pointerEvents="none",g.style.width="100%",g.style.height="100%",r.appendChild(g))},m=function(){if(g){const C=g.getContext("2d");C&&C.clearRect(0,0,g.width,g.height)}};i.style.width="100%",i.style.height="100%",i.style.display="block",r.appendChild(i);let g=null;if(!r._fishOverlay){const C=n.worldMap.getMap(),x=i.width,v=i.height,k=(A,T)=>A<0||T<0||T>=C.length||A>=C[0].length?!1:C[T][A]===R;r._fishOverlay=new Oe(r,x,v,k)}this.fishOverlay=r._fishOverlay,i._countryClickHandler&&i.removeEventListener("mousedown",i._countryClickHandler);const p=C=>{if(this.paused)return;const x=i.width,v=i.height,k=Math.floor(C.offsetX*(x/i.clientWidth)),A=Math.floor(C.offsetY*(v/i.clientHeight)),T=n.worldMap.getMap(),I=n.worldMap.getCountries();let E=null;if(k>=0&&A>=0&&A<T.length&&k<T[0].length){const B=T[A][k];if(B>=0&&I[B]){if(E=I[B],E.coordinates.some(([S,W])=>S===k&&W===A)||console.warn(`[GameGui] Click at (${k},${A}) is not in coordinates of country: ${E.name}`),this.clickedCountryNames.push(E.name),f(),m(),g&&E){const S=g.getContext("2d");if(S){X.drawCountryGlow(S,E,[0,0,0],E.color);const[W,U]=E.center?E.center():[0,0],te=E.fortified?"🛡️ "+E.name:E.name;if(S.save(),S.font="bold 10px Verdana, Geneva, sans-serif",S.textAlign="center",S.textBaseline="middle",S.lineWidth=3,S.strokeStyle="black",S.strokeText(te,W,U),S.fillStyle="white",S.fillText(te,W,U),P.showArmies&&typeof E.armies=="number"){const ne=`${Math.round(E.armies/1e3)}k`;S.font="bold 9px Verdana, Geneva, sans-serif",S.lineWidth=2,S.strokeStyle="black",S.strokeText(ne,W,U+13),S.fillStyle="#FFD700",S.fillText(ne,W,U+13)}S.restore()}}this.updateActionButtons();const $=document.getElementById("country-info-panel");if($&&n&&n.activePlayer&&typeof n.gameTurn=="number"){const S=n.activePlayer.getCountryInfo(E,n.gameTurn);$.innerHTML=`
                <div><b>Name:</b> ${S.name}</div>
                <div><b>Owner:</b> ${S.owner?S.owner.name:"None"}</div>
                <div><b>Income:</b> ${S.income!==void 0?S.income:"?"}</div>
                <div><b>Army:</b> ${S.army!==void 0?S.army:"?"}</div>
                <div><b>Recency:</b> ${S.recency!==void 0?S.recency:"?"}</div>
              `}const q=document.getElementById("last-clicked-country-info-panel");if(q&&n&&n.activePlayer&&typeof n.gameTurn=="number"){const S=n.activePlayer.getCountryInfo(E,n.gameTurn);q.innerHTML=`
                <b>Last Clicked Country Info</b><br>
                <div><b>Name:</b> ${S.name}</div>
                <div><b>Owner:</b> ${S.owner?S.owner.name:"None"}</div>
                <div><b>Income:</b> ${S.income!==void 0?S.income:"?"}</div>
                <div><b>Army:</b> ${S.army!==void 0?S.army:"?"}</div>
                <div><b>Recency:</b> ${S.recency!==void 0?S.recency:"?"}</div>
              `}}}};i.addEventListener("mousedown",p),i._countryClickHandler=p}else{const f=document.createElement("div");f.style.width="100%",f.style.height="100%",f.style.background="repeating-linear-gradient(135deg,#444 0 10px,#333 10px 20px)",f.style.border="4px solid #666",f.style.borderRadius="12px",f.style.display="flex",f.style.alignItems="center",f.style.justifyContent="center";const m=document.createElement("img");m.src="riskStartup.png",m.alt="Risk Startup",m.style.width="100%",m.style.height="100%",m.style.objectFit="cover",m.style.borderRadius="8px",f.appendChild(m),r.appendChild(f)}const l=document.createElement("div"),a=document.createElement("button");a.textContent="New Game",a.classList.add("persistent-action-btn"),a.style.padding="12px 0",a.style.fontSize="1.1rem",a.style.background="linear-gradient(90deg,#00c3ff 0%,#ffff1c 100%)",a.style.color="#222",a.style.border="none",a.style.borderRadius="8px",a.style.cursor="pointer",a.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",a.style.marginBottom="24px",a.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",a.onclick=()=>{this.startNewGame()},l.appendChild(a),l.appendChild(c),l.style.flex="1",l.style.background="#3b2412",l.style.display="flex",l.style.flexDirection="column",l.style.padding="32px 24px",l.style.color="#fff",l.style.minWidth="320px",l.style.fontFamily="'MedievalSharp', 'Times New Roman', serif";const d=document.createElement("div");d.style.marginBottom="32px";const u=document.createElement("div");if(u.style.fontSize="1.2rem",u.style.fontWeight="bold",n&&n.players&&n.players.length>0){const f=n.activePlayer;u.textContent=`Turn: ${n.gameTurn} | Player: ${f.name}`;const m=document.createElement("div"),g=f.constructor.ACTIONS_PER_TURN||5,p=f.actionsLeft;m.style.margin="8px 0 0 0",m.style.fontSize="2rem",m.style.letterSpacing="0.2rem";for(let C=0;C<g;C++){const x=document.createElement("span");x.textContent=C<p?"★":"☆",x.style.color=C<p?"#ffd700":"#888",m.appendChild(x)}m.title=`${p} of ${g} actions remaining`,d.appendChild(m)}else u.textContent="No game loaded. Start a new game to play!";if(d.appendChild(u),l.appendChild(d),n&&n.players&&n.players.length>0){const f=document.createElement("div");f.textContent="Players",f.style.fontWeight="bold",f.style.marginBottom="8px",l.appendChild(f);const m=document.createElement("ul");m.style.listStyle="none",m.style.padding="0",m.style.margin="0 0 24px 0";for(const g of n.players){const p=document.createElement("li");p.style.display="flex",p.style.alignItems="center",p.style.marginBottom="8px",g===n.activePlayer&&(p.style.boxShadow="0 0 16px 4px #ffd700, 0 0 4px 2px #fff",p.style.border="2px solid #ffd700",p.style.borderRadius="12px",p.style.background="rgba(255, 215, 0, 0.10)");const C=document.createElement("span");C.style.display="inline-block",C.style.width="16px",C.style.height="16px",C.style.borderRadius="50%",C.style.background=g.color,C.style.marginRight="8px",p.appendChild(C);const x=document.createElement("span");if(x.textContent=g.name+(g.isAI?" (AI)":""),x.style.flex="1",p.appendChild(x),typeof g.money=="number"){const v=document.createElement("span");v.textContent=`💰 ${g.money}`,v.style.marginLeft="8px",p.appendChild(v);const k=document.createElement("span");k.style.display="inline-block",k.style.width="54px",k.style.height="12px",k.style.marginLeft="8px",k.style.verticalAlign="middle",k.style.background="#222",k.style.border="1px solid #444",k.style.borderRadius="6px",k.style.overflow="hidden";const A=document.createElement("span"),T=Math.min(g.IncomeShare/P.INCOME_SHARE_WIN,1);A.style.display="inline-block",A.style.height="100%",A.style.width=`${Math.round(T*100)}%`,A.style.background=T>=1?"linear-gradient(90deg,#43cea2,#ffd700)":"linear-gradient(90deg,#43cea2,#185a9d)",A.style.transition="width 0.3s",k.title=`Income share: ${(g.IncomeShare*100).toFixed(1)}% (win at ${(P.INCOME_SHARE_WIN*100).toFixed(0)}%)`,k.appendChild(A),p.appendChild(k)}m.appendChild(p)}l.appendChild(m)}const h=document.createElement("div");h.id="action-result-panel",h.style.background="#a67c52",h.style.border="1px solid #555",h.style.borderRadius="8px",h.style.padding="10px 12px",h.style.marginBottom="18px",h.style.color="#fff",h.style.fontSize="1.05rem",h.style.minHeight="60px",h.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",h.innerHTML='<span style="color:#888">No recent action.</span>',l.appendChild(h);const w=document.createElement("div");w.id="action-buttons-area",w.style.display="flex",w.style.flexDirection="column",w.style.gap="12px",w.style.marginTop="auto";const y=document.createElement("button");y.textContent="End Turn",y.classList.add("persistent-action-btn"),y.style.padding="12px 0",y.style.fontSize="1.1rem",y.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",y.style.color="#fff",y.style.border="none",y.style.borderRadius="8px",y.style.cursor="pointer",y.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",y.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",y.onclick=()=>{this.paused||this.currentGame&&(this.currentGame.nextTurn(),this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),this.turnStarted())},w.appendChild(y),l.appendChild(w),s.appendChild(r),s.appendChild(l),t.appendChild(s)}};b(j,"_instance",null);let _=j;function $e(M,e){const n=document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="10000",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.pointerEvents="none",n.style.overflow="hidden";const t=document.createElement("div");t.innerText="Armchair",t.style.position="relative",t.style.color="#fffbe6",t.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',t.style.fontSize="6vw",t.style.fontWeight="bold",t.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",t.style.letterSpacing="0.18em",t.style.opacity="0",t.style.transform="translateX(-120%) skew(-12deg)",t.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",t.style.filter="drop-shadow(0 0 12px #fffbe6)",t.style.background="",t.style.webkitBackgroundClip="",t.style.backgroundClip="",t.style.webkitTextFillColor="";const o=document.createElement("div");o.innerText="General",o.style.position="relative",o.style.color="#fffbe6",o.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',o.style.fontSize="6vw",o.style.fontWeight="bold",o.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",o.style.letterSpacing="0.18em",o.style.opacity="0",o.style.transform="translateX(120%) skew(12deg)",o.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",o.style.filter="drop-shadow(0 0 12px #fffbe6)",o.style.background="",o.style.webkitBackgroundClip="",o.style.backgroundClip="",o.style.webkitTextFillColor="";const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="center",s.style.gap="1vw",s.style.pointerEvents="none",s.appendChild(t),s.appendChild(o),n.appendChild(s),M.appendChild(n);const r=document.createElement("canvas");r.width=M.offsetWidth||800,r.height=M.offsetHeight||600,r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.pointerEvents="none",n.appendChild(r);const i=r.getContext("2d"),c=10,l=[];r.width/2;const a=r.height*.8;for(let y=0;y<c;y++){const m=y%2===0?r.width*.05:r.width*.95,g=r.width*(.15+.7*Math.random()),p=a-r.height*.25+Math.random()*r.height*.1,C=a-r.height*.05+Math.random()*r.height*.18,x=1200+Math.random()*400,v=r.height*(.32+Math.random()*.12);l.push({startX:m,startY:p,endX:g,endY:C,duration:x,startTime:null,exploded:!1,explosionTime:null,arcHeight:v})}function d(y,f,m){i&&(i.save(),i.beginPath(),i.arc(y,f,18*m,0,2*Math.PI),i.fillStyle="rgba(40,40,40,0.95)",i.shadowColor="#222",i.shadowBlur=12*m,i.fill(),i.restore(),i.save(),i.beginPath(),i.arc(y-6*m,f-6*m,5*m,0,2*Math.PI),i.fillStyle="rgba(200,200,200,0.18)",i.fill(),i.restore())}function u(y,f,m){if(i){if(m<.15){const g=38+60*m;i.save(),i.beginPath(),i.arc(y,f,g,0,2*Math.PI),i.fillStyle=`rgba(255,255,220,${.7*(1-m/.15)})`,i.shadowColor="#fffbe6",i.shadowBlur=48,i.fill(),i.restore()}if(m<.6){const g=32+80*m;i.save(),i.beginPath(),i.arc(y,f,g,0,2*Math.PI),i.fillStyle=`rgba(255,120,40,${.5*(1-m/.6)})`,i.shadowColor="#ffae42",i.shadowBlur=32,i.fill(),i.restore(),i.save(),i.beginPath(),i.arc(y,f,g*.5,0,2*Math.PI),i.fillStyle=`rgba(255,220,120,${.7*(1-m/.6)})`,i.shadowColor="#fffbe6",i.shadowBlur=16,i.fill(),i.restore()}if(m>.2){const g=(m-.2)/.8;for(let p=0;p<4;p++){const C=Math.PI*2*(p/4)+Math.random()*.2,x=38+60*m+Math.random()*10,v=y+Math.cos(C)*x*.7*g,k=f+Math.sin(C)*x*.5*g+10*g;i.save(),i.beginPath(),i.arc(v,k,18+18*g,0,2*Math.PI),i.fillStyle=`rgba(80,60,40,${.18*(1-g)})`,i.shadowColor="#222",i.shadowBlur=8,i.fill(),i.restore()}}}}function h(y){i.clearRect(0,0,r.width,r.height);let f=!0;for(const m of l){m.startTime||(m.startTime=y);const g=y-m.startTime;if(m.exploded){if(m.explosionTime&&y-m.explosionTime<700){const p=(y-m.explosionTime)/700;u(m.endX,m.endY,p),f=!1}}else{f=!1;const p=Math.min(g/m.duration,1),C=m.startX+(m.endX-m.startX)*p,x=(1-p)*m.startY+p*m.endY-m.arcHeight*4*p*(1-p),v=.9+.3*(1-Math.abs(2*p-1));d(C,x,v),p>=1&&(m.exploded=!0,m.explosionTime=y)}}f||requestAnimationFrame(h)}requestAnimationFrame(h),setTimeout(()=>{t.style.opacity="1",t.style.transform="translateX(0) skew(0)",o.style.opacity="1",o.style.transform="translateX(0) skew(0)"},400),setTimeout(()=>{},3200);const w=document.createElement("link");w.rel="stylesheet",w.href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=UnifrakturCook:wght@700&display=swap",document.head.appendChild(w)}const Q=document.getElementById("app");if(Q)Q.innerHTML="",new _().mount(Q),setTimeout(()=>{const e=Q.querySelector('div[style*="flex: 3"]');e&&$e(e)},0);else throw new Error("No app element found in index.html");export{Me as C,X as R,ie as W};
