var he=Object.defineProperty;var ue=(M,e,t)=>e in M?he(M,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):M[e]=t;var v=(M,e,t)=>ue(M,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const fe="modulepreload",ye=function(M){return"/Armchair-General/"+M},ne={},K=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let r=function(l){return Promise.all(l.map(a=>Promise.resolve(a).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=r(t.map(l=>{if(l=ye(l),l in ne)return;ne[l]=!0;const a=l.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":fe,a||(u.as="script"),u.crossOrigin="",u.href=l,c&&u.setAttribute("nonce",c),document.head.appendChild(u),a)return new Promise((f,g)=>{u.addEventListener("load",f),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return o.then(r=>{for(const i of r||[])i.status==="rejected"&&s(i.reason);return e().catch(s)})};class me{constructor(e=[]){v(this,"countries");this.countries=e}}const ie=Math.sqrt(3),pe=.5*(ie-1),H=(3-ie)/6,oe=M=>Math.floor(M)|0,re=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function J(M=Math.random){const e=ge(M),t=new Float64Array(e).map(o=>re[o%12*2]),n=new Float64Array(e).map(o=>re[o%12*2+1]);return function(s,r){let i=0,c=0,l=0;const a=(s+r)*pe,d=oe(s+a),u=oe(r+a),f=(d+u)*H,g=d-f,h=u-f,m=s-g,y=r-h;let w,p;m>y?(w=1,p=0):(w=0,p=1);const C=m-w+H,x=y-p+H,b=m-1+2*H,k=y-1+2*H,A=d&255,T=u&255;let S=.5-m*m-y*y;if(S>=0){const D=A+e[T],E=t[D],$=n[D];S*=S,i=S*S*(E*m+$*y)}let I=.5-C*C-x*x;if(I>=0){const D=A+w+e[T+p],E=t[D],$=n[D];I*=I,c=I*I*(E*C+$*x)}let G=.5-b*b-k*k;if(G>=0){const D=A+1+e[T+1],E=t[D],$=n[D];G*=G,l=G*G*(E*b+$*k)}return 70*(i+c+l)}}function ge(M){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const o=n+~~(M()*(256-n)),s=t[n];t[n]=t[o],t[o]=s}for(let n=256;n<512;n++)t[n]=t[n-256];return t}function we(M,e,t,n=1e3){var l;const o=M.length,s=((l=M[0])==null?void 0:l.length)||0,r=Array.from({length:o},()=>Array(s).fill(!1)),i=[[1,0],[-1,0],[0,1],[0,-1]],c=M.map(a=>a.slice());for(let a=0;a<o;a++)for(let d=0;d<s;d++)if(!r[a][d]&&M[a][d]===t){const u=[[a,d]],f=[[a,d]];for(r[a][d]=!0;u.length;){const[g,h]=u.shift();for(const[m,y]of i){const w=g+m,p=h+y;w>=0&&w<o&&p>=0&&p<s&&!r[w][p]&&M[w][p]===t&&(r[w][p]=!0,u.push([w,p]),f.push([w,p]))}}if(f.length<n)for(const[g,h]of f)c[g][h]=e}return c}function Ce(M,e,t){var l;const n=M.length,o=((l=M[0])==null?void 0:l.length)||0,s=Array.from({length:n},()=>Array(o).fill(!1)),r=[];for(let a=0;a<o;a++)M[0][a]===e&&(r.push([0,a]),s[0][a]=!0),M[n-1][a]===e&&(r.push([n-1,a]),s[n-1][a]=!0);for(let a=1;a<n-1;a++)M[a][0]===e&&(r.push([a,0]),s[a][0]=!0),M[a][o-1]===e&&(r.push([a,o-1]),s[a][o-1]=!0);const i=[[1,0],[-1,0],[0,1],[0,-1]];for(;r.length;){const[a,d]=r.shift();for(const[u,f]of i){const g=a+u,h=d+f;g>=0&&g<n&&h>=0&&h<o&&!s[g][h]&&M[g][h]===e&&(s[g][h]=!0,r.push([g,h]))}}return M.map((a,d)=>a.map((u,f)=>u===e&&!s[d][f]?t:u))}function xe(M,e){return ae(M,e,{scale:.0018,threshold:-.05,borderStrength:.5,borderWidth:.15,octaves:6,persistence:.5,seed:Math.floor(Math.random()*1e9)})}function ae(M,e,t){const n=(t==null?void 0:t.scale)??.015,o=(t==null?void 0:t.threshold)??0,s=(t==null?void 0:t.seed)!==void 0?be(t.seed):Math.random,r=J(s),i=(t==null?void 0:t.borderStrength)??.5,c=(t==null?void 0:t.borderWidth)??.2,l=(t==null?void 0:t.octaves)??4,a=(t==null?void 0:t.persistence)??.5,d=[];for(let f=0;f<e;f++){const g=[];for(let h=0;h<M;h++){const m=h-M/2,y=f-e/2;let w=0,p=0,C=1,x=1;for(let S=0;S<l;S++)w+=r(m*n*C,y*n*C)*x,p+=x,x*=a,C*=2;w/=p;const b=Math.min(h,M-1-h)/(M/2),k=Math.min(f,e-1-f)/(e/2),A=Math.min(b,k);let T=w;if(A<c){const S=i*(1-A/c);T=w*(1-S)+R*S}g.push(T>o?z:R)}d.push(g)}let u=Ce(d,R,z);return u=we(u,R,z,1e3),u}function be(M){return function(){let e=M+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}class ve{constructor(e,t=null,n=0,o=0){v(this,"name");v(this,"owner");v(this,"armies");v(this,"income");v(this,"coordinates");v(this,"border");v(this,"oceanBorder");v(this,"neighbors");v(this,"color");v(this,"fortified",!1);v(this,"_center",null);this.name=e,this.owner=t,this.armies=n,this.income=o,this.coordinates=[],this.border=[],this.oceanBorder=[],this.neighbors=[],this.color=[Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150)]}setOwner(e){this.owner=e}setArmies(e){this.armies=e}center(){if(this._center)return this._center;if(!this.coordinates.length)return this._center=[0,0],this._center;let e=0,t=0;for(const[n,o]of this.coordinates)e+=n,t+=o;return this._center=[e/this.coordinates.length,t/this.coordinates.length],this._center}canBeFortified(){if(this.fortified)return!1;if(this.owner){for(const[e,t]of this.owner.plannedFortifications)if(e===this)return!1}return!0}}class Me{static generateCountriesMap(e,t={}){if(!e||e.length===0||!e[0])throw new Error("continentMap must be a non-empty 2D array");const n=e.length,o=e[0].length,s=t.countryCount??12,r=t.scale??.09,i=t.minResistance??10,c=t.maxResistance??50,l=t.skipProbability??.9,a=t.seed!==void 0?ke(t.seed):Math.random,d=J(a),u=[];for(let p=0;p<n;p++){const C=[];for(let x=0;x<o;x++)C.push(e[p][x]===z?i+(c-i)*Math.abs(d(x*r,p*r)):1/0);u.push(C)}const f=[],g=[];for(let p=0;p<n;p++)for(let C=0;C<o;C++)e[p][C]===z&&g.push([C,p]);for(let p=0;p<s&&g.length>0;p++){const C=Math.floor(a()*g.length),[x,b]=g.splice(C,1)[0];f.push({x,y:b,idx:p})}for(let p=0;p<n;p++)for(let C=0;C<o;C++)e[p][C]!==R&&(e[p][C]=z);for(const{x:p,y:C,idx:x}of f)e[C][p]=x;const h=f.map(({x:p,y:C,idx:x})=>[p,C,x]),m=(i+c)/2;for(;h.length>0;){const p=Math.floor(a()*h.length),[C,x,b]=h.splice(p,1)[0],k=[];for(const[A,T]of[[1,0],[0,1],[-1,0],[0,-1]]){const S=C+A,I=x+T;S>=0&&S<o&&I>=0&&I<n&&e[I][S]===z&&k.push([S,I])}if(k.length!==0)for(const[A,T]of k)u[T][A]>m&&a()<l||(e[T][A]=b,h.push([A,T,b]))}const y=Array.from({length:n},()=>Array(o).fill(!1));let w=0;for(let p=0;p<n;p++)for(let C=0;C<o;C++)e[p][C]>=0&&e[p][C]+1>w&&(w=e[p][C]+1);for(let p=0;p<n;p++)for(let C=0;C<o;C++)if(e[p][C]===z&&!y[p][C]){const x=[[C,p]];for(y[p][C]=!0;x.length>0;){const[b,k]=x.pop();e[k][b]=w;for(const[A,T]of[[1,0],[0,1],[-1,0],[0,-1]]){const S=b+A,I=k+T;S>=0&&S<o&&I>=0&&I<n&&e[I][S]===z&&!y[I][S]&&(x.push([S,I]),y[I][S]=!0)}}w++}return e}static generateCountriesInternal(e,t){const n=this.generateCountriesMap(e,t);if(!n||n.length===0||!n[0])throw new Error("map must be a non-empty 2D array");const o=n.length,s=n[0].length,r={};for(let l=0;l<o;l++)for(let a=0;a<s;a++){const d=n[l][a];if(d>=0){if(!r[d]){const u=new ve(`Country ${d}`);u.id=d,r[d]=u}r[d].coordinates.push([a,l])}}const i=Math.max(...Object.keys(r).map(Number)),c=Array.from({length:i+1},(l,a)=>r[a]);return this.findCountryBorders(n,c,s,o),{map:n,countries:c}}static findCountryBorders(e,t,n,o){const s=[[1,0],[0,1],[-1,0],[0,-1]];for(const r of t){const i=r.id;r.border=[],r.oceanBorder=[];for(const[c,l]of r.coordinates){let a=!1,d=!1;for(const[u,f]of s){const g=c+u,h=l+f;(g<0||g>=n||h<0||h>=o||e[h][g]!==i)&&(a=!0,(g<0||g>=n||h<0||h>=o||e[h][g]===R)&&(d=!0))}a&&r.border.push([c,l]),d&&r.oceanBorder.push([c,l])}}}static findNeighbors(e){const t=new Map;for(const n of e)for(const[o,s]of n.border)t.set(`${o},${s}`,n);for(const n of e){const o=new Set;for(const[s,r]of n.border)for(const[i,c]of[[1,0],[0,1],[-1,0],[0,-1]]){const l=s+i,a=r+c,d=t.get(`${l},${a}`);d&&d!==n&&o.add(d)}n.neighbors=Array.from(o)}}static mergeSmallCountries(e,t=1e3){let n=!0;for(;n;){n=!1;for(let o=e.length-1;o>=0;o--){const s=e[o];if(s.coordinates.length<t&&s.neighbors.length>0){let r=s.neighbors[0];for(const i of s.neighbors)i.coordinates.length<r.coordinates.length&&(r=i);r.coordinates.push(...s.coordinates),e.splice(o,1),n=!0}}n&&this.findNeighbors(e)}}static generateCountries(e,t={}){const{map:n,countries:o}=this.generateCountriesInternal(e,t);this.findNeighbors(o);const s=(t==null?void 0:t.minCountrySize)??1e3;if(this.mergeSmallCountries(o,s),!n||n.length===0||!n[0])throw new Error("map must be a non-empty 2D array");const r=n[0].length,i=n.length;return this.findCountryBorders(n,o,r,i),this.findNeighbors(o),{map:n,countries:o}}}function ke(M){return function(){let e=M+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function Ae(M,e){return Me.generateCountries(M,{countryCount:e,minResistance:0,maxResistance:130,skipProbability:0})}const R=-1,z=-2,q=class q{constructor(e,t,n=[]){v(this,"countries");v(this,"map");v(this,"continents",[]);this.countries=n,this.map=q.createOceanMap(e,t)}static logCountryNamesInOrder(e,t=""){const n=e.map((o,s)=>`${s}: ${o.name}`);console.log(`[WorldMap] Country order${t?" - "+t:""}:
`+n.join(", "))}static checkMapCountryConsistency(e,t){if(!Array.isArray(e)||!Array.isArray(t))return console.error("[WorldMap] Consistency check failed: map or countries not arrays"),!1;let n=!0;for(let o=0;o<e.length;++o)for(let s=0;s<e[o].length;++s){const r=e[o][s];r>=0&&(t[r]?typeof t[r].name!="string"&&(console.error(`[WorldMap] Inconsistent: countries[${r}] has no valid name at map[${o}][${s}]`),n=!1):(console.error(`[WorldMap] Inconsistent: map[${o}][${s}] = ${r}, but countries[${r}] is undefined`),n=!1))}return n}assignRandomCountryNames(){let e=!1;for(;!e;){const t=new Set;for(const n of this.countries){let o,s=0;do if(o=q.generateRandomName(),s++,s>1e3)throw new Error("Failed to generate unique random country names");while(t.has(o));n.name=o,t.add(o)}e=t.size===this.countries.length}}assignRealCountryNames(){let e=!1;for(;!e;){const t=[...q.REAL_COUNTRY_NAMES],n=new Set;for(const o of this.countries){let s;if(t.length>0){const r=Math.floor(Math.random()*t.length);s=t.splice(r,1)[0]}else{let r=0;do if(s=q.generateRandomName(),r++,r>1e3)throw new Error("Failed to generate unique fallback country names");while(n.has(s))}o.name=s,n.add(s)}e=n.size===this.countries.length}}static generateRandomName(){const e=["zan","mor","vek","tal","rin","dor","lek","sha","val","nor","ka","bel","dra","sil","tur","gar","fen","mir","sol","vor","lin","sar","qu","zel","ron","bar","zen","tir","lom","kal","vin","lor","mel","dar","gol","han","jor","ken","lun","mar"],t=2+Math.floor(Math.random()*2);let n="";for(let o=0;o<t;o++)n+=e[Math.floor(Math.random()*e.length)];return n.charAt(0).toUpperCase()+n.slice(1)}static createOceanMap(e,t){return Array.from({length:t},()=>Array(e).fill(R))}static generateContinentsMap(e,t,n){return ae(e,t,n)}static createMap(e,t,n=40,o=!0){const s=xe(e,t),{map:r,countries:i}=Ae(s,n),c=new q(e,t,i);return c.map=r,o?c.assignRealCountryNames():c.assignRandomCountryNames(),c.regenerateMapFromCountries(c.countries),c.createContinents(),c}addCountry(e){this.countries.push(e)}createContinents(){const e=new Set,t=[];for(const n of this.countries)if(!e.has(n)){const o=[n],s=[];for(e.add(n);o.length>0;){const r=o.shift();s.push(r);for(const i of r.neighbors)e.has(i)||(e.add(i),o.push(i))}t.push(new me(s))}this.continents=t}getCountries(){return this.countries}distance(e,t){const[n,o]=e.center(),[s,r]=t.center(),i=Math.sqrt((n-s)**2+(o-r)**2);if(e.neighbors.includes(t)||t.neighbors.includes(e))return i;const c=e.oceanBorder&&e.oceanBorder.length>0,l=t.oceanBorder&&t.oceanBorder.length>0;return c&&l?i*3:null}getMap(){return this.map}regenerateMapFromCountries(e){if(!this.map||!Array.isArray(this.map)||this.map.length===0||this.map[0].length===0)throw new Error("WorldMap.map is not initialized or has invalid dimensions");const t=this.map.length,n=this.map[0].length,o=q.createOceanMap(n,t);for(let s=0;s<e.length;++s){const r=e[s];if(!r.coordinates||!Array.isArray(r.coordinates))throw new Error(`Country at index ${s} has no valid coordinates array`);for(const[i,c]of r.coordinates){if(typeof i!="number"||typeof c!="number"||i<0||i>=n||c<0||c>=t)throw new Error(`Country index ${s} has out-of-bounds coordinate (${i}, ${c})`);o[c][i]=s}}this.map=o}};v(q,"REAL_COUNTRY_NAMES",["Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia"]);let se=q;const B=class B{static render(e,t=[],n=[],o=!1,s=null){var g;const r=e.getMap(),i=((g=e.getCountries)==null?void 0:g.call(e))||[],c=r.length,l=r[0].length,a=document.createElement("canvas");a.width=l,a.height=c;const d=a.getContext("2d");if(!d)throw new Error("Could not get canvas context");const u=d.createImageData(l,c),f=u.data;for(let h=0;h<c;h++)for(let m=0;m<l;m++){const y=r[h][m],[w,p,C]=B.getRGBForValue(y,i,m,h,r),x=(h*l+m)*4;f[x]=w,f[x+1]=p,f[x+2]=C,f[x+3]=255}if(t&&t.length>0){for(const h of t)if(!(!h||!h.coordinates)){for(const[m,y]of h.coordinates)if(m>=0&&m<l&&y>=0&&y<c){const w=(y*l+m)*4;f[w]=Math.min(255,Math.round(.6*255+.4*f[w])),f[w+1]=Math.min(255,Math.round(.6*255+.4*f[w+1])),f[w+2]=Math.round(.4*f[w+2]),f[w+3]=255}}}for(const h of i){const m=h.owner&&h.owner.homeCountry===h,y=m?[255,140,0]:[0,0,0];for(const[w,p]of h.border||[])if(m)for(let C=-1;C<=1;C++)for(let x=-1;x<=1;x++){const b=w+x,k=p+C;if(b>=0&&b<l&&k>=0&&k<c){const A=(k*l+b)*4;f[A]=y[0],f[A+1]=y[1],f[A+2]=y[2],f[A+3]=255}}else if(w>=0&&w<l&&p>=0&&p<c){const C=(p*l+w)*4;f[C]=y[0],f[C+1]=y[1],f[C+2]=y[2],f[C+3]=255}}d.putImageData(u,0,0),d.save(),d.font="bold 10px MedievalSharp, Verdana, serif",d.textAlign="center",d.textBaseline="middle";for(const h of i){if(!h.name)continue;const[m,y]=h.center?h.center():[0,0],w=h.fortified?"🛡️ "+h.name:h.name;d.lineWidth=3,d.strokeStyle="black",d.strokeText(w,m,y);const p=n.some(x=>x===h);d.fillStyle=p?"#90EE90":"white",d.fillText(w,m,y);let C=!1;if((o||s&&h.owner===s&&!s.isAI||s&&typeof s.armyKnown=="function"&&s.armyKnown(h)&&!s.isAI)&&(C=!0),C){const x=h.armies||0,b=`${Math.round(x/1e3)}k`;d.font="bold 9px MedievalSharp, Verdana, serif",d.lineWidth=2,d.strokeStyle="black",d.strokeText(b,m,y+13),d.fillStyle="#FFD700",d.fillText(b,m,y+13),d.font="bold 10px MedievalSharp, Verdana, serif"}}return d.restore(),a}static displayWithPanZoom(e,t,n=512,o=512,s=[]){let r=null,i=B.render(e,[],s);const c=i.width,l=i.height,a=document.createElement("canvas");a.width=n,a.height=o,a.style.border="1px solid #888",t.appendChild(a);const d=a.getContext("2d");if(!d)throw new Error("Could not get canvas context");let u=Math.min(a.width/c,a.height/l),f=(a.width-c*u)/2,g=(a.height-l*u)/2,h=!1,m=0,y=0;function w(){i=B.render(e,r?[r]:[],s),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,a.width,a.height),d.setTransform(u,0,0,u,f,g),d.drawImage(i,0,0)}return a.addEventListener("mousedown",p=>{const C=a.getBoundingClientRect(),x=(p.clientX-C.left-f)/u,b=(p.clientY-C.top-g)/u,k=e.getMap(),A=e.getCountries(),T=Math.floor(x),S=Math.floor(b);let I=null;if(T>=0&&S>=0&&S<k.length&&T<k[0].length){const G=k[S][T];G>=0&&A[G]&&(I=A[G])}if(I){r=I,w();return}h=!0,m=p.clientX,y=p.clientY}),window.addEventListener("mousemove",p=>{if(!h)return;const C=p.clientX-m,x=p.clientY-y;f+=C,g+=x,m=p.clientX,y=p.clientY,w()}),window.addEventListener("mouseup",()=>{h=!1}),a.addEventListener("wheel",p=>{p.preventDefault();const C=p.offsetX,x=p.offsetY,b=Math.exp(-p.deltaY*.001);f=C-(C-f)*b,g=x-(x-g)*b,u*=b,w()}),w(),a}static getRGBForValue(e,t,n,o,s){var r,i,c;if(e===R){n=n??0,o=o??0,s=s??[];const l=((r=s[0])==null?void 0:r.length)||1024,a=s.length||768,d=o/a;let u=Math.round(30*(1-d)+10*d),f=Math.round(144*(1-d)+80*d),g=Math.round(255*(1-d)+180*d);const h=B._oceanNoise2D(n*.03,o*.03),m=Math.floor(18*h);u+=m,f+=m,g+=m;let y=!1;if(s&&n>0&&o>0&&n<l-1&&o<a-1)for(const[w,p]of[[1,0],[-1,0],[0,1],[0,-1]]){const C=n+w,x=o+p;if(s[x][C]!==R){y=!0;break}}return y&&(u=Math.min(255,u+40),f=Math.min(255,f+40),g=Math.min(255,g+40)),[u,f,g]}if(e===z){n=n??0,o=o??0,s=s??[];const l=((i=s[0])==null?void 0:i.length)||1024,a=s.length||768,d=B._landNoise2D(n*.04,o*.04),u=[34,139,34],f=[80,180,80],g=.5+.5*d;let h=Math.round(u[0]*(1-g)+f[0]*g),m=Math.round(u[1]*(1-g)+f[1]*g),y=Math.round(u[2]*(1-g)+f[2]*g),w=!1;if(s&&n>0&&o>0&&n<l-1&&o<a-1)for(const[p,C]of[[1,0],[-1,0],[0,1],[0,-1]]){const x=n+p,b=o+C;if(s[b][x]===R){w=!0;break}}return w&&(h=Math.min(255,h+30),m=Math.min(255,m+30),y=Math.min(255,y+30)),[h,m,y]}if(e>=0){const l=t[e];let a=[200,200,200];if(l)if(l.owner&&typeof l.owner.RGBColor=="string"){const A=l.owner.RGBColor.split(",").map(Number);A.length===3&&A.every(T=>!isNaN(T))&&(a=[A[0],A[1],A[2]])}else l.color&&(a=l.color);n=n??0,o=o??0,s=s??[];const d=((c=s[0])==null?void 0:c.length)||1024,u=s.length||768,f=B._landNoise2D(n*.02,o*.02),g=Math.round(18*f),h=a,m=[Math.max(0,a[0]-32),Math.max(0,a[1]-48),Math.max(0,a[2]-32)],y=.5+.5*f;let w=Math.round(h[0]*(1-y)+m[0]*y)+g,p=Math.round(h[1]*(1-y)+m[1]*y)+g,C=Math.round(h[2]*(1-y)+m[2]*y)+g;const x=B._landNoise2D(n*.006+100,o*.006+100),b=Math.round(18*x);w=Math.min(255,Math.max(0,w+b)),p=Math.min(255,Math.max(0,p+b)),C=Math.min(255,Math.max(0,C+b));let k=!1;if(s&&n>0&&o>0&&n<d-1&&o<u-1)for(const[A,T]of[[1,0],[-1,0],[0,1],[0,-1]]){const S=n+A,I=o+T;if(s[I][S]===R){k=!0;break}}return k&&(w=Math.min(255,w+12),p=Math.min(255,p+12),C=Math.min(255,C+12)),[w,p,C]}return[255,255,255]}static drawCountryGlow(e,t,n,o){function s(i,c,l){return[Math.round(i[0]+(c[0]-i[0])*l),Math.round(i[1]+(c[1]-i[1])*l),Math.round(i[2]+(c[2]-i[2])*l)]}let r=new Set(t.coordinates.map(([i,c])=>`${i},${c}`));for(let i=0;i<10;++i){const c=[];for(const d of r){const[u,f]=d.split(",").map(Number),g=[[u-1,f],[u+1,f],[u,f-1],[u,f+1]];for(const[h,m]of g)if(!r.has(`${h},${m}`)){c.push([u,f]);break}}const l=i/9,a=s(n,o,l);e.save(),e.fillStyle=`rgb(${a[0]},${a[1]},${a[2]})`;for(const[d,u]of c)e.fillRect(d,u,1,1);e.restore();for(const[d,u]of c)r.delete(`${d},${u}`);if(r.size===0)break}e.save();for(const i of r){const[c,l]=i.split(",").map(Number);let a=[200,200,200];if(t)if(t.owner&&typeof t.owner.RGBColor=="string"){const x=t.owner.RGBColor.split(",").map(Number);x.length===3&&x.every(b=>!isNaN(b))&&(a=[x[0],x[1],x[2]])}else t.color&&(a=t.color);const d=B._landNoise2D(c*.02,l*.02),u=Math.round(18*d),f=a,g=[Math.max(0,a[0]-32),Math.max(0,a[1]-48),Math.max(0,a[2]-32)],h=.5+.5*d;let m=Math.round(f[0]*(1-h)+g[0]*h)+u,y=Math.round(f[1]*(1-h)+g[1]*h)+u,w=Math.round(f[2]*(1-h)+g[2]*h)+u;const p=B._landNoise2D(c*.006+100,l*.006+100),C=Math.round(18*p);m=Math.min(255,Math.max(0,m+C)),y=Math.min(255,Math.max(0,y+C)),w=Math.min(255,Math.max(0,w+C)),e.fillStyle=`rgb(${m},${y},${w})`,e.fillRect(c,l,1,1)}e.restore()}};v(B,"drawBorders",!0),v(B,"_oceanNoise2D",J()),v(B,"_landNoise2D",J());let j=B;class _{RequiresAmount(e,t,n){return null}}class N{constructor(e,t,n,o,s=null){v(this,"countries");v(this,"amount");v(this,"action");v(this,"score");v(this,"followUp");this.countries=e,this.amount=t,this.action=n,this.score=o,this.followUp=s}}class Se{constructor(e,t,n){v(this,"canvas");v(this,"ctx");v(this,"start");v(this,"end");this.canvas=e;const o=e.getContext("2d");if(!o)throw new Error("Could not get canvas context");this.ctx=o,this.start=t,this.end=n}draw(){const e=this.ctx,{start:t,end:n}=this,o=(t.x+n.x)/2,s=(t.y+n.y)/2,r=n.x-t.x,i=n.y-t.y,c=Math.sqrt(r*r+i*i),l=.25*c,a=-i/c*l,d=r/c*l,u=o+a,f=s+d,g=e.createLinearGradient(t.x,t.y,n.x,n.y);g.addColorStop(0,"#fff"),g.addColorStop(.5,"#0ff"),g.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=12,e.strokeStyle=g,e.beginPath(),e.moveTo(t.x,t.y),e.quadraticCurveTo(u,f,n.x,n.y),e.stroke();const h=.95,m=this.getQuadraticPoint(t,{x:u,y:f},n,h),y=this.getQuadraticTangent(t,{x:u,y:f},n,h);this.drawArrowhead(m,y),e.restore()}getQuadraticPoint(e,t,n,o){const s=(1-o)*(1-o)*e.x+2*(1-o)*o*t.x+o*o*n.x,r=(1-o)*(1-o)*e.y+2*(1-o)*o*t.y+o*o*n.y;return{x:s,y:r}}getQuadraticTangent(e,t,n,o){const s=2*(1-o)*(t.x-e.x)+2*o*(n.x-t.x),r=2*(1-o)*(t.y-e.y)+2*o*(n.y-t.y),i=Math.sqrt(s*s+r*r);return{x:s/i,y:r/i}}drawArrowhead(e,t){const n=this.ctx;n.save(),n.translate(e.x,e.y);const o=Math.atan2(t.y,t.x);n.rotate(o),n.beginPath(),n.moveTo(0,0),n.lineTo(-18,7),n.lineTo(-12,0),n.lineTo(-18,-7),n.closePath(),n.fillStyle="rgba(0,255,255,0.95)",n.shadowColor="#fff",n.shadowBlur=8,n.fill(),n.restore()}}class Ee{constructor(e,t,n){v(this,"canvas");v(this,"attacker");v(this,"defender");this.canvas=e,this.attacker=t,this.defender=n}async start(){const e=this.canvas.getContext("2d");if(!e)return;const[t,n]=this.attacker.center(),[o,s]=this.defender.center(),r={x:t,y:n},i={x:o,y:s};new Se(this.canvas,r,i);const c=500,l=this.attacker,a=this.defender;return new Promise(d=>{const u=f=>{const h=performance.now()-f,m=Math.min(h/c,1);e.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCountry(e,l,"attacker"),this.drawCountry(e,a,"defender"),this.drawAnimatedArrow(e,r,i,m),m<1?requestAnimationFrame(()=>u(f)):d()};requestAnimationFrame(f=>u(f))})}drawAnimatedArrow(e,t,n,o){const s=(t.x+n.x)/2,r=(t.y+n.y)/2,i=n.x-t.x,c=n.y-t.y,l=Math.sqrt(i*i+c*c),a=.25*l,d=-c/l*a,u=i/l*a,f=s+d,g=r+u,h=e.createLinearGradient(t.x,t.y,n.x,n.y);h.addColorStop(0,"#fff"),h.addColorStop(.5,"#0ff"),h.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=16,e.strokeStyle=h,e.beginPath(),e.moveTo(t.x,t.y);const m=60;for(let y=1;y<=Math.floor(m*o);++y){const w=y/m,p=this.getQuadraticPoint(t,{x:f,y:g},n,w);e.lineTo(p.x,p.y)}if(e.stroke(),o>.05){const y=o,w=this.getQuadraticPoint(t,{x:f,y:g},n,y),p=this.getQuadraticTangent(t,{x:f,y:g},n,y);this.drawArrowhead(e,w,p)}e.restore()}drawCountry(e,t,n){let o;n==="attacker"?o=[180,0,0]:n==="defender"?o=[0,0,180]:o=t.color||[200,200,200],j.drawCountryGlow(e,t,o,t.color);const[s,r]=t.center?t.center():[0,0],i=t.fortified?"🛡️ "+t.name:t.name;if(e.save(),e.font="bold 10px Verdana, Geneva, sans-serif",e.textAlign="center",e.textBaseline="middle",e.lineWidth=3,e.strokeStyle="black",e.strokeText(i,s,r),e.fillStyle="white",e.fillText(i,s,r),typeof t.armies=="number"&&P.showArmies){const c=`${Math.round(t.armies/1e3)}k`;e.font="bold 9px Verdana, Geneva, sans-serif",e.lineWidth=2,e.strokeStyle="black",e.strokeText(c,s,r+13),e.fillStyle="#FFD700",e.fillText(c,s,r+13)}e.restore()}getQuadraticPoint(e,t,n,o){const s=(1-o)*(1-o)*e.x+2*(1-o)*o*t.x+o*o*n.x,r=(1-o)*(1-o)*e.y+2*(1-o)*o*t.y+o*o*n.y;return{x:s,y:r}}getQuadraticTangent(e,t,n,o){const s=2*(1-o)*(t.x-e.x)+2*o*(n.x-t.x),r=2*(1-o)*(t.y-e.y)+2*o*(n.y-t.y),i=Math.sqrt(s*s+r*r);return{x:s/i,y:r/i}}drawArrowhead(e,t,n){e.save(),e.translate(t.x,t.y);const o=Math.atan2(n.y,n.x);e.rotate(o),e.beginPath(),e.moveTo(0,0),e.lineTo(-18,7),e.lineTo(-12,0),e.lineTo(-18,-7),e.closePath(),e.fillStyle="rgba(0,255,255,0.95)",e.shadowColor="#fff",e.shadowBlur=8,e.fill(),e.restore()}}class F extends _{GetButtonText(e,t){if(e.length<2)return null;const n=e[e.length-2],o=e[e.length-1];if(n.owner!==t||n===o)return null;const s=n.neighbors.includes(o),r=n.oceanBorder.length>0&&o.oceanBorder.length>0;return!s&&!r||o.owner===t?null:`Attack ${o.name} from ${n.name}`}async Act(e,t,n,o=0){var p,C;if(!n)throw new Error("Internal error: currentGame is required.");if(e.length<2)throw new Error("Select source and target countries to attack.");const s=e[e.length-2],r=e[e.length-1];if(s.owner!==t)throw new Error("You must own the attacking country.");const i=s.neighbors.includes(r),c=s.oceanBorder.length>0&&r.oceanBorder.length>0;if(!i&&!c)throw new Error("Target country must be a neighbor or reachable by naval attack.");if(r.owner===t)throw new Error("Cannot attack your own country.");if(o<=0||o>=s.armies)throw new Error("Invalid number of armies committed.");if(!t.game)throw new Error("ActionAttack: activePlayer.game is missing");if(!t.game.gui)throw new Error("ActionAttack: activePlayer.game.gui is missing");const a=t.game.gui.getWorldMapCanvas(),d=a.parentElement;if(!d)throw new Error("ActionAttack: mapCanvas.parentElement is null");d.style.position="relative";let u=document.getElementById("attack-animation-overlay");u&&((p=u.parentElement)==null||p.removeChild(u));let f=document.createElement("canvas");f.id="attack-animation-overlay",f.width=a.width,f.height=a.height,f.style.position="absolute",f.style.left="0",f.style.top="0",f.style.pointerEvents="none",f.style.zIndex="9999",f.style.width="100%",f.style.height="100%",f.style.background="rgba(255,255,255,0.01)",d.appendChild(f),new Ee(f,s,r).start(),await new Promise(x=>setTimeout(x,0)),await new Promise(x=>setTimeout(x,1e3)),(C=f==null?void 0:f.parentElement)==null||C.removeChild(f);const h=F.AttackChance(s.armies,r.armies,n.worldMap.distance(s,r)||0,r.fortified,n),m=Math.random(),y=Math.sqrt(Math.abs(m-h));let w="";if(s.armies-=o,m<h){const x=r.owner;x&&(x.ownedCountries=x.ownedCountries.filter(k=>k!==r),x.plannedFortifications=x.plannedFortifications.filter(([k,A])=>k!==r)),r.owner=t,t.ownedCountries.push(r);let b=Math.max(1,Math.round(o*Math.sqrt(y)));b>0&&(b=Math.max(1e3,Math.round(b/1e3)*1e3)),r.armies=b,r.fortified=!1,x&&x.ownedCountries.length===0&&n.players.includes(x)&&(n.players=n.players.filter(k=>k!==x),n.activePlayerIndex>=n.players.length&&(n.activePlayerIndex=0)),t.ownedCountries.length===0&&n.players.includes(t)&&(n.players=n.players.filter(k=>k!==t),n.activePlayerIndex>=n.players.length&&(n.activePlayerIndex=0));for(const k of n.players)k.knowledge=k.knowledge.filter(A=>A.country!==r);w=`Attack successful! ${b} of your ${o} armies occupy ${r.name}.`}else{let x=Math.round(r.armies*Math.sqrt(y));x>0&&(x=Math.max(1e3,Math.round(x/1e3)*1e3)),r.armies=Math.max(1,r.armies-x),r.armies>0&&(r.armies=Math.max(1e3,Math.round(r.armies/1e3)*1e3)),w=`Attack failed! All ${o} attacking armies lost. Defenders lost ${x} troops.`}return w}static AttackChance(e,t,n,o,s){return n===null?0:(t*=n/100,o&&(t*=2),e>=3*t?1:e<=t/3?0:e<t?.5*(e-t/3)/(t-t/3):.5+.5*(e-t)/(2*t))}RequiresAmount(e,t,n){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}get countryCountNeeded(){return 2}Type(){return"Attack"}}class Q extends _{GetButtonText(e,t){if(e.length<2)return null;const n=e[e.length-2],o=e[e.length-1];return!n||!o||n.owner!==t||o.owner!==t||n===o?null:`Move armies from ${n.name} to ${o.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to move armies.";const s=e[e.length-2],r=e[e.length-1];return s.owner!==t||r.owner!==t?"Both countries must be owned by you.":s===r?"Source and target countries must be different.":o<=0||o>=s.armies?"Invalid number of armies to move.":(s.armies-=o,r.armies+=o,`Moved ${o} armies from ${s.name} to ${r.name}.`)}RequiresAmount(e,t,n){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}get countryCountNeeded(){return 2}Type(){return"Move"}}class le extends _{GetButtonText(e,t){if(e.length===0)return null;const n=e[e.length-1];return n.owner!==t||n.fortified?null:`Fortify ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length===0)return"Please select a country to fortify.";const s=e[e.length-1];return s.canBeFortified()?t.money<P.fortifyCost?`Not enough money to fortify. You need $${P.fortifyCost}.`:(t.money-=P.fortifyCost,t.plannedFortifications.push([s,n.gameTurn+2]),`Fortification planned for ${s.name} on turn ${n.gameTurn+2}.`):`${s.name} cannot be fortified.`}RequiresAmount(e,t,n){return null}get countryCountNeeded(){return 1}Type(){return"Fortify"}}class V extends _{GetButtonText(e,t){if(e.length<1)return null;const n=e[e.length-1];return!n||n.owner!==t?null:`Buy armies for ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<1)return"Select a friendly country to buy armies for.";const s=e[e.length-1];if(s.owner!==t)return"You must own the target country.";if(o<=0)return"Invalid number of armies to buy.";const r=o*P.armyCost;return t.money<r?`Not enough money. Need ${r.toLocaleString()}, have ${t.money.toLocaleString()}.`:(t.money-=r,s.armies+=o,`Bought ${o} armies for ${s.name} at a cost of ${r.toLocaleString()}.`)}RequiresAmount(e,t,n){const o=Math.floor(t.money/P.armyCost/1e3)*1e3;return o<1e3?null:[1e3,o]}get countryCountNeeded(){return 1}Type(){return"BuyArmies"}}const L=class L{constructor(e,t){v(this,"player");v(this,"game");v(this,"actionPlan",[]);this.player=e,this.game=t}GetBestArmies(e){return!this.player.ownedCountries||this.player.ownedCountries.length===0?[]:this.player.ownedCountries.slice().sort((t,n)=>(n.armies||0)-(t.armies||0)).slice(0,e)}FindSpyOpportunities(){const e=new ce,t=[],n=this.getNonOwnedCountriesSortedByDistance(),r=this.game.worldMap.getCountries().filter(a=>a.owner&&a.owner!==this.player),i=Math.min(5,this.player.ownedCountries.length);let c=0;for(const a of r){const d=this.player.knowledge.find(u=>u.country===a);a.owner&&a.owner!==this.player?d&&this.game.gameTurn-d.gameTurn<=3&&c++:a.owner||d&&c++}let l=1;c<i&&(l=10);for(const{country:a,distance:d}of n){const u=this.player.knowledge.find(g=>g.country===a);if(!a.owner&&u||a.owner&&a.owner!==this.player&&u&&this.game.gameTurn-u.gameTurn<=3)continue;let f=3e3-Math.sqrt(d);if(f*=l,f>0){const g=a.fortified?P.spyFortifiedCost:P.spyCost;if(this.player.money>=g){const h=f*(this.player.totalIncome()/5e6);t.push(new N([a],0,e,h))}}}return t}FindAttackOpportunities(){const e=new F,n=this.game.worldMap.getCountries(),o=[];for(const s of n){if(s.owner===this.player)continue;const[r,i]=this.countryBestAttackerScore(s);if(!r)continue;const c=Math.floor(r.armies*L.ATTACK_COMMIT/1e3)*1e3;c<1e3||o.push(new N([r,s],c,e,i*this.player.aggressivity))}return o}async takeAction(){if(this.player.actionsLeft<=0)return!1;if(this.player.actionsLeft>=4&&Math.random()<.2&&this.actionPlan.length===0)return this.PlanSurpriseAttack(),!0;let e=null;if(this.actionPlan.length>0){e=this.actionPlan.shift();const o=e.action,s=e.countries,r=e.amount;if(o instanceof Q){const i=s[0];if(!i||i.armies<r+1e3)return console.warn("Skipping invalid move from actionPlan:",e),this.actionPlan=[],!1}else if(o instanceof F){const i=s[0],c=s[1];if(!i||!c||c.owner===this.player||i.armies<r)return console.warn("Skipping invalid attack from actionPlan:",e),this.actionPlan=[],!1}else if(o instanceof V&&this.player.money<r*P.armyCost)return console.warn("Skipping invalid buy from actionPlan:",e),this.actionPlan=[],!1}else e=this.findBestOpportunity();if(!e)return!1;const t=await e.action.Act(e.countries,this.player,this.game,e.amount),n=e.countries.slice(-e.action.countryCountNeeded);return this.player.actionLog.push({actionType:e.action.Type(),countries:n,amount:e.amount,result:t??null}),e.followUp&&this.actionPlan.length===0&&this.actionPlan.push(e.followUp),this.player.useAction(),!0}countryDefenseEstimate(e){let t;const n=this.player.knowledge.find(s=>s.country===e),o=e.owner&&e.owner!==this.player;return o&&(!n||this.game.gameTurn-n.gameTurn>3)?t=1e5:!o&&!n?t=7e4:n?t=n.army:t=7e4,e.fortified&&(t*=2),t}countryScore(e){let t;const n=this.player.knowledge.find(s=>s.country===e);n&&typeof n.income=="number"?t=n.income:t=1e6;const o=this.countryDefenseEstimate(e);return t/o}countryBestAttackerScore(e){const t=this.countryDefenseEstimate(e);let n=0,o=null;for(const s of this.player.ownedCountries){const r=this.game.worldMap.distance(s,e);if(r===null)continue;const i=Math.round((s.armies||0)*L.ATTACK_COMMIT/1e3)*1e3;if(i<1e3)continue;const c=F.AttackChance(i,t,r,!1,this.game);let l=0;c>=.7&&(l=c*c*this.countryScore(e)*1e3),l>n&&(n=l,o=s)}return[o,n]}FindMoveOpportunities(e){const t=[];if(this.player.ownedCountries.length===0)return t;const n=this.player.ownedCountries.reduce((l,a)=>a.armies>l.armies?a:l,this.player.ownedCountries[0]);let o=null,s=-1/0,r=null;for(const l of this.player.ownedCountries){const a=this.getReachableNonOwnedCountries(l);for(const{country:d,distance:u}of a){let f=1;u>100&&(f=Math.max(0,1-(u-100)/900));const g=this.countryScore(d)*f;g>s&&(s=g,o=l,r=d)}}if(o&&o!==n){const l=Math.floor(n.armies*.5/1e3)*1e3;if(l>0&&n!==o){let a=null;if(this.actionPlan.length===0&&r){const d=o.armies+l,u=Object.create(o);if(u.armies=d,this.isAttackFeasible(u,r,L.ATTACK_COMMIT)){const f=new F,g=Math.floor(d*L.ATTACK_COMMIT/1e3)*1e3;a=new N([o,r],g,f,100)}}t.push(new N([n,o],l,e,s,a))}}const i=this.player.totalArmies()/this.player.ownedCountries.length,c=this.player.ownedCountries.reduce((l,a)=>a.armies<l.armies?a:l,this.player.ownedCountries[0]);if(c.armies<i/2&&c!==n){const l=i/2,a=Math.floor((l-c.armies)/1e3)*1e3,d=Math.max(0,Math.min(a,n.armies-1e3));d>0&&n!==c&&t.push(new N([n,c],d,e,i-c.armies))}return t}FindFortifyOpportunities(e){const t=[],n=this.player.ownedCountries.filter(o=>!o.fortified).length;for(const o of this.player.ownedCountries)if(o.canBeFortified()&&this.player.money>=P.fortifyCost){let s=o.income/100;s*=n,t.push(new N([o],0,e,s))}return t}FindBuyOpportunities(){if(this.player.money<=2e6)return[];const t=[],n=new V,o=this.player.money,s=P.armyCost,r=Math.max(0,o-2e6);if(this.player.ownedCountries.length===0||r<s)return t;const i=Math.floor(this.player.totalArmies()/this.player.ownedCountries.length),c=this.player.ownedCountries.reduce((u,f)=>f.armies<u.armies?f:u,this.player.ownedCountries[0]);if(c.armies<i){const u=i-c.armies,f=Math.floor(r/s),g=Math.min(u,f,1e5),h=Math.floor(g/1e3)*1e3;if(h>0){const m=(i-c.armies)/1e3;t.push(new N([c],h,n,m))}}let l=null,a=-1/0,d=null;for(const u of this.player.ownedCountries){const f=this.getReachableNonOwnedCountries(u);for(const{country:g,distance:h}of f){let m=1;h>100&&(m=Math.max(0,1-(h-100)/900));const y=this.countryScore(g)*m;y>a&&(a=y,l=u,d=g)}}if(l||(l=this.player.homeCountry),l){const u=Math.floor((r-2e6)/s),f=Math.floor(u/1e3)*1e3;if(f>0){let g=null;if(this.actionPlan.length===0&&d){const h=l.armies+f,m=Object.create(l);if(m.armies=h,this.isAttackFeasible(m,d,L.ATTACK_COMMIT)){const y=new F,w=Math.floor(h*L.ATTACK_COMMIT/1e3)*1e3;g=new N([l,d],w,y,100)}}t.push(new N([l],f,n,a*1e3,g))}}if(r>0&&this.player.ownedCountries.length>0){const u=this.findMostThreatenedOwnedCountry();if(!u)throw new Error("findMostThreatenedOwnedCountry() returned null, which should not happen if there are owned countries.");const f=Math.floor(r/s),g=Math.floor(f/1e3)*1e3;if(g>0){const h=r/1e3;t.push(new N([u],g,n,h))}}return t}findBestOpportunity(){const e=new Q,t=new le,n=[];if(n.push(...this.FindSpyOpportunities()),n.push(...this.FindAttackOpportunities()),n.push(...this.FindMoveOpportunities(e)),n.push(...this.FindFortifyOpportunities(t)),n.push(...this.FindBuyOpportunities()),n.length===0)return null;const o=.5,s=Math.max(...n.map(d=>d.score)),r=n.map(d=>Math.exp((d.score-s)/o)),i=r.reduce((d,u)=>d+u,0),c=r.map(d=>d/i),l=Math.random();let a=0;for(let d=0;d<n.length;++d)if(a+=c[d],l<a)return n[d];throw new Error("Softmax selection failed to pick an opportunity.")}getNonOwnedCountriesSortedByDistance(){const e=this.game.worldMap,t=e.getCountries(),n=[];for(const o of t){if(o.owner===this.player)continue;let s=1e4;for(const r of this.player.ownedCountries){const i=e.distance(r,o);i!==null&&(s=Math.min(s,i))}n.push({country:o,distance:s})}return n.sort((o,s)=>o.distance-s.distance),n}getReachableNonOwnedCountries(e){const t=this.game.worldMap,n=t.getCountries(),o=[];for(const s of n){if(s.owner===this.player)continue;const r=t.distance(e,s);r!==null&&o.push({country:s,distance:r})}return o.sort((s,r)=>s.distance-r.distance),o}MakeAttackPlan(e){if(this.actionPlan.length>0)return;const t=F,n=Q,o=V,s=this.player.ownedCountries;if(s.length===0||e.owner===this.player)return;let r=1/0,i=null;for(const b of s){const k=this.game.worldMap.distance(b,e);k!==null&&k<r&&(r=k,i=b)}if(!i)return;const c=new Map;for(const b of s)c.set(b,b.armies);let l=this.player.money;const a=[],d=new o,u=P.armyCost,f=Math.floor(l/u);if(f>0){const b=Math.floor(f/1e3)*1e3;b>0&&(a.push(new N([i],b,d,1)),c.set(i,c.get(i)+b),l-=b*u)}const g=new n;let h=0,m=c.get(i);const y=s.filter(b=>b!==i).sort((b,k)=>k.armies-b.armies);for(const b of y){if(h>=2)break;const k=this.game.worldMap.distance(b,i),A=c.get(b);if(k!==null&&A>1e3){const T=Math.floor((A-1e3)/1e3)*1e3;T>0&&(a.push(new N([b,i],T,g,1)),c.set(b,A-T),m+=T,c.set(i,m),h++)}}const w=this.countryDefenseEstimate(e),p=this.game.worldMap.distance(i,e)||1,C=Math.floor(m*L.ATTACK_COMMIT/1e3)*1e3,x=t.AttackChance(C,w,p,e.fortified,this.game);if(x>.7&&C>=1e3){const b=new t;a.push(new N([i,e],C,b,x*100)),c.set(i,1e3),this.actionPlan.push(...a)}}PlanSurpriseAttack(){if(this.actionPlan.length>0)return;const e=this.game.worldMap.getCountries();let t=1/0,n=null;for(const r of e)if(!r.owner){const i=this.countryDefenseEstimate(r);i<t&&(t=i,n=r)}if(n){this.MakeAttackPlan(n);return}let o=1/0,s=null;for(const r of e)if(r.owner&&r.owner!==this.player){const i=this.countryDefenseEstimate(r);i<o&&(o=i,s=r)}s&&this.MakeAttackPlan(s)}isAttackFeasible(e,t,n=.8){if(!e||!t||e.owner!==this.player||t.owner===this.player||e===t)return!1;const o=e.neighbors.includes(t),s=e.oceanBorder.length>0&&t.oceanBorder.length>0;if(!o&&!s||typeof e.armies!="number"||e.armies<=1e3)return!1;const r=this.countryDefenseEstimate(t),i=this.game.worldMap.distance(e,t);if(i===null)return!1;const c=Math.floor(e.armies*n);return!(F.AttackChance(c,r,i,t.fortified,this.game)<.7)}findMostThreatenedOwnedCountry(){if(!this.player.ownedCountries||this.player.ownedCountries.length===0)throw new Error("AI has no owned countries to evaluate for threat.");const e=this.game.worldMap,t=e.getCountries();let n=null,o=-1/0;for(const s of this.player.ownedCountries){let r=0;for(const i of t){if(!i.owner||i.owner===this.player)continue;const c=e.distance(s,i);c===null||c===0||(r+=1/c)}r>o&&(o=r,n=s)}if(!n)throw new Error("No threatened country found. This should not happen if there are enemy countries.");return n}};v(L,"ATTACK_COMMIT",.8);let Z=L;const O=class O{constructor(e,t=[]){v(this,"worldMap");v(this,"players");v(this,"gameTurn");v(this,"activePlayerIndex");v(this,"gui");this.worldMap=e,this.players=t,this.gameTurn=1,this.activePlayerIndex=0,this.players.length>0&&this.activePlayer.startTurn()}get activePlayer(){return this.players[this.activePlayerIndex]}nextTurn(){this.activePlayer.money+=this.activePlayer.totalIncome(),this.activePlayerIndex=(this.activePlayerIndex+1)%this.players.length,this.activePlayerIndex===0&&this.gameTurn++;const e=this.activePlayer;e.plannedFortifications=e.plannedFortifications.filter(([t,n])=>n===this.gameTurn?(t.fortified=!0,!1):!0),this.activePlayer.startTurn()}static initNewGame(e,t,n){for(const d of t)d.money=O.initialPlayerMoney,d.homeCountry=null,d.ownedCountries=[],d.isAI&&(d.AI=new Z(d,null));const o=e.getCountries();for(const d of o)d.income=Math.floor((5e5+Math.random()*2e6)/1e3)*1e3,d.owner=null;let s=-1,r=[];const i=t.length,c=10;function l(d,u){if(!d.center||!u.center)return 0;const[f,g]=d.center(),[h,m]=u.center();return Math.sqrt((f-h)**2+(g-m)**2)}for(let d=0;d<c;++d){const u=[...o];for(let h=u.length-1;h>0;h--){const m=Math.floor(Math.random()*(h+1));[u[h],u[m]]=[u[m],u[h]]}const f=u.slice(0,i);let g=1/0;for(let h=0;h<f.length;++h)for(let m=h+1;m<f.length;++m)g=Math.min(g,l(f[h],f[m]));g>s&&(s=g,r=f)}for(let d=0;d<t.length;++d){const u=r[d];t[d].homeCountry=u,u.owner=t[d],t[d].ownedCountries.push(u),u.income=O.homeCountryIncome,u.fortified=!0}for(const d of e.getCountries())if(d.owner)d.armies=1e5;else{const u=Math.round((Math.random()*Math.random()*99e3+1e3)/1e3)*1e3;d.armies=u}const a=new O(e,t);n&&(a.gui=n);for(const d of t)d.game=a,d.isAI&&d.AI&&(d.AI.game=a,d.AI.player=d);return a}};v(O,"armyCost",100),v(O,"spyCost",2e5),v(O,"spyFortifiedCost",1e6),v(O,"initialPlayerMoney",1e7),v(O,"homeCountryIncome",4e6),v(O,"fortifyCost",1e5),v(O,"showArmies",!1),v(O,"INCOME_SHARE_WIN",.8);let P=O;const Te=Object.freeze(Object.defineProperty({__proto__:null,Game:P},Symbol.toStringTag,{value:"Module"}));class ce extends _{GetButtonText(e,t){if(e.length===0)return null;const n=e[e.length-1];return n.owner==t?null:`Spy on ${n.name}`}async Act(e,t,n,o=0){if(e.length===0)return"Please select a country to spy on.";const s=e[e.length-1],r=s.fortified?P.spyFortifiedCost:P.spyCost;if(t.money<r)return`Not enough money to spy. You need $${r}.`;const i=t.knowledge.find(a=>a.country===s);if(!n)return"Internal error: currentGame is required.";const c=n.gameTurn;if(i&&i.gameTurn===c)return"You already have recent information about this country.";t.money-=r;const l={country:s,gameTurn:c,army:s.armies,income:s.income};return i?(i.gameTurn=l.gameTurn,i.army=l.army,i.income=l.income):t.knowledge.push(l),null}RequiresAmount(e,t,n){return null}get countryCountNeeded(){return 1}Type(){return"Spy"}}function Ie(M,e,t=M){return new Promise(n=>{const o=document.createElement("div");o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.background="rgba(0,0,0,0.5)",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.zIndex="10000";const s=document.createElement("div");s.style.background="#fff",s.style.padding="32px 40px",s.style.borderRadius="12px",s.style.boxShadow="0 2px 16px rgba(0,0,0,0.2)",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.gap="18px";const r=document.createElement("div");r.textContent="Select amount to commit:",r.style.fontSize="1.2rem",r.style.marginBottom="8px",s.appendChild(r);const i=document.createElement("div");i.textContent=`Maximum: ${e.toLocaleString()}`,i.style.fontSize="1rem",i.style.color="#555",i.style.marginBottom="4px",s.appendChild(i);let c=Math.max(M,Math.min(e,e));const l=document.createElement("div");l.textContent=c.toLocaleString(),l.style.fontSize="2rem",l.style.fontWeight="bold",l.style.margin="8px 0",s.appendChild(l);const a=document.createElement("div");a.style.display="flex",a.style.gap="6px";function d(m){c=Math.max(M,Math.min(e,m)),l.textContent=c.toLocaleString()}function u(m,y){const w=document.createElement("button");return w.textContent=m,w.style.padding="6px 14px",w.style.fontSize="1.1rem",w.style.border="none",w.style.borderRadius="6px",w.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",w.style.color="#fff",w.style.cursor="pointer",w.onclick=y,w}a.appendChild(u("-100k",()=>d(c-1e5))),a.appendChild(u("-10k",()=>d(c-1e4))),a.appendChild(u("-1k",()=>d(c-1e3))),a.appendChild(u("Min",()=>d(M))),a.appendChild(u("Half",()=>d(Math.floor(e/2/1e3)*1e3))),a.appendChild(u("Max",()=>d(e))),a.appendChild(u("+1k",()=>d(c+1e3))),a.appendChild(u("+10k",()=>d(c+1e4))),a.appendChild(u("+100k",()=>d(c+1e5))),s.appendChild(a);const f=document.createElement("div");f.style.display="flex",f.style.gap="12px",f.style.marginTop="18px";const g=u("OK",()=>{document.body.removeChild(o),n(c)});g.style.background="linear-gradient(90deg,#43cea2 0%,#43e97b 100%)",g.style.fontWeight="bold";const h=u("Cancel",()=>{document.body.removeChild(o),n(null)});h.style.background="linear-gradient(90deg,#e57373 0%,#ffb74d 100%)",f.appendChild(g),f.appendChild(h),s.appendChild(f),o.appendChild(s),document.body.appendChild(o),g.focus()})}class Pe extends _{GetButtonText(e,t){if(e.length<2)return null;const n=e[e.length-2],o=e[e.length-1];if(n.owner!==t||n===o||!(t.knowledge&&t.knowledge.some(c=>c.country===o)))return null;const r=n.neighbors.includes(o),i=n.oceanBorder.length>0&&o.oceanBorder.length>0;return!r&&!i||o.owner===t?null:`Calculate attack chance for ${o.name} from ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to calculate attack.";const s=e[e.length-2],r=e[e.length-1];if(s.owner!==t)return"You must own the attacking country.";const i=s.neighbors.includes(r),c=s.oceanBorder.length>0&&r.oceanBorder.length>0;if(!i&&!c)return"Target country must be a neighbor or reachable by naval attack.";if(r.owner===t)return"Cannot attack your own country.";if(o<=0||o>=s.armies)return"Invalid number of armies committed.";const l=t.getCountryInfo(r,n.gameTurn),a=n.worldMap.distance(s,r);let u=`Attack chance: ${(F.AttackChance(s.armies,l.army||0,a||0,r.fortified,n)*100).toFixed(2)}%`;return l.recency&&l.recency>0&&(u+=`
Warning: Information about ${r.name} may be outdated (last spied ${l.recency} turn(s) ago).`),u}RequiresAmount(e,t,n){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}Type(){return"CalculateAttack"}get countryCountNeeded(){return 2}}function de(M,e,t){let n=document.getElementById("gamegui-win-modal");if(n)return;n=document.createElement("div"),n.id="gamegui-win-modal",n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.width="100vw",n.style.height="100vh",n.style.background="rgba(0,0,0,0.85)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="99999";const o=document.createElement("canvas");o.width=window.innerWidth,o.height=window.innerHeight,o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.zIndex="0",o.style.pointerEvents="none",n.appendChild(o);function s(){o.width=window.innerWidth,o.height=window.innerHeight}window.addEventListener("resize",s);const r=document.createElement("div");r.style.width="50vw",r.style.height="50vh",r.style.background='url("Won.png") center/cover no-repeat',r.style.padding="48px 64px",r.style.borderRadius="24px",r.style.boxShadow="0 4px 32px rgba(0,0,0,0.25)",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.gap="32px",r.style.position="relative",r.style.zIndex="1";const i=document.createElement("div");i.innerHTML=`<div style="font-size:2.5rem;font-weight:bold;color:#222;text-shadow:0 2px 8px #fff,0 0 8px #000">🎉 ${M} WINS! 🎉</div><div style="font-size:1.3rem;color:#333;margin-top:18px;text-shadow:0 2px 8px #fff,0 0 8px #000">has reached ${e.toFixed(0)}% of world income!</div>`,r.appendChild(i);const c=document.createElement("button");c.textContent="OK",c.style.marginTop="24px",c.style.padding="12px 36px",c.style.fontSize="1.3rem",c.style.border="none",c.style.borderRadius="8px",c.style.background="linear-gradient(90deg,#43cea2 0%,#ffd700 100%)",c.style.color="#222",c.style.fontWeight="bold",c.style.cursor="pointer",c.style.textShadow="0 2px 8px #fff,0 0 8px #000",c.onclick=()=>{g=!1,window.removeEventListener("resize",s),n&&n.parentNode&&n.parentNode.removeChild(n),t&&t()},r.appendChild(c),n.appendChild(r),document.body.appendChild(n);const l=o.getContext("2d"),a=[];let d=o.height;function u(){const m=Math.random()*o.width*.8+o.width*.1,y=o.height*.02+Math.random()*o.height*.04,w=(Math.random()-.5)*2,p=(-8-Math.random()*4)*2,C=`hsl(${Math.random()*360},90%,60%)`;a.push({x:m,y:o.height,vx:w,vy:p,color:C,exploded:!1,particles:[],age:0,targetY:y})}function f(m){for(let y=0;y<48;y++){const w=y/48*2*Math.PI,p=2+Math.random()*2.5;m.particles.push({x:m.x,y:m.y,vx:Math.cos(w)*p,vy:Math.sin(w)*p,color:m.color,alpha:1,age:0})}}let g=!0;function h(){if(!(!g||!l)){l.clearRect(0,0,o.width,o.height),Math.random()<.06&&a.length<7&&u();for(const m of a)if(!m.exploded)m.x+=m.vx,m.y+=m.vy,m.vy+=.13,m.age++,m.y<d&&(d=m.y),l.save(),l.beginPath(),l.arc(m.x,m.y,4,0,2*Math.PI),l.fillStyle=m.color,l.globalAlpha=.9,l.shadowColor=m.color,l.shadowBlur=16,l.fill(),l.restore(),m.y<=m.targetY&&(m.exploded=!0,f(m));else{for(const y of m.particles)y.x+=y.vx,y.y+=y.vy,y.vy+=.04,y.alpha-=.012+Math.random()*.01,y.age++,l.save(),l.beginPath(),l.arc(y.x,y.y,2.2,0,2*Math.PI),l.fillStyle=y.color,l.globalAlpha=Math.max(0,y.alpha),l.shadowColor=y.color,l.shadowBlur=8,l.fill(),l.restore();m.particles=m.particles.filter(y=>y.alpha>.05&&y.age<90)}for(let m=a.length-1;m>=0;m--)a[m].exploded&&a[m].particles.length===0&&a.splice(m,1);requestAnimationFrame(h)}}h()}const Be=Object.freeze(Object.defineProperty({__proto__:null,showWinDialog:de},Symbol.toStringTag,{value:"Module"}));class Ne{constructor(e,t,n,o){v(this,"overlay");v(this,"ctx");v(this,"width");v(this,"height");v(this,"fish",[]);v(this,"running",!1);v(this,"lastSpawn",0);v(this,"nextSpawn",0);v(this,"getOceanPredicate");v(this,"animationFrameId",null);v(this,"timeoutId",null);v(this,"loop",e=>{this.ctx.clearRect(0,0,this.width,this.height),this.fish=this.fish.filter(t=>!t.done);for(const t of this.fish)t.update(e),t.draw(this.ctx);e>this.nextSpawn&&(this.spawnFish(),this.scheduleNextSpawn()),this.fish.length>0||this.nextSpawn-e<2e3?this.animationFrameId=requestAnimationFrame(this.loop):(this.running=!1,this.timeoutId=setTimeout(()=>this.start(),this.nextSpawn-e))});this.width=t,this.height=n,this.getOceanPredicate=o,this.overlay=document.createElement("canvas"),this.overlay.width=t,this.overlay.height=n,this.overlay.style.position="absolute",this.overlay.style.left="0",this.overlay.style.top="0",this.overlay.style.pointerEvents="none",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.zIndex="20",e.appendChild(this.overlay);const s=this.overlay.getContext("2d");if(!s)throw new Error("Could not get canvas context for FishOverlay");this.ctx=s,this.scheduleNextSpawn(),this.start()}scheduleNextSpawn(){this.nextSpawn=performance.now()+5e3+Math.random()*1e4}spawnFish(){for(let e=0;e<10;e++){const t=Math.floor(Math.random()*this.width),n=Math.floor(this.height*(.4+.5*Math.random())),o=Math.random()<.5?1:-1,s=32+Math.random()*24,r=t+o*s;if(this.getOceanPredicate(t,n)&&this.getOceanPredicate(Math.round(r),n)){const i="#444";this.fish.push(new Oe(t,n,o,i));break}}}start(){this.running||(this.running=!0,this.animationFrameId=requestAnimationFrame(this.loop))}stop(){this.running=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}resume(){this.running||this.start()}}class Oe{constructor(e,t,n,o){v(this,"x0");v(this,"y0");v(this,"x1");v(this,"y1");v(this,"dir");v(this,"color","#444");v(this,"t0");v(this,"duration");v(this,"done",!1);v(this,"splash",!1);v(this,"splashStart",0);v(this,"splashDuration",1200);this.x0=e,this.y0=t;const s=32+Math.random()*24;this.x1=e+n*s,this.y1=t,this.dir=n,this.t0=performance.now(),this.duration=(1200+Math.random()*400)/2}update(e){const t=(e-this.t0)/this.duration;if(!this.splash&&t>.95&&(this.splash=!0,this.splashStart=e),t>1&&this.splash){e-this.splashStart>this.splashDuration&&(this.done=!0);return}if(t>1){this.done=!0;return}}draw(e){const t=performance.now(),n=Math.min(1,(t-this.t0)/this.duration),o=18,s=this.x0+(this.x1-this.x0)*n,r=this.y0-(1-4*Math.pow(n-.5,2))*o,i=1+.18*Math.sin(Math.PI*n),c=.5*Math.sin(Math.PI*n);if(n<=.95){e.save(),e.translate(s,r);const l=1/3,a=e.createRadialGradient(0,0,.3,0,0,7*i*l);a.addColorStop(0,"#222"),a.addColorStop(.7,"#666"),a.addColorStop(1,"#bbb"),e.fillStyle=a,e.beginPath(),e.ellipse(0,0,7*i*l,3*l,0,0,2*Math.PI),e.fill(),e.save(),e.beginPath(),e.moveTo(-7*i*l,0),e.lineTo(-11*i*l,-4*l),e.lineTo(-11*i*l,4*l),e.closePath(),e.fillStyle="#222",e.globalAlpha=.8,e.fill(),e.restore(),e.save(),e.beginPath(),e.ellipse(-2*i*l,2.2*l,2*l,.7*l,Math.PI/4+c,0,2*Math.PI),e.ellipse(-2*i*l,-2.2*l,2*l,.7*l,-Math.PI/4-c,0,2*Math.PI),e.fillStyle="#888",e.globalAlpha=.7,e.fill(),e.restore(),e.restore()}if(this.splash){const l=Math.min(1,(t-this.splashStart)/this.splashDuration);for(let a=0;a<3;a++){const d=10+12*l+a*6;e.save(),e.beginPath(),e.arc(this.x1,this.y1,d,0,2*Math.PI),e.strokeStyle=`rgba(10,10,10,${.7*(1-l)})`,e.lineWidth=2.5-a*.5,e.globalAlpha=1*(1-l),e.stroke(),e.restore()}}}}function Ge(M){var d;let e=document.getElementById("action-log-dialog");e&&e.remove();const t=document.createElement("div");t.id="action-log-dialog",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.6)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="99999",(d=W.getInstance())==null||d.pauseGame();const n=document.createElement("div");n.style.background="#fff",n.style.width="100vw",n.style.height="100vh",n.style.padding="0",n.style.borderRadius="0",n.style.boxShadow="none",n.style.maxWidth="100vw",n.style.maxHeight="100vh",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="stretch",n.style.gap="0",n.style.overflow="hidden";const o=document.createElement("button");o.textContent="Close",o.style.alignSelf="flex-end",o.style.margin="16px 24px 0 0",o.style.padding="10px 32px",o.style.fontSize="1.2rem",o.style.border="none",o.style.borderRadius="8px",o.style.background="linear-gradient(90deg,#ff9966 0%,#ff5e62 100%)",o.style.color="#fff",o.style.cursor="pointer",o.onclick=()=>{var f,g;(f=W.getInstance())==null||f.resumeGame(),t.remove();const u=W.getInstance();u&&u.currentGame&&!u.canceled&&((g=u.currentGame.activePlayer)!=null&&g.isAI)&&setTimeout(()=>u.turnStarted(),0)},n.appendChild(o);const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="row",s.style.alignItems="center",s.style.gap="16px",s.style.padding="24px 32px 8px 32px",s.style.background="#f5f5f5";const r=document.createElement("select");r.style.fontSize="1.1rem",r.style.padding="6px 12px";for(const u of M.players){const f=document.createElement("option");f.value=u.name,f.textContent=u.name+(u.isAI?" (AI)":""),r.appendChild(f)}s.appendChild(r);const i=document.createElement("input");i.type="text",i.placeholder="Filter (wildcard, all fields)",i.style.fontSize="1.1rem",i.style.padding="6px 12px",i.style.borderRadius="6px",i.style.border="1px solid #aaa",s.appendChild(i),n.appendChild(s);const c=document.createElement("div");c.style.overflow="auto",c.style.flex="1",c.style.padding="0 32px 32px 32px",c.style.background="#fff",n.appendChild(c);function l(u,f){c.innerHTML="";const g=document.createElement("table");g.style.width="100%",g.style.borderCollapse="collapse",g.style.fontSize="1.05rem";const h=document.createElement("thead"),m=document.createElement("tr");for(const p of["#","Action","Countries","Amount","Result"]){const C=document.createElement("th");C.textContent=p,C.style.borderBottom="2px solid #888",C.style.padding="8px 12px",C.style.background="#eee",m.appendChild(C)}h.appendChild(m),g.appendChild(h);const y=document.createElement("tbody");let w=u.actionLog;if(f.trim()){const p=f.trim().toLowerCase();w=w.filter(C=>C.actionType.toLowerCase().includes(p)||C.countries.map(x=>x.name).join(",").toLowerCase().includes(p)||(""+C.amount).includes(p)||(C.result?C.result.toLowerCase():"").includes(p))}w.forEach((p,C)=>{const x=document.createElement("tr");x.style.borderBottom="1px solid #ddd";const b=document.createElement("td");b.textContent=(C+1).toString(),b.style.padding="6px 12px",x.appendChild(b);const k=document.createElement("td");k.textContent=p.actionType,k.style.padding="6px 12px",x.appendChild(k);const A=document.createElement("td");A.textContent=p.countries.map(I=>I.name).join(", "),A.style.padding="6px 12px",x.appendChild(A);const T=document.createElement("td");T.textContent=p.amount.toString(),T.style.padding="6px 12px",x.appendChild(T);const S=document.createElement("td");S.textContent=p.result??"",S.style.padding="6px 12px",x.appendChild(S),y.appendChild(x)}),g.appendChild(y),c.appendChild(g)}let a=M.players[0];l(a,""),r.onchange=()=>{a=M.players.find(u=>u.name===r.value)||M.players[0],l(a,i.value)},i.oninput=()=>{l(a,i.value)},t.appendChild(n),document.body.appendChild(t)}const Y=class Y{constructor(){v(this,"state");v(this,"currentGame",null);v(this,"rootContainer",null);v(this,"canceled",!1);v(this,"paused",!1);v(this,"clickedCountryNames",[]);v(this,"worldMapCanvas",null);v(this,"mapDirty",!0);v(this,"actions");v(this,"fishOverlay",null);v(this,"_onResize",()=>{this.markMapDirty(),this.rootContainer&&this.renderMainGui(this.rootContainer,this.currentGame)});this.state="initialized",this.actions=[new ce,new le,new F,new Pe,new Q,new V],Y._instance=this,window.addEventListener("keydown",e=>{e.key==="F9"&&this.currentGame&&Ge(this.currentGame),e.key==="F8"&&K(()=>Promise.resolve().then(()=>Be),void 0).then(t=>{var o,s;const n=((s=(o=this.currentGame)==null?void 0:o.activePlayer)==null?void 0:s.name)||"Player";t.showWinDialog(n,100)})})}pauseGame(){if(this.paused=!0,!this.fishOverlay){const e=document.querySelector('div[style*="flex: 3"]');e&&e._fishOverlay&&(this.fishOverlay=e._fishOverlay)}this.fishOverlay&&typeof this.fishOverlay.stop=="function"?(console.log("Pausing FishOverlay",this.fishOverlay),this.fishOverlay.stop()):console.log("No FishOverlay to pause")}resumeGame(){if(this.paused=!1,!this.fishOverlay){const e=document.querySelector('div[style*="flex: 3"]');e&&e._fishOverlay&&(this.fishOverlay=e._fishOverlay)}this.fishOverlay&&typeof this.fishOverlay.resume=="function"?(console.log("Resuming FishOverlay",this.fishOverlay),this.fishOverlay.resume()):console.log("No FishOverlay to resume")}isPaused(){return this.paused}static getInstance(){return Y._instance}afterAction(){if(this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],n=this.currentGame.worldMap.getCountries().find(o=>o.name===e);if(n&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const o=this.currentGame.activePlayer.getCountryInfo(n,this.currentGame.gameTurn),s=document.getElementById("country-info-panel");s&&(s.innerHTML=`
            <b>Country Info</b><br>
            <div><b>Name:</b> ${o.name}</div>
            <div><b>Owner:</b> ${o.owner?o.owner.name:"None"}</div>
            <div><b>Income:</b> ${o.income!==void 0?o.income:"?"}</div>
            <div><b>Army:</b> ${o.army!==void 0?o.army:"?"}</div>
            <div><b>Recency:</b> ${o.recency!==void 0?o.recency:"?"}</div>
          `)}}if(this.markMapDirty(),this.rootContainer&&(this.renderMainGui(this.rootContainer,this.currentGame),this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap)){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],n=this.currentGame.worldMap.getCountries().find(o=>o.name===e);if(n&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const o=this.currentGame.activePlayer.getCountryInfo(n,this.currentGame.gameTurn),s=document.getElementById("country-info-panel");s&&(s.innerHTML=`
              <b>Country Info</b><br>
              <div><b>Name:</b> ${o.name}</div>
              <div><b>Owner:</b> ${o.owner?o.owner.name:"None"}</div>
              <div><b>Income:</b> ${o.income!==void 0?o.income:"?"}</div>
              <div><b>Army:</b> ${o.army!==void 0?o.army:"?"}</div>
              <div><b>Recency:</b> ${o.recency!==void 0?o.recency:"?"}</div>
            `)}}this.updateActionButtons()}updateActionButtons(){if(this.paused)return;const e=document.getElementById("action-buttons-area");if(!e)return;const t=[];if(Array.from(e.children).forEach(r=>{r instanceof HTMLElement&&(r.classList.contains("persistent-action-btn")?(t.push(r),r.textContent&&r.textContent.trim()==="New Game"&&(r.disabled=!1)):e.removeChild(r))}),!this.currentGame||!this.currentGame.players||!this.currentGame.activePlayer)return;const n=this.currentGame.worldMap?this.currentGame.worldMap.getCountries():[],o=this.clickedCountryNames.map(r=>n.find(i=>i.name===r)).filter(Boolean);if(this.currentGame.activePlayer.actionsLeft<=0){const r=document.createElement("div");r.textContent="You are out of actions for this turn!",r.style.background="linear-gradient(90deg,#ff5e62 0%,#ff9966 100%)",r.style.color="#fff",r.style.fontSize="1.5rem",r.style.fontWeight="bold",r.style.padding="32px 0",r.style.borderRadius="12px",r.style.textAlign="center",r.style.margin="24px 0",e.appendChild(r);return}const s=[];for(const r of this.actions){const i=r.GetButtonText(o,this.currentGame.activePlayer);if(i){const c=document.createElement("button");c.textContent=i,c.style.padding="12px 0",c.style.fontSize="1.1rem",c.style.background="linear-gradient(90deg,#00c3ff 0%,#ffff1c 100%)",c.style.color="#222",c.style.border="none",c.style.borderRadius="8px",c.style.cursor="pointer",c.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",c.style.marginBottom="8px",c.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",c.onclick=async()=>{const l=r.RequiresAmount(o,this.currentGame.activePlayer,this.currentGame);let a=null,d=0;if(l){const[f,g]=l,h=await Ie(f,g,f);if(h===null)return;d=h,a=await r.Act(o,this.currentGame.activePlayer,this.currentGame,h)}else a=await r.Act(o,this.currentGame.activePlayer,this.currentGame);const u=o.slice(-r.countryCountNeeded);this.currentGame.activePlayer.actionLog.push({actionType:r.Type(),countries:u,amount:d,result:a??null}),this.currentGame.activePlayer.useAction(),typeof a=="string"&&a!==null?(this.showModalMessage(a),this.afterAction()):this.afterAction()},s.push(c)}}if(s.length&&t.length){const r=document.createElement("div");r.style.height="16px",r.style.width="100%",e.insertBefore(r,t[0]),s.forEach(i=>e.insertBefore(i,r))}else s.length&&s.forEach(r=>e.appendChild(r))}showModalMessage(e){let t=document.getElementById("gamegui-modal-messagebox");if(!t){t=document.createElement("div"),t.id="gamegui-modal-messagebox",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.5)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="9999";const o=document.createElement("div");o.style.background="#fff",o.style.padding="32px 40px",o.style.borderRadius="12px",o.style.boxShadow="0 2px 16px rgba(0,0,0,0.2)",o.style.maxWidth="90vw",o.style.maxHeight="80vh",o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.gap="24px";const s=document.createElement("div");s.id="gamegui-modal-messagebox-text",s.style.fontSize="1.2rem",s.style.color="#222",o.appendChild(s);const r=document.createElement("button");r.textContent="OK",r.style.marginTop="12px",r.style.padding="8px 24px",r.style.fontSize="1.1rem",r.style.border="none",r.style.borderRadius="6px",r.style.background="linear-gradient(90deg,#ff9966 0%,#ff5e62 100%)",r.style.color="#fff",r.style.cursor="pointer",r.onclick=()=>{t&&t.parentNode&&t.parentNode.removeChild(t)},o.appendChild(r),t.appendChild(o),document.body.appendChild(t)}const n=document.getElementById("gamegui-modal-messagebox-text");n&&(n.textContent=e),t.style.display="flex"}markMapDirty(){this.mapDirty=!0}getWorldMapCanvas(){if(this.paused)throw new Error("Game is paused");if(!this.currentGame||!this.currentGame.worldMap)throw new Error("GameGui.getWorldMapCanvas: currentGame or worldMap is missing");if(this.mapDirty||!this.worldMapCanvas){let e=[];if(this.currentGame.activePlayer){const t=this.currentGame.activePlayer.getKnownCountries();e=t.owned.concat(t.known)}this.worldMapCanvas=j.render(this.currentGame.worldMap,[],e,P.showArmies,this.currentGame.activePlayer),this.mapDirty=!1}return this.worldMapCanvas}async mount(e){this.rootContainer=e,window.addEventListener("resize",this._onResize),this.renderMainGui(e,this.currentGame)}unmount(){window.removeEventListener("resize",this._onResize)}async turnStarted(){var n,o;if(this.paused)return;if(this.currentGame&&this.currentGame.activePlayer&&this.currentGame.activePlayer.IncomeShare>=P.INCOME_SHARE_WIN){de(this.currentGame.activePlayer.name,P.INCOME_SHARE_WIN*100,()=>{this.canceled=!0}),this.canceled=!0;return}if(this.renderMainGui(this.rootContainer,this.currentGame),this.canceled||!((o=(n=this.currentGame)==null?void 0:n.activePlayer)!=null&&o.isAI))return;const e=this.currentGame.activePlayer.AI;if(!e)return;const t=async()=>{if(this.paused||this.canceled)return;const s=await e.takeAction();this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),s?setTimeout(()=>t(),100):(this.currentGame.nextTurn(),this.markMapDirty(),this.currentGame.activePlayer.isAI?setTimeout(()=>this.turnStarted(),100):this.turnStarted())};t()}async startNewGame(){this.canceled=!0;const e=this.rootContainer,{showNewGameDialog:t}=await K(async()=>{const{showNewGameDialog:n}=await import("./NewGameDialog-CzNN0h4Y.js");return{showNewGameDialog:n}},[]);try{const n=await t(e),o=await K(()=>import("./Player-BLwqAABQ.js"),[]),s=await K(()=>Promise.resolve().then(()=>Te),void 0);s.Game.showArmies=n.showArmies;const r=["#4fc3f7","#81c784","#ffb74d","#e57373","#ba68c8","#ffd54f","#64b5f6","#a1887f"],i=o.Player.COLORS??r,c=n.players.map((l,a)=>new o.Player(l.name,i[a%i.length],[],null,[],0,l.isAI));this.currentGame=s.Game.initNewGame(n.map,c,this),this.markMapDirty(),this.getWorldMapCanvas(),this.renderMainGui(e,this.currentGame),this.currentGame&&this.currentGame.players.length>0&&(this.canceled=!1,this.currentGame.activePlayer.startTurn(),this.turnStarted())}catch(n){console.error("NewGameDialog error or cancellation:",n)}}renderMainGui(e,t){if(this.paused)return;const n=this.rootContainer;if(!n)throw new Error("rootContainer is not set (null) in renderMainGui");const o=n.querySelector('div[style*="flex: 3"]');if(o&&o._fishOverlay){const h=o._fishOverlay;typeof h.stop=="function"&&h.stop(),h.overlay&&h.overlay.parentNode&&h.overlay.parentNode.removeChild(h.overlay),o._fishOverlay=null}n.innerHTML="";const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="row",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100vw",s.style.height="100vh",s.style.background="linear-gradient(120deg, #232526 0%, #414345 100%)",s.style.borderRadius="0",s.style.boxShadow="none",s.style.overflow="hidden",s.style.margin="0",s.style.maxWidth="100vw";const r=document.createElement("div");r.style.flex="3",r.style.background="#222",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.position="relative",r.style.borderRight="2px solid #333";let i=null;t&&t.worldMap&&(i=this.getWorldMapCanvas()),this.clickedCountryNames||(this.clickedCountryNames=[]);const c=document.createElement("div");if(c.id="country-info-panel",c.style.background="#a67c52",c.style.border="1px solid #555",c.style.borderRadius="8px",c.style.padding="10px 12px",c.style.marginBottom="18px",c.style.color="#b3e5fc",c.style.fontSize="1.05rem",c.style.minHeight="100px",c.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",c.innerHTML='<b>Country Info</b><br><span style="color:#888">Click a country to view details.</span>',i){let h=function(){y||(y=document.createElement("canvas"),y.width=i.width,y.height=i.height,y.style.position="absolute",y.style.left="0",y.style.top="0",y.style.pointerEvents="none",y.style.width="100%",y.style.height="100%",r.appendChild(y))},m=function(){if(y){const p=y.getContext("2d");p&&p.clearRect(0,0,y.width,y.height)}};i.style.width="100%",i.style.height="100%",i.style.display="block",r.appendChild(i);let y=null;if(!r._fishOverlay){const p=t.worldMap.getMap(),C=i.width,x=i.height,b=(k,A)=>k<0||A<0||A>=p.length||k>=p[0].length?!1:p[A][k]===R;r._fishOverlay=new Ne(r,C,x,b)}this.fishOverlay=r._fishOverlay,i._countryClickHandler&&i.removeEventListener("mousedown",i._countryClickHandler);const w=p=>{if(this.paused)return;const C=i.width,x=i.height,b=Math.floor(p.offsetX*(C/i.clientWidth)),k=Math.floor(p.offsetY*(x/i.clientHeight)),A=t.worldMap.getMap(),T=t.worldMap.getCountries();let S=null;if(b>=0&&k>=0&&k<A.length&&b<A[0].length){const I=A[k][b];if(I>=0&&T[I]){if(S=T[I],S.coordinates.some(([E,$])=>E===b&&$===k)||console.warn(`[GameGui] Click at (${b},${k}) is not in coordinates of country: ${S.name}`),this.clickedCountryNames.push(S.name),h(),m(),y&&S){const E=y.getContext("2d");if(E){j.drawCountryGlow(E,S,[0,0,0],S.color);const[$,X]=S.center?S.center():[0,0],ee=S.fortified?"🛡️ "+S.name:S.name;if(E.save(),E.font="bold 10px Verdana, Geneva, sans-serif",E.textAlign="center",E.textBaseline="middle",E.lineWidth=3,E.strokeStyle="black",E.strokeText(ee,$,X),E.fillStyle="white",E.fillText(ee,$,X),P.showArmies&&typeof S.armies=="number"){const te=`${Math.round(S.armies/1e3)}k`;E.font="bold 9px Verdana, Geneva, sans-serif",E.lineWidth=2,E.strokeStyle="black",E.strokeText(te,$,X+13),E.fillStyle="#FFD700",E.fillText(te,$,X+13)}E.restore()}}this.updateActionButtons();const G=document.getElementById("country-info-panel");if(G&&t&&t.activePlayer&&typeof t.gameTurn=="number"){const E=t.activePlayer.getCountryInfo(S,t.gameTurn);G.innerHTML=`
                <b>Country Info</b><br>
                <div><b>Name:</b> ${E.name}</div>
                <div><b>Owner:</b> ${E.owner?E.owner.name:"None"}</div>
                <div><b>Income:</b> ${E.income!==void 0?E.income:"?"}</div>
                <div><b>Army:</b> ${E.army!==void 0?E.army:"?"}</div>
                <div><b>Recency:</b> ${E.recency!==void 0?E.recency:"?"}</div>
              `}const D=document.getElementById("last-clicked-country-info-panel");if(D&&t&&t.activePlayer&&typeof t.gameTurn=="number"){const E=t.activePlayer.getCountryInfo(S,t.gameTurn);D.innerHTML=`
                <b>Last Clicked Country Info</b><br>
                <div><b>Name:</b> ${E.name}</div>
                <div><b>Owner:</b> ${E.owner?E.owner.name:"None"}</div>
                <div><b>Income:</b> ${E.income!==void 0?E.income:"?"}</div>
                <div><b>Army:</b> ${E.army!==void 0?E.army:"?"}</div>
                <div><b>Recency:</b> ${E.recency!==void 0?E.recency:"?"}</div>
              `}}}};i.addEventListener("mousedown",w),i._countryClickHandler=w}else{const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.background="repeating-linear-gradient(135deg,#444 0 10px,#333 10px 20px)",h.style.border="4px solid #666",h.style.borderRadius="12px",h.style.display="flex",h.style.alignItems="center",h.style.justifyContent="center";const m=document.createElement("img");m.src="riskStartup.png",m.alt="Risk Startup",m.style.width="100%",m.style.height="100%",m.style.objectFit="cover",m.style.borderRadius="8px",h.appendChild(m),r.appendChild(h)}const l=document.createElement("div"),a=document.createElement("button");a.textContent="New Game",a.classList.add("persistent-action-btn"),a.style.padding="12px 0",a.style.fontSize="1.1rem",a.style.background="linear-gradient(90deg,#00c3ff 0%,#ffff1c 100%)",a.style.color="#222",a.style.border="none",a.style.borderRadius="8px",a.style.cursor="pointer",a.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",a.style.marginBottom="24px",a.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",a.onclick=()=>{this.startNewGame()},l.appendChild(a),l.appendChild(c),l.style.flex="1",l.style.background="#3b2412",l.style.display="flex",l.style.flexDirection="column",l.style.padding="32px 24px",l.style.color="#fff",l.style.minWidth="320px",l.style.fontFamily="'MedievalSharp', 'Times New Roman', serif";const d=document.createElement("div");d.style.marginBottom="32px";const u=document.createElement("div");if(u.style.fontSize="1.2rem",u.style.fontWeight="bold",t&&t.players&&t.players.length>0){const h=t.activePlayer;u.textContent=`Turn: ${t.gameTurn} | Player: ${h.name}`;const m=document.createElement("div"),y=h.constructor.ACTIONS_PER_TURN||5,w=h.actionsLeft;m.style.margin="8px 0 0 0",m.style.fontSize="2rem",m.style.letterSpacing="0.2rem";for(let p=0;p<y;p++){const C=document.createElement("span");C.textContent=p<w?"★":"☆",C.style.color=p<w?"#ffd700":"#888",m.appendChild(C)}m.title=`${w} of ${y} actions remaining`,d.appendChild(m)}else u.textContent="No game loaded. Start a new game to play!";if(d.appendChild(u),l.appendChild(d),t&&t.players&&t.players.length>0){const h=document.createElement("div");h.textContent="Players",h.style.fontWeight="bold",h.style.marginBottom="8px",l.appendChild(h);const m=document.createElement("ul");m.style.listStyle="none",m.style.padding="0",m.style.margin="0 0 24px 0";for(const y of t.players){const w=document.createElement("li");w.style.display="flex",w.style.alignItems="center",w.style.marginBottom="8px",y===t.activePlayer&&(w.style.boxShadow="0 0 16px 4px #ffd700, 0 0 4px 2px #fff",w.style.border="2px solid #ffd700",w.style.borderRadius="12px",w.style.background="rgba(255, 215, 0, 0.10)");const p=document.createElement("span");p.style.display="inline-block",p.style.width="16px",p.style.height="16px",p.style.borderRadius="50%",p.style.background=y.color,p.style.marginRight="8px",w.appendChild(p);const C=document.createElement("span");if(C.textContent=y.name+(y.isAI?" (AI)":""),C.style.flex="1",w.appendChild(C),typeof y.money=="number"){const x=document.createElement("span");x.textContent=`💰 ${y.money}`,x.style.marginLeft="8px",w.appendChild(x);const b=document.createElement("span");b.style.display="inline-block",b.style.width="54px",b.style.height="12px",b.style.marginLeft="8px",b.style.verticalAlign="middle",b.style.background="#222",b.style.border="1px solid #444",b.style.borderRadius="6px",b.style.overflow="hidden";const k=document.createElement("span"),A=Math.min(y.IncomeShare/P.INCOME_SHARE_WIN,1);k.style.display="inline-block",k.style.height="100%",k.style.width=`${Math.round(A*100)}%`,k.style.background=A>=1?"linear-gradient(90deg,#43cea2,#ffd700)":"linear-gradient(90deg,#43cea2,#185a9d)",k.style.transition="width 0.3s",b.title=`Income share: ${(y.IncomeShare*100).toFixed(1)}% (win at ${(P.INCOME_SHARE_WIN*100).toFixed(0)}%)`,b.appendChild(k),w.appendChild(b)}m.appendChild(w)}l.appendChild(m)}const f=document.createElement("div");f.id="action-buttons-area",f.style.display="flex",f.style.flexDirection="column",f.style.gap="12px",f.style.marginTop="auto";const g=document.createElement("button");g.textContent="End Turn",g.classList.add("persistent-action-btn"),g.style.padding="12px 0",g.style.fontSize="1.1rem",g.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",g.style.color="#fff",g.style.border="none",g.style.borderRadius="8px",g.style.cursor="pointer",g.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",g.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",g.onclick=()=>{this.paused||this.currentGame&&(this.currentGame.nextTurn(),this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),this.turnStarted())},f.appendChild(g),l.appendChild(f),s.appendChild(r),s.appendChild(l),n.appendChild(s)}};v(Y,"_instance",null);let W=Y;function $e(M,e){const t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.zIndex="10000",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.pointerEvents="none",t.style.overflow="hidden";const n=document.createElement("div");n.innerText="Armchair",n.style.position="relative",n.style.color="#fffbe6",n.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',n.style.fontSize="6vw",n.style.fontWeight="bold",n.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",n.style.letterSpacing="0.18em",n.style.opacity="0",n.style.transform="translateX(-120%) skew(-12deg)",n.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",n.style.filter="drop-shadow(0 0 12px #fffbe6)",n.style.background="",n.style.webkitBackgroundClip="",n.style.backgroundClip="",n.style.webkitTextFillColor="";const o=document.createElement("div");o.innerText="General",o.style.position="relative",o.style.color="#fffbe6",o.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',o.style.fontSize="6vw",o.style.fontWeight="bold",o.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",o.style.letterSpacing="0.18em",o.style.opacity="0",o.style.transform="translateX(120%) skew(12deg)",o.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",o.style.filter="drop-shadow(0 0 12px #fffbe6)",o.style.background="",o.style.webkitBackgroundClip="",o.style.backgroundClip="",o.style.webkitTextFillColor="";const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="center",s.style.gap="1vw",s.style.pointerEvents="none",s.appendChild(n),s.appendChild(o),t.appendChild(s),M.appendChild(t);const r=document.createElement("canvas");r.width=M.offsetWidth||800,r.height=M.offsetHeight||600,r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.pointerEvents="none",t.appendChild(r);const i=r.getContext("2d"),c=10,l=[];r.width/2;const a=r.height*.8;for(let h=0;h<c;h++){const y=h%2===0?r.width*.05:r.width*.95,w=r.width*(.15+.7*Math.random()),p=a-r.height*.25+Math.random()*r.height*.1,C=a-r.height*.05+Math.random()*r.height*.18,x=1200+Math.random()*400,b=r.height*(.32+Math.random()*.12);l.push({startX:y,startY:p,endX:w,endY:C,duration:x,startTime:null,exploded:!1,explosionTime:null,arcHeight:b})}function d(h,m,y){i&&(i.save(),i.beginPath(),i.arc(h,m,18*y,0,2*Math.PI),i.fillStyle="rgba(40,40,40,0.95)",i.shadowColor="#222",i.shadowBlur=12*y,i.fill(),i.restore(),i.save(),i.beginPath(),i.arc(h-6*y,m-6*y,5*y,0,2*Math.PI),i.fillStyle="rgba(200,200,200,0.18)",i.fill(),i.restore())}function u(h,m,y){if(i){if(y<.15){const w=38+60*y;i.save(),i.beginPath(),i.arc(h,m,w,0,2*Math.PI),i.fillStyle=`rgba(255,255,220,${.7*(1-y/.15)})`,i.shadowColor="#fffbe6",i.shadowBlur=48,i.fill(),i.restore()}if(y<.6){const w=32+80*y;i.save(),i.beginPath(),i.arc(h,m,w,0,2*Math.PI),i.fillStyle=`rgba(255,120,40,${.5*(1-y/.6)})`,i.shadowColor="#ffae42",i.shadowBlur=32,i.fill(),i.restore(),i.save(),i.beginPath(),i.arc(h,m,w*.5,0,2*Math.PI),i.fillStyle=`rgba(255,220,120,${.7*(1-y/.6)})`,i.shadowColor="#fffbe6",i.shadowBlur=16,i.fill(),i.restore()}if(y>.2){const w=(y-.2)/.8;for(let p=0;p<4;p++){const C=Math.PI*2*(p/4)+Math.random()*.2,x=38+60*y+Math.random()*10,b=h+Math.cos(C)*x*.7*w,k=m+Math.sin(C)*x*.5*w+10*w;i.save(),i.beginPath(),i.arc(b,k,18+18*w,0,2*Math.PI),i.fillStyle=`rgba(80,60,40,${.18*(1-w)})`,i.shadowColor="#222",i.shadowBlur=8,i.fill(),i.restore()}}}}function f(h){i.clearRect(0,0,r.width,r.height);let m=!0;for(const y of l){y.startTime||(y.startTime=h);const w=h-y.startTime;if(y.exploded){if(y.explosionTime&&h-y.explosionTime<700){const p=(h-y.explosionTime)/700;u(y.endX,y.endY,p),m=!1}}else{m=!1;const p=Math.min(w/y.duration,1),C=y.startX+(y.endX-y.startX)*p,x=(1-p)*y.startY+p*y.endY-y.arcHeight*4*p*(1-p),b=.9+.3*(1-Math.abs(2*p-1));d(C,x,b),p>=1&&(y.exploded=!0,y.explosionTime=h)}}m||requestAnimationFrame(f)}requestAnimationFrame(f),setTimeout(()=>{n.style.opacity="1",n.style.transform="translateX(0) skew(0)",o.style.opacity="1",o.style.transform="translateX(0) skew(0)"},400),setTimeout(()=>{},3200);const g=document.createElement("link");g.rel="stylesheet",g.href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=UnifrakturCook:wght@700&display=swap",document.head.appendChild(g)}const U=document.getElementById("app");if(U)U.innerHTML="",new W().mount(U),setTimeout(()=>{const e=U.querySelector('div[style*="flex: 3"]');e&&$e(e)},0);else throw new Error("No app element found in index.html");export{ve as C,j as R,se as W};
