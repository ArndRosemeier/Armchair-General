var wt=Object.defineProperty;var xt=(A,e,t)=>e in A?wt(A,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):A[e]=t;var v=(A,e,t)=>xt(A,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const vt="modulepreload",bt=function(A){return"/Armchair-General/"+A},je={},ge=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let i=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=i(t.map(l=>{if(l=bt(l),l in je)return;je[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":vt,c||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((y,p)=>{u.addEventListener("load",y),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return o.then(i=>{for(const s of i||[])s.status==="rejected"&&r(s.reason);return e().catch(r)})};class Ct{constructor(e=[]){v(this,"countries");this.countries=e}}const Ve=Math.sqrt(3),Mt=.5*(Ve-1),we=(3-Ve)/6,Ue=A=>Math.floor(A)|0,Ye=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Te(A=Math.random){const e=At(A),t=new Float64Array(e).map(o=>Ye[o%12*2]),n=new Float64Array(e).map(o=>Ye[o%12*2+1]);return function(r,i){let s=0,a=0,l=0;const c=(r+i)*Mt,d=Ue(r+c),u=Ue(i+c),y=(d+u)*we,p=d-y,h=u-y,x=r-p,g=i-h;let w,f;x>g?(w=1,f=0):(w=0,f=1);const m=x-w+we,b=g-f+we,C=x-1+2*we,k=g-1+2*we,S=d&255,P=u&255;let N=.5-x*x-g*g;if(N>=0){const T=S+e[P],I=t[T],O=n[T];N*=N,s=N*N*(I*x+O*g)}let M=.5-m*m-b*b;if(M>=0){const T=S+w+e[P+f],I=t[T],O=n[T];M*=M,a=M*M*(I*m+O*b)}let E=.5-C*C-k*k;if(E>=0){const T=S+1+e[P+1],I=t[T],O=n[T];E*=E,l=E*E*(I*C+O*k)}return 70*(s+a+l)}}function At(A){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const o=n+~~(A()*(256-n)),r=t[n];t[n]=t[o],t[o]=r}for(let n=256;n<512;n++)t[n]=t[n-256];return t}function kt(A,e,t,n=1e3){var l;const o=A.length,r=((l=A[0])==null?void 0:l.length)||0,i=Array.from({length:o},()=>Array(r).fill(!1)),s=[[1,0],[-1,0],[0,1],[0,-1]],a=A.map(c=>c.slice());for(let c=0;c<o;c++)for(let d=0;d<r;d++)if(!i[c][d]&&A[c][d]===t){const u=[[c,d]],y=[[c,d]];for(i[c][d]=!0;u.length;){const[p,h]=u.shift();for(const[x,g]of s){const w=p+x,f=h+g;w>=0&&w<o&&f>=0&&f<r&&!i[w][f]&&A[w][f]===t&&(i[w][f]=!0,u.push([w,f]),y.push([w,f]))}}if(y.length<n)for(const[p,h]of y)a[p][h]=e}return a}function St(A,e,t){var l;const n=A.length,o=((l=A[0])==null?void 0:l.length)||0,r=Array.from({length:n},()=>Array(o).fill(!1)),i=[];for(let c=0;c<o;c++)A[0][c]===e&&(i.push([0,c]),r[0][c]=!0),A[n-1][c]===e&&(i.push([n-1,c]),r[n-1][c]=!0);for(let c=1;c<n-1;c++)A[c][0]===e&&(i.push([c,0]),r[c][0]=!0),A[c][o-1]===e&&(i.push([c,o-1]),r[c][o-1]=!0);const s=[[1,0],[-1,0],[0,1],[0,-1]];for(;i.length;){const[c,d]=i.shift();for(const[u,y]of s){const p=c+u,h=d+y;p>=0&&p<n&&h>=0&&h<o&&!r[p][h]&&A[p][h]===e&&(r[p][h]=!0,i.push([p,h]))}}return A.map((c,d)=>c.map((u,y)=>u===e&&!r[d][y]?t:u))}function It(A,e){return Ze(A,e,{scale:.0018,threshold:-.05,borderStrength:.5,borderWidth:.15,octaves:6,persistence:.5,seed:Math.floor(Math.random()*1e9)})}function Ze(A,e,t){const n=(t==null?void 0:t.scale)??.015,o=(t==null?void 0:t.threshold)??0,r=(t==null?void 0:t.seed)!==void 0?Tt(t.seed):Math.random,i=Te(r),s=(t==null?void 0:t.borderStrength)??.5,a=(t==null?void 0:t.borderWidth)??.2,l=(t==null?void 0:t.octaves)??4,c=(t==null?void 0:t.persistence)??.5,d=[];for(let y=0;y<e;y++){const p=[];for(let h=0;h<A;h++){const x=h-A/2,g=y-e/2;let w=0,f=0,m=1,b=1;for(let N=0;N<l;N++)w+=i(x*n*m,g*n*m)*b,f+=b,b*=c,m*=2;w/=f;const C=Math.min(h,A-1-h)/(A/2),k=Math.min(y,e-1-y)/(e/2),S=Math.min(C,k);let P=w;if(S<a){const N=s*(1-S/a);P=w*(1-N)+Q*N}p.push(P>o?oe:Q)}d.push(p)}let u=St(d,Q,oe);return u=kt(u,Q,oe,1e3),u}function Tt(A){return function(){let e=A+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}class Ce{constructor(e,t=null,n=0,o=0){v(this,"name");v(this,"owner");v(this,"armies");v(this,"income");v(this,"IncomePotential");v(this,"coordinates");v(this,"border");v(this,"oceanBorder");v(this,"neighbors");v(this,"color");v(this,"fortified",!1);v(this,"nationalPride");v(this,"unrestLevel",0);v(this,"_center",null);this.name=e,this.owner=t,this.armies=n,this.income=o;const r=1+9*Math.pow(Math.random(),3);this.IncomePotential=Math.floor(this.income*r/1e3)*1e3,this.coordinates=[],this.border=[],this.oceanBorder=[],this.neighbors=[],this.color=[Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150),Math.floor(80+Math.random()*150)];const i=1e3,s=1e5,a=Math.random()*Math.random();this.nationalPride=Math.floor(i+(s-i)*a),this.unrestLevel=0}setOwner(e){this.owner=e}setArmies(e){this.armies=e}center(){if(this._center)return this._center;if(!this.coordinates.length)return this._center=[0,0],this._center;let e=0,t=0;for(const[n,o]of this.coordinates)e+=n,t+=o;return this._center=[e/this.coordinates.length,t/this.coordinates.length],this._center}canBeFortified(){if(this.fortified)return!1;if(this.owner){for(const[e,t]of this.owner.plannedFortifications)if(e===this)return!1}return!0}toJSON(){return{id:this.name,name:this.name,ownerId:this.owner?this.owner.name:null,armies:this.armies,income:this.income,coordinates:this.coordinates,border:this.border,oceanBorder:this.oceanBorder,neighborIds:this.neighbors.map(e=>e.name),color:this.color,fortified:this.fortified,nationalPride:this.nationalPride,unrestLevel:this.unrestLevel}}static fromJSON(e,t,n){const o=new Ce(e.name,null,e.armies,e.income);return o.coordinates=e.coordinates,o.border=e.border,o.oceanBorder=e.oceanBorder,o.color=e.color,o.fortified=e.fortified,o.nationalPride=e.nationalPride??1e3,o.unrestLevel=e.unrestLevel??0,o._ownerId=e.ownerId,o._neighborIds=e.neighborIds,n[e.name]=o,o}resolveReferences(e,t){this.owner=this._ownerId?e[this._ownerId]:null,this.neighbors=(this._neighborIds||[]).map(n=>t[n]).filter(Boolean),delete this._ownerId,delete this._neighborIds}static calculateIncomePotential(e){const t=1+9*Math.pow(Math.random(),3);return Math.floor(e*t/1e3)*1e3}recalculateIncomePotential(){this.IncomePotential=Ce.calculateIncomePotential(this.income)}}class Et{static generateCountriesMap(e,t={}){if(!e||e.length===0||!e[0])throw new Error("continentMap must be a non-empty 2D array");const n=e.length,o=e[0].length,r=t.countryCount??12,i=t.scale??.09,s=t.minResistance??10,a=t.maxResistance??50,l=t.skipProbability??.9,c=t.seed!==void 0?Pt(t.seed):Math.random,d=Te(c),u=[];for(let f=0;f<n;f++){const m=[];for(let b=0;b<o;b++)m.push(e[f][b]===oe?s+(a-s)*Math.abs(d(b*i,f*i)):1/0);u.push(m)}const y=[],p=[];for(let f=0;f<n;f++)for(let m=0;m<o;m++)e[f][m]===oe&&p.push([m,f]);for(let f=0;f<r&&p.length>0;f++){const m=Math.floor(c()*p.length),[b,C]=p.splice(m,1)[0];y.push({x:b,y:C,idx:f})}for(let f=0;f<n;f++)for(let m=0;m<o;m++)e[f][m]!==Q&&(e[f][m]=oe);for(const{x:f,y:m,idx:b}of y)e[m][f]=b;const h=y.map(({x:f,y:m,idx:b})=>[f,m,b]),x=(s+a)/2;for(;h.length>0;){const f=Math.floor(c()*h.length),[m,b,C]=h.splice(f,1)[0],k=[];for(const[S,P]of[[1,0],[0,1],[-1,0],[0,-1]]){const N=m+S,M=b+P;N>=0&&N<o&&M>=0&&M<n&&e[M][N]===oe&&k.push([N,M])}if(k.length!==0)for(const[S,P]of k)u[P][S]>x&&c()<l||(e[P][S]=C,h.push([S,P,C]))}const g=Array.from({length:n},()=>Array(o).fill(!1));let w=0;for(let f=0;f<n;f++)for(let m=0;m<o;m++)e[f][m]>=0&&e[f][m]+1>w&&(w=e[f][m]+1);for(let f=0;f<n;f++)for(let m=0;m<o;m++)if(e[f][m]===oe&&!g[f][m]){const b=[[m,f]];for(g[f][m]=!0;b.length>0;){const[C,k]=b.pop();e[k][C]=w;for(const[S,P]of[[1,0],[0,1],[-1,0],[0,-1]]){const N=C+S,M=k+P;N>=0&&N<o&&M>=0&&M<n&&e[M][N]===oe&&!g[M][N]&&(b.push([N,M]),g[M][N]=!0)}}w++}return e}static generateCountriesInternal(e,t){const n=this.generateCountriesMap(e,t);if(!n||n.length===0||!n[0])throw new Error("map must be a non-empty 2D array");const o=n.length,r=n[0].length,i={};for(let l=0;l<o;l++)for(let c=0;c<r;c++){const d=n[l][c];if(d>=0){if(!i[d]){const u=new Ce(`Country ${d}`);u.id=d,i[d]=u}i[d].coordinates.push([c,l])}}const s=Math.max(...Object.keys(i).map(Number)),a=Array.from({length:s+1},(l,c)=>i[c]);return this.findCountryBorders(n,a,r,o),{map:n,countries:a}}static findCountryBorders(e,t,n,o){const r=[[1,0],[0,1],[-1,0],[0,-1]];for(const i of t){const s=i.id;i.border=[],i.oceanBorder=[];for(const[a,l]of i.coordinates){let c=!1,d=!1;for(const[u,y]of r){const p=a+u,h=l+y;(p<0||p>=n||h<0||h>=o||e[h][p]!==s)&&(c=!0,(p<0||p>=n||h<0||h>=o||e[h][p]===Q)&&(d=!0))}c&&i.border.push([a,l]),d&&i.oceanBorder.push([a,l])}}}static findNeighbors(e){const t=new Map;for(const n of e)for(const[o,r]of n.border)t.set(`${o},${r}`,n);for(const n of e){const o=new Set;for(const[r,i]of n.border)for(const[s,a]of[[1,0],[0,1],[-1,0],[0,-1]]){const l=r+s,c=i+a,d=t.get(`${l},${c}`);d&&d!==n&&o.add(d)}n.neighbors=Array.from(o)}}static mergeSmallCountries(e,t=1e3,n){let o=!0;for(;o;){o=!1;for(let r=e.length-1;r>=0;r--){const i=e[r];if(i.coordinates.length<t&&i.neighbors.length>0){let s=i.neighbors[0];for(const a of i.neighbors)a.coordinates.length<s.coordinates.length&&(s=a);if(s.coordinates.push(...i.coordinates),n&&s.id!==void 0&&i.id!==void 0)for(const[a,l]of i.coordinates)n[l][a]=s.id;e.splice(r,1),o=!0}}o&&(this.findNeighbors(e),console.log("Merged countries"))}}static generateCountries(e,t={}){const{map:n,countries:o}=this.generateCountriesInternal(e,t);this.findNeighbors(o);const r=(t==null?void 0:t.minCountrySize)??1e3;if(this.mergeSmallCountries(o,r,n),!n||n.length===0||!n[0])throw new Error("map must be a non-empty 2D array");const i=n[0].length,s=n.length;return this.findCountryBorders(n,o,i,s),this.findNeighbors(o),{map:n,countries:o}}}function Pt(A){return function(){let e=A+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function Nt(A,e){return Et.generateCountries(A,{countryCount:e,minResistance:0,maxResistance:130,skipProbability:0})}const Q=-1,oe=-2,se=class se{constructor(e,t,n=[]){v(this,"countries");v(this,"map");v(this,"continents",[]);this.countries=n,this.map=se.createOceanMap(e,t)}static logCountryNamesInOrder(e,t=""){const n=e.map((o,r)=>`${r}: ${o.name}`);console.log(`[WorldMap] Country order${t?" - "+t:""}:
`+n.join(", "))}static checkMapCountryConsistency(e,t){if(!Array.isArray(e)||!Array.isArray(t))return console.error("[WorldMap] Consistency check failed: map or countries not arrays"),!1;let n=!0;for(let o=0;o<e.length;++o)for(let r=0;r<e[o].length;++r){const i=e[o][r];i>=0&&(t[i]?typeof t[i].name!="string"&&(console.error(`[WorldMap] Inconsistent: countries[${i}] has no valid name at map[${o}][${r}]`),n=!1):(console.error(`[WorldMap] Inconsistent: map[${o}][${r}] = ${i}, but countries[${i}] is undefined`),n=!1))}return n}assignRandomCountryNames(){let e=!1;for(;!e;){const t=new Set;for(const n of this.countries){let o,r=0;do if(o=se.generateRandomName(),r++,r>1e3)throw new Error("Failed to generate unique random country names");while(t.has(o));n.name=o,t.add(o)}e=t.size===this.countries.length}}assignRealCountryNames(){let e=!1;for(;!e;){const t=[...se.REAL_COUNTRY_NAMES],n=new Set;for(const o of this.countries){let r;if(t.length>0){const i=Math.floor(Math.random()*t.length);r=t.splice(i,1)[0]}else{let i=0;do if(r=se.generateRandomName(),i++,i>1e3)throw new Error("Failed to generate unique fallback country names");while(n.has(r))}o.name=r,n.add(r)}e=n.size===this.countries.length}}static generateRandomName(){const e=["zan","mor","vek","tal","rin","dor","lek","sha","val","nor","ka","bel","dra","sil","tur","gar","fen","mir","sol","vor","lin","sar","qu","zel","ron","bar","zen","tir","lom","kal","vin","lor","mel","dar","gol","han","jor","ken","lun","mar"],t=2+Math.floor(Math.random()*2);let n="";for(let o=0;o<t;o++)n+=e[Math.floor(Math.random()*e.length)];return n.charAt(0).toUpperCase()+n.slice(1)}static createOceanMap(e,t){return Array.from({length:t},()=>Array(e).fill(Q))}static generateContinentsMap(e,t,n){return Ze(e,t,n)}static createMap(e,t,n=40,o=!0){const r=It(e,t),{map:i,countries:s}=Nt(r,n),a=new se(e,t,s);return a.map=i,o?a.assignRealCountryNames():a.assignRandomCountryNames(),a.regenerateMapFromCountries(a.countries),a.createContinents(),a}addCountry(e){this.countries.push(e)}createContinents(){const e=new Set,t=[];for(const n of this.countries)if(!e.has(n)){const o=[n],r=[];for(e.add(n);o.length>0;){const i=o.shift();r.push(i);for(const s of i.neighbors)e.has(s)||(e.add(s),o.push(s))}t.push(new Ct(r))}this.continents=t}getCountries(){return this.countries}distance(e,t){const[n,o]=e.center(),[r,i]=t.center(),s=Math.sqrt((n-r)**2+(o-i)**2);if(e.neighbors.includes(t)||t.neighbors.includes(e))return s;const a=e.oceanBorder&&e.oceanBorder.length>0,l=t.oceanBorder&&t.oceanBorder.length>0;return a&&l?s*3:null}getMap(){return this.map}regenerateMapFromCountries(e){if(!this.map||!Array.isArray(this.map)||this.map.length===0||this.map[0].length===0)throw new Error("WorldMap.map is not initialized or has invalid dimensions");const t=this.map.length,n=this.map[0].length,o=se.createOceanMap(n,t);for(let r=0;r<e.length;++r){const i=e[r];if(!i.coordinates||!Array.isArray(i.coordinates))throw new Error(`Country at index ${r} has no valid coordinates array`);for(const[s,a]of i.coordinates){if(typeof s!="number"||typeof a!="number"||s<0||s>=n||a<0||a>=t)throw new Error(`Country index ${r} has out-of-bounds coordinate (${s}, ${a})`);o[a][s]=r}}this.map=o}};v(se,"REAL_COUNTRY_NAMES",["Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia"]);let Be=se;function Ot(A){if(!A.length)throw new Error("No countries provided");let e=0,t=0;for(const i of A)for(const[s,a]of i.coordinates)s>e&&(e=s),a>t&&(t=a);const n=e+1,o=t+1,r=new Be(n,o,A);return r.regenerateMapFromCountries(A),r.createContinents(),r}const J=class J{static render(e,t=[],n=[],o=!1,r=null){var p;const i=e.getMap(),s=((p=e.getCountries)==null?void 0:p.call(e))||[],a=i.length,l=i[0].length,c=document.createElement("canvas");c.width=l,c.height=a;const d=c.getContext("2d");if(!d)throw new Error("Could not get canvas context");const u=d.createImageData(l,a),y=u.data;for(let h=0;h<a;h++)for(let x=0;x<l;x++){const g=i[h][x],[w,f,m]=J.getRGBForValue(g,s,x,h,i),b=(h*l+x)*4;y[b]=w,y[b+1]=f,y[b+2]=m,y[b+3]=255}if(t&&t.length>0){for(const h of t)if(!(!h||!h.coordinates)){for(const[x,g]of h.coordinates)if(x>=0&&x<l&&g>=0&&g<a){const w=(g*l+x)*4;y[w]=Math.min(255,Math.round(.6*255+.4*y[w])),y[w+1]=Math.min(255,Math.round(.6*255+.4*y[w+1])),y[w+2]=Math.round(.4*y[w+2]),y[w+3]=255}}}for(const h of s){const x=h.owner&&h.owner.homeCountry===h,g=x?[255,140,0]:[0,0,0];for(const[w,f]of h.border||[])if(x)for(let m=-1;m<=1;m++)for(let b=-1;b<=1;b++){const C=w+b,k=f+m;if(C>=0&&C<l&&k>=0&&k<a){const S=(k*l+C)*4;y[S]=g[0],y[S+1]=g[1],y[S+2]=g[2],y[S+3]=255}}else if(w>=0&&w<l&&f>=0&&f<a){const m=(f*l+w)*4;y[m]=g[0],y[m+1]=g[1],y[m+2]=g[2],y[m+3]=255}}d.putImageData(u,0,0),d.save(),d.font="bold 10px MedievalSharp, Verdana, serif",d.textAlign="center",d.textBaseline="middle";for(const h of s){if(!h.name)continue;const[x,g]=h.center?h.center():[0,0],w=h.fortified?"üõ°Ô∏è "+h.name:h.name;d.lineWidth=3,d.strokeStyle="black",d.strokeText(w,x,g);const f=n.some(C=>C===h);h.unrestLevel>0?(d.font="italic bold 10px MedievalSharp, Verdana, serif",d.fillStyle="#FF0000",d.fillText(w,x,g)):(d.font="bold 10px MedievalSharp, Verdana, serif",d.fillStyle=f?"#90EE90":"white",d.fillText(w,x,g));let m=!1;(o||r&&h.owner===r&&!r.isAI||r&&typeof r.armyKnown=="function"&&r.armyKnown(h)&&!r.isAI)&&(m=!0);let b=13;if(m){const C=h.armies||0,k=`${Math.round(C/1e3)}k`;d.font="bold 9px MedievalSharp, Verdana, serif",d.lineWidth=2,d.strokeStyle="black",d.strokeText(k,x,g+b),d.fillStyle="#FFD700",d.fillText(k,x,g+b),d.font="bold 10px MedievalSharp, Verdana, serif",b+=13}h.unrestLevel>0&&(d.font="italic bold 8px MedievalSharp, Verdana, serif",d.strokeText("Rioting",x,g+b),d.fillStyle="#FF0000",d.fillText("Rioting",x,g+b))}return d.restore(),c}static displayWithPanZoom(e,t,n=512,o=512,r=[]){let i=null,s=J.render(e,[],r);const a=s.width,l=s.height,c=document.createElement("canvas");c.width=n,c.height=o,c.style.border="1px solid #888",t.appendChild(c);const d=c.getContext("2d");if(!d)throw new Error("Could not get canvas context");let u=Math.min(c.width/a,c.height/l),y=(c.width-a*u)/2,p=(c.height-l*u)/2,h=!1,x=0,g=0;function w(){s=J.render(e,i?[i]:[],r),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,c.width,c.height),d.setTransform(u,0,0,u,y,p),d.drawImage(s,0,0)}return c.addEventListener("mousedown",f=>{const m=c.getBoundingClientRect(),b=(f.clientX-m.left-y)/u,C=(f.clientY-m.top-p)/u,k=e.getMap(),S=e.getCountries(),P=Math.floor(b),N=Math.floor(C);let M=null;if(P>=0&&N>=0&&N<k.length&&P<k[0].length){const E=k[N][P];E>=0&&S[E]&&(M=S[E])}if(M){i=M,w();return}h=!0,x=f.clientX,g=f.clientY}),window.addEventListener("mousemove",f=>{if(!h)return;const m=f.clientX-x,b=f.clientY-g;y+=m,p+=b,x=f.clientX,g=f.clientY,w()}),window.addEventListener("mouseup",()=>{h=!1}),c.addEventListener("wheel",f=>{f.preventDefault();const m=f.offsetX,b=f.offsetY,C=Math.exp(-f.deltaY*.001);y=m-(m-y)*C,p=b-(b-p)*C,u*=C,w()}),w(),c}static getRGBForValue(e,t,n,o,r){var i,s,a;if(e===Q){n=n??0,o=o??0,r=r??[];const l=((i=r[0])==null?void 0:i.length)||1024,c=r.length||768,d=o/c;let u=Math.round(30*(1-d)+10*d),y=Math.round(144*(1-d)+80*d),p=Math.round(255*(1-d)+180*d);const h=J._oceanNoise2D(n*.03,o*.03),x=Math.floor(18*h);u+=x,y+=x,p+=x;let g=!1;if(r&&n>0&&o>0&&n<l-1&&o<c-1)for(const[w,f]of[[1,0],[-1,0],[0,1],[0,-1]]){const m=n+w,b=o+f;if(r[b][m]!==Q){g=!0;break}}return g&&(u=Math.min(255,u+40),y=Math.min(255,y+40),p=Math.min(255,p+40)),[u,y,p]}if(e===oe){n=n??0,o=o??0,r=r??[];const l=((s=r[0])==null?void 0:s.length)||1024,c=r.length||768,d=J._landNoise2D(n*.04,o*.04),u=[34,139,34],y=[80,180,80],p=.5+.5*d;let h=Math.round(u[0]*(1-p)+y[0]*p),x=Math.round(u[1]*(1-p)+y[1]*p),g=Math.round(u[2]*(1-p)+y[2]*p),w=!1;if(r&&n>0&&o>0&&n<l-1&&o<c-1)for(const[f,m]of[[1,0],[-1,0],[0,1],[0,-1]]){const b=n+f,C=o+m;if(r[C][b]===Q){w=!0;break}}return w&&(h=Math.min(255,h+30),x=Math.min(255,x+30),g=Math.min(255,g+30)),[h,x,g]}if(e>=0){const l=t[e];let c=[200,200,200];if(l)if(l.owner&&typeof l.owner.RGBColor=="string"){const S=l.owner.RGBColor.split(",").map(Number);S.length===3&&S.every(P=>!isNaN(P))&&(c=[S[0],S[1],S[2]])}else l.color&&(c=l.color);n=n??0,o=o??0,r=r??[];const d=((a=r[0])==null?void 0:a.length)||1024,u=r.length||768,y=J._landNoise2D(n*.02,o*.02),p=Math.round(18*y),h=c,x=[Math.max(0,c[0]-32),Math.max(0,c[1]-48),Math.max(0,c[2]-32)],g=.5+.5*y;let w=Math.round(h[0]*(1-g)+x[0]*g)+p,f=Math.round(h[1]*(1-g)+x[1]*g)+p,m=Math.round(h[2]*(1-g)+x[2]*g)+p;const b=J._landNoise2D(n*.006+100,o*.006+100),C=Math.round(18*b);w=Math.min(255,Math.max(0,w+C)),f=Math.min(255,Math.max(0,f+C)),m=Math.min(255,Math.max(0,m+C));let k=!1;if(r&&n>0&&o>0&&n<d-1&&o<u-1)for(const[S,P]of[[1,0],[-1,0],[0,1],[0,-1]]){const N=n+S,M=o+P;if(r[M][N]===Q){k=!0;break}}return k&&(w=Math.min(255,w+12),f=Math.min(255,f+12),m=Math.min(255,m+12)),[w,f,m]}return[255,255,255]}static drawCountryGlow(e,t,n,o){function r(s,a,l){return[Math.round(s[0]+(a[0]-s[0])*l),Math.round(s[1]+(a[1]-s[1])*l),Math.round(s[2]+(a[2]-s[2])*l)]}let i=new Set(t.coordinates.map(([s,a])=>`${s},${a}`));for(let s=0;s<10;++s){const a=[];for(const d of i){const[u,y]=d.split(",").map(Number),p=[[u-1,y],[u+1,y],[u,y-1],[u,y+1]];for(const[h,x]of p)if(!i.has(`${h},${x}`)){a.push([u,y]);break}}const l=s/9,c=r(n,o,l);e.save(),e.fillStyle=`rgb(${c[0]},${c[1]},${c[2]})`;for(const[d,u]of a)e.fillRect(d,u,1,1);e.restore();for(const[d,u]of a)i.delete(`${d},${u}`);if(i.size===0)break}e.save();for(const s of i){const[a,l]=s.split(",").map(Number);let c=[200,200,200];if(t)if(t.owner&&typeof t.owner.RGBColor=="string"){const b=t.owner.RGBColor.split(",").map(Number);b.length===3&&b.every(C=>!isNaN(C))&&(c=[b[0],b[1],b[2]])}else t.color&&(c=t.color);const d=J._landNoise2D(a*.02,l*.02),u=Math.round(18*d),y=c,p=[Math.max(0,c[0]-32),Math.max(0,c[1]-48),Math.max(0,c[2]-32)],h=.5+.5*d;let x=Math.round(y[0]*(1-h)+p[0]*h)+u,g=Math.round(y[1]*(1-h)+p[1]*h)+u,w=Math.round(y[2]*(1-h)+p[2]*h)+u;const f=J._landNoise2D(a*.006+100,l*.006+100),m=Math.round(18*f);x=Math.min(255,Math.max(0,x+m)),g=Math.min(255,Math.max(0,g+m)),w=Math.min(255,Math.max(0,w+m)),e.fillStyle=`rgb(${x},${g},${w})`,e.fillRect(a,l,1,1)}e.restore()}};v(J,"drawBorders",!0),v(J,"_oceanNoise2D",Te()),v(J,"_landNoise2D",Te());let Me=J;class ue{RequiresAmount(e,t,n){return null}}class Y{constructor(e,t,n,o,r=null){v(this,"countries");v(this,"amount");v(this,"action");v(this,"score");v(this,"followUp");this.countries=e,this.amount=t,this.action=n,this.score=o,this.followUp=r}}class Rt{constructor(e,t,n){v(this,"canvas");v(this,"ctx");v(this,"start");v(this,"end");this.canvas=e;const o=e.getContext("2d");if(!o)throw new Error("Could not get canvas context");this.ctx=o,this.start=t,this.end=n}draw(){const e=this.ctx,{start:t,end:n}=this,o=(t.x+n.x)/2,r=(t.y+n.y)/2,i=n.x-t.x,s=n.y-t.y,a=Math.sqrt(i*i+s*s),l=.25*a,c=-s/a*l,d=i/a*l,u=o+c,y=r+d,p=e.createLinearGradient(t.x,t.y,n.x,n.y);p.addColorStop(0,"#fff"),p.addColorStop(.5,"#0ff"),p.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=12,e.strokeStyle=p,e.beginPath(),e.moveTo(t.x,t.y),e.quadraticCurveTo(u,y,n.x,n.y),e.stroke();const h=.95,x=this.getQuadraticPoint(t,{x:u,y},n,h),g=this.getQuadraticTangent(t,{x:u,y},n,h);this.drawArrowhead(x,g),e.restore()}getQuadraticPoint(e,t,n,o){const r=(1-o)*(1-o)*e.x+2*(1-o)*o*t.x+o*o*n.x,i=(1-o)*(1-o)*e.y+2*(1-o)*o*t.y+o*o*n.y;return{x:r,y:i}}getQuadraticTangent(e,t,n,o){const r=2*(1-o)*(t.x-e.x)+2*o*(n.x-t.x),i=2*(1-o)*(t.y-e.y)+2*o*(n.y-t.y),s=Math.sqrt(r*r+i*i);return{x:r/s,y:i/s}}drawArrowhead(e,t){const n=this.ctx;n.save(),n.translate(e.x,e.y);const o=Math.atan2(t.y,t.x);n.rotate(o),n.beginPath(),n.moveTo(0,0),n.lineTo(-18,7),n.lineTo(-12,0),n.lineTo(-18,-7),n.closePath(),n.fillStyle="rgba(0,255,255,0.95)",n.shadowColor="#fff",n.shadowBlur=8,n.fill(),n.restore()}}class Bt{constructor(e,t,n){v(this,"canvas");v(this,"attacker");v(this,"defender");this.canvas=e,this.attacker=t,this.defender=n}async start(){const e=this.canvas.getContext("2d");if(!e)return;const[t,n]=this.attacker.center(),[o,r]=this.defender.center(),i={x:t,y:n},s={x:o,y:r};new Rt(this.canvas,i,s);const a=500,l=this.attacker,c=this.defender;return new Promise(d=>{const u=y=>{const h=performance.now()-y,x=Math.min(h/a,1);e.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCountry(e,l,"attacker"),this.drawCountry(e,c,"defender"),this.drawAnimatedArrow(e,i,s,x),x<1?requestAnimationFrame(()=>u(y)):d()};requestAnimationFrame(y=>u(y))})}drawAnimatedArrow(e,t,n,o){const r=(t.x+n.x)/2,i=(t.y+n.y)/2,s=n.x-t.x,a=n.y-t.y,l=Math.sqrt(s*s+a*a),c=.25*l,d=-a/l*c,u=s/l*c,y=r+d,p=i+u,h=e.createLinearGradient(t.x,t.y,n.x,n.y);h.addColorStop(0,"#fff"),h.addColorStop(.5,"#0ff"),h.addColorStop(1,"#00f"),e.save(),e.lineWidth=8,e.shadowColor="#0ff",e.shadowBlur=16,e.strokeStyle=h,e.beginPath(),e.moveTo(t.x,t.y);const x=60;for(let g=1;g<=Math.floor(x*o);++g){const w=g/x,f=this.getQuadraticPoint(t,{x:y,y:p},n,w);e.lineTo(f.x,f.y)}if(e.stroke(),o>.05){const g=o,w=this.getQuadraticPoint(t,{x:y,y:p},n,g),f=this.getQuadraticTangent(t,{x:y,y:p},n,g);this.drawArrowhead(e,w,f)}e.restore()}drawCountry(e,t,n){let o;n==="attacker"?o=[180,0,0]:n==="defender"?o=[0,0,180]:o=t.color||[200,200,200],Me.drawCountryGlow(e,t,o,t.color);const[r,i]=t.center?t.center():[0,0],s=t.fortified?"üõ°Ô∏è "+t.name:t.name;if(e.save(),e.font="bold 10px Verdana, Geneva, sans-serif",e.textAlign="center",e.textBaseline="middle",e.lineWidth=3,e.strokeStyle="black",e.strokeText(s,r,i),e.fillStyle="white",e.fillText(s,r,i),typeof t.armies=="number"&&_.showArmies){const a=`${Math.round(t.armies/1e3)}k`;e.font="bold 9px Verdana, Geneva, sans-serif",e.lineWidth=2,e.strokeStyle="black",e.strokeText(a,r,i+13),e.fillStyle="#FFD700",e.fillText(a,r,i+13)}e.restore()}getQuadraticPoint(e,t,n,o){const r=(1-o)*(1-o)*e.x+2*(1-o)*o*t.x+o*o*n.x,i=(1-o)*(1-o)*e.y+2*(1-o)*o*t.y+o*o*n.y;return{x:r,y:i}}getQuadraticTangent(e,t,n,o){const r=2*(1-o)*(t.x-e.x)+2*o*(n.x-t.x),i=2*(1-o)*(t.y-e.y)+2*o*(n.y-t.y),s=Math.sqrt(r*r+i*i);return{x:r/s,y:i/s}}drawArrowhead(e,t,n){e.save(),e.translate(t.x,t.y);const o=Math.atan2(n.y,n.x);e.rotate(o),e.beginPath(),e.moveTo(0,0),e.lineTo(-18,7),e.lineTo(-12,0),e.lineTo(-18,-7),e.closePath(),e.fillStyle="rgba(0,255,255,0.95)",e.shadowColor="#fff",e.shadowBlur=8,e.fill(),e.restore()}}class re extends ue{GetButtonText(e,t){if(e.length<2)return null;const n=e[e.length-2],o=e[e.length-1];if(n.owner!==t||n===o)return null;const r=n.neighbors.includes(o),i=n.oceanBorder.length>0&&o.oceanBorder.length>0;return!r&&!i||o.owner===t?null:`Attack ${o.name} from ${n.name}`}async Act(e,t,n,o=0){var f,m;if(!n)throw new Error("Internal error: currentGame is required.");if(e.length<2)throw new Error("Select source and target countries to attack.");const r=e[e.length-2],i=e[e.length-1];if(r.owner!==t)throw new Error("You must own the attacking country.");const s=r.neighbors.includes(i),a=r.oceanBorder.length>0&&i.oceanBorder.length>0;if(!s&&!a)throw new Error("Target country must be a neighbor or reachable by naval attack.");if(i.owner===t)throw new Error("Cannot attack your own country.");if(o<=0||o>=r.armies)throw new Error("Invalid number of armies committed.");if(!t.game)throw new Error("ActionAttack: activePlayer.game is missing");if(!t.game.gui)throw new Error("ActionAttack: activePlayer.game.gui is missing");const c=t.game.gui.getWorldMapCanvas(),d=c.parentElement;if(!d)throw new Error("ActionAttack: mapCanvas.parentElement is null");d.style.position="relative";let u=document.getElementById("attack-animation-overlay");u&&((f=u.parentElement)==null||f.removeChild(u));let y=document.createElement("canvas");y.id="attack-animation-overlay",y.width=c.width,y.height=c.height,y.style.position="absolute",y.style.left="0",y.style.top="0",y.style.pointerEvents="none",y.style.zIndex="9999",y.style.width="100%",y.style.height="100%",y.style.background="rgba(255,255,255,0.01)",d.appendChild(y),new Bt(y,r,i).start(),await new Promise(b=>setTimeout(b,0)),await new Promise(b=>setTimeout(b,1e3)),(m=y==null?void 0:y.parentElement)==null||m.removeChild(y);const h=re.AttackChance(r.armies,i.armies,n.worldMap.distance(r,i)||0,i.fortified,n),x=Math.random(),g=Math.sqrt(Math.abs(x-h));let w="";if(r.armies-=o,x<h){const b=i.owner;b&&(b.ownedCountries=b.ownedCountries.filter(k=>k!==i),b.plannedFortifications=b.plannedFortifications.filter(([k,S])=>k!==i)),i.owner=t,t.ownedCountries.push(i);let C=Math.max(1,Math.round(o*Math.sqrt(g)));C>0&&(C=Math.max(1e3,Math.round(C/1e3)*1e3)),i.armies=C,i.fortified=!1,b&&b.ownedCountries.length===0&&n.players.includes(b)&&(n.players=n.players.filter(k=>k!==b),n.activePlayerIndex>=n.players.length&&(n.activePlayerIndex=0)),t.ownedCountries.length===0&&n.players.includes(t)&&(n.players=n.players.filter(k=>k!==t),n.activePlayerIndex>=n.players.length&&(n.activePlayerIndex=0));for(const k of n.players)k.knowledge=k.knowledge.filter(S=>S.country!==i);w=`Attack successful! ${C} of your ${o} armies occupy ${i.name}.`}else{let b=Math.round(i.armies*Math.sqrt(g));b>0&&(b=Math.max(1e3,Math.round(b/1e3)*1e3)),i.armies=Math.max(1,i.armies-b),i.armies>0&&(i.armies=Math.max(1e3,Math.round(i.armies/1e3)*1e3)),w=`Attack failed! All ${o} attacking armies lost. Defenders lost ${b} troops.`}return w}static AttackChance(e,t,n,o,r){return n===null?0:(t*=n/100,o&&(t*=2),e>=3*t?1:e<=t/3?0:e<t?.5*(e-t/3)/(t-t/3):.5+.5*(e-t)/(2*t))}RequiresAmount(e,t,n){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}get countryCountNeeded(){return 2}Type(){return"Attack"}ActionString(e,t,n,o=0){if(e.length<2)return"Attack: Not enough countries selected.";const r=e[e.length-2];return`Attacking ${e[e.length-1].name} from ${r.name} with ${o} soldiers`}}class Ge extends ue{GetButtonText(e,t){if(e.length<2)return null;const n=e[e.length-2],o=e[e.length-1];return!n||!o||n.owner!==t||o.owner!==t||n===o?null:`Move armies from ${n.name} to ${o.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to move armies.";const r=e[e.length-2],i=e[e.length-1];return r.owner!==t||i.owner!==t?"Both countries must be owned by you.":r===i?"Source and target countries must be different.":o<=0||o>=r.armies?"Invalid number of armies to move.":(r.armies-=o,i.armies+=o,`Moved ${o} armies from ${r.name} to ${i.name}.`)}RequiresAmount(e,t,n){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}get countryCountNeeded(){return 2}Type(){return"Move"}ActionString(e,t,n,o=0){if(e.length<2)return"Move: Not enough countries selected.";const r=e[e.length-2],i=e[e.length-1];return`Moving ${o} armies from ${r.name} to ${i.name}`}}class et extends ue{GetButtonText(e,t){if(e.length===0)return null;const n=e[e.length-1];return n.owner!==t||!n.canBeFortified()?null:`Fortify ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length===0)return"Please select a country to fortify.";const r=e[e.length-1];return r.canBeFortified()?t.money<_.fortifyCost?`Not enough money to fortify. You need $${_.fortifyCost}.`:(t.money-=_.fortifyCost,t.plannedFortifications.push([r,n.gameTurn+2]),`Fortification planned for ${r.name} on turn ${n.gameTurn+2}.`):`${r.name} cannot be fortified.`}RequiresAmount(e,t,n){return null}get countryCountNeeded(){return 1}Type(){return"Fortify"}ActionString(e,t,n,o=0){return e.length<1?"Fortify: No country selected.":`Fortifying ${e[e.length-1].name}`}}class Le extends ue{GetButtonText(e,t){if(e.length<1)return null;const n=e[e.length-1];return!n||n.owner!==t?null:`Buy armies for ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<1)return"Select a friendly country to buy armies for.";const r=e[e.length-1];if(r.owner!==t)return"You must own the target country.";if(o<=0)return"Invalid number of armies to buy.";const i=o*_.armyCost;return t.money<i?`Not enough money. Need ${i.toLocaleString()}, have ${t.money.toLocaleString()}.`:(t.money-=i,r.armies+=o,`Bought ${o} armies for ${r.name} at a cost of ${i.toLocaleString()}.`)}RequiresAmount(e,t,n){const o=Math.floor(t.money/_.armyCost/1e3)*1e3;return o<1e3?null:[1e3,o]}get countryCountNeeded(){return 1}Type(){return"BuyArmies"}ActionString(e,t,n,o=0){if(e.length<1)return"Buy Armies: No country selected.";const r=e[e.length-1];return`Buying ${o} soldiers for ${r.name}`}}class tt extends ue{GetButtonText(e,t){var o;if(!((o=t.game)!=null&&o.InvestEnabled)||e.length<1)return null;const n=e[e.length-1];return!n||n.owner!==t?null:`Invest in ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<1)return"Select a country to invest in.";const r=e[e.length-1];if(r.owner!==t)return"You can only invest in your own country.";if(o<=0)return"Investment amount must be positive.";if(t.money<o)return"You do not have enough money to invest.";const i=r.IncomePotential-r.income;if(i<=0)return`${r.name} is already at its income potential.`;let s=Math.floor(o/5/1e3)*1e3;if(s<=0||(s>i&&(s=Math.floor(i/1e3)*1e3),s<=0))return"Investment amount too small to increase income.";let a=s*5;return a>o&&(a=o),r.income+=s,t.money-=a,`Invested ${a} in ${r.name}. Income increased by ${s}. New income: ${r.income} (Potential: ${r.IncomePotential})`}RequiresAmount(e,t,n){if(e.length<1)return null;const o=e[e.length-1];if(!o)return null;const r=5e3,i=o.IncomePotential-o.income;if(i<=0)return null;let s=Math.floor(i*5/1e3)*1e3;return s=Math.min(s,Math.floor(t.money/1e3)*1e3),s<r?null:[r,s]}get countryCountNeeded(){return 1}Type(){return"Invest"}ActionString(e,t,n,o=0){if(e.length<1)return"Invest: No country selected.";const r=e[e.length-1];return`Investing ${o} in ${r.name}`}}const ne=class ne{constructor(e,t){v(this,"player");v(this,"game");v(this,"actionPlan",[]);this.player=e,this.game=t}GetBestArmies(e){return!this.player.ownedCountries||this.player.ownedCountries.length===0?[]:this.player.ownedCountries.slice().sort((t,n)=>(n.armies||0)-(t.armies||0)).slice(0,e)}FindSpyOpportunities(){const e=new nt,t=[];if(this.player.ownedCountries.length>0){const c=this.player.ownedCountries.reduce((h,x)=>x.armies>h.armies?x:h,this.player.ownedCountries[0]),d=this.game.worldMap,p=d.getCountries().filter(h=>h.owner&&h.owner!==this.player).map(h=>{const x=d.distance(c,h);return x!==null?{country:h,distance:x}:null}).filter(h=>h!==null).sort((h,x)=>h.distance-x.distance).slice(0,3);for(const{country:h,distance:x}of p){if(x>200)continue;const g=this.player.knowledge.find(w=>w.country===h);if(!g||this.game.gameTurn-g.gameTurn>3){const w=h.fortified?_.spyFortifiedCost:_.spyCost;if(this.player.money>=w){t.push(new Y([h],0,e,1e4));break}}}}const n=this.getNonOwnedCountriesSortedByDistance(),i=this.game.worldMap.getCountries().filter(c=>c.owner&&c.owner!==this.player),s=Math.min(5,this.player.ownedCountries.length);let a=0;for(const c of i){const d=this.player.knowledge.find(u=>u.country===c);c.owner&&c.owner!==this.player?d&&this.game.gameTurn-d.gameTurn<=3&&a++:c.owner||d&&a++}let l=1;a<s&&(l=10);for(const{country:c,distance:d}of n){const u=this.player.knowledge.find(p=>p.country===c);if(!c.owner&&u||c.owner&&c.owner!==this.player&&u&&this.game.gameTurn-u.gameTurn<=3)continue;let y=3e3-Math.sqrt(d);if(y*=l,y>0){const p=c.fortified?_.spyFortifiedCost:_.spyCost;if(this.player.money>=p){const h=y*(this.player.totalIncome()/5e6);t.push(new Y([c],0,e,h))}}}return t}FindAttackOpportunities(){const e=new re,n=this.game.worldMap.getCountries(),o=[];for(const r of n){if(r.owner===this.player)continue;const[i,s]=this.countryBestAttackerScore(r);if(!i)continue;const a=Math.floor(i.armies*ne.ATTACK_COMMIT/1e3)*1e3;a<1e3||o.push(new Y([i,r],a,e,s*this.player.aggressivity))}return o}async takeAction(){var a;if(this.player.actionsLeft<=0)return!1;this.player.actionsLeft>=4&&Math.random()<.2&&this.actionPlan.length===0&&this.PlanSurpriseAttack();let e=null,t=!1,n=[];if(this.actionPlan.length>0)e=this.actionPlan.shift(),t=!0;else{const l=this.findBestOpportunity();e=l.chosen,n=l.all}if(!e)return this.player.actionsLeft>0?(this.player.useAction(),!0):!1;const o=await e.action.Act(e.countries,this.player,this.game,e.amount),r=e.countries.slice(-e.action.countryCountNeeded);this.player.actionLog.push({actionType:e.action.Type(),countries:r,amount:e.amount,result:o??null});const i=6-this.player.actionsLeft,s=((a=this.game)==null?void 0:a.gameTurn)??0;if(t)this.player.OpportunityHistory.push({opportunity:{...e,score:1e6},gameTurn:s,actionNumber:i});else for(const l of n)this.player.OpportunityHistory.push({opportunity:l,gameTurn:s,actionNumber:i});return e.followUp&&this.actionPlan.length===0&&this.actionPlan.push(e.followUp),this.player.useAction(),!0}countryDefenseEstimate(e){let t;const n=this.player.knowledge.find(r=>r.country===e),o=e.owner&&e.owner!==this.player;return o&&(!n||this.game.gameTurn-n.gameTurn>3)?t=1e5:!o&&!n?t=7e4:n?t=n.army:t=7e4,e.fortified&&(t*=2),t}countryScore(e){let t;const n=this.player.knowledge.find(r=>r.country===e);n&&typeof n.income=="number"?t=n.income:t=1e6;const o=this.countryDefenseEstimate(e);return t/o}countryBestAttackerScore(e){const t=this.countryDefenseEstimate(e);let n=0,o=null;for(const r of this.player.ownedCountries){const i=this.game.worldMap.distance(r,e);if(i===null)continue;const s=Math.round((r.armies||0)*ne.ATTACK_COMMIT/1e3)*1e3;if(s<1e3)continue;const a=re.AttackChance(s,t,i,!1,this.game);let l=0;a>=.7&&(l=a*a*this.countryScore(e)*1e3),l>n&&(n=l,o=r)}return[o,n]}FindMoveOpportunities(e){const t=[];if(this.player.ownedCountries.length===0)return t;const n=this.player.ownedCountries.reduce((l,c)=>c.armies>l.armies?c:l,this.player.ownedCountries[0]);let o=null,r=-1/0,i=null;for(const l of this.player.ownedCountries){const c=this.getReachableNonOwnedCountries(l);for(const{country:d,distance:u}of c){let y=1;u>100&&(y=Math.max(0,1-(u-100)/900));const p=this.countryScore(d)*y;p>r&&(r=p,o=l,i=d)}}if(o&&o!==n){const l=Math.floor(n.armies*.5/1e3)*1e3;if(l>0&&n!==o){let c=null;if(this.actionPlan.length===0&&i){const d=o.armies+l,u=Object.create(o);if(u.armies=d,this.isAttackFeasible(u,i,ne.ATTACK_COMMIT)){const y=new re,p=Math.floor(d*ne.ATTACK_COMMIT/1e3)*1e3;c=new Y([o,i],p,y,100)}}t.push(new Y([n,o],l,e,r,c))}}const s=this.player.totalArmies()/this.player.ownedCountries.length,a=this.player.ownedCountries.reduce((l,c)=>c.armies<l.armies?c:l,this.player.ownedCountries[0]);if(a.armies<s/2&&a!==n){const l=s/2,c=Math.floor((l-a.armies)/1e3)*1e3,d=Math.max(0,Math.min(c,n.armies-1e3));d>0&&n!==a&&t.push(new Y([n,a],d,e,s-a.armies))}return t}FindFortifyOpportunities(e){const t=[],n=this.player.ownedCountries.filter(o=>!o.fortified).length;for(const o of this.player.ownedCountries)if(o.canBeFortified()&&this.player.money>=_.fortifyCost){let r=o.income/100;r*=n,t.push(new Y([o],0,e,r))}return t}FindBuyOpportunities(){if(this.player.money<=2e6)return[];const t=[],n=new Le,o=this.player.money,r=_.armyCost,i=Math.max(0,o-2e6);if(this.player.ownedCountries.length===0||i<r)return t;const s=Math.floor(this.player.totalArmies()/this.player.ownedCountries.length),a=this.player.ownedCountries.reduce((u,y)=>y.armies<u.armies?y:u,this.player.ownedCountries[0]);if(a.armies<s){const u=s-a.armies,y=Math.floor(i/r),p=Math.min(u,y,1e5),h=Math.floor(p/1e3)*1e3;if(h>0){let x=(s-a.armies)/1e3;a.unrestLevel>0&&(x+=10),t.push(new Y([a],h,n,x))}}let l=null,c=-1/0,d=null;for(const u of this.player.ownedCountries){const y=this.getReachableNonOwnedCountries(u);for(const{country:p,distance:h}of y){let x=1;h>100&&(x=Math.max(0,1-(h-100)/900));const g=this.countryScore(p)*x;g>c&&(c=g,l=u,d=p)}}if(l||(l=this.player.homeCountry),l){const u=Math.floor((i-2e6)/r),y=Math.floor(u/1e3)*1e3;if(y>0){let p=null;if(this.actionPlan.length===0&&d){const h=l.armies+y,x=Object.create(l);if(x.armies=h,this.isAttackFeasible(x,d,ne.ATTACK_COMMIT)){const g=new re,w=Math.floor(h*ne.ATTACK_COMMIT/1e3)*1e3;p=new Y([l,d],w,g,100)}}t.push(new Y([l],y,n,c*1e3,p))}}if(i>0&&this.player.ownedCountries.length>0){const u=this.findMostThreatenedOwnedCountry();if(!u)throw new Error("findMostThreatenedOwnedCountry() returned null, which should not happen if there are owned countries.");const y=Math.floor(i/r),p=Math.floor(y/1e3)*1e3;if(p>0){const h=i/1e3;t.push(new Y([u],p,n,h))}}return t}findBestOpportunity(){const e=new Ge,t=new et,n=[];if(n.push(...this.FindSpyOpportunities()),n.push(...this.FindAttackOpportunities()),n.push(...this.FindMoveOpportunities(e)),n.push(...this.FindFortifyOpportunities(t)),n.push(...this.FindBuyOpportunities()),this.game.InvestEnabled&&n.push(...this.FindInvestOpportunities()),n.length===0)return{chosen:null,all:[]};const o=.5,r=Math.max(...n.map(d=>d.score)),i=n.map(d=>Math.exp((d.score-r)/o)),s=i.reduce((d,u)=>d+u,0),a=i.map(d=>d/s),l=Math.random();let c=0;for(let d=0;d<n.length;++d)if(c+=a[d],l<c)return{chosen:n[d],all:n};throw new Error("Softmax selection failed to pick an opportunity.")}getNonOwnedCountriesSortedByDistance(){const e=this.game.worldMap,t=e.getCountries(),n=[];for(const o of t){if(o.owner===this.player)continue;let r=1e4;for(const i of this.player.ownedCountries){const s=e.distance(i,o);s!==null&&(r=Math.min(r,s))}n.push({country:o,distance:r})}return n.sort((o,r)=>o.distance-r.distance),n}getReachableNonOwnedCountries(e){const t=this.game.worldMap,n=t.getCountries(),o=[];for(const r of n){if(r.owner===this.player)continue;const i=t.distance(e,r);i!==null&&o.push({country:r,distance:i})}return o.sort((r,i)=>r.distance-i.distance),o}MakeAttackPlan(e){if(this.actionPlan.length>0)return;const t=re,n=Ge,o=Le,r=this.player.ownedCountries;if(r.length===0||e.owner===this.player)return;let i=1/0,s=null;for(const C of r){const k=this.game.worldMap.distance(C,e);k!==null&&k<i&&(i=k,s=C)}if(!s)return;const a=new Map;for(const C of r)a.set(C,C.armies);let l=this.player.money;const c=[],d=new o,u=_.armyCost,y=Math.floor(l/u);if(y>0){const C=Math.floor(y/1e3)*1e3;C>0&&(c.push(new Y([s],C,d,1)),a.set(s,a.get(s)+C),l-=C*u)}const p=new n;let h=0,x=a.get(s);const g=r.filter(C=>C!==s).sort((C,k)=>k.armies-C.armies);for(const C of g){if(h>=2)break;const k=this.game.worldMap.distance(C,s),S=a.get(C);if(k!==null&&S>1e3){const P=Math.floor((S-1e3)/1e3)*1e3;P>0&&(c.push(new Y([C,s],P,p,1)),a.set(C,S-P),x+=P,a.set(s,x),h++)}}const w=this.countryDefenseEstimate(e),f=this.game.worldMap.distance(s,e)||1,m=Math.floor(x*ne.ATTACK_COMMIT/1e3)*1e3,b=t.AttackChance(m,w,f,e.fortified,this.game);if(b>.7&&m>=1e3){const C=new t;c.push(new Y([s,e],m,C,b*100)),a.set(s,1e3),this.actionPlan.push(...c)}}PlanSurpriseAttack(){if(this.actionPlan.length>0)return;const e=this.game.worldMap.getCountries();let t=1/0,n=null;for(const i of e)if(!i.owner){const s=this.countryDefenseEstimate(i);s<t&&(t=s,n=i)}if(n){this.MakeAttackPlan(n);return}let o=1/0,r=null;for(const i of e)if(i.owner&&i.owner!==this.player){const s=this.countryDefenseEstimate(i);s<o&&(o=s,r=i)}r&&this.MakeAttackPlan(r)}isAttackFeasible(e,t,n=.8){if(!e||!t||e.owner!==this.player||t.owner===this.player||e===t)return!1;const o=e.neighbors.includes(t),r=e.oceanBorder.length>0&&t.oceanBorder.length>0;if(!o&&!r||typeof e.armies!="number"||e.armies<=1e3)return!1;const i=this.countryDefenseEstimate(t),s=this.game.worldMap.distance(e,t);if(s===null)return!1;const a=Math.floor(e.armies*n);return!(re.AttackChance(a,i,s,t.fortified,this.game)<.7)}findMostThreatenedOwnedCountry(){if(!this.player.ownedCountries||this.player.ownedCountries.length===0)throw new Error("AI has no owned countries to evaluate for threat.");const e=this.game.worldMap,t=e.getCountries();let n=null,o=-1/0;for(const r of this.player.ownedCountries){let i=0;for(const s of t){if(!s.owner||s.owner===this.player)continue;const a=e.distance(r,s);a===null||a===0||(i+=1/a)}i>o&&(o=i,n=r)}if(!n)throw new Error("No threatened country found. This should not happen if there are enemy countries.");return n}FindInvestOpportunities(){const e=new tt,t=this.player.ownedCountries.filter(r=>r.neighbors.length===0||r.neighbors.every(i=>i.owner===this.player));if(t.length===0)return[];const n=t.reduce((r,i)=>i.armies>r.armies?i:r,t[0]);let o=Math.floor((this.player.money-3e4)/5e3)*5e3;return o<=0?[]:[new Y([n],o,e,1e3)]}};v(ne,"ATTACK_COMMIT",.8);let Ae=ne;const V=class V{constructor(e,t,n=[],o=null,r=[],i=0,s=!1){v(this,"actionsLeft",V.ACTIONS_PER_TURN);v(this,"game");v(this,"actionLog",[]);v(this,"OpportunityHistory",[]);v(this,"name");v(this,"color");v(this,"ownedCountries");v(this,"homeCountry");v(this,"isAI");v(this,"AI");v(this,"money");v(this,"knowledge");v(this,"plannedFortifications",[]);v(this,"aggressivity");this.name=e,this.color=t,this.ownedCountries=n,this.homeCountry=o,this.knowledge=r,this.money=i,this.isAI=s,this.actionsLeft=V.ACTIONS_PER_TURN,this.aggressivity=Math.floor(Math.random()*8)+2,this.AI=new Ae(this,void 0),this.OpportunityHistory=[]}resetActions(){this.actionsLeft=V.ACTIONS_PER_TURN}useAction(){this.actionsLeft>0&&this.actionsLeft--}get RGBColor(){return V.COLOR_RGBS[this.color]||"0,0,0"}getKnownCountries(){const e=new Set;this.knowledge.forEach(n=>e.add(n.country));const t=Array.from(e).filter(n=>!this.ownedCountries.includes(n));return{owned:[...this.ownedCountries],known:t}}getCountryInfo(e,t){if(e.owner===this)return{name:e.name,owner:e.owner,income:e.income,army:e.armies,recency:0};{const n=this.knowledge.find(o=>o.country===e);return{name:e.name,owner:e.owner,income:n?n.income:void 0,army:n?n.army:void 0,recency:n?t-n.gameTurn:void 0}}}totalIncome(){return this.ownedCountries.reduce((e,t)=>t.unrestLevel>0?e:e+(t.income??0),0)}totalArmies(){return this.ownedCountries.reduce((e,t)=>e+(t.armies??0),0)}startTurn(){this.resetActions()}get IncomeShare(){if(!this.game||!this.game.players||this.game.players.length===0)return 0;const e=this.game.players.reduce((t,n)=>{var o;return t+(((o=n.totalIncome)==null?void 0:o.call(n))??0)},0);return e===0?0:this.totalIncome()/e}armyKnown(e){if(e.owner===this)return!0;const t=this.knowledge.find(n=>n.country===e);return!!(!e.owner&&t||e.owner&&e.owner!==this&&t&&this.game&&t.gameTurn===this.game.gameTurn)}toJSON(){return{id:this.name,name:this.name,color:this.color,ownedCountryIds:this.ownedCountries.map(e=>e.name),homeCountryId:this.homeCountry?this.homeCountry.name:null,isAI:this.isAI,money:this.money,knowledge:this.knowledge.map(e=>({countryId:e.country.name,gameTurn:e.gameTurn,army:e.army,income:e.income})),plannedFortifications:this.plannedFortifications.map(([e,t])=>[e.name,t]),aggressivity:this.aggressivity,actionsLeft:this.actionsLeft}}static fromJSON(e,t){const n=new V(e.name,e.color,[],null,[],e.money,e.isAI);return n.aggressivity=e.aggressivity,n.actionsLeft=e.actionsLeft??V.ACTIONS_PER_TURN,n._ownedCountryIds=e.ownedCountryIds,n._homeCountryId=e.homeCountryId,n._knowledgeRaw=e.knowledge,n._plannedFortificationsRaw=e.plannedFortifications,n}resolveReferences(e){this.ownedCountries=(this._ownedCountryIds||[]).map(t=>e[t]).filter(Boolean),this.homeCountry=this._homeCountryId?e[this._homeCountryId]:null,this.knowledge=(this._knowledgeRaw||[]).map(t=>({country:e[t.countryId],gameTurn:t.gameTurn,army:t.army,income:t.income})),this.plannedFortifications=(this._plannedFortificationsRaw||[]).map(([t,n])=>[e[t],n]),delete this._ownedCountryIds,delete this._homeCountryId,delete this._knowledgeRaw,delete this._plannedFortificationsRaw}};v(V,"ACTIONS_PER_TURN",5),v(V,"COLOR_RGBS",{red:"255,0,0",blue:"0,0,255",green:"0,128,0",yellow:"255,255,0",purple:"128,0,128",orange:"255,140,0",teal:"0,128,128",brown:"139,69,19"}),v(V,"COLORS",["red","blue","green","yellow","purple","orange","teal","brown"]);let he=V;const Gt=Object.freeze(Object.defineProperty({__proto__:null,Player:he},Symbol.toStringTag,{value:"Module"})),X=class X{constructor(e,t=[]){v(this,"worldMap");v(this,"players");v(this,"gameTurn");v(this,"activePlayerIndex");v(this,"gui");v(this,"advisedOpportunity");v(this,"InvestEnabled",!1);this.worldMap=e,this.players=t,this.gameTurn=1,this.activePlayerIndex=0,this.advisedOpportunity=null,this.InvestEnabled=!1,this.players.length>0&&this.activePlayer.startTurn()}get activePlayer(){return this.players[this.activePlayerIndex]}nextTurn(){this.activePlayer.money+=this.activePlayer.totalIncome(),this.activePlayerIndex=(this.activePlayerIndex+1)%this.players.length,this.activePlayerIndex===0&&(this.gameTurn++,this.handleUnrest());const e=this.activePlayer;e.plannedFortifications=e.plannedFortifications.filter(([t,n])=>n===this.gameTurn?(t.fortified=!0,!1):!0),this.activePlayer.startTurn(),this.advisedOpportunity=null}static initNewGame(e,t,n){for(const d of t)d.money=X.initialPlayerMoney,d.homeCountry=null,d.ownedCountries=[],d.isAI&&(d.AI=new Ae(d,null));const o=e.getCountries();for(const d of o)d.income=Math.floor((5e5+Math.random()*2e6)/1e3)*1e3,d.owner=null;let r=-1,i=[];const s=t.length,a=10;function l(d,u){if(!d.center||!u.center)return 0;const[y,p]=d.center(),[h,x]=u.center();return Math.sqrt((y-h)**2+(p-x)**2)}for(let d=0;d<a;++d){const u=[...o];for(let h=u.length-1;h>0;h--){const x=Math.floor(Math.random()*(h+1));[u[h],u[x]]=[u[x],u[h]]}const y=u.slice(0,s);let p=1/0;for(let h=0;h<y.length;++h)for(let x=h+1;x<y.length;++x)p=Math.min(p,l(y[h],y[x]));p>r&&(r=p,i=y)}for(let d=0;d<t.length;++d){const u=i[d];t[d].homeCountry=u,u.owner=t[d],t[d].ownedCountries.push(u),u.income=X.homeCountryIncome,u.fortified=!0,u.nationalPride=1e3}for(const d of e.getCountries())if(d.owner)d.armies=1e5;else{const u=Math.round((Math.random()*Math.random()*99e3+1e3)/1e3)*1e3;d.armies=u}const c=new X(e,t);n&&(c.gui=n);for(const d of t)d.game=c,d.isAI&&d.AI&&(d.AI.game=c,d.AI.player=d);for(const d of e.getCountries())typeof d.recalculateIncomePotential=="function"&&d.recalculateIncomePotential();return c}toJSON(){var e;return{gameTurn:this.gameTurn,activePlayerName:((e=this.players[this.activePlayerIndex])==null?void 0:e.name)??null,playerNames:this.players.map(t=>t.name)}}static fromJSON(e,t,n){const o=new X(n,t);o.gameTurn=e.gameTurn,o.activePlayerIndex=t.findIndex(r=>r.name===e.activePlayerName),o.activePlayerIndex===-1&&(o.activePlayerIndex=0);for(const r of t)r.game=o,r.isAI&&r.AI&&(r.AI.game=o,r.AI.player=r);return o}AddPlayer(e){return this.players.length>=8?!1:(this.players.push(e),!0)}static generateAIName(){const e=["Augustus","Charlemagne","Qin Shi Huang","Akbar","Justinian","Napoleon","Constantine","Ashoka","Catherine","Meiji","Trajan","Hadrian","Aurangzeb","Elizabeth","Peter","Victoria","Franz Joseph","Wilhelm","Haile Selassie","Menelik"];return e[Math.floor(Math.random()*e.length)]}handleUnrest(){for(const e of this.worldMap.getCountries()){if(!e.owner)continue;if(Math.floor(Math.random()*99e3)+1e3+e.armies<e.nationalPride?(e.unrestLevel=Math.min(e.unrestLevel+1,2),e.nationalPride=Math.min(e.nationalPride+1e3,1e5)):(e.unrestLevel=Math.max(e.unrestLevel-1,0),e.nationalPride=Math.max(e.nationalPride-1e3,1e3)),e.unrestLevel===2){const o=new he(X.generateAIName(),he.COLORS[this.players.length%he.COLORS.length],[],null,[],0,!0);if(this.AddPlayer(o)){const r=e.owner;r&&(r.ownedCountries=r.ownedCountries.filter(i=>i!==e)),this.UnKnowCountry(e),e.armies=e.nationalPride*2,e.nationalPride=1e3,e.unrestLevel=0,e.income*=2,e.recalculateIncomePotential(),o.homeCountry=e,o.ownedCountries.push(e),e.owner=o,e.fortified=!0,o.game=this,o.AI=new Ae(o,this)}else{const r=e.owner;r&&(r.ownedCountries=r.ownedCountries.filter(i=>i!==e)),this.UnKnowCountry(e),e.owner=null,e.armies=e.nationalPride,e.unrestLevel=0,e.nationalPride=Math.min(e.nationalPride+1e4,1e5),e.fortified=!1,e.recalculateIncomePotential()}}}}UnKnowCountry(e){for(const t of this.players)t.knowledge=t.knowledge.filter(n=>n.country!==e)}};v(X,"armyCost",100),v(X,"spyCost",2e5),v(X,"spyFortifiedCost",1e6),v(X,"initialPlayerMoney",1e7),v(X,"homeCountryIncome",4e6),v(X,"fortifyCost",1e5),v(X,"showArmies",!1),v(X,"INCOME_SHARE_WIN",.8);let _=X;const Lt=Object.freeze(Object.defineProperty({__proto__:null,Game:_},Symbol.toStringTag,{value:"Module"}));class nt extends ue{GetButtonText(e,t){var i;if(e.length===0)return null;const n=e[e.length-1];if(n.owner==t)return null;const o=t.knowledge.find(s=>s.country===n),r=(i=t.game)==null?void 0:i.gameTurn;return!n.owner&&o||n.owner&&n.owner!==t&&o&&o.gameTurn===r?null:`Spy on ${n.name}`}async Act(e,t,n,o=0){if(e.length===0)return"Please select a country to spy on.";const r=e[e.length-1],i=r.fortified?_.spyFortifiedCost:_.spyCost;if(t.money<i)return`Not enough money to spy. You need $${i}.`;const s=t.knowledge.find(c=>c.country===r);if(!n)return"Internal error: currentGame is required.";const a=n.gameTurn;if(s&&s.gameTurn===a)return"You already have recent information about this country.";t.money-=i;const l={country:r,gameTurn:a,army:r.armies,income:r.income};return s?(s.gameTurn=l.gameTurn,s.army=l.army,s.income=l.income):t.knowledge.push(l),null}RequiresAmount(e,t,n){return null}get countryCountNeeded(){return 1}Type(){return"Spy"}ActionString(e,t,n,o=0){return e.length<1?"Spy: No country selected.":`Spying on ${e[e.length-1].name}`}}function Xe(A,e,t=A){return new Promise(n=>{const o=document.createElement("div");o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.background="rgba(0,0,0,0.5)",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.zIndex="10000";const r=document.createElement("div");r.style.background="#fff",r.style.padding="32px 40px",r.style.borderRadius="12px",r.style.boxShadow="0 2px 16px rgba(0,0,0,0.2)",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.gap="18px";const i=document.createElement("div");i.textContent="Select amount to commit:",i.style.fontSize="1.2rem",i.style.marginBottom="8px",r.appendChild(i);const s=document.createElement("div");s.textContent=`Maximum: ${e.toLocaleString()}`,s.style.fontSize="1rem",s.style.color="#555",s.style.marginBottom="4px",r.appendChild(s);let a=Math.max(A,Math.min(e,t));const l=document.createElement("div");l.textContent=a.toLocaleString(),l.style.fontSize="2rem",l.style.fontWeight="bold",l.style.margin="8px 0",r.appendChild(l);const c=document.createElement("div");c.style.display="flex",c.style.gap="6px";function d(x){a=Math.max(A,Math.min(e,x)),l.textContent=a.toLocaleString()}function u(x,g){const w=document.createElement("button");return w.textContent=x,w.style.padding="6px 14px",w.style.fontSize="1.1rem",w.style.border="none",w.style.borderRadius="6px",w.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",w.style.color="#fff",w.style.cursor="pointer",w.onclick=g,w}c.appendChild(u("-100k",()=>d(a-1e5))),c.appendChild(u("-10k",()=>d(a-1e4))),c.appendChild(u("-1k",()=>d(a-1e3))),c.appendChild(u("Min",()=>d(A))),c.appendChild(u("Half",()=>d(Math.floor(e/2/1e3)*1e3))),c.appendChild(u("Max",()=>d(e))),c.appendChild(u("+1k",()=>d(a+1e3))),c.appendChild(u("+10k",()=>d(a+1e4))),c.appendChild(u("+100k",()=>d(a+1e5))),r.appendChild(c);const y=document.createElement("div");y.style.display="flex",y.style.gap="12px",y.style.marginTop="18px";const p=u("OK",()=>{document.body.removeChild(o),n(a)});p.style.background="linear-gradient(90deg,#43cea2 0%,#43e97b 100%)",p.style.fontWeight="bold";const h=u("Cancel",()=>{document.body.removeChild(o),n(null)});h.style.background="linear-gradient(90deg,#e57373 0%,#ffb74d 100%)",y.appendChild(p),y.appendChild(h),r.appendChild(y),o.appendChild(r),document.body.appendChild(o),p.focus()})}class $t extends ue{GetButtonText(e,t){if(e.length<2)return null;const n=e[e.length-2],o=e[e.length-1];if(n.owner!==t||n===o||!(t.knowledge&&t.knowledge.some(a=>a.country===o)))return null;const i=n.neighbors.includes(o),s=n.oceanBorder.length>0&&o.oceanBorder.length>0;return!i&&!s||o.owner===t?null:`Calculate attack chance for ${o.name} from ${n.name}`}async Act(e,t,n,o=0){if(!n)return"Internal error: currentGame is required.";if(e.length<2)return"Select source and target countries to calculate attack.";const r=e[e.length-2],i=e[e.length-1];if(r.owner!==t)return"You must own the attacking country.";const s=r.neighbors.includes(i),a=r.oceanBorder.length>0&&i.oceanBorder.length>0;if(!s&&!a)return"Target country must be a neighbor or reachable by naval attack.";if(i.owner===t)return"Cannot attack your own country.";if(o<=0||o>=r.armies)return"Invalid number of armies committed.";const l=t.getCountryInfo(i,n.gameTurn),c=n.worldMap.distance(r,i);let u=`Attack chance: ${(re.AttackChance(r.armies,l.army||0,c||0,i.fortified,n)*100).toFixed(2)}%`;return l.recency&&l.recency>0&&(u+=`
Warning: Information about ${i.name} may be outdated (last spied ${l.recency} turn(s) ago).`),u}RequiresAmount(e,t,n){if(e.length<2)return null;const o=e[e.length-2];return!o||typeof o.armies!="number"||o.armies<=1?null:[1e3,o.armies-1e3]}Type(){return"CalculateAttack"}get countryCountNeeded(){return 2}ActionString(e,t,n,o=0){if(e.length<2)return"Calculate Attack: Not enough countries selected.";const r=e[e.length-2];return`Calculating attack chance for ${e[e.length-1].name} from ${r.name} with ${o} soldiers`}}function ot(A,e,t){let n=document.getElementById("gamegui-win-modal");if(n)return;n=document.createElement("div"),n.id="gamegui-win-modal",n.style.position="fixed",n.style.left="0",n.style.top="0",n.style.width="100vw",n.style.height="100vh",n.style.background="rgba(0,0,0,0.85)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="99999";const o=document.createElement("canvas");o.width=window.innerWidth,o.height=window.innerHeight,o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.width="100vw",o.style.height="100vh",o.style.zIndex="0",o.style.pointerEvents="none",n.appendChild(o);function r(){o.width=window.innerWidth,o.height=window.innerHeight}window.addEventListener("resize",r);const i=document.createElement("div");i.style.width="50vw",i.style.height="50vh",i.style.background='url("Won.png") center/cover no-repeat',i.style.padding="48px 64px",i.style.borderRadius="24px",i.style.boxShadow="0 4px 32px rgba(0,0,0,0.25)",i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.gap="32px",i.style.position="relative",i.style.zIndex="1";const s=document.createElement("div");s.style.position="absolute",s.style.top="32px",s.style.right="48px",s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="flex-end",s.style.zIndex="2",s.style.padding="12px 24px",s.style.background="rgba(255,255,255,0.0)";const a=document.createElement("div");a.textContent="WINNER",a.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",a.style.fontSize="2.7rem",a.style.fontWeight="bold",a.style.color="#222",a.style.textShadow="0 2px 8px #fff,0 0 8px #000",s.appendChild(a);const l=document.createElement("div");l.textContent=A,l.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",l.style.fontSize="2.1rem",l.style.fontWeight="bold",l.style.color="#fff",l.style.marginTop="8px",l.style.textShadow="0 0 16px #ffd700, 0 0 32px #43cea2, 0 0 48px #ff00cc, 0 0 64px #00e6e6",l.style.animation="win-glow 2.2s linear infinite";const c=document.createElement("style");c.textContent=`@keyframes win-glow {
    0% { text-shadow: 0 0 16px #ffd700, 0 0 32px #43cea2, 0 0 48px #ff00cc, 0 0 64px #00e6e6; }
    25% { text-shadow: 0 0 24px #43cea2, 0 0 40px #ffd700, 0 0 56px #00e6e6, 0 0 72px #ff00cc; }
    50% { text-shadow: 0 0 32px #ff00cc, 0 0 48px #00e6e6, 0 0 64px #ffd700, 0 0 80px #43cea2; }
    75% { text-shadow: 0 0 24px #00e6e6, 0 0 40px #ff00cc, 0 0 56px #43cea2, 0 0 72px #ffd700; }
    100% { text-shadow: 0 0 16px #ffd700, 0 0 32px #43cea2, 0 0 48px #ff00cc, 0 0 64px #00e6e6; }
  }`,document.head.appendChild(c),s.appendChild(l);const d=document.createElement("button");d.textContent="OK",d.style.marginTop="18px",d.style.padding="12px 36px",d.style.fontSize="1.3rem",d.style.border="none",d.style.borderRadius="8px",d.style.background="linear-gradient(90deg,#43cea2 0%,#ffd700 100%)",d.style.color="#222",d.style.fontWeight="bold",d.style.cursor="pointer",d.style.textShadow="0 2px 8px #fff,0 0 8px #000",d.onclick=()=>{g=!1,window.removeEventListener("resize",r),n&&n.parentNode&&n.parentNode.removeChild(n),t&&t()},s.appendChild(d),i.appendChild(s),n.appendChild(i),document.body.appendChild(n);const u=o.getContext("2d"),y=[];let p=o.height;function h(){const f=Math.random()*o.width*.8+o.width*.1,m=o.height*.02+Math.random()*o.height*.04,b=(Math.random()-.5)*2,C=(-8-Math.random()*4)*2,k=`hsl(${Math.random()*360},90%,60%)`;y.push({x:f,y:o.height,vx:b,vy:C,color:k,exploded:!1,particles:[],age:0,targetY:m})}function x(f){for(let m=0;m<48;m++){const b=m/48*2*Math.PI,C=2+Math.random()*2.5;f.particles.push({x:f.x,y:f.y,vx:Math.cos(b)*C,vy:Math.sin(b)*C,color:f.color,alpha:1,age:0})}}let g=!0;function w(){if(!(!g||!u)){u.clearRect(0,0,o.width,o.height),Math.random()<.06&&y.length<7&&h();for(const f of y)if(!f.exploded)f.x+=f.vx,f.y+=f.vy,f.vy+=.13,f.age++,f.y<p&&(p=f.y),u.save(),u.beginPath(),u.arc(f.x,f.y,4,0,2*Math.PI),u.fillStyle=f.color,u.globalAlpha=.9,u.shadowColor=f.color,u.shadowBlur=16,u.fill(),u.restore(),f.y<=f.targetY&&(f.exploded=!0,x(f));else{for(const m of f.particles)m.x+=m.vx,m.y+=m.vy,m.vy+=.04,m.alpha-=.012+Math.random()*.01,m.age++,u.save(),u.beginPath(),u.arc(m.x,m.y,2.2,0,2*Math.PI),u.fillStyle=m.color,u.globalAlpha=Math.max(0,m.alpha),u.shadowColor=m.color,u.shadowBlur=8,u.fill(),u.restore();f.particles=f.particles.filter(m=>m.alpha>.05&&m.age<90)}for(let f=y.length-1;f>=0;f--)y[f].exploded&&y[f].particles.length===0&&y.splice(f,1);requestAnimationFrame(w)}}w()}const Ft=Object.freeze(Object.defineProperty({__proto__:null,showWinDialog:ot},Symbol.toStringTag,{value:"Module"}));class Dt{constructor(e,t,n,o){v(this,"overlay");v(this,"ctx");v(this,"width");v(this,"height");v(this,"fish",[]);v(this,"running",!1);v(this,"lastSpawn",0);v(this,"nextSpawn",0);v(this,"getOceanPredicate");v(this,"animationFrameId",null);v(this,"timeoutId",null);v(this,"loop",e=>{this.ctx.clearRect(0,0,this.width,this.height),this.fish=this.fish.filter(t=>!t.done);for(const t of this.fish)t.update(e),t.draw(this.ctx);e>this.nextSpawn&&(this.spawnFish(),this.scheduleNextSpawn()),this.fish.length>0||this.nextSpawn-e<2e3?this.animationFrameId=requestAnimationFrame(this.loop):(this.running=!1,this.timeoutId=setTimeout(()=>this.start(),this.nextSpawn-e))});this.width=t,this.height=n,this.getOceanPredicate=o,this.overlay=document.createElement("canvas"),this.overlay.width=t,this.overlay.height=n,this.overlay.style.position="absolute",this.overlay.style.left="0",this.overlay.style.top="0",this.overlay.style.pointerEvents="none",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.zIndex="20",e.appendChild(this.overlay);const r=this.overlay.getContext("2d");if(!r)throw new Error("Could not get canvas context for FishOverlay");this.ctx=r,this.scheduleNextSpawn(),this.start()}scheduleNextSpawn(){this.nextSpawn=performance.now()+5e3+Math.random()*1e4}spawnFish(){for(let e=0;e<10;e++){const t=Math.floor(Math.random()*this.width),n=Math.floor(this.height*(.4+.5*Math.random())),o=Math.random()<.5?1:-1,r=32+Math.random()*24,i=t+o*r;if(this.getOceanPredicate(t,n)&&this.getOceanPredicate(Math.round(i),n)){const s="#444";this.fish.push(new _t(t,n,o,s));break}}}start(){this.running||(this.running=!0,this.animationFrameId=requestAnimationFrame(this.loop))}stop(){this.running=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}resume(){this.running||this.start()}}class _t{constructor(e,t,n,o){v(this,"x0");v(this,"y0");v(this,"x1");v(this,"y1");v(this,"dir");v(this,"color","#444");v(this,"t0");v(this,"duration");v(this,"done",!1);v(this,"splash",!1);v(this,"splashStart",0);v(this,"splashDuration",1200);this.x0=e,this.y0=t;const r=32+Math.random()*24;this.x1=e+n*r,this.y1=t,this.dir=n,this.t0=performance.now(),this.duration=(1200+Math.random()*400)/2}update(e){const t=(e-this.t0)/this.duration;if(!this.splash&&t>.95&&(this.splash=!0,this.splashStart=e),t>1&&this.splash){e-this.splashStart>this.splashDuration&&(this.done=!0);return}if(t>1){this.done=!0;return}}draw(e){const t=performance.now(),n=Math.min(1,(t-this.t0)/this.duration),o=18,r=this.x0+(this.x1-this.x0)*n,i=this.y0-(1-4*Math.pow(n-.5,2))*o,s=1+.18*Math.sin(Math.PI*n),a=.5*Math.sin(Math.PI*n);if(n<=.95){e.save(),e.translate(r,i);const l=1/3,c=e.createRadialGradient(0,0,.3,0,0,7*s*l);c.addColorStop(0,"#222"),c.addColorStop(.7,"#666"),c.addColorStop(1,"#bbb"),e.fillStyle=c,e.beginPath(),e.ellipse(0,0,7*s*l,3*l,0,0,2*Math.PI),e.fill(),e.save(),e.beginPath(),e.moveTo(-7*s*l,0),e.lineTo(-11*s*l,-4*l),e.lineTo(-11*s*l,4*l),e.closePath(),e.fillStyle="#222",e.globalAlpha=.8,e.fill(),e.restore(),e.save(),e.beginPath(),e.ellipse(-2*s*l,2.2*l,2*l,.7*l,Math.PI/4+a,0,2*Math.PI),e.ellipse(-2*s*l,-2.2*l,2*l,.7*l,-Math.PI/4-a,0,2*Math.PI),e.fillStyle="#888",e.globalAlpha=.7,e.fill(),e.restore(),e.restore()}if(this.splash){const l=Math.min(1,(t-this.splashStart)/this.splashDuration);for(let c=0;c<3;c++){const d=10+12*l+c*6;e.save(),e.beginPath(),e.arc(this.x1,this.y1,d,0,2*Math.PI),e.strokeStyle=`rgba(10,10,10,${.7*(1-l)})`,e.lineWidth=2.5-c*.5,e.globalAlpha=1*(1-l),e.stroke(),e.restore()}}}}function zt(A){var d;let e=document.getElementById("action-log-dialog");e&&e.remove();const t=document.createElement("div");t.id="action-log-dialog",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.6)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="99999",(d=me.getInstance())==null||d.pauseGame();const n=document.createElement("div");n.style.background="#fff",n.style.width="100vw",n.style.height="100vh",n.style.padding="0",n.style.borderRadius="0",n.style.boxShadow="none",n.style.maxWidth="100vw",n.style.maxHeight="100vh",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="stretch",n.style.gap="0",n.style.overflow="hidden";const o=document.createElement("button");o.textContent="Close",o.style.alignSelf="flex-end",o.style.margin="16px 24px 0 0",o.style.padding="10px 32px",o.style.fontSize="1.2rem",o.style.border="none",o.style.borderRadius="8px",o.style.background="linear-gradient(90deg,#ff9966 0%,#ff5e62 100%)",o.style.color="#fff",o.style.cursor="pointer",o.onclick=()=>{var y,p;(y=me.getInstance())==null||y.resumeGame(),t.remove();const u=me.getInstance();u&&u.currentGame&&!u.canceled&&((p=u.currentGame.activePlayer)!=null&&p.isAI)&&setTimeout(()=>u.turnStarted(),0)},n.appendChild(o);const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="row",r.style.alignItems="center",r.style.gap="16px",r.style.padding="24px 32px 8px 32px",r.style.background="#f5f5f5";const i=document.createElement("select");i.style.fontSize="1.1rem",i.style.padding="6px 12px";for(const u of A.players){const y=document.createElement("option");y.value=u.name,y.textContent=u.name+(u.isAI?" (AI)":""),i.appendChild(y)}r.appendChild(i);const s=document.createElement("input");s.type="text",s.placeholder="Filter (wildcard, all fields)",s.style.fontSize="1.1rem",s.style.padding="6px 12px",s.style.borderRadius="6px",s.style.border="1px solid #aaa",r.appendChild(s),n.appendChild(r);const a=document.createElement("div");a.style.overflow="auto",a.style.flex="1",a.style.padding="0 32px 32px 32px",a.style.background="#fff",n.appendChild(a);function l(u,y){a.innerHTML="";const p=document.createElement("table");p.style.width="100%",p.style.borderCollapse="collapse",p.style.fontSize="1.05rem";const h=document.createElement("thead"),x=document.createElement("tr");for(const f of["#","Action","Countries","Amount","Result"]){const m=document.createElement("th");m.textContent=f,m.style.borderBottom="2px solid #888",m.style.padding="8px 12px",m.style.background="#eee",x.appendChild(m)}h.appendChild(x),p.appendChild(h);const g=document.createElement("tbody");let w=u.actionLog;if(y.trim()){const f=y.trim().toLowerCase();w=w.filter(m=>m.actionType.toLowerCase().includes(f)||m.countries.map(b=>b.name).join(",").toLowerCase().includes(f)||(""+m.amount).includes(f)||(m.result?m.result.toLowerCase():"").includes(f))}w.forEach((f,m)=>{const b=document.createElement("tr");b.style.borderBottom="1px solid #ddd";const C=document.createElement("td");C.textContent=(m+1).toString(),C.style.padding="6px 12px",b.appendChild(C);const k=document.createElement("td");k.textContent=f.actionType,k.style.padding="6px 12px",b.appendChild(k);const S=document.createElement("td");S.textContent=f.countries.map(M=>M.name).join(", "),S.style.padding="6px 12px",b.appendChild(S);const P=document.createElement("td");P.textContent=f.amount.toString(),P.style.padding="6px 12px",b.appendChild(P);const N=document.createElement("td");N.textContent=f.result??"",N.style.padding="6px 12px",b.appendChild(N),g.appendChild(b)}),p.appendChild(g),a.appendChild(p)}let c=A.players[0];l(c,""),i.onchange=()=>{c=A.players.find(u=>u.name===i.value)||A.players[0],l(c,s.value)},s.oninput=()=>{l(c,s.value)},t.appendChild(n),document.body.appendChild(t)}class Ke{static serialize(e){const t=e.worldMap.getCountries(),n=e.players;return JSON.stringify({countries:t.map(o=>o.toJSON()),players:n.map(o=>o.toJSON()),game:e.toJSON()})}static deserialize(e){const t=JSON.parse(e),n={},o=t.countries.map(l=>Ce.fromJSON(l,{},n)),r={},i=t.players.map(l=>{const c=he.fromJSON(l,n);return r[c.name]=c,c});o.forEach(l=>l.resolveReferences(r,n)),i.forEach(l=>l.resolveReferences(n));const s=Ot(o);return _.fromJSON(t.game,i,s)}}class Wt{constructor(e){v(this,"text");this.text=e}renderTo(e){e.innerHTML="",e.style.padding="2.7em 3.2em 2.7em 3.2em",e.style.fontFamily="UnifrakturCook, UnifrakturMaguntia, serif",e.style.color="#3a2c13",e.style.lineHeight="1.8",e.style.maxWidth="none",e.style.width="100%",e.style.margin="2.2em 0",e.style.boxSizing="border-box",e.style.fontSize="1.38em",e.style.background="url('https://www.transparenttextures.com/patterns/old-mathematics.png'), url('https://www.transparenttextures.com/patterns/noise.png'), radial-gradient(ellipse at 60% 40%, #f8f5e1 70%, #f3e7c6 100%)",e.style.backgroundBlendMode="multiply, multiply",e.style.border="4px double #bfa76f",e.style.borderRadius="18px",e.style.boxShadow="0 0 32px #bfa76f55, 0 0 0 8px #fffbe6cc inset",e.style.textShadow="0 1px 0 #fffbe6, 0 0 6px #fffbe6cc";const t=this.text.split(/\r?\n/);let n=!1,o="";t.forEach((i,s)=>{if(/^=+/.test(i)){const a=document.createElement("h1");a.textContent=i.replace(/=+/g,"").trim(),a.style.fontFamily="UnifrakturCook, UnifrakturMaguntia, serif",a.style.fontSize="3.2em",a.style.letterSpacing="0.13em",a.style.textShadow="0 0 18px #fffbe6, 0 2px 12px #bfa76f, 0 0 2px #fffbe6",a.style.textAlign="center",a.style.margin="0.9em 0 0.6em 0",a.style.color="#bfa76f",a.style.borderBottom="3px solid #bfa76f",a.style.paddingBottom="0.2em",a.style.position="relative",a.innerHTML=`<span style="font-family:'UnifrakturCook',serif;font-size:1.2em;vertical-align:middle;">&#10070;</span> `+a.textContent+` <span style="font-family:'UnifrakturCook',serif;font-size:1.2em;vertical-align:middle;">&#10070;</span>`,e.appendChild(a);return}if(/^\d+\./.test(i)){const a=document.createElement("h2");a.textContent=i.replace(/^\d+\./,"").trim(),a.style.fontFamily="UnifrakturCook, UnifrakturMaguntia, serif",a.style.fontSize="2.1em",a.style.margin="1.5em 0 0.4em 0",a.style.color="#bfa76f",a.style.textShadow="0 0 10px #fffbe6, 0 0 2px #bfa76f",a.style.borderBottom="2px dashed #bfa76f",a.style.paddingBottom="0.12em",a.style.position="relative",a.innerHTML=`<span style="font-family:'UnifrakturCook',serif;font-size:1.1em;vertical-align:middle;">&#10070;</span> `+a.textContent,e.appendChild(a);return}if(!/^-{2,}/.test(i)){if(/^\s*\- /.test(i)){if(!n){n=!0;const c=document.createElement("ul");c.style.margin="0.7em 0 0.7em 2.2em",c.style.fontSize="1.18em",c.style.listStyleType='"‚ú∏  ";',c.style.color="#7a5c1b",c.style.fontFamily="UnifrakturCook, UnifrakturMaguntia, serif",e.appendChild(c)}const a=e.lastElementChild,l=document.createElement("li");l.innerHTML=this.parseInline(i.replace(/^\s*\- /,"")),l.style.marginBottom="0.3em",l.style.textShadow="0 0 4px #fffbe6",a.appendChild(l);return}else n&&(n=!1);if(/^Q: /.test(i)){o+=`<div class="faq-q"><span class="faq-q-label">Q:</span> ${this.parseInline(i.slice(3))}</div>`;return}if(/^A: /.test(i)){if(o+=`<div class="faq-a"><span class="faq-a-label">A:</span> ${this.parseInline(i.slice(3))}</div>`,!/^Q: |^A: /.test(t[s+1]||"")){const a=document.createElement("div");a.className="faq-block",a.innerHTML=o,a.style.background="linear-gradient(135deg,#fffbe6 60%,#f3e7c6 100%)",a.style.border="3px double #bfa76f",a.style.borderRadius="14px",a.style.margin="1.5em 0",a.style.padding="1.2em 2em",a.style.boxShadow="0 0 16px #bfa76f33, 0 0 0 4px #fffbe6cc inset",a.style.fontFamily="UnifrakturCook, UnifrakturMaguntia, serif",a.style.fontSize="1.18em",a.style.textShadow="0 0 6px #fffbe6",e.appendChild(a),o=""}return}if(i.trim()===""){n&&(n=!1);return}if(e.childElementCount===0&&i.trim().length>0){const a=document.createElement("p");a.innerHTML=`<span style="float:left;font-size:2.8em;font-family:'UnifrakturCook','UnifrakturMaguntia',serif;color:#bfa76f;line-height:0.7;margin-right:0.22em;text-shadow:0 0 8px #fffbe6,0 0 2px #bfa76f;">${i.trim()[0]}</span>${this.parseInline(i.trim().slice(1))}`,a.style.fontSize="1.32em",a.style.margin="1.5em 0 0.9em 0",a.style.textAlign="justify",a.style.letterSpacing="0.01em",e.appendChild(a);return}if(i.trim().length>0){const a=document.createElement("p");a.innerHTML=this.parseInline(i.trim()),a.style.fontSize="1.19em",a.style.margin="0.8em 0",a.style.textAlign="justify",a.style.letterSpacing="0.01em",a.style.textShadow="0 0 4px #fffbe6",e.appendChild(a);return}}});const r=document.createElement("style");r.textContent=`
      .faq-q-label { color: #b22222; font-weight: bold; margin-right: 0.3em; }
      .faq-a-label { color: #1a5c1a; font-weight: bold; margin-right: 0.3em; }
      .faq-q { margin-bottom: 0.2em; }
      .faq-a { margin-bottom: 0.7em; }
    `,e.appendChild(r)}parseInline(e){return e.replace(/\*\*(.+?)\*\*/g,"<b>$1</b>").replace(/__(.+?)__/g,"<b>$1</b>")}}const qt=`1. A Preface to the Esteemed Players\r
----------------\r
Armchair-General is a contest of dominion and cunning, inspired by the noble diversions of the salons and war rooms of Europe. Herein, you shall assume the mantle of a sovereign, vying for supremacy upon a map of many lands, commanding armies, fortifying your realms, and managing your treasury with prudence and foresight.\r
\r
\r
2. The Object of the Game\r
------------------\r
The aim, most illustrious, is not the mere annihilation of your rivals, but the attainment of preeminence through wealth. Victory is bestowed upon the first to command four-fifths (80%) of the total income derived from all lands and players. Let it be known: it is the purse, not the sword alone, that secures the crown.\r
\r
\r
3. The Implements of Play\r
-------------------\r
- **Countries**: Territories upon the map, each awaiting the hand of a master.\r
- **Players**: Worthy adversaries, be they of flesh and blood or the mechanical mind (the latter, a marvel of our age).\r
- **Armies**: Regiments and battalions, the instruments of your will.\r
- **Money**: The sinews of war, to be spent with care.\r
- **Turns**: The passage of time, measured in rounds, each player acting in their due order.\r
\r
\r
4. The Course of Play\r
------------------\r
At the commencement, each sovereign is granted dominion over certain lands, a modest treasury, and a contingent of troops.\r
Upon your turn, you may undertake up to five actions‚Äîno more, lest chaos reign. These may include the raising of armies, the strengthening of fortifications, the movement of troops, the launching of assaults, and other stratagems.\r
When all have acted, the round concludes, and a new one begins. The contest endures until a single player commands the requisite share of the world‚Äôs income.\r
\r
\r
5. On Actions & Their Execution\r
-----------------------\r
- **Buy Armies**: Expend coin to muster new regiments in your lands.\r
- **Fortify**: Invest in the strengthening of a country‚Äôs defenses; such works require time and are not completed in an instant.\r
- **Move Armies**: Dispatch your forces from one friendly land to another, provided they are neighbors or have an ocean connection.\r
- **Attack**: Attempt the conquest of a rival‚Äôs country. The further your troops must march, the weaker their resolve; distance diminishes strength.\r
  - Ordinarily, only adjacent lands may be attacked. Yet, should both possess a coast, a bold amphibious assault may be attempted, though the perils of the sea triple the effective distance.\r
- **Spy**: Dispatch agents to gather intelligence, if such means are at your disposal.\r
- **Income**: At the dawn of each round, your coffers are replenished according to your holdings.\r
\r
\r
6. The Board and Its Apparatus\r
---------------------------\r
- **Map Area**: A grand tableau displaying all lands, their masters, and the strength of their garrisons.\r
- **Country Selection**: Indicate your intentions by pointing to lands upon the map.\r
- **Action Buttons**: Upon selection, the appropriate options for your chosen lands shall present themselves.\r
  - For actions requiring two lands (such as movement or attack), select the origin and then the destination; the proper course will be made clear.\r
\r
\r
7. The Advisor\r
-------------\r
Seated at your right hand, you shall find your Advisor‚Äîa personage of wisdom and experience, ever ready to offer counsel. He surveys the field, weighs the fortunes of war, and whispers recommendations for your consideration. He is especially valuable to those new to the game, or to any who find themselves at a loss for their next move.\r
Heed him or not, as your own judgment dictates.\r
\r
\r
8.  Questions and answers\r
------------------------------------\r
Q: How is victory achieved?\r
A: By commanding 80% of the world‚Äôs income, through the wise acquisition of lands.\r
\r
Q: How may I enrich my treasury?\r
A: Each round, your income is determined by the lands under your sway.\r
\r
Q: What of fortifications?\r
A: They are planned and, after a suitable interval, completed, rendering a land more secure.\r
\r
Q: May I play against an automaton?\r
A: Indeed, the mechanical mind is a worthy, if unfeeling, adversary.\r
\r
Q: What if my coffers are empty?\r
A: You must await further income before raising armies or fortifying your lands.\r
\r
Q: How do I move my armies?\r
A: Select a land you own, then another of your dominions; the option to move will appear.\r
\r
May your stratagems be subtle, your armies steadfast, and your treasury ever full.\r
‚Äî The Publisher, and your humble Advisor\r
`;class Ht{constructor(e){v(this,"container");v(this,"players");v(this,"selectedPlayer",null);v(this,"selectedTurn","all");v(this,"overlay",null);v(this,"_turnSelect",null);this.players=e.filter(t=>t.isAI),this.container=document.createElement("div"),this.container.style.padding="24px 24px 24px 24px",this.container.style.background="#232526",this.container.style.color="#fff",this.container.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",this.container.style.overflow="auto",this.container.style.maxHeight="90vh",this.container.style.width="80vw",this.container.style.maxWidth="80vw",this.container.style.borderRadius="12px",this.container.style.boxShadow="0 2px 16px #0008",this.container.style.zIndex="10001",this.container.style.position="relative"}mount(e){const t=document.createElement("div");t.style.position="sticky",t.style.top="0",t.style.background="#232526",t.style.zIndex="10002",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="space-between",t.style.padding="0 0 12px 0";const n=this.renderPlayerSelector();t.appendChild(n);const o=this.renderTurnSelector();t.appendChild(o);const r=document.createElement("button");r.textContent="√ó",r.title="Close",r.style.fontSize="2.2em",r.style.background="none",r.style.border="none",r.style.color="#ffd700",r.style.cursor="pointer",r.style.fontWeight="bold",r.style.marginLeft="18px",r.style.marginRight="8px",r.onclick=()=>{this.overlay?this.overlay.remove():this.container.remove()},t.appendChild(r),this.container.innerHTML="",this.container.appendChild(t),e.appendChild(this.container),e.id==="opportunity-browser-overlay"&&(this.overlay=e),this.players.length>0&&this.selectPlayer(this.players[0])}renderPlayerSelector(){const e=document.createElement("div");e.style.display="flex",e.style.gap="12px",e.style.alignItems="center";const t=document.createElement("span");t.textContent="Select AI Player:",t.style.fontWeight="bold",e.appendChild(t);const n=document.createElement("select");for(const o of this.players){const r=document.createElement("option");r.value=o.name,r.textContent=o.name,n.appendChild(r)}return n.onchange=()=>{const o=this.players.find(r=>r.name===n.value);o&&this.selectPlayer(o)},e.appendChild(n),e}renderTurnSelector(){const e=document.createElement("div");e.style.display="flex",e.style.gap="8px",e.style.alignItems="center";const t=document.createElement("span");t.textContent="Game Turn:",t.style.fontWeight="bold",e.appendChild(t);const n=document.createElement("select");return n.style.minWidth="60px",n.style.fontSize="1em",n.style.marginRight="8px",n.onchange=()=>{this.selectedTurn=n.value==="all"?"all":parseInt(n.value),this.renderTable()},this._turnSelect=n,e.appendChild(n),e}selectPlayer(e){this.selectedPlayer=e,this.renderTable()}renderTable(){var d,u,y;const e=this.container.querySelector("table");if(e&&e.remove(),!this.selectedPlayer)return;const t=this.selectedPlayer.OpportunityHistory,n=Array.from(new Set(t.map(p=>p.gameTurn))).sort((p,h)=>p-h);if(this._turnSelect){this._turnSelect.innerHTML="";const p=document.createElement("option");p.value="all",p.textContent="All",this._turnSelect.appendChild(p);for(const h of n){const x=document.createElement("option");x.value=String(h),x.textContent=String(h),this.selectedTurn===h&&(x.selected=!0),this._turnSelect.appendChild(x)}this.selectedTurn!=="all"&&!n.includes(this.selectedTurn)&&(this.selectedTurn="all")}const o=this.selectedTurn==="all"?t:t.filter(p=>p.gameTurn===this.selectedTurn),r={};for(const p of o){const h=`${p.gameTurn}-${p.actionNumber}`;r[h]||(r[h]=[]),r[h].push(p)}const i=Object.keys(r).sort((p,h)=>{const[x,g]=p.split("-").map(Number),[w,f]=h.split("-").map(Number);return x!==w?x-w:g-f}),s=document.createElement("table");s.style.width="100%",s.style.borderCollapse="collapse",s.style.background="#333",s.style.marginTop="12px";const a=document.createElement("thead"),l=document.createElement("tr");for(const p of["Game Turn","Action #","Action","Countries","Amount","Score"]){const h=document.createElement("th");h.textContent=p,h.style.padding="8px 12px",h.style.background="#444",h.style.color="#ffd700",h.style.fontWeight="bold",h.style.borderBottom="2px solid #ffd700",l.appendChild(h)}a.appendChild(l),s.appendChild(a);const c=document.createElement("tbody");for(const p of i){const h=r[p].slice().sort((g,w)=>w.opportunity.score-g.opportunity.score);let x=h.length>0?h[0].opportunity.score:null;for(const g of h){const w=document.createElement("tr");g.opportunity.score===x?(w.style.background="linear-gradient(90deg,#ffd70022,#fffbe622)",w.style.fontWeight="bold"):w.style.background="#232526";for(const f of[g.gameTurn,g.actionNumber,((u=(d=g.opportunity.action)==null?void 0:d.Type)==null?void 0:u.call(d))??"",(y=g.opportunity.countries)==null?void 0:y.map(m=>m.name).join(", "),g.opportunity.amount,g.opportunity.score]){const m=document.createElement("td");m.textContent=String(f??""),m.style.padding="6px 10px",m.style.borderBottom="1px solid #444",m.style.textAlign="center",c.appendChild(w),w.appendChild(m)}}}s.appendChild(c),this.container.appendChild(s)}}const be=class be{constructor(){v(this,"state");v(this,"currentGame",null);v(this,"rootContainer",null);v(this,"canceled",!1);v(this,"paused",!1);v(this,"clickedCountryNames",[]);v(this,"worldMapCanvas",null);v(this,"mapDirty",!0);v(this,"actions");v(this,"fishOverlay",null);v(this,"_onResize",()=>{this.markMapDirty(),this.rootContainer&&this.renderMainGui(this.rootContainer,this.currentGame)});v(this,"isProcessingAdvisorSynthetic",!1);v(this,"isAdvisorAnimationRunning",!1);this.state="initialized",this.actions=[new nt,new et,new re,new $t,new Ge,new Le,new tt],be._instance=this,window.addEventListener("keydown",e=>{if(e.key==="F9"&&this.currentGame&&zt(this.currentGame),e.key==="F8"&&ge(()=>Promise.resolve().then(()=>Ft),void 0).then(t=>{var o,r;const n=((r=(o=this.currentGame)==null?void 0:o.activePlayer)==null?void 0:r.name)||"Player";t.showWinDialog(n,100)}),e.key==="F10"){if(document.getElementById("opportunity-browser-overlay"))return;const t=document.createElement("div");t.id="opportunity-browser-overlay",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(20,20,30,0.92)",t.style.zIndex="99999",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.onclick=o=>{o.target===t&&t.remove()},document.body.appendChild(t),this.currentGame&&this.currentGame.players&&new Ht(this.currentGame.players).mount(t);const n=o=>{o.key==="Escape"&&(t.remove(),window.removeEventListener("keydown",n))};window.addEventListener("keydown",n)}})}pauseGame(){if(this.paused=!0,!this.fishOverlay){const e=document.querySelector('div[style*="flex: 3"]');e&&e._fishOverlay&&(this.fishOverlay=e._fishOverlay)}this.fishOverlay&&typeof this.fishOverlay.stop=="function"?(console.log("Pausing FishOverlay",this.fishOverlay),this.fishOverlay.stop()):console.log("No FishOverlay to pause")}resumeGame(){if(this.paused=!1,!this.fishOverlay){const e=document.querySelector('div[style*="flex: 3"]');e&&e._fishOverlay&&(this.fishOverlay=e._fishOverlay)}this.fishOverlay&&typeof this.fishOverlay.resume=="function"?(console.log("Resuming FishOverlay",this.fishOverlay),this.fishOverlay.resume()):console.log("No FishOverlay to resume")}isPaused(){return this.paused}static getInstance(){return be._instance}afterAction(){if(this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],n=this.currentGame.worldMap.getCountries().find(o=>o.name===e);if(n&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const o=this.currentGame.activePlayer.getCountryInfo(n,this.currentGame.gameTurn),r=document.getElementById("country-info-panel");if(r){const i=n.unrestLevel>0?"color: red; font-style: italic;":"";n.unrestLevel>0;const s=n.unrestLevel>0?"color: red; text-decoration: line-through;":"";r.innerHTML=`
            <div><b>Name:</b> <span style="${i}">${o.name}</span></div>
            <div><b>Owner:</b> ${o.owner?o.owner.name:"None"}</div>
            <div><b>Income:</b> <span style="${s}">${o.income!==void 0?o.income:"?"} </span></div>
            ${this.currentGame&&this.currentGame.InvestEnabled?`<div><b>Income Potential:</b> <span>${n.IncomePotential!==void 0?n.IncomePotential:"?"}</span></div>`:""}
            <div><b>Army:</b> ${o.army!==void 0?o.army:"?"}</div>
          `}}}if(this.markMapDirty(),this.rootContainer&&(this.renderMainGui(this.rootContainer,this.currentGame),this.clickedCountryNames.length>0&&this.currentGame&&this.currentGame.worldMap)){const e=this.clickedCountryNames[this.clickedCountryNames.length-1],n=this.currentGame.worldMap.getCountries().find(o=>o.name===e);if(n&&this.currentGame.activePlayer&&typeof this.currentGame.gameTurn=="number"){const o=this.currentGame.activePlayer.getCountryInfo(n,this.currentGame.gameTurn),r=document.getElementById("country-info-panel");if(r){const i=n.unrestLevel>0?"color: red; font-style: italic;":"";n.unrestLevel>0;const s=n.unrestLevel>0?"color: red; text-decoration: line-through;":"",a=this.currentGame.activePlayer;if(!a.armyKnown(n)){const l=a.knowledge.find(c=>c.country===n);n.owner&&n.owner!==a&&l&&this.currentGame.gameTurn-l.gameTurn}r.innerHTML=`
              <div><b>Name:</b> <span style="${i}">${o.name}</span></div>
              <div><b>Owner:</b> ${o.owner?o.owner.name:"None"}</div>
              <div><b>Income:</b> <span style="${s}">${o.income!==void 0?o.income:"?"} </span></div>
              ${this.currentGame&&this.currentGame.InvestEnabled?`<div><b>Income Potential:</b> <span>${n.IncomePotential!==void 0?n.IncomePotential:"?"}</span></div>`:""}
              <div><b>Army:</b> ${o.army!==void 0?o.army:"?"}</div>
            `}}if(!this.isProcessingAdvisorSynthetic&&this.currentGame.activePlayer&&this.currentGame.activePlayer.actionLog.length>0){const o=this.currentGame.activePlayer.actionLog[this.currentGame.activePlayer.actionLog.length-1];if(o.countries&&o.countries.length>0){const r=o.countries[o.countries.length-1];if(r&&r.name){this.clickedCountryNames.push(r.name);const i=this.rootContainer.querySelector('div[style*="flex: 3"]'),s=i?i.querySelector("canvas"):null;if(s&&i){const l=this.currentGame.worldMap.getCountries().find(c=>c.name===r.name);if(l){const[c,d]=l.center?l.center():[0,0],u=s.width,y=s.height,p=s.getBoundingClientRect(),h=p.width/u,x=p.height/y,g=c*h,w=d*x,f=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:p.left+g,clientY:p.top+w});s.dispatchEvent(f)}}}}}}this.updateActionButtons()}updateActionButtons(){if(this.paused)return;const e=document.querySelector('div[style*="flex: 3"]');let t=e?e.querySelector("#country-action-overlay"):null;t&&(t.remove(),t=null);const n=document.getElementById("action-buttons-area");if(n&&Array.from(n.children).forEach(s=>{s instanceof HTMLElement&&(s.classList.contains("persistent-action-btn")||n.removeChild(s))}),!this.currentGame||!this.currentGame.players||!this.currentGame.activePlayer)return;const o=this.currentGame.worldMap?this.currentGame.worldMap.getCountries():[],r=this.clickedCountryNames.map(s=>o.find(a=>a.name===s)).filter(Boolean);if(this.currentGame.activePlayer.actionsLeft<=0||r.length===0||!e)return;const i=[];for(const s of this.actions){const a=s.GetButtonText(r,this.currentGame.activePlayer);if(a){const l=document.createElement("button");l.textContent=a,l.style.padding="4px 10px",l.style.fontSize="0.95rem",l.style.background="rgba(0,0,0,0.18)",l.style.color="#b3e5fc",l.style.border="1px solid #555",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.boxShadow="0 1px 4px rgba(30,32,34,0.10)",l.style.margin="0 6px 0 0",l.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",l.style.transition="background 0.15s, color 0.15s",l.onmouseenter=()=>{l.style.background="#ffd700",l.style.color="#222"},l.onmouseleave=()=>{l.style.background="rgba(0,0,0,0.18)",l.style.color="#b3e5fc"},l.onclick=async()=>{const c=s.RequiresAmount(r,this.currentGame.activePlayer,this.currentGame);let d=null,u=0;if(c){const[p,h]=c;let x=h;if(this.currentGame&&this.currentGame.advisedOpportunity){const w=this.currentGame.advisedOpportunity,f=this.currentGame.worldMap.getCountries();for(const S of w.countries){const P=f.find(N=>N.name===S.name);P&&P!==S&&(console.warn("[Advisor/Action] Country instance mismatch:",S.name,S,P),P.name===S.name&&console.error("[Advisor/Action] Country instance mismatch but names match:",S.name,S,P))}const m=w.action.Type()===s.Type();m||console.log("[Advisor/Action] Action type mismatch:",w.action.Type(),s.Type());const b=w.countries.length,C=r.slice(-b),k=C.length===b&&w.countries.every((S,P)=>S===C[P]);if(!k){console.log("[Advisor/Action] Country array mismatch:"),console.log("  opp.countries:",w.countries.map(S=>S.name)),console.log("  lastClicked:",C.map(S=>S&&S.name));for(let S=0;S<Math.max(w.countries.length,C.length);++S){const P=w.countries[S],N=C[S];P!==N&&(P&&N&&P.name===N.name?console.error("[Advisor/Action] Country instance mismatch at index",S,"but names match:",P.name,P,N):console.log("[Advisor/Action] Country mismatch at index",S,":",P,N))}}m&&k?(console.log("[Advisor/Action] Using advisor suggested amount:",w.amount),x=w.amount):console.log("[Advisor/Action] Not using advisor amount. sameAction:",m,"sameCountries:",k)}const g=await Xe(p,h,x);if(g===null)return;u=g,d=await s.Act(r,this.currentGame.activePlayer,this.currentGame,g)}else d=await s.Act(r,this.currentGame.activePlayer,this.currentGame);const y=r.slice(-s.countryCountNeeded);this.currentGame.activePlayer.actionLog.push({actionType:s.Type(),countries:y,amount:u,result:d??null}),this.currentGame.activePlayer.useAction(),typeof d=="string"&&d!==null?(this.afterAction(),this.showActionResult(d)):this.afterAction(),this.currentGame&&(this.currentGame.advisedOpportunity=null)},i.push(l)}}if(i.length>0){t=document.createElement("div"),t.id="country-action-overlay",t.style.position="absolute",t.style.pointerEvents="auto",t.style.background="rgba(40, 40, 60, 0.85)",t.style.border="1.5px solid #555",t.style.borderRadius="10px",t.style.padding="12px 18px",t.style.color="#b3e5fc",t.style.fontSize="0.95rem",t.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.style.gap="10px",t.style.zIndex="21",t.style.minWidth="140px",t.style.maxWidth="340px",t.style.visibility="hidden",t.style.flexWrap="wrap",t.style.maxWidth="340px",t.style.minHeight="unset",i.forEach(a=>{a.style.width="100%",a.style.margin="0",a.style.textAlign="center",a.style.background="#b3e5fc",a.style.color="#1a237e",a.onmouseenter=()=>{a.style.background="#ffd700",a.style.color="#222"},a.onmouseleave=()=>{a.style.background="#b3e5fc",a.style.color="#1a237e"},t.appendChild(a)}),e.appendChild(t);const s=e.querySelector("canvas");if(s&&r.length===1){const a=r[0],[l,c]=a.center?a.center():[0,0],d=s.width,u=s.height,y=s.getBoundingClientRect(),p=y.width/d,h=y.height/u,x=l*p,g=c*h,w=e.querySelector("#country-info-overlay");w&&w.style.display!=="none"?requestAnimationFrame(()=>{const f=w.offsetHeight;t.style.left=`${x-t.offsetWidth/2}px`,t.style.top=`${g+f+2}px`,t.style.visibility="visible",t.style.flexWrap="wrap",t.style.maxWidth="340px",t.style.minHeight="unset"}):(t.style.left=`${x-t.offsetWidth/2}px`,t.style.top=`${g+8}px`,t.style.visibility="visible")}}}showActionResult(e){const t=document.getElementById("action-result-panel");t&&(t.innerHTML=`<span style="color:#fff">${e}</span>`)}clearActionResult(){const e=document.getElementById("action-result-panel");e&&(e.innerHTML='<span style="color:#888">No recent action.</span>')}markMapDirty(){this.mapDirty=!0}getWorldMapCanvas(){if(this.paused)throw new Error("Game is paused");if(!this.currentGame||!this.currentGame.worldMap)throw new Error("GameGui.getWorldMapCanvas: currentGame or worldMap is missing");if(this.mapDirty||!this.worldMapCanvas){let e=[];if(this.currentGame.activePlayer){const t=this.currentGame.activePlayer.getKnownCountries();e=t.owned.concat(t.known)}this.worldMapCanvas=Me.render(this.currentGame.worldMap,[],e,_.showArmies,this.currentGame.activePlayer),this.mapDirty=!1}return this.worldMapCanvas}async mount(e){this.rootContainer=e,window.addEventListener("resize",this._onResize),this.renderMainGui(e,this.currentGame)}unmount(){window.removeEventListener("resize",this._onResize)}async turnStarted(){var n,o;if(this.paused)return;if(this.clearActionResult(),this.currentGame&&this.currentGame.activePlayer&&this.currentGame.activePlayer.IncomeShare>=_.INCOME_SHARE_WIN){ot(this.currentGame.activePlayer.name,_.INCOME_SHARE_WIN*100,()=>{this.canceled=!0}),this.canceled=!0;return}if(this.renderMainGui(this.rootContainer,this.currentGame),this.canceled||!((o=(n=this.currentGame)==null?void 0:n.activePlayer)!=null&&o.isAI))return;const e=this.currentGame.activePlayer.AI;if(!e)return;const t=async()=>{if(this.paused||this.canceled)return;const r=await e.takeAction();this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),r?setTimeout(()=>t(),100):(this.currentGame.nextTurn(),this.markMapDirty(),this.currentGame.activePlayer.isAI?setTimeout(()=>this.turnStarted(),100):this.turnStarted())};t()}async startNewGame(){this.canceled=!0;const e=this.rootContainer,{showNewGameDialog:t}=await ge(async()=>{const{showNewGameDialog:n}=await import("./NewGameDialog-CraRxwix.js");return{showNewGameDialog:n}},[]);try{const n=await t(e),o=await ge(()=>Promise.resolve().then(()=>Gt),void 0),r=await ge(()=>Promise.resolve().then(()=>Lt),void 0);r.Game.showArmies=n.showArmies;const i=["#4fc3f7","#81c784","#ffb74d","#e57373","#ba68c8","#ffd54f","#64b5f6","#a1887f"],s=o.Player.COLORS??i,a=n.players.map((l,c)=>new o.Player(l.name,s[c%s.length],[],null,[],0,l.isAI));this.currentGame=r.Game.initNewGame(n.map,a,this),this.markMapDirty(),this.getWorldMapCanvas(),this.renderMainGui(e,this.currentGame),this.currentGame&&this.currentGame.players.length>0&&(this.canceled=!1,this.currentGame.activePlayer.startTurn(),this.turnStarted())}catch(n){console.error("NewGameDialog error or cancellation:",n)}}renderMainGui(e,t){if(this.paused)return;const n=this.rootContainer;if(!n)throw new Error("rootContainer is not set (null) in renderMainGui");const o=n.querySelector('div[style*="flex: 3"]');if(o&&o._fishOverlay){const M=o._fishOverlay;typeof M.stop=="function"&&M.stop(),M.overlay&&M.overlay.parentNode&&M.overlay.parentNode.removeChild(M.overlay),o._fishOverlay=null}n.innerHTML="";const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="row",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100vw",r.style.height=typeof window<"u"&&"visualViewport"in window?"100dvh":"100vh",r.style.background="linear-gradient(120deg, #232526 0%, #414345 100%)",r.style.borderRadius="0",r.style.boxShadow="none",r.style.overflow="hidden",r.style.margin="0",r.style.maxWidth="100vw";const i=document.createElement("div");i.style.flex="3",i.style.background="#222",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.position="relative",i.style.borderRight="2px solid #333";let s=null;t&&t.worldMap&&(s=this.getWorldMapCanvas()),this.clickedCountryNames||(this.clickedCountryNames=[]);let a=i.querySelector("#country-info-overlay");if(a||(a=document.createElement("div"),a.id="country-info-overlay",a.style.position="absolute",a.style.pointerEvents="auto",a.style.background="rgba(40, 40, 60, 0.85)",a.style.border="1.5px solid #555",a.style.borderRadius="10px",a.style.padding="14px 18px",a.style.color="#b3e5fc",a.style.fontSize="1.08rem",a.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",a.style.minWidth="180px",a.style.maxWidth="320px",a.style.display="none",a.style.zIndex="20",i.appendChild(a)),s){let M=function(){T||(T=document.createElement("canvas"),T.width=s.width,T.height=s.height,T.style.position="absolute",T.style.left="0",T.style.top="0",T.style.pointerEvents="none",T.style.width="100%",T.style.height="100%",i.appendChild(T))},E=function(){if(T){const O=T.getContext("2d");O&&O.clearRect(0,0,T.width,T.height)}};s.style.width="100%",s.style.height="100%",s.style.display="block",i.appendChild(s);let T=null;if(!i._fishOverlay){const O=t.worldMap.getMap(),D=s.width,z=s.height,F=(R,G)=>R<0||G<0||G>=O.length||R>=O[0].length?!1:O[G][R]===Q;i._fishOverlay=new Dt(i,D,z,F)}this.fishOverlay=i._fishOverlay,s._countryClickHandler&&s.removeEventListener("mousedown",s._countryClickHandler);const I=O=>{if(this.paused)return;const D=s.width,z=s.height,F=Math.floor(O.offsetX*(D/s.clientWidth)),R=Math.floor(O.offsetY*(z/s.clientHeight)),G=t.worldMap.getMap(),U=t.worldMap.getCountries();let B=null;if(F>=0&&R>=0&&R<G.length&&F<G[0].length){const Z=G[R][F];if(Z>=0&&U[Z]){if(B=U[Z],B&&!B.coordinates.some(([$,ee])=>$===F&&ee===R)&&console.warn(`[GameGui] Click at (${F},${R}) is not in coordinates of country: ${B.name}`),B&&this.clickedCountryNames.push(B.name),M(),E(),T&&B){const $=T.getContext("2d");if($){Me.drawCountryGlow($,B,[0,0,0],B.color);const[ee,ie]=B.center?B.center():[0,0],ae=B.fortified?"üõ°Ô∏è "+B.name:B.name;if($.save(),$.font="bold 10px Verdana, Geneva, sans-serif",$.textAlign="center",$.textBaseline="middle",$.lineWidth=3,$.strokeStyle="black",$.strokeText(ae,ee,ie),$.fillStyle="white",$.fillText(ae,ee,ie),_.showArmies&&typeof B.armies=="number"){const fe=`${Math.round(B.armies/1e3)}k`;$.font="bold 9px Verdana, Geneva, sans-serif",$.lineWidth=2,$.strokeStyle="black",$.strokeText(fe,ee,ie+13),$.fillStyle="#FFD700",$.fillText(fe,ee,ie+13)}$.restore()}}if(B&&a&&t&&t.activePlayer&&typeof t.gameTurn=="number"){const $=t.activePlayer.getCountryInfo(B,t.gameTurn),ee=B.unrestLevel>0?"color: #ff6666; font-style: italic;":"";B.unrestLevel>0;const ie=B.unrestLevel>0?"color: #ff6666; text-decoration: line-through;":"",ae=t.activePlayer;if(!ae.armyKnown(B)){const ce=ae.knowledge.find(L=>L.country===B);B.owner&&B.owner!==ae&&ce&&t.gameTurn-ce.gameTurn}a.innerHTML=`
                <div><b>Name:</b> <span style="${ee}">${$.name}</span></div>
                <div><b>Owner:</b> ${$.owner?$.owner.name:"None"}</div>
                <div><b>Income:</b> <span style="${ie}">${$.income!==void 0?$.income:"?"} </span></div>
                ${this.currentGame&&this.currentGame.InvestEnabled?`<div><b>Income Potential:</b> <span>${B.IncomePotential!==void 0?B.IncomePotential:"?"}</span></div>`:""}
                <div><b>Army:</b> ${$.army!==void 0?$.army:"?"}</div>
              `;const[fe,lt]=B.center?B.center():[0,0],ct=s.width,dt=s.height,De=s.getBoundingClientRect(),ht=De.width/ct,ut=De.height/dt,ft=fe*ht,yt=lt*ut;a.style.left=`${ft-a.offsetWidth/2}px`,a.style.top=`${yt-a.offsetHeight-18}px`,a.style.display="block",requestAnimationFrame(()=>{const ce=document.querySelector('div[style*="flex: 3"]');let L=ce?ce.querySelector("#country-action-overlay"):null;if(L&&(L.remove(),L=null),!t.activePlayer||t.activePlayer.actionsLeft<=0||!B)return;const mt=t.worldMap.getCountries(),le=this.clickedCountryNames.map(W=>mt.find(ke=>ke.name===W)).filter(Boolean);if(le.length===0)return;const Ee=[];for(const W of this.actions){const ke=W.GetButtonText(le,t.activePlayer);if(ke){const j=document.createElement("button");j.textContent=ke,j.style.padding="4px 10px",j.style.fontSize="0.95rem",j.style.background="rgba(0,0,0,0.18)",j.style.color="#b3e5fc",j.style.border="1px solid #555",j.style.borderRadius="6px",j.style.cursor="pointer",j.style.boxShadow="0 1px 4px rgba(30,32,34,0.10)",j.style.margin="0 6px 0 0",j.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",j.style.transition="background 0.15s, color 0.15s",j.onmouseenter=()=>{j.style.background="#ffd700",j.style.color="#222"},j.onmouseleave=()=>{j.style.background="rgba(0,0,0,0.18)",j.style.color="#b3e5fc"},j.onclick=async()=>{if(le.length===0)return;const _e=W.RequiresAmount(le,t.activePlayer,t);let ye=null,ze=0;if(_e){const[pt,We]=_e;let qe=We;if(t&&t.advisedOpportunity){const te=t.advisedOpportunity,gt=t.worldMap.getCountries();for(const q of te.countries){const K=gt.find(de=>de.name===q.name);K&&K!==q&&(console.warn("[Advisor/Action] Country instance mismatch:",q.name,q,K),K.name===q.name&&console.error("[Advisor/Action] Country instance mismatch but names match:",q.name,q,K))}const Ne=te.action.Type()===W.Type();Ne||console.log("[Advisor/Action] Action type mismatch:",te.action.Type(),W.Type());const He=te.countries.length,pe=le.slice(-He),Oe=pe.length===He&&te.countries.every((q,K)=>q===pe[K]);if(!Oe){console.log("[Advisor/Action] Country array mismatch:"),console.log("  opp.countries:",te.countries.map(q=>q.name)),console.log("  lastClicked:",pe.map(q=>q&&q.name));for(let q=0;q<Math.max(te.countries.length,pe.length);++q){const K=te.countries[q],de=pe[q];K!==de&&(K&&de&&K.name===de.name?console.error("[Advisor/Action] Country instance mismatch at index",q,"but names match:",K.name,K,de):console.log("[Advisor/Action] Country mismatch at index",q,":",K,de))}}Ne&&Oe?(console.log("[Advisor/Action] Using advisor suggested amount:",te.amount),qe=te.amount):console.log("[Advisor/Action] Not using advisor amount. sameAction:",Ne,"sameCountries:",Oe)}const Pe=await Xe(pt,We,qe);if(Pe===null)return;ze=Pe,ye=await W.Act(le,t.activePlayer,t,Pe)}else ye=await W.Act(le,t.activePlayer,t);t.activePlayer.actionLog.push({actionType:W.Type(),countries:le,amount:ze,result:ye??null}),t.activePlayer.useAction(),typeof ye=="string"&&ye!==null?(this.afterAction(),this.showActionResult(ye)):this.afterAction(),t&&(t.advisedOpportunity=null)},Ee.push(j)}}Ee.length>0&&ce&&B&&(L=document.createElement("div"),L.id="country-action-overlay",L.style.position="absolute",L.style.pointerEvents="auto",L.style.background="rgba(40, 40, 60, 0.85)",L.style.border="1.5px solid #555",L.style.borderRadius="10px",L.style.padding="12px 18px",L.style.color="#b3e5fc",L.style.fontSize="0.95rem",L.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",L.style.display="flex",L.style.flexDirection="column",L.style.alignItems="center",L.style.justifyContent="center",L.style.gap="10px",L.style.zIndex="21",L.style.minWidth="140px",L.style.maxWidth="340px",L.style.visibility="hidden",L.style.flexWrap="wrap",L.style.maxWidth="340px",L.style.minHeight="unset",Ee.forEach(W=>{W.style.width="100%",W.style.margin="0",W.style.textAlign="center",W.style.background="#b3e5fc",W.style.color="#1a237e",W.onmouseenter=()=>{W.style.background="#ffd700",W.style.color="#222"},W.onmouseleave=()=>{W.style.background="#b3e5fc",W.style.color="#1a237e"},L.appendChild(W)}),ce.appendChild(L),L.style.left=`${a.offsetLeft}px`,L.style.top=`${a.offsetTop+a.offsetHeight+2}px`,L.style.visibility="visible",L.style.flexWrap="wrap",L.style.maxWidth="340px",L.style.minHeight="unset")})}}}this.isProcessingAdvisorSynthetic=!1};s.addEventListener("mousedown",I),s._countryClickHandler=I}else{const M=document.createElement("div");M.style.width="100%",M.style.height="100%",M.style.background="repeating-linear-gradient(135deg,#444 0 10px,#333 10px 20px)",M.style.border="4px solid #666",M.style.borderRadius="12px",M.style.display="flex",M.style.alignItems="center",M.style.justifyContent="center";const E=document.createElement("img");E.src="riskStartup.png",E.alt="Risk Startup",E.style.width="100%",E.style.height="100%",E.style.objectFit="cover",E.style.borderRadius="8px",M.appendChild(E),i.appendChild(M)}const l=document.createElement("div"),c=document.createElement("div");c.style.display="flex",c.style.flexDirection="row",c.style.justifyContent="center",c.style.alignItems="center",c.style.gap="4.5%",c.style.marginBottom="2.67%",c.style.width="100%",c.style.minWidth="0";function d(M,E,T){const I=document.createElement("img");return I.src=M,I.alt=E,I.style.flex="1 1 0",I.style.width="0",I.style.minWidth="0",I.style.height="auto",I.style.objectFit="contain",I.style.cursor="pointer",I.style.borderRadius="2%",I.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",I.style.transition="transform 0.1s, box-shadow 0.1s",I.addEventListener("mouseenter",()=>{I.style.transform="scale(1.08)",I.style.boxShadow="0 4px 16px #ffd700"}),I.addEventListener("mouseleave",()=>{I.style.transform="scale(1)",I.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)"}),I.onclick=T,I.style.display="block",I.style.margin="0 0",I}const u=d("newgame.png","New Game",()=>this.startNewGame()),y=d("savegame.png","Save Game",()=>{try{if(!this.currentGame)throw new Error("No game to save");const M=Ke.serialize(this.currentGame),E=new Blob([M],{type:"application/json"}),T=URL.createObjectURL(E),I=document.createElement("a");I.href=T,I.download="armchair-general-save.json",document.body.appendChild(I),I.click(),setTimeout(()=>{document.body.removeChild(I),URL.revokeObjectURL(T)},100)}catch(M){throw alert("Save failed: "+(M&&M.message?M.message:M)),M}}),p=d("loadgame.png","Load Game",()=>{const M=document.createElement("input");M.type="file",M.accept=".json,application/json",M.onchange=E=>{const T=E.target.files[0];if(!T)return;const I=new FileReader;I.onload=()=>{try{const O=I.result,D=Ke.deserialize(O);D.gui=this;for(const z of D.players)z.game=D,z.isAI&&z.AI&&(z.AI.game=D,z.AI.player=z);this.currentGame=D,this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),this.turnStarted()}catch(O){throw alert("Load failed: "+(O&&O.message?O.message:O)),O}},I.readAsText(T)},M.click()}),h=document.createElement("img");h.src="manual.png",h.alt="Manual",h.style.display="block",h.style.marginLeft="auto",h.style.marginTop="1.33%",h.style.marginBottom="0",h.style.width="24%",h.style.height="auto",h.style.cursor="pointer",h.style.boxShadow="0 0 12px #bfa76f55",h.style.opacity="0.7",h.onclick=()=>{const M=document.createElement("div");M.style.position="fixed",M.style.left="0",M.style.top="0",M.style.width="100vw",M.style.height="100vh",M.style.background="rgba(40,30,10,0.20)",M.style.zIndex="99999",M.style.display="flex",M.style.alignItems="center",M.style.justifyContent="center";const E=document.createElement("div");E.style.width="80vw",E.style.maxWidth="none",E.style.height="80vh",E.style.overflowY="auto",E.style.background="rgba(255,250,230,0.85)",E.style.borderRadius="5.5%",E.style.boxShadow="0 0 64px #bfa76f99, 0 0 8px #fffbe6",E.style.position="relative";const T=document.createElement("button");T.textContent="√ó",T.style.position="absolute",T.style.top="2%",T.style.right="7%",T.style.fontSize="2.2em",T.style.background="none",T.style.border="none",T.style.color="#b22222",T.style.cursor="pointer",T.style.fontWeight="bold",T.style.zIndex="100000",T.onpointerdown=()=>{M.remove()},E.appendChild(T);const I=document.createElement("div");I.style.padding="2.5em 2.5em 2em 2.5em",new Wt(qt).renderTo(I),E.appendChild(I),M.appendChild(E),document.body.appendChild(M)},c.appendChild(u),c.appendChild(y),c.appendChild(p),l.appendChild(c),l.appendChild(h);const x=document.createElement("div");x.style.marginBottom="3.56%";const g=document.createElement("div");if(g.style.fontSize="1.2vw",g.style.fontWeight="bold",t&&t.players&&t.players.length>0){const M=t.activePlayer;g.textContent=`Turn: ${t.gameTurn} | Player: ${M.name}`;const E=document.createElement("div"),T=M.constructor.ACTIONS_PER_TURN||5,I=M.actionsLeft;E.style.margin="0.89% 0 0 0",E.style.fontSize="2rem",E.style.letterSpacing="0.2rem";for(let D=0;D<T;D++){const z=document.createElement("span");z.textContent=D<I?"‚òÖ":"‚òÜ",z.style.color=D<I?"#ffd700":"#888",E.appendChild(z)}E.title=`${I} of ${T} actions remaining`;const O=document.createElement("div");O.style.display="flex",O.style.flexDirection="row",O.style.alignItems="center",O.style.justifyContent="space-between",O.appendChild(E),O.appendChild(h),x.appendChild(O)}if(x.appendChild(g),l.appendChild(x),t&&t.players&&t.players.length>0){const M=document.createElement("div");M.textContent="Players",M.style.fontWeight="bold",M.style.marginBottom="0.89%",l.appendChild(M);const E=document.createElement("ul");E.style.listStyle="none",E.style.padding="0",E.style.margin="0 0 2.67% 0";for(const T of t.players){const I=document.createElement("li");I.style.display="flex",I.style.alignItems="center",I.style.marginBottom="0.89%",T===t.activePlayer&&(I.style.boxShadow="0 0 16px 4px #ffd700, 0 0 4px 2px #fff",I.style.border="2px solid #ffd700",I.style.borderRadius="3%",I.style.background="rgba(255, 215, 0, 0.10)");const O=document.createElement("span");O.style.display="inline-block",O.style.width="8%",O.style.aspectRatio="1 / 1",O.style.height="auto",O.style.borderRadius="50%",O.style.background=`radial-gradient(circle, ${T.color} 60%, transparent 100%)`,O.style.marginRight="2%",I.appendChild(O);const D=document.createElement("span");if(D.textContent=T.name+(T.isAI?" (AI)":""),D.style.flex="1",I.appendChild(D),typeof T.money=="number"){const z=document.createElement("span"),F=Math.round(T.money/1e3)/100;z.textContent=`üí∞ ${F}k`,z.style.marginLeft="2%",I.appendChild(z);const R=document.createElement("div");R.style.display="inline-block",R.style.width="13.5%",R.style.height="1em",R.style.marginLeft="2%",R.style.verticalAlign="middle",R.style.background="#222",R.style.border="1px solid #444",R.style.borderRadius="1.5%",R.style.overflow="hidden";const G=document.createElement("div"),U=Math.min(T.IncomeShare/_.INCOME_SHARE_WIN,1);G.style.display="block",G.style.height="100%",G.style.width=`${Math.round(U*100)}%`,G.style.background=U>=1?"linear-gradient(90deg,#43cea2,#ffd700)":"linear-gradient(90deg,#43cea2,#185a9d)",G.style.transition="width 0.3s",R.title=`Income share: ${(T.IncomeShare*100).toFixed(1)}% (win at ${(_.INCOME_SHARE_WIN*100).toFixed(0)}%)`,R.appendChild(G),I.appendChild(R)}E.appendChild(I)}l.appendChild(E)}const w=document.createElement("div");w.id="action-result-panel",w.style.background="#a67c52",w.style.border="1px solid #555",w.style.borderRadius="2%",w.style.padding="1.11% 3%",w.style.marginBottom="2%",w.style.color="#fff",w.style.fontSize="1.05rem",w.style.minHeight="6.67%",w.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",w.innerHTML='<span style="color:#888">No recent action.</span>',l.appendChild(w);const f=document.createElement("div");f.id="action-panel",f.style.display="flex",f.style.flexDirection="row",f.style.alignItems="flex-start",f.style.background="#a67c52",f.style.border="1px solid #555",f.style.borderRadius="2%",f.style.padding="2.22% 6%",f.style.marginTop="auto",f.style.marginBottom="2%",f.style.minHeight="15.56%",f.style.maxWidth="100%";const m=document.createElement("div");m.id="advisor-speech-bubble",m.style.position="relative",m.style.flex="1 1 0%",m.style.height="80%",m.style.background="white",m.style.color="#222",m.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",m.style.fontSize="1.18rem",m.style.padding="2% 6%",m.style.borderRadius="4.5%",m.style.boxShadow="0 2px 12px rgba(0,0,0,0.18)",m.style.border="2px solid #a67c52",m.style.display="none",m.style.zIndex="2",m.style.pointerEvents="none",m.style.transition="opacity 0.3s",m.style.opacity="0",m.style.textAlign="left",m.style.lineHeight="1.4",m.innerHTML="",m.style.setProperty("position","relative");const b=document.createElement("style");b.innerHTML=`
    #advisor-speech-bubble::after {
      content: '';
      position: absolute;
      right: -7%; /* 28px/400px */
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-top: 2% solid transparent; /* 18px/900px */
      border-bottom: 2% solid transparent; /* 18px/900px */
      border-left: 7% solid white; /* 28px/400px */
      filter: drop-shadow(-2px 0 0 #a67c52);
      z-index: 3;
    }
    `,document.head.appendChild(b);const C=document.createElement("div");C.style.flex="0 0 36%",C.style.display="flex",C.style.flexDirection="column",C.style.alignItems="flex-end",C.style.justifyContent="center",C.style.height="100%",C.style.marginLeft="auto",f.appendChild(m),f.appendChild(C),l.appendChild(f);const k=document.createElement("button");k.textContent="End Turn",k.classList.add("persistent-action-btn"),k.style.padding="1.33% 0",k.style.fontSize="1.2vw",k.style.background="linear-gradient(90deg,#43cea2 0%,#185a9d 100%)",k.style.color="#fff",k.style.border="none",k.style.borderRadius="2%",k.style.cursor="pointer",k.style.boxShadow="0 2px 8px rgba(30,32,34,0.13)",k.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",k.style.marginBottom="2%",k.onclick=()=>{this.paused||this.currentGame&&(this.currentGame.nextTurn(),this.markMapDirty(),this.renderMainGui(this.rootContainer,this.currentGame),this.turnStarted())},l.appendChild(k);const S=document.createElement("div");S.style.textAlign="right",S.style.marginTop="-1.11%",S.style.marginBottom="0.89%",S.style.fontSize="0.92em",S.style.opacity="0.7",S.style.letterSpacing="0.01em",S.style.userSelect="text";const P=document.createElement("a");P.href="mailto:armchair@futuremagic.de?subject=Armchair-general",P.textContent="armchair@futuremagic.de",P.style.color="#fff",P.style.textDecoration="underline dotted",P.style.fontSize="inherit",P.style.fontFamily="inherit",P.target="_blank",S.appendChild(P),l.appendChild(S),l.style.flex="0 0 20%",l.style.background="#3b2412",l.style.display="flex",l.style.flexDirection="column",l.style.padding="0.5% 0.5%",l.style.color="#fff",l.style.boxSizing="border-box",l.style.fontFamily="'MedievalSharp', 'Times New Roman', serif",l.style.fontSize="1.2vw",l.style.overflowY="auto",r.appendChild(i),r.appendChild(l),n.appendChild(r),C.addEventListener("click",async()=>{var I;if(console.log("[Advisor] advisor image clicked"),this.isAdvisorAnimationRunning){console.log("[Advisor] Animation already running, ignoring click");return}const M=(I=this.currentGame)==null?void 0:I.activePlayer;if(!M||!M.AI)return;M.AI.game=this.currentGame;const E=M.AI.findBestOpportunity();let T="";if(!E)T="Sorry, sir, I have no idea what to do!";else{let O=E.action.ActionString(E.countries,M,this.currentGame,E.amount);O.length>0&&(O=O.charAt(0).toLowerCase()+O.slice(1)),T=`I think, ${O} would be a good idea.`}if(m.innerHTML=T,m.style.display="block",m.style.opacity="1",E){this.currentGame&&(this.currentGame.advisedOpportunity=E);const{runAdvisorAnimation:O}=await ge(async()=>{const{runAdvisorAnimation:D}=await import("./AdvisorAnimation-DpQpr7s9.js");return{runAdvisorAnimation:D}},[]);this.isAdvisorAnimationRunning=!0,console.log("[Advisor] Starting advisor animation"),await O(this,E),this.isAdvisorAnimationRunning=!1}setTimeout(()=>{m.style.opacity="0",setTimeout(()=>m.style.display="none",5e3)},5e3)});const N=document.createElement("img");N.src="Advisor.png",N.alt="Advisor",N.style.maxWidth="100%",N.style.maxHeight="144px",N.style.objectFit="contain",N.style.borderRadius="6px",C.appendChild(N)}setClickedCountryNames(e){this.clickedCountryNames=e}};v(be,"_instance",null);let me=be;function jt(A,e){const t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.zIndex="10000",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.pointerEvents="none",t.style.overflow="hidden";const n=document.createElement("div");n.innerText="Armchair",n.style.position="relative",n.style.color="#fffbe6",n.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',n.style.fontSize="6vw",n.style.fontWeight="bold",n.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",n.style.letterSpacing="0.18em",n.style.opacity="0",n.style.transform="translateX(-120%) skew(-12deg)",n.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",n.style.filter="drop-shadow(0 0 12px #fffbe6)",n.style.background="",n.style.webkitBackgroundClip="",n.style.backgroundClip="",n.style.webkitTextFillColor="";const o=document.createElement("div");o.innerText="General",o.style.position="relative",o.style.color="#fffbe6",o.style.fontFamily='"Cinzel Decorative", "Old English Text MT", "UnifrakturCook", "Times New Roman", serif',o.style.fontSize="6vw",o.style.fontWeight="bold",o.style.textShadow="0 0 60px #b22222, 0 0 16px #fffbe6, 0 0 8px #bfa76f, 0 0 2px #fff, 0 4px 24px #b22222, 0 0 32px #ffd700",o.style.letterSpacing="0.18em",o.style.opacity="0",o.style.transform="translateX(120%) skew(12deg)",o.style.transition="opacity 0.7s, transform 1.7s cubic-bezier(0.22,1,0.36,1)",o.style.filter="drop-shadow(0 0 12px #fffbe6)",o.style.background="",o.style.webkitBackgroundClip="",o.style.backgroundClip="",o.style.webkitTextFillColor="";const r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.justifyContent="center",r.style.gap="1vw",r.style.pointerEvents="none",r.appendChild(n),r.appendChild(o),t.appendChild(r),A.appendChild(t);const i=document.createElement("canvas");i.width=A.offsetWidth||800,i.height=A.offsetHeight||600,i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",t.appendChild(i);const s=i.getContext("2d"),a=10,l=[];i.width/2;const c=i.height*.8;for(let h=0;h<a;h++){const g=h%2===0?i.width*.05:i.width*.95,w=i.width*(.15+.7*Math.random()),f=c-i.height*.25+Math.random()*i.height*.1,m=c-i.height*.05+Math.random()*i.height*.18,b=1200+Math.random()*400,C=i.height*(.32+Math.random()*.12);l.push({startX:g,startY:f,endX:w,endY:m,duration:b,startTime:null,exploded:!1,explosionTime:null,arcHeight:C})}function d(h,x,g){s&&(s.save(),s.beginPath(),s.arc(h,x,18*g,0,2*Math.PI),s.fillStyle="rgba(40,40,40,0.95)",s.shadowColor="#222",s.shadowBlur=12*g,s.fill(),s.restore(),s.save(),s.beginPath(),s.arc(h-6*g,x-6*g,5*g,0,2*Math.PI),s.fillStyle="rgba(200,200,200,0.18)",s.fill(),s.restore())}function u(h,x,g){if(s){if(g<.15){const w=38+60*g;s.save(),s.beginPath(),s.arc(h,x,w,0,2*Math.PI),s.fillStyle=`rgba(255,255,220,${.7*(1-g/.15)})`,s.shadowColor="#fffbe6",s.shadowBlur=48,s.fill(),s.restore()}if(g<.6){const w=32+80*g;s.save(),s.beginPath(),s.arc(h,x,w,0,2*Math.PI),s.fillStyle=`rgba(255,120,40,${.5*(1-g/.6)})`,s.shadowColor="#ffae42",s.shadowBlur=32,s.fill(),s.restore(),s.save(),s.beginPath(),s.arc(h,x,w*.5,0,2*Math.PI),s.fillStyle=`rgba(255,220,120,${.7*(1-g/.6)})`,s.shadowColor="#fffbe6",s.shadowBlur=16,s.fill(),s.restore()}if(g>.2){const w=(g-.2)/.8;for(let f=0;f<4;f++){const m=Math.PI*2*(f/4)+Math.random()*.2,b=38+60*g+Math.random()*10,C=h+Math.cos(m)*b*.7*w,k=x+Math.sin(m)*b*.5*w+10*w;s.save(),s.beginPath(),s.arc(C,k,18+18*w,0,2*Math.PI),s.fillStyle=`rgba(80,60,40,${.18*(1-w)})`,s.shadowColor="#222",s.shadowBlur=8,s.fill(),s.restore()}}}}function y(h){s.clearRect(0,0,i.width,i.height);let x=!0;for(const g of l){g.startTime||(g.startTime=h);const w=h-g.startTime;if(g.exploded){if(g.explosionTime&&h-g.explosionTime<700){const f=(h-g.explosionTime)/700;u(g.endX,g.endY,f),x=!1}}else{x=!1;const f=Math.min(w/g.duration,1),m=g.startX+(g.endX-g.startX)*f,b=(1-f)*g.startY+f*g.endY-g.arcHeight*4*f*(1-f),C=.9+.3*(1-Math.abs(2*f-1));d(m,b,C),f>=1&&(g.exploded=!0,g.explosionTime=h)}}x||requestAnimationFrame(y)}requestAnimationFrame(y),setTimeout(()=>{n.style.opacity="1",n.style.transform="translateX(0) skew(0)",o.style.opacity="1",o.style.transform="translateX(0) skew(0)"},400),setTimeout(()=>{},3200);const p=document.createElement("link");p.rel="stylesheet",p.href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=UnifrakturCook:wght@700&display=swap",document.head.appendChild(p)}const Ut="/Armchair-General/Balloon.png",$e=Array.from("Futuremagic-Productions"),Re=$e.length,rt=.18,st=192,it=32,Fe=80,at=Fe+80,Yt=1980;let xe=rt,Se=st,Je=it,H=Fe,ve=at,Qe=.12;function Xt(A,e){const t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.zIndex="10000",t.style.pointerEvents="none",t.style.overflow="hidden",A.appendChild(t);const n=document.createElement("canvas");n.width=A.offsetWidth||800,n.height=A.offsetHeight||600,n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",t.appendChild(n);const o=n.getContext("2d"),r=n.width/Yt;xe=rt*r,Se=st*r,Je=it*r,H=Fe*r,ve=at*r,Qe=.12;const i=new window.Image;i.src=Ut,i.onload=()=>{w()};let s,a;const l=Math.floor(Math.random()*4),c=H+Math.random()*(n.width-2*H),d=H+Math.random()*(n.height-2*H);l===0?(s={x:-n.width*.2,y:d},a=Math.atan2(d-s.y,c-s.x)):l===1?(s={x:n.width+n.width*.2,y:d},a=Math.atan2(d-s.y,c-s.x)):l===2?(s={x:c,y:-n.height*.2},a=Math.atan2(d-s.y,c-s.x)):(s={x:c,y:n.height+n.height*.2},a=Math.atan2(d-s.y,c-s.x));let u=!1;const y=1,p=[],h=Math.ceil((Re+2)*Se);let x=xe;const g=.002;function w(){performance.now();function f(m){let b=!1;const C=Je;if(s.x<C||s.x>n.width-C||s.y<C||s.y>n.height-C){const F=n.width/2-s.x,R=n.height/2-s.y,U=(Math.atan2(R,F)-a+Math.PI*3)%(Math.PI*2)-Math.PI;a+=U*.04,b=!0}if(!b){let F=!1,R=null;if((s.x<ve||s.x>n.width-ve||s.y<ve||s.y>n.height-ve)&&(R={x:Math.max(H,Math.min(n.width-H,s.x)),y:Math.max(H,Math.min(n.height-H,s.y))},F=!0),F&&R){const G=n.width/2,U=n.height/2,Z=(Math.atan2(U-s.y,G-s.x)-a+Math.PI*3)%(Math.PI*2)-Math.PI;a+=Z*.04}else{const G=m*Qe*.001;a+=Math.sin(G*.5)*.005}}s.x+=Math.cos(a)*y,s.y+=Math.sin(a)*y,u?(s.x<H&&(s.x=H),s.x>n.width-H&&(s.x=n.width-H),s.y<H&&(s.y=H),s.y>n.height-H&&(s.y=n.height-H)):s.x>=H&&s.x<=n.width-H&&s.y>=H&&s.y<=n.height-H&&(u=!0);const k=performance.now()*12e-6%1,S=k*Math.PI*2,P=k*Math.PI*2*.73+1.7,N=k*Math.PI*2*.41+2.3,M=.18*Math.sin(P)+.12*Math.sin(S*1.31+.9)+.09*Math.sin(N);let E=xe*(.7+.6*(.5+.5*Math.sin(S)+M)),T=E-x;Math.abs(T)>g&&(E=x+Math.sign(T)*g);let I=x+(E-x)*.18;const O=I-x;Math.abs(O)>g&&(I=x+Math.sign(O)*g),x=I,p.unshift({x:s.x,y:s.y,dir:a,scale3d:I}),p.length>h&&p.pop(),o.clearRect(0,0,n.width,n.height);const D=[];for(let F=0;F<Re;++F){const R=Math.floor(F*Se),G=p[R]||p[p.length-1]||{x:s.x,y:s.y,scale3d:xe},U=G.scale3d,B=i.height*U;D.push({x:G.x,y:G.y-B*.1})}o.save(),o.strokeStyle="#bfa76f",o.lineWidth=2,o.shadowColor="#fffbe6",o.shadowBlur=6,o.beginPath();for(let F=0;F<D.length-1;++F){const R=D[F],G=D[F+1],U=(R.x+G.x)/2,B=(R.y+G.y)/2,Z=Math.hypot(G.x-R.x,G.y-R.y),$=performance.now()*.001,ee=18+12*Math.sin($+F*.7),ie=Z*.18+ee,ae=U,fe=B+ie;F===0&&o.moveTo(R.x,R.y),o.quadraticCurveTo(ae,fe,G.x,G.y)}o.stroke(),o.shadowBlur=0,o.restore();const z=[];for(let F=0;F<Re;++F){const R=Math.floor(F*Se),G=p[R]||p[p.length-1]||{x:s.x,y:s.y,scale3d:xe};z.push({i:F,x:G.x,y:G.y,scale3d:G.scale3d})}z.sort((F,R)=>F.scale3d-R.scale3d);for(const F of z){const{i:R,x:G,y:U,scale3d:B}=F,Z=i.width*B,$=i.height*B;o.save(),o.globalAlpha=.98,o.drawImage(i,G-Z/2,U-$,Z,$),o.font=`bold ${Math.round(256*B)}px Cinzel, Arial, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillStyle="orange",o.strokeStyle="#fffbe6",o.lineWidth=2.2,o.shadowColor="orange",o.shadowBlur=24*B,o.strokeText($e[R],G,U-$*.55),o.fillText($e[R],G,U-$*.55),o.shadowBlur=0,o.restore()}requestAnimationFrame(f)}requestAnimationFrame(f)}setTimeout(()=>{},8e3)}const Ie=document.getElementById("app");if(Ie)Ie.innerHTML="",new me().mount(Ie),setTimeout(()=>{const e=Ie.querySelector('div[style*="flex: 3"]');e&&(Xt(e),jt(e))},0);else throw new Error("No app element found in index.html");export{Ce as C,he as P,Me as R,Be as W};
